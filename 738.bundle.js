"use strict";(self.webpackChunkdivinecraft=self.webpackChunkdivinecraft||[]).push([[738],{89569:(t,e,s)=>{s.d(e,{J:()=>i});class i{static Create(){return[1,0,0,0,1,0,0,0,1]}static Add(t,e){return t.map(((t,s)=>t+e[s]))}static AddToRef(t,e,s){t.forEach(((t,i)=>s[i]=t+e[i]))}static Multiply(t,e){const s=new Array(9);for(let i=0;i<3;i++)for(let r=0;r<3;r++){s[3*i+r]=0;for(let a=0;a<3;a++)s[3*i+r]+=t[3*i+a]*e[3*a+r]}return s}static MultiplyToRef(t,e,s){for(let i=0;i<3;i++)for(let r=0;r<3;r++){s[3*i+r]=0;for(let a=0;a<3;a++)s[3*i+r]+=t[3*i+a]*e[3*a+r]}}static Transpose(t){return[t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]]}static TransposeToRef(t,e){[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]=[t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]]}static Inverse(t){const e=t[0]*(t[4]*t[8]-t[7]*t[5])-t[1]*(t[3]*t[8]-t[6]*t[5])+t[2]*(t[3]*t[7]-t[6]*t[4]);if(0===e)return null;const s=1/e;return[(t[4]*t[8]-t[7]*t[5])*s,(t[2]*t[7]-t[1]*t[8])*s,(t[1]*t[5]-t[2]*t[4])*s,(t[5]*t[6]-t[3]*t[8])*s,(t[0]*t[8]-t[2]*t[6])*s,(t[2]*t[3]-t[0]*t[5])*s,(t[3]*t[7]-t[4]*t[6])*s,(t[1]*t[6]-t[0]*t[7])*s,(t[0]*t[4]-t[1]*t[3])*s]}static InverseToRef(t,e){const s=this.Inverse(t);return null!==s&&(s.forEach(((t,s)=>e[s]=t)),!0)}static RotationX(t){const e=Math.cos(t),s=Math.sin(t);return[1,0,0,0,e,-s,0,s,e]}static RotationY(t){const e=Math.cos(t),s=Math.sin(t);return[e,0,s,0,1,0,-s,0,e]}static RotationZ(t){const e=Math.cos(t),s=Math.sin(t);return[e,-s,0,s,e,0,0,0,1]}static Scaling(t,e,s){return[t,0,0,0,e,0,0,0,s]}static Transform(t,e,s){return[1,0,0,0,1,0,t,e,s]}static ApplyMatrix(t,e){return{x:t[0]*e.x+t[1]*e.y+t[2]*e.z,y:t[3]*e.x+t[4]*e.y+t[5]*e.z,z:t[6]*e.x+t[7]*e.y+t[8]*e.z}}static ApplyMatrixArray(t,e){return[t[0]*e[0]+t[1]*e[1]+t[2]*e[2],t[3]*e[0]+t[4]*e[1]+t[5]*e[2],t[6]*e[0]+t[7]*e[1]+t[8]*e[2]]}}},68823:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(89569);const r=t=>t>=0?2*t:-2*t-1,a=(t,e)=>(t+e)*(t+e+1)/2+e;class n{x;y;z;static Create(t=0,e=0,s=0){return new n(t,e,s)}static HashXYZ(t,e,s){const i=r(t),n=r(e),o=r(s),c=a(i,n);return a(c,o)}static Hash(t){return this.HashXYZ(t.x,t.y,t.z)}static HashArray(t){return this.HashXYZ(t[0],t[1],t[2])}static ApplyMatrix(t,e){return i.J.ApplyMatrix(t,e)}static ApplyMatrixArray(t,e){return i.J.ApplyMatrixArray(t,e)}static RotateAroundPivot(t,e,s){const i={x:e.x-s.x,y:e.y-s.y,z:e.z-s.z},r=n.ApplyMatrix(t,i);return{x:r.x+s.x,y:r.y+s.y,z:r.z+s.z}}static RotateAroundPivotArray(t,e,s){const i=[e[0]-s[0],e[1]-s[1],e[2]-s[2]],r=n.ApplyMatrixArray(t,i);return[r[0]+s[0],r[1]+s[1],r[2]+s[2]]}static FloorInPlace(t){return t.x=Math.floor(t.x),t.y=Math.floor(t.y),t.z=Math.floor(t.z),t}static FloorArrayInPlace(t){return t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.floor(t[2]),t}static RoundArrayInPlaceToScalar(t,e){return t[0]=Math.round(t[0]*e)/e,t[1]=Math.round(t[1]*e)/e,t[2]=Math.round(t[2]*e)/e,t}static Add(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}}static AddToRef(t,e,s){s.x=t.x+e.x,s.y=t.y+e.y,s.z=t.z+e.z}static AddInPlace(t,e){t.x+=e.x,t.y+=e.y,t.z+=e.z}static AddArray(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2]]}static AddArrayToRef(t,e,s){s[0]=t[0]+e[0],s[1]=t[1]+e[1],s[2]=t[2]+e[2]}static AddArrayInPlace(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}static AddScalar(t,e){return{x:t.x+e,y:t.y+e,z:t.z+e}}static AddScalarToRef(t,e,s){s.x=t.x+e,s.y=t.y+e,s.z=t.z+e}static AddScalarInPlace(t,e){t.x+=e,t.y+=e,t.z+=e}static AddScalarArray(t,e){return[t[0]+e,t[1]+e,t[2]+e]}static AddScalarArrayToRef(t,e,s){s[0]=t[0]+e,s[1]=t[1]+e,s[2]=t[2]+e}static AddScalarArrayInPlace(t,e){t[0]+=e,t[1]+=e,t[2]+=e}static Subtract(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}}static SubtractToRef(t,e,s){s.x=t.x-e.x,s.y=t.y-e.y,s.z=t.z-e.z}static SubtractInPlace(t,e){return t.x-=e.x,t.y-=e.y,t.z-=e.z,t}static SubtractArray(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}static SubtractArrayToRef(t,e,s){s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2]}static SubtractArrayInPlace(t,e){t[0]-=e[0],t[1]-=e[1],t[2]-=e[2]}static SubtractScalar(t,e){return{x:t.x-e,y:t.y-e,z:t.z-e}}static SubtractScalarToRef(t,e,s){s.x=t.x-e,s.y=t.y-e,s.z=t.z-e}static SubtractScalarInPlace(t,e){t.x-=e,t.y-=e,t.z-=e}static SubtractScalarArray(t,e){return[t[0]-e,t[1]-e,t[2]-e]}static SubtractScalarArrayToRef(t,e,s){s[0]=t[0]-e,s[1]=t[1]-e,s[2]=t[2]-e}static SubtractScalarArrayInPlace(t,e){t[0]-=e,t[1]-=e,t[2]-=e}static Multiply(t,e){return{x:t.x*e.x,y:t.y*e.y,z:t.z*e.z}}static MultiplyToRef(t,e,s){s.x=t.x*e.x,s.y=t.y*e.y,s.z=t.z*e.z}static MultiplyInPlace(t,e){t.x*=e.x,t.y*=e.y,t.z*=e.z}static MultiplyArray(t,e){return[t[0]*e[0],t[1]*e[1],t[2]*e[2]]}static MultiplyArrayToRef(t,e,s){s[0]=t[0]*e[0],s[1]=t[1]*e[1],s[2]=t[2]*e[2]}static MultiplyArrayInPlace(t,e){t[0]*=e[0],t[1]*=e[1],t[2]*=e[2]}static MultiplyScalar(t,e){return{x:t.x*e,y:t.y*e,z:t.z*e}}static MultiplyScalarToRef(t,e,s){s.x=t.x*e,s.y=t.y*e,s.z=t.z*e}static MultiplyScalarInPlace(t,e){t.x*=e,t.y*=e,t.z*=e}static MultiplyScalarArray(t,e){return[t[0]*e,t[1]*e,t[2]*e]}static MultiplyScalarArrayToRef(t,e,s){s[0]=t[0]*e,s[1]=t[1]*e,s[2]=t[2]*e}static MultiplyScalarArrayInPlace(t,e){t[0]*=e,t[1]*=e,t[2]*=e}static Divide(t,e){return{x:t.x/e.x,y:t.y/e.y,z:t.z/e.z}}static DivideToRef(t,e,s){s.x=t.x/e.x,s.y=t.y/e.y,s.z=t.z/e.z}static DivideInPlace(t,e){return t.x/=e.x,t.y/=e.y,t.z/=e.z,t}static DivideArray(t,e){return[t[0]/e[0],t[1]/e[1],t[2]/e[2]]}static DivideArrayToRef(t,e,s){s[0]=t[0]/e[0],s[1]=t[1]/e[1],s[2]=t[2]/e[2]}static DivideArrayInPlace(t,e){t[0]/=e[0],t[1]/=e[1],t[2]/=e[2]}static DivideScalar(t,e){return{x:t.x/e,y:t.y/e,z:t.z/e}}static DivideScalarToRef(t,e,s){s.x=t.x/e,s.y=t.y/e,s.z=t.z/e}static DivideScalarInPlace(t,e){t.x/=e,t.y/=e,t.z/=e}static DivideScalarArray(t,e){return[t[0]/e,t[1]/e,t[2]/e]}static DivideScalarArrayToRef(t,e,s){s[0]=t[0]/e,s[1]=t[1]/e,s[2]=t[2]/e}static DivideScalarArrayInPlace(t,e){t[0]/=e,t[1]/=e,t[2]/=e}static Dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static DotArray(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}static Cross(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}}static CrossToRef(t,e,s){s.x=t.y*e.z-t.z*e.y,s.y=t.z*e.x-t.x*e.z,s.z=t.x*e.y-t.y*e.x}static CrossInPlace(t,e){const s=t.y*e.z-t.z*e.y,i=t.z*e.x-t.x*e.z,r=t.x*e.y-t.y*e.x;t.x=s,t.y=i,t.z=r}static CrossArray(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}static CrossArrayToRef(t,e,s){s[0]=t[1]*e[2]-t[2]*e[1],s[1]=t[2]*e[0]-t[0]*e[2],s[2]=t[0]*e[1]-t[1]*e[0]}static CrossArrayInPlace(t,e){const s=t[1]*e[2]-t[2]*e[1],i=t[2]*e[0]-t[0]*e[2],r=t[0]*e[1]-t[1]*e[0];t[0]=s,t[1]=i,t[2]=r}static Length(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}static LengthArray(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}static Normalize(t){const e=n.Length(t);return 0===e?{x:0,y:0,z:0}:{x:t.x/e,y:t.y/e,z:t.z/e}}static NormalizeToRef(t,e){const s=n.Length(t);0===s?(e.x=0,e.y=0,e.z=0):(e.x=t.x/s,e.y=t.y/s,e.z=t.z/s)}static NormalizeInPlace(t){const e=n.Length(t);0===e?(t.x=0,t.y=0,t.z=0):(t.x/=e,t.y/=e,t.z/=e)}static NormalizeArray(t){const e=n.LengthArray(t);return 0===e?[0,0,0]:[t[0]/e,t[1]/e,t[2]/e]}static NormalizeArrayToRef(t,e){const s=n.LengthArray(t);0===s?(e[0]=0,e[1]=0,e[2]=0):(e[0]=t[0]/s,e[1]=t[1]/s,e[2]=t[2]/s)}static NormalizeArrayInPlace(t){const e=n.LengthArray(t);0===e?(t[0]=0,t[1]=0,t[2]=0):(t[0]/=e,t[1]/=e,t[2]/=e)}static Distance(t,e){return n.Length(n.Subtract(t,e))}static DistanceArray(t,e){return n.LengthArray(n.SubtractArray(t,e))}static Lerp(t,e,s){return{x:t.x+s*(e.x-t.x),y:t.y+s*(e.y-t.y),z:t.z+s*(e.z-t.z)}}static LerpToRef(t,e,s,i){i.x=t.x+s*(e.x-t.x),i.y=t.y+s*(e.y-t.y),i.z=t.z+s*(e.z-t.z)}static LerpInPlace(t,e,s){t.x+=s*(e.x-t.x),t.y+=s*(e.y-t.y),t.z+=s*(e.z-t.z)}static LerpArray(t,e,s){return[t[0]+s*(e[0]-t[0]),t[1]+s*(e[1]-t[1]),t[2]+s*(e[2]-t[2])]}static LerpArrayToRef(t,e,s,i){i[0]=t[0]+s*(e[0]-t[0]),i[1]=t[1]+s*(e[1]-t[1]),i[2]=t[2]+s*(e[2]-t[2])}static LerpArrayInPlace(t,e,s){t[0]+=s*(e[0]-t[0]),t[1]+=s*(e[1]-t[1]),t[2]+=s*(e[2]-t[2])}static Negate(t){return{x:-t.x,y:-t.y,z:-t.z}}static NegateToRef(t,e){e.x=-t.x,e.y=-t.y,e.z=-t.z}static NegateInPlace(t){t.x=-t.x,t.y=-t.y,t.z=-t.z}static NegateArray(t){return[-t[0],-t[1],-t[2]]}static NegateArrayToRef(t,e){e[0]=-t[0],e[1]=-t[1],e[2]=-t[2]}static NegateArrayInPlace(t){t[0]=-t[0],t[1]=-t[1],t[2]=-t[2]}static Equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}static EqualsArray(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}static Clone(t){return{x:t.x,y:t.y,z:t.z}}static CloneArray(t){return[t[0],t[1],t[2]]}static Copy(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t}static CopyArray(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}static CopyFromArray(t,e){return t.x=e[0],t.y=e[1],t.z=e[2],t}static CopyIntoArray(t,e){return t[0]=e.x,t[1]=e.y,t[2]=e.z,t}static ToArray(t){return[t.x,t.y,t.z]}static FromArray(t){return new n(t[0],t[1],t[2])}constructor(t,e,s){this.x=t,this.y=e,this.z=s}}},98296:(t,e,s)=>{s.d(e,{E:()=>o,z:()=>h});var i=s(2341),r=s(45238),a=s(92149);let n=0;class o{static INTERNAL_CODE="__internal__";static _tasks=new Map;static _waiting=new Map;static getTasks(t){return this._tasks.get(t)||!1}static isInternal(t){return!!Array.isArray(t)&&t[0]==o.INTERNAL_CODE&&"number"==typeof t[1]&&!!c[t[1]]}static getInternal(t){return!!c[t[1]]&&c[t[1]]}static runInternal(t,e,s){const i=this.getInternal(t);i&&i(t,e,s)}static getPromiseId(){return n++,n}static addPromiseTakss(t,e,s){let i=this._waiting.get(t);i||(i=new Map,this._waiting.set(t,i)),i.set(e,s)}static completePromiseTasks(t,e,s){let i=this._waiting.get(t);if(!i)return;const r=i.get(e);i.delete(e),r&&r(s)}}const c={[i.g.connectPort]:(t,e,s)=>{const i=t[2],a=i[0],n=i[1];let o;if(o="browser"==r.Q.environment?s.ports[0]:i[2],"worker"==n){const t=r.Q.getThread(a);t&&t.setPort(o)}if("worker"!=n){const t=r.Q.getThreadPool(n);t&&t.addPort(o)}},[i.g.setReady]:(t,e)=>{const s=t[2];a.j.readySet.add(e),e.name=s[0],e.index=s[1]},[i.g.runTask]:async(t,e,s)=>{const i=t[2],a=i[0],n=o.getTasks(a);if(!n)return void console.warn(`Tried running task ${a} | Thread ${r.Q.threadName} | Origin Thread ${e.name}`);const c=i[1],d=n(i[2],e,s);if(c<0)return;let l=null;l=d instanceof Promise?await d:d;let u=null,g=null;Array.isArray(l)&&(u=l[0],g=l[1]),h.completeTasks[2][0]=a,h.completeTasks[2][1]=c,h.completeTasks[2][2]=u,e.sendMessage(h.completeTasks,g),h.completeTasks[2][2]=null},[i.g.completeTasks]:(t,e)=>{const s=t[2],i=s[0],r=s[1],a=s[2];o.completePromiseTasks(i,r,a)},[i.g.checkTasks]:(t,e)=>{const s=t[2];h.cehckTasksResult[2][0]=!!o.getTasks(s[0]),h.cehckTasksResult[2][1]=s[1],e.sendMessage(h.cehckTasksResult)},[i.g.checkTasksResult]:t=>{const e=t[2][0],s=t[2][1];o.completePromiseTasks("tasks-check",s,e)}},h={runTask:[o.INTERNAL_CODE,i.g.runTask,["",0,null]],completeTasks:[o.INTERNAL_CODE,i.g.completeTasks,["",0,null]],checkTasks:[o.INTERNAL_CODE,i.g.checkTasks,["",0]],cehckTasksResult:[o.INTERNAL_CODE,i.g.checkTasksResult,[!1,0]]}},2341:(t,e,s)=>{var i;s.d(e,{g:()=>i}),function(t){t[t.setReady=0]="setReady",t[t.connectPort=1]="connectPort",t[t.runTask=2]="runTask",t[t.completeTasks=3]="completeTasks",t[t.checkTasks=4]="checkTasks",t[t.checkTasksResult=5]="checkTasksResult"}(i||(i={}))},45238:(t,e,s)=>{s.d(e,{Q:()=>o});var i=s(92149),r=s(5767),a=s(98296);let n=!1;class o{static threadNumber=0;static threadName="unamed-threadcomm-thread";static environment="browser";static _threads=new Map;static _threadPools=new Map;static parent=new i.j("parent",0);static get isInitalized(){return n}static async init(t,e,s="window"){this.threadName=t,this.parent.name=s,this.parent.setPort(e),n=!0,this.addThread(this.parent)}static addThread(t){this._threads.set(t.name,t)}static createThread(t,e={}){const s=Object.assign(new i.j(t,0),e);return this._threads.set(t,s),s}static createThreadPool(t){const e=new r.p(t);return this._threadPools.set(t,e),e}static getThread(t){return this._threads.get(t)||null}static getThreadPool(t){return this._threadPools.get(t)||null}static registerTask(t,e){a.E._tasks.set(t,e)}}"undefined"!=typeof process&&"undefined"==typeof Worker&&"undefined"==typeof window&&(o.environment="node")},62567:(t,e,s)=>{s.d(e,{QK:()=>i.Q,jV:()=>r.j,pX:()=>a.p});var i=s(45238),r=s(92149),a=s(5767)},24042:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(62567),r=s(4974),a=s(50489),n=s(46558),o=s(13163),c=s(83066);function h(t){i.QK.registerTask("sync-data",(e=>{r.i.syncSettings(e.settings),o.A.voxels.load(e.voxels.data.palette),c.L.VoxelTags=e.voxels.data.tags,o.A.voxelIdToNameMap=new Map(e.voxels.data.idToNameMap),o.A.voxelNametoIdMap=new Map(e.voxels.data.nameToIdMap),o.A.substance.load(e.voxels.substances.palette),c.L.SubstanceStags=e.voxels.substances.tags,o.A.material.load(e.voxels.materials.palette);const s=e.voxels.models;for(const t of s.models)a.r.registerModel(t.id,t.schema);for(const t of s.voxels)a.r.registerVoxel(t.id,t.modelId,t.modSchema);n.B.load(s.tagState),t.onSync(e)}))}},82323:(t,e,s)=>{s.d(e,{Q:()=>r});var i=s(62567);class r{threadMap=new Map;_threads=[];constructor(){self.addEventListener("beforeunload",(()=>{for(const t of this._threads)t instanceof i.pX&&t.destroyAll(),t instanceof i.jV&&t.destroy()}))}setThreadPort(t,e){const s=this.getThread(t);if(s instanceof i.pX){if(!Array.isArray(e))throw new Error("Thread is a pool and needs an array of ports");for(const t of e)s.addPort(t)}else if(s instanceof i.jV){if(Array.isArray(e))throw new Error("Thread is a single thread and needs one port.");s.setPort(e)}}addThread(t){this.threadMap.set(t.name,t),this._threads.push(t)}getThread(t){const e=this.threadMap.get(t);if(!e)throw new Error(`Thread with id ${t} does not exists`);return e}}},13632:(t,e,s)=>{s.d(e,{BN:()=>o,WS:()=>r,bv:()=>n,pN:()=>a});var i=s(61e3);function r(t,e,s,i,r,a,n=[0,0,0]){return n[0]=t>>i<<i,n[1]=e>>r<<r,n[2]=s>>a<<a,n}function a(t,e,s,r,a,n,o=i.Az.Create()){return o.x=t>>r<<r,o.y=e>>a<<a,o.z=s>>n<<n,o}function n(t,e,s,r,a=i.Az.Create()){return a.y=Math.floor(t/(e*r)),a.x=Math.floor(t%(e*r)/r),a.z=t%r,a}function o(t,e,s,i,r,a){return Math.floor(s+a*(t+i*e))}},4974:(t,e,s)=>{s.d(e,{i:()=>o});var i=s(9609),r=s(32005),a=s(61803);class n extends a.m{enviorment=r.O.isNode()?"node":"browser";settings=new i.ih;get doSunPropagation(){return 1==this.settings.lighting.autoSunLight}get doRGBPropagation(){return 1==this.settings.lighting.autoRGBLight}get doLight(){return this.doRGBPropagation||this.doSunPropagation}get doFlow(){return this.settings.flow.enable}get isClient(){return"browser"!=this.enviorment}getSettings(){return this.settings}syncSettings(t){for(const e of Object.keys(t)){if(e.includes("__"))throw new Error("Can not include properties with multpile underscores.");if(void 0!==this.settings[e])for(const s of Object.keys(t[e])){if(s.includes("__"))throw new Error("Can not include properties with multpile underscores.");void 0!==this.settings[e][s]&&(this.settings[e][s]=t[e][s])}}this.dispatch("synced",{settings:this})}getSettingsCopy(){return JSON.parse(JSON.stringify(this.settings))}}const o=new n},9609:(t,e,s)=>{s.d(e,{ih:()=>g});var i=s(61e3);class r{mode="webgl";cpuBound=!1}class a{textureSize=16}class n{autoRebuild=!0}class o{min=i.Az.Create(-Number.MAX_SAFE_INTEGER,0,-Number.MAX_SAFE_INTEGER);max=i.Az.Create(Number.MAX_SAFE_INTEGER,256,Number.MAX_SAFE_INTEGER)}class c{power2Size=i.Az.Create(4,8,4)}class h{power2Size=i.Az.Create(4,4,4)}class d{doColors=!0}class l{enable=!0;baseFlowLimit=200}class u{doAO=!0;doSunLight=!0;doRGBLight=!0;autoRGBLight=!0;autoSunLight=!0}class g{rendererSettings=new r;textures=new a;updating=new n;world=new o;sectors=new c;sections=new h;voxels=new d;flow=new l;lighting=new u}},40892:(t,e,s)=>{s.d(e,{s:()=>i});class i{}},20330:(t,e,s)=>{function i(t,e){const s=e/8|0;return function(t,e){return(1<<e&t)>>>e}(t[s],e-8*s)}function r(t,e,s){const i=e/8|0;t[i]=function(t,e,s){return t&~(1<<e)|(1&s)<<e}(t[i],e-8*i,s)}s.d(e,{JU:()=>r,Tv:()=>i})},32005:(t,e,s)=>{s.d(e,{O:()=>i});class i{static isNode(){return"undefined"!=typeof process&&process.versions&&!!process.versions.node}static isBrowser(){return!this.isNode()}}},76132:(t,e,s)=>{s.d(e,{N:()=>i});class i{_count=0;_palette=[];_map={};constructor(t){if(t){const e=t.length;for(let s=0;s<e;s++)this.register(t[s])}}get size(){return this._count}load(t){this._palette=[],this._map={};const e=t.length;for(let s=0;s<e;s++)this.register(t[s])}register(t){const e=this._count;return this._count++,this._palette[e]=t,this._map[t]=e,e}get(){return this._palette}getMap(){return this._map}isRegistered(t){return void 0!==this._map[t]}getNumberId(t){return this._map[t]}getStringId(t){return this._palette[t]}}},61803:(t,e,s)=>{s.d(e,{m:()=>i});class i extends EventTarget{addEventListener(t,e,s){super.addEventListener(t,e,s)}removeEventListener(t,e){super.removeEventListener(t,e)}dispatch(t,e){return super.dispatchEvent(new CustomEvent(t,{detail:e})),!0}}},27051:(t,e,s)=>{s.d(e,{S:()=>h});var i=s(96914),r=s(81847),a=s(46558),n=s(27219),o=s(83066),c=s(13163);class h{_loadedId=0;id=0;secondaryId=0;_tags;_substanceTags;__secondary=!1;_index=0;_lightData=new i.$;process(){this.id=this.ids[this._index],this.secondaryId=this.secondary[this._index],this.secondaryId>1?this.id=this.secondaryId:this.secondaryId=0,this._loadedId=this.getId(),this._tags=o.L.VoxelTags[this._loadedId],this._substanceTags=o.L.SubstanceStags[c.A.substance.getNumberId(this._tags.dve_substance)]}setSecondary(t){return this.__secondary=t,n.x,o.L,this._loadedId=this.getId(),this}getRenderedMaterial(){return this._tags[n.x.renderedMaterial]}getMaterial(){return this._tags[n.x.voxelMaterial]}checkCollisions(){return this._tags[n.x.checkCollisions]}getCollider(){return this._tags[n.x.colliderID]}getSubstance(){return this._tags[n.x.substance]}getSubstanceData(){return this._substanceTags}isOpaque(){return!this._tags[n.x.isTransparent]}getMod(){return this.mod[this._index]}setMod(t){return this.mod[this._index]=t,this}getLevel(){return r.o.getLevel(this.level[this._index])}setLevel(t){return this.level[this._index]=r.o.setLevel(this.level[this._index],t),this}getLevelState(){return r.o.getLevelState(this.level[this._index])}setLevelState(t){return this.level[this._index]=r.o.setLevelState(this.level[this._index],t),this}getState(){return this.state[this._index]}setState(t){return this.state[this._index]=t,this}hasSecondaryVoxel(){return this.secondaryId>1}canHaveSecondaryVoxel(){return this._tags[n.x.canHaveSecondary]}hasRGBLight(){const t=this.getLight();return this._lightData.hasRGBLight(t)}hasSunLight(){const t=this.getLight();return this._lightData.hasSunLight(t)}getLight(){return 0==this._loadedId?this.light[this._index]:this.isOpaque()?this.isLightSource()?this._tags[n.x.lightValue]:-1:this.isLightSource()?this._lightData.mixLight(this.light[this._index],this._tags[n.x.lightValue]):this.light[this._index]}setLight(t){return this.light[this._index]=t,this}isLightSource(){return!(this._loadedId<=0)&&(a.B.isRegistered(this._loadedId,n.x.isLightSource)?!0===a.B.getValue(this._loadedId,n.x.isLightSource,this.getState()):this._tags[n.x.isLightSource])}getLightSourceValue(){return this._loadedId<=0?0:this._tags[n.x.lightValue]}noAO(){return!(this._loadedId<=0)&&this._tags[n.x.noAO]}isRenderable(){return this.id>0||!!(this.canHaveSecondaryVoxel()&&this.secondary[this._index]>0)}isAir(){return 0==this.ids[this._index]}setAir(){return this.ids[0]=0,this}getId(){return this.__secondary?this.secondaryId:this.id}setId(t){return this.__secondary?(this.secondary[this._index]=t,this):(this.ids[this._index]=t,this)}setStringId(t){return this.setId(c.A.voxels.getNumberId(t))}getStringId(){return this.__secondary?c.A.voxels.getStringId(this.secondaryId):c.A.voxels.getStringId(this.id)}setName(t){this.setStringId(c.A.voxelName.getId(t))}getName(){return this.getStringId()}isSameVoxel(t){return this.getId()==t.getId()}copy(t){return this.ids[this._index]=t.ids[t._index],this.light[this._index]=t.light[t._index],this.level[this._index]=t.level[t._index],this.state[this._index]=t.state[t._index],this.mod[this._index]=t.mod[t._index],this.secondary[this._index]=t.secondary[t._index],this}copyRaw(t){return this.ids[this._index]=t[0],this.light[this._index]=t[1],this.level[this._index]=t[2],this.state[this._index]=t[3],this.secondary[this._index]=t[4],this.mod[this._index]=t[5],this}getRaw(){return[this.ids[this._index],this.light[this._index],this.level[this._index],this.state[this._index],this.mod[this._index],this.secondary[this._index]]}getRawToRef(t){return t[0]=this.ids[this._index],t[1]=this.light[this._index],t[2]=this.level[this._index],t[3]=this.state[this._index],t[4]=this.mod[this._index],t[5]=this.secondary[this._index],t}}},81847:(t,e,s)=>{s.d(e,{o:()=>i});class i{static getLevel(t){return 15&t}static setLevel(t,e){return-16&t|e}static getLevelState(t){return(240&t)>>4}static setLevelState(t,e){return-241&t|e<<4}}},96914:(t,e,s)=>{s.d(e,{$:()=>i});class i{_lightValues=new Uint16Array([0,0,0,0]);sumRGB(t){return this.getR(t)+this.getG(t)+this.getB(t)}getS(t){return 15&t}getR(t){return(240&t)>>4}getG(t){return(3840&t)>>8}getB(t){return(61440&t)>>12}setS(t,e){return-16&e|t}setR(t,e){return-241&e|t<<4}setG(t,e){return-3841&e|t<<8}setB(t,e){return-61441&e|t<<12}removeS(t){return this.setS(0,t)}hasRGBLight(t){return!(t<=0)&&(this.getR(t)>0||this.getG(t)>0||this.getB(t)>0)}hasSunLight(t){return!(t<=0)&&this.getS(t)>0}mixLight(t,e){const s=this.getS(t),i=this.getS(e),r=s<i?i:s,a=this.getR(t),n=this.getR(e),o=a<n?n:a,c=this.getG(t),h=this.getG(e),d=c<h?h:c,l=this.getB(t),u=this.getB(e),g=l<u?u:l;let x=this.setS(r,0);return x=this.setR(o,x),x=this.setG(d,x),x=this.setB(g,x),x}getRGB(t){return t<0?0:(65520&t)>>4}setRGB(t,e){return e<0?0:-65521&e|t<<4}createLightValue(t,e,s,i){let r=0;return r=this.setS(t,r),r=this.setR(e,r),r=this.setG(e,r),this.setB(e,r)}setLightValues(t){let e=this.setS(t[0],0);return e=this.setR(t[1],e),e=this.setG(t[2],e),this.setB(t[3],e)}getLightValuesArray(t){return this._lightValues[0]=this.getS(t),this._lightValues[1]=this.getR(t),this._lightValues[2]=this.getG(t),this._lightValues[3]=this.getB(t),this._lightValues}getLightValuesArrayToRef(t,e){return e[0]=this.getS(t),e[1]=this.getR(t),e[2]=this.getG(t),e[3]=this.getB(t),e}addLightValues(t,e){return this._lightValues[0]=this.getS(t)+this.getS(e),this._lightValues[1]=this.getR(t)+this.getR(e),this._lightValues[2]=this.getG(t)+this.getG(e),this._lightValues[3]=this.getB(t)+this.getB(e),this._lightValues[0]>15&&(this._lightValues[0]=15),this._lightValues[1]>15&&(this._lightValues[1]=15),this._lightValues[2]>15&&(this._lightValues[2]=15),this._lightValues[3]>15&&(this._lightValues[3]=15),this.setLightValues(this._lightValues)}divideLightValue(t,e){return this._lightValues[0]=Math.ceil(this.getS(t)/e),this._lightValues[1]=Math.ceil(this.getR(t)/e),this._lightValues[2]=Math.ceil(this.getG(t)/e),this._lightValues[3]=Math.ceil(this.getB(t)/e),this.setLightValues(this._lightValues)}}},13163:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(76132);class r{static material=new i.N;static substance=new i.N;static voxels=new i.N;static voxelNametoIdMap=new Map;static voxelIdToNameMap=new Map;static loadInVoxel(t,e,s){this.voxels=new i.N(t),this.voxelNametoIdMap=new Map(Object.entries(e)),this.voxelIdToNameMap=new Map(Object.entries(s))}static voxelName={getId:t=>this.voxelNametoIdMap.get(t),getName:t=>this.voxelIdToNameMap.get(t)}}},27219:(t,e,s)=>{var i,r;s.d(e,{L:()=>r,x:()=>i}),function(t){t.substance="dve_substance",t.renderedMaterial="dve_rendered_material",t.voxelMaterial="dve_voxel_material",t.hardness="dve_hardness",t.colliderID="dve_collider_id",t.checkCollisions="dve_check_collisions",t.isLightSource="dve_is_light_source",t.noAO="dve_no_ao",t.isTransparent="dve_is_transparent",t.lightValue="dve_light_value",t.canHaveSecondary="dve_can_have_secondary"}(i||(i={})),function(t){t.parent="dve_parent_substance",t.isSolid="dve_is_solid",t.isTransparent="dve_is_transparent",t.isLiquid="dve_is_liquid",t.flowRate="dve_flow_rate",t.isWindAffected="dve_is_wind_affected"}(r||(r={}))},46558:(t,e,s)=>{s.d(e,{B:()=>o});var i=s(13163),r=s(28421),a=s(81233),n=s(50489);class o{static voxelTags=[];static toJSON(){const t=[];return this.voxelTags.forEach(((e,s)=>{t[s]=Object.fromEntries(Object.keys(e).map((t=>[t,{tree:e[t].tree.tree,treePalette:e[t].treePalette}])))})),t}static load(t){t.forEach(((t,e)=>{if(!t)return;const s=new r.X(n.r.modelStaeBaseSchemaData.get(n.r.voxelModelMap.get(i.A.voxels.getStringId(e))));for(const i in t)this.register(e,i,s,t[i].tree,t[i].treePalette)}))}static register(t,e,s,i,r){let n=this.voxelTags[t];n||(n={},this.voxelTags[t]=n),n[e]={tree:new a.z(s,0,i),treePalette:r}}static isRegistered(t,e){return this.voxelTags[t]&&void 0!==this.voxelTags[t][e]}static getData(t,e){return this.voxelTags[t][e]}static getState(t,e,s){return this.voxelTags[t][e].tree.getState(s)}static getValue(t,e,s){return this.voxelTags[t][e].treePalette[this.voxelTags[t][e].tree.getState(s)]}}},83066:(t,e,s)=>{s.d(e,{L:()=>r});var i=s(27219);class r{static IncludedVoxelTags=[i.x.substance,i.x.renderedMaterial,i.x.voxelMaterial,i.x.hardness,i.x.colliderID,i.x.checkCollisions,i.x.isLightSource,i.x.lightValue,i.x.noAO,i.x.isTransparent,i.x.canHaveSecondary];static IncludedSubstnacesTags=[i.L.parent,i.L.isSolid,i.L.isTransparent,i.L.isLiquid,i.L.flowRate,i.L.isWindAffected];static VoxelTagDefaults={[i.x.renderedMaterial]:"dve_solid",[i.x.substance]:"dve_solid",[i.x.colliderID]:"dve_cube"};static VoxelTags=[];static SubstanceStagDefaults={};static SubstanceStags=[]}},50489:(t,e,s)=>{s.d(e,{r:()=>a});var i=s(62421),r=s(31848);class a{static modelStaeBaseSchemaData=new Map;static modelStateSchemaData=new Map;static voxelModSchemaData=new Map;static modelStaeSchemas=new Map;static voxelModSchemas=new Map;static voxelModelMap=new Map;static voxelSchemas=new Map;static hasVoxelSchema(t){return this.voxelSchemas.has(t)}static getVoxelSchemas(t){if(this.voxelSchemas.has(t))return this.voxelSchemas.get(t);const e=this.voxelModelMap.get(t);if(!e)throw new Error(`Voxel ${t} is not registered`);let s=this.modelStaeSchemas.get(e);if(!s){const t=this.modelStateSchemaData.get(e);if(!t)throw new Error(`Model ${e} is not registered`);s=new i.n(t)}let a=this.voxelModSchemas.get(t);if(!a){const e=this.voxelModSchemaData.get(t);if(!e)throw new Error(`Voxel ${t} is not registered`);a=new i.n(e)}const n=new r.G(t,s,a);return this.voxelSchemas.set(t,n),n}static registerModel(t,e){const s=[];this.modelStaeBaseSchemaData.set(t,e);for(const t of e)"binary"==t.type&&s.push(t);this.modelStateSchemaData.set(t,s)}static registerVoxel(t,e,s){this.voxelModelMap.set(t,e);const i=[];for(const t of s)"binary"==t.type&&i.push(t);this.voxelModSchemaData.set(t,i)}}},62421:(t,e,s)=>{s.d(e,{n:()=>r});var i=s(25753);class r{nodeMap=new Map;nodes=[];constructor(t){for(const e of t)if("binary"==e.type){const t=new i.f(e);this.nodes.push(t),this.nodeMap.set(e.id,t)}}_value=0;readString(t){if("*"==t)return 0;const e=t.split(",");let s=0;for(const t of e){const[e,i]=t.split("=");if("*"==i)continue;const r=this.nodeMap.get(e);if(r)if(r.valuePalette){const t=r.valuePalette.getNumberId(i);if(void 0===t)throw new Error(`Binary schema string node value with id ${i} does not exist.`);s=r.setValue(s,t)}else s=r.setValue(s,Number(i))}return s}fromStateObject(t){let e=0;for(let s=0;s<t.length;s+=2){const i=t[s];if("string"!=typeof i)continue;const r=t[s+1],a=this.nodeMap.get(i);if(a)if("string"!=typeof r)e=a.setValue(e,r);else{if(!a.valuePalette)continue;e=a.setValue(e,a.valuePalette.getNumberId(r)||0)}}return e}getStateObject(t){const e=[];for(const s of this.nodes)s.valuePalette?e.push(s.id,s.valuePalette.getStringId(s.getValue(t))):e.push(s.id,s.getValue(t));return e}compareString(t,e){if("*"==t)return!0;const s=t.split(",");for(const t of s){const[s,i]=t.split("=");if("*"==i)continue;const r=this.nodeMap.get(s);if(r)if(r.valuePalette){const t=r.valuePalette.getNumberId(i);if(void 0===t)throw new Error(`Binary schema string node value  with id ${s} does not exist.`);if(r.getValue(e)!==t)return!1}else if(r.getValue(e)!==Number(i))return!1}return!0}startEncoding(t=0){return this._value=t,this}getNmber(t){const e=this.nodeMap.get(t);if(!e)throw new Error(`Node with ${t} does not exist.`);return e.getValue(this._value)}getValue(t){const e=this.nodeMap.get(t);if(!e)throw new Error(`Node with ${t} does not exist.`);if(!e.valuePalette)throw new Error(`Node with ${t} does not have a value palette.`);return e.valuePalette.getStringId(e.getValue(this._value))}setNumber(t,e){const s=this.nodeMap.get(t);if(!s)throw new Error(`Node with ${t} does not exist.`);return this._value=s.setValue(this._value,e),this}setValue(t,e){const s=this.nodeMap.get(t);if(!s)throw new Error(`Node with ${t} does not exist.`);if(!s.valuePalette)throw new Error(`Node with ${t} does not have a value palette.`);return this._value=s.setValue(this._value,s.valuePalette.getNumberId(e)),this}getEncoded(){return this._value}}},25753:(t,e,s)=>{s.d(e,{f:()=>r});var i=s(76132);class r{id;valuePalette;bitIndex=0;bitMask=0;constructor(t){this.id=t.id,this.bitIndex=t.index,this.bitMask=t.mask,t.valuePalette&&(this.valuePalette=new i.N(t.valuePalette))}getValue(t){return(t&this.bitMask<<this.bitIndex)>>this.bitIndex}setValue(t,e){return t&~(this.bitMask<<this.bitIndex)|(e&this.bitMask)<<this.bitIndex}}},74578:(t,e,s)=>{s.d(e,{u:()=>r});var i=s(47491);class r extends i.k{data;constructor(t,e){super(t),this.data=e}evulate(){const t=this.schema.position.x+this.data.direction[0],e=this.schema.position.y+this.data.direction[1],s=this.schema.position.z+this.data.direction[2],i=this.schema.dataCursor.getVoxel(t,e,s);return!!i&&this.schema.voxel.isSameVoxel(i)}}},47491:(t,e,s)=>{s.d(e,{k:()=>i});class i{schema;constructor(t){this.schema=t}}},61304:(t,e,s)=>{s.d(e,{i:()=>r});var i=s(74578);class r{schema;id;conditions=[];constructor(t,e){this.schema=t,this.id=e.id;for(const s of e.conditions)"same-voxel"==s.type&&this.conditions.push(new i.u(t,s))}getValue(){let t=1;const e=this.conditions.length;for(let s=0;s<e;s++)if(!this.conditions[s].evulate()){t=0;break}return t}}},28421:(t,e,s)=>{s.d(e,{X:()=>n});var i=s(61304),r=s(25753),a=s(61e3);class n{nodes=[];position=a.Az.Create();voxel;dataCursor;constructor(t){for(const e of t)"binary"==e.type&&this.nodes.push(new r.f(e)),"relation"==e.type&&this.nodes.push(new i.i(this,e))}}},31848:(t,e,s)=>{s.d(e,{G:()=>i});class i{id;state;mod;constructor(t,e,s){this.id=t,this.state=e,this.mod=s}}},81233:(t,e,s)=>{s.d(e,{z:()=>i});class i{schema;defaultValue;tree;startingIndex=0;constructor(t,e=0,s){this.schema=t,this.defaultValue=e,this.tree=s}getState(t){if(!this.tree.length)return this.defaultValue;let e=this.startingIndex,s=this.tree;for(;;){if(s=s[e][this.schema.nodes[e].getValue(t)],"number"==typeof s)return s;if(void 0===s)return-1;for(let t=0;t<s.length;t++)if(s[t]){e=t;break}if("number"==typeof s)return s}return-1}}},9879:(t,e,s)=>{s.d(e,{j:()=>c});var i=s(1481),r=s(94477),a=s(56059),n=s(61e3),o=s(40892);class c extends o.s{_current=null;_section;voxel=new r.$(this);_voxelIndex=0;_voxelPosition=n.Az.Create();_sectorPosition=n.Az.Create();inBounds(t,e,s){const i=this._sectorPosition.x+a.k.sector.bounds.x,r=this._sectorPosition.y+a.k.sector.bounds.y,n=this._sectorPosition.z+a.k.sector.bounds.z;return!(t<this._sectorPosition.x||e<this._sectorPosition.y||s<this._sectorPosition.z||t>i||e>r||s>n)}setSector(t,e,s,r){const a=i._.sectors.get(t,e,s,r);return!!a&&(this._current=a,this._sectorPosition.x=a.position[0],this._sectorPosition.y=a.position[1],this._sectorPosition.z=a.position[2],!0)}getSection(t,e,s){if(!this._current)return null;const i=this._current.sections[a.k.section.getIndex(t,e,s)];if(!i){if(!i)throw new Error(`Could not load section at ${t}-${e}-${s} | ${a.k.section.getIndex(t,e,s)}`);return this._section=null,null}return i}getVoxel(t,e,s){if(!this._current)return null;const i=this.getSection(t,e,s);return this._section=i,a.k.voxel.getPosition(t,e,s,this._voxelPosition),this._voxelIndex=a.k.voxel.getIndexFromPosition(this._voxelPosition.x,this._voxelPosition.y,this._voxelPosition.z),this.voxel.loadIn(),this.voxel}getVoxelAtIndex(t){this._voxelIndex=t}}},94477:(t,e,s)=>{s.d(e,{$:()=>r});var i=s(27051);class r extends i.S{dataCursor;_section;ids;light;level;state;mod;secondary;constructor(t){super(),this.dataCursor=t}loadIn(){this.dataCursor._section&&(this._section=this.dataCursor._section,this.ids=this._section.ids,this.light=this._section.light,this.level=this._section.level,this.state=this._section.state,this.mod=this._section.mod,this.secondary=this._section.secondary,this._index=this.dataCursor._voxelIndex,this.process())}updateVoxel(t){const e=this.dataCursor._voxelPosition;return 0==t?(this.dataCursor._section?.setBuried(this.dataCursor._voxelIndex,!1),this.dataCursor._section?.setHasVoxel(e.y,!0),!0):1==t?(this.dataCursor._section?.setBuried(this.dataCursor._voxelIndex,!1),this.dataCursor._section?.setHasVoxelDirty(e.y,!0),this.dataCursor._section?.setHasVoxel(e.y,!1),!0):(2==t&&this.dataCursor._section?.setBuried(this.dataCursor._voxelIndex,!1),!1)}}},83959:(t,e,s)=>{s.d(e,{f:()=>i});class i{static CreateNew(t){return new i({id:t,sectors:new Map})}constructor(t){return Object.assign(this,t)}set(t,e){this.sectors.set(t,e)}delete(t){this.sectors.delete(t)}get(t){return this.sectors.get(t)}}},91669:(t,e,s)=>{s.d(e,{h:()=>o});var i=s(38903),r=s(56059),a=s(20330),n=s(70468);class o{static FlagIds=n.B;static TimeStampIds=n.E;static GetHeaderSize(){return 60%2==0?60:61}static GetBufferSize(){const t=r.k.sector.bounds.y/r.k.section.bounds.y;return this.GetHeaderSize()+i.w.GetBufferSize()*t}static CreateNew(){const t=new SharedArrayBuffer(this.GetBufferSize()),e=new Uint8Array(t,0,12),s=new Uint32Array(t,12,48),a=[],n=r.k.sector.bounds.y/r.k.section.bounds.y;for(let e=0;e<n;e++)a[e]=i.w.CreateNew(e,t);return{position:[0,0,0],buffer:t,flagArray:e,timeStampArray:s,sections:a}}sections=[];bufferView;constructor(t){this.position=t.position,this.flagArray=t.flagArray,this.timeStampArray=t.timeStampArray,this.buffer=t.buffer,this.bufferView=new Uint8Array(t.buffer);for(let e=0;e<t.sections.length;e++)this.sections[e]=new i.w(this,e,t.sections[e])}getSection(t){const e=(t-this.position[1])/r.k.section.bounds.y;return this.sections[e]}setBitFlag(t,e){(0,a.JU)(this.flagArray,t,e?1:0)}getBitFlag(t){return 1==(0,a.Tv)(this.flagArray,t)}setTimeStamp(t,e){this.timeStampArray[t]=e}getTimeStamp(t){return this.timeStampArray[t]}toJSON(){const t=[];for(const e of this.sections)t.push(e.toJSON());return{position:this.position,buffer:this.buffer,flagArray:this.flagArray,timeStampArray:this.timeStampArray,sections:t}}}},70468:(t,e,s)=>{var i,r;s.d(e,{B:()=>i,E:()=>r}),function(t){t[t.isWorldGenDone=0]="isWorldGenDone",t[t.isWorldDecorDone=1]="isWorldDecorDone",t[t.isWorldPropagationDone=2]="isWorldPropagationDone",t[t.isWorldSunDone=3]="isWorldSunDone",t[t.isDirty=4]="isDirty",t[t.isStored=5]="isStored",t[t.persistent=6]="persistent"}(i||(i={})),function(t){t[t.lastSaveTimestamp=0]="lastSaveTimestamp",t[t.lastAnalyzerUpdateTimestamp=1]="lastAnalyzerUpdateTimestamp"}(r||(r={}))},78259:(t,e,s)=>{var i;s.d(e,{U:()=>i}),function(t){t.SyncSector="sync-sector",t.UnSyncSector="unsync-sector",t.SyncDimension="sync-dimension",t.UnSyncDimension="unsync-dimension"}(i||(i={}))},1481:(t,e,s)=>{s.d(e,{_:()=>u});var i=s(56059),r=s(83959),a=s(91669),n=s(61e3);class o{static dimension={onNew:t=>{},onRemove:t=>{}};static sectors={onNew:(t,e)=>{},onRemove:(t,e)=>{}}}class c{static add(t){const e=r.f.CreateNew(t);return u._dimensions.set(t,e),e}static get(t){return u._dimensions.get(t)}}const h=n.Az.Create();class d{static _secotrs=[];static _enabled=!1;static getSector(){return this._enabled&&this._secotrs.length?this._secotrs.shift():a.h.CreateNew()}static returnSector(t){t.bufferView.fill(0)}}class l{static setSecotrPool(t){d._enabled=t,d._secotrs.length=0}static add(t,e,s,r,n){let o=u.dimensions.get(t);o||(o=u.dimensions.add(t)),i.k.sector.getPositionVec3Array(e,s,r,n.position);const c=new a.h(n);return o.sectors.set(i.k.hash.hashVec3Array(c.position),c),c}static addAt(t,e){return this.add(...t,e)}static new(t,e,s,i){if(this.get(t,e,s,i))return!1;let r=u.dimensions.get(t);r||(r=u.dimensions.add(t));const n=this.add(t,e,s,i,a.h.CreateNew());return o.sectors.onNew([t,e,s,i],n),!0}static newAt(t){return this.new(...t)}static get(t,e,s,r){let a=u.dimensions.get(t);return a&&a.sectors.get(i.k.hash.hashVec3(i.k.sector.getPosition(e,s,r,h)))||!1}static getAt(t){return this.get(...t)}static remove(t,e,s,r){let a=u.dimensions.get(t);if(!a)return!1;const n=i.k.sector.getPosition(e,s,r,h),c=i.k.hash.hashVec3(n),l=a.sectors.get(c);return!!l&&(d._enabled&&d.returnSector(l),o.sectors.onRemove([t,n.x,n.y,n.z],l),a.sectors.delete(c),!0)}static removeAt(t){return this.remove(...t)}}class u{static _dimensions=new Map;static _hooks=o;static dimensions=c;static sectors=l;static clearAll(){this._dimensions.clear()}}},56059:(t,e,s)=>{s.d(e,{k:()=>g});var i=s(4974),r=s(61e3),a=s(13632);const n=r.Az.Create(),o=r.Az.Create();class c{static bounds={MinZ:-Number.MAX_SAFE_INTEGER,MaxZ:Number.MAX_SAFE_INTEGER,MinX:-Number.MAX_SAFE_INTEGER,MaxX:Number.MAX_SAFE_INTEGER,MinY:0,MaxY:256};static setWorldBounds(t,e,s,i,r,a){this.bounds.MinX=t,this.bounds.MaxX=i,this.bounds.MinX=s,this.bounds.MaxZ=a,this.bounds.MinY=e,this.bounds.MaxY=r}static inBounds(t,e,s){return!(t<this.bounds.MinX||e<this.bounds.MinY||s<this.bounds.MinZ||t>this.bounds.MaxX||e>this.bounds.MaxY||s>this.bounds.MaxZ)}static getWorldWidth(){return this.bounds.MaxX-this.bounds.MinX}static getWorldDepth(){return this.bounds.MaxZ-this.bounds.MinZ}static getWorldHeightY(){return this.bounds.MaxY-this.bounds.MinY}static getWorldDimensions(){return{width:this.getWorldWidth(),depth:this.getWorldDepth(),height:this.getWorldHeightY()}}}class h{static power2Axes=r.Az.Create();static bounds=r.Az.Create();static volumne=0;static getPosition(t,e,s,i=r.Az.Create()){return(0,a.pN)(t,e,s,h.power2Axes.x,h.power2Axes.y,h.power2Axes.z,i),i}static getPositionVec3Array(t,e,s,i=[0,0,0]){return(0,a.WS)(t,e,s,h.power2Axes.x,h.power2Axes.y,h.power2Axes.z,i),i}}class d{static power2Axes=r.Az.Create();static bounds=r.Az.Create();static volumne=0;static getPosition(t,e,s,i=r.Az.Create()){return(0,a.pN)(t,e,s,d.power2Axes.x,d.power2Axes.y,d.power2Axes.z,i),i}static getPositionVec3Array(t,e,s,i=[0,0,0]){return(0,a.WS)(t,e,s,d.bounds.x,d.bounds.y,d.bounds.z,i),i}static getIndex(t,e,s){return d.getPosition(t,e,s,n),h.getPosition(t,e,s,o),(n.y-o.y)/d.bounds.y}}class l{static bounds=r.Az.Create();static getPosition(t,e,s,i=r.Az.Create()){return(0,a.pN)(t,e,s,d.power2Axes.x,d.power2Axes.y,d.power2Axes.z,i),i.x=t-i.x,i.y=e-i.y,i.z=s-i.z,i}static getPositionVec3Array(t,e,s,i=[0,0,0]){return(0,a.WS)(t,e,s,d.power2Axes.x,d.power2Axes.y,d.power2Axes.z,i),i[0]=t-i[0],i[1]=e-i[1],i[2]=s-i[2],i}static getPositionFromIndex(t,e=r.Az.Create()){return(0,a.bv)(t,d.bounds.x,d.bounds.y,d.bounds.z,e)}static getIndex(t,e,s){const i=this.getPosition(t,e,s,n);return(0,a.BN)(i.x,i.y,i.z,d.bounds.x,d.bounds.y,d.bounds.z)}static getIndexFromPosition(t,e,s){return(0,a.BN)(t,e,s,d.bounds.x,d.bounds.y,d.bounds.z)}}class u{static hashVec3(t){return`${t.x}-${t.y}-${t.z}`}static hashVec3Array(t){return`${t[0]}-${t[1]}-${t[2]}`}static hashXYZ(t,e,s){return`${t}-${e}-${s}`}}class g{static hash=u;static world=c;static sector=h;static section=d;static voxel=l}i.i.addEventListener("synced",(t=>{const{settings:e}=t.detail.settings;c.setWorldBounds(e.world.min.x,e.world.min.y,e.world.min.z,e.world.max.x,e.world.max.y,e.world.max.z),h.power2Axes.x=e.sectors.power2Size.x,h.power2Axes.y=e.sectors.power2Size.y,h.power2Axes.z=e.sectors.power2Size.z,h.bounds.x=1<<h.power2Axes.x,h.bounds.y=1<<h.power2Axes.y,h.bounds.z=1<<h.power2Axes.z,d.power2Axes.x=e.sections.power2Size.x,d.power2Axes.y=e.sections.power2Size.y,d.power2Axes.z=e.sections.power2Size.z,d.bounds.x=1<<d.power2Axes.x,d.bounds.y=1<<d.power2Axes.y,d.bounds.z=1<<d.power2Axes.z,d.volumne=d.bounds.x*d.bounds.y*d.bounds.z,h.volumne=h.bounds.x/d.bounds.x*(h.bounds.y/d.bounds.y)*(h.bounds.z/d.bounds.z)}))}}]);