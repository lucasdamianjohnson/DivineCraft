"use strict";(self.webpackChunkdivinecraft=self.webpackChunkdivinecraft||[]).push([[147],{54262:(t,e,s)=>{s.d(e,{J:()=>i});class i{static Create(){return[1,0,0,0,1,0,0,0,1]}static Add(t,e){return t.map(((t,s)=>t+e[s]))}static AddToRef(t,e,s){t.forEach(((t,i)=>s[i]=t+e[i]))}static Multiply(t,e){const s=new Array(9);for(let i=0;i<3;i++)for(let r=0;r<3;r++){s[3*i+r]=0;for(let a=0;a<3;a++)s[3*i+r]+=t[3*i+a]*e[3*a+r]}return s}static MultiplyToRef(t,e,s){for(let i=0;i<3;i++)for(let r=0;r<3;r++){s[3*i+r]=0;for(let a=0;a<3;a++)s[3*i+r]+=t[3*i+a]*e[3*a+r]}}static Transpose(t){return[t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]]}static TransposeToRef(t,e){[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]=[t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]]}static Inverse(t){const e=t[0]*(t[4]*t[8]-t[7]*t[5])-t[1]*(t[3]*t[8]-t[6]*t[5])+t[2]*(t[3]*t[7]-t[6]*t[4]);if(0===e)return null;const s=1/e;return[(t[4]*t[8]-t[7]*t[5])*s,(t[2]*t[7]-t[1]*t[8])*s,(t[1]*t[5]-t[2]*t[4])*s,(t[5]*t[6]-t[3]*t[8])*s,(t[0]*t[8]-t[2]*t[6])*s,(t[2]*t[3]-t[0]*t[5])*s,(t[3]*t[7]-t[4]*t[6])*s,(t[1]*t[6]-t[0]*t[7])*s,(t[0]*t[4]-t[1]*t[3])*s]}static InverseToRef(t,e){const s=this.Inverse(t);return null!==s&&(s.forEach(((t,s)=>e[s]=t)),!0)}static RotationX(t){const e=Math.cos(t),s=Math.sin(t);return[1,0,0,0,e,-s,0,s,e]}static RotationY(t){const e=Math.cos(t),s=Math.sin(t);return[e,0,s,0,1,0,-s,0,e]}static RotationZ(t){const e=Math.cos(t),s=Math.sin(t);return[e,-s,0,s,e,0,0,0,1]}static Scaling(t,e,s){return[t,0,0,0,e,0,0,0,s]}static Transform(t,e,s){return[1,0,0,0,1,0,t,e,s]}static ApplyMatrix(t,e){return{x:t[0]*e.x+t[1]*e.y+t[2]*e.z,y:t[3]*e.x+t[4]*e.y+t[5]*e.z,z:t[6]*e.x+t[7]*e.y+t[8]*e.z}}static ApplyMatrixArray(t,e){return[t[0]*e[0]+t[1]*e[1]+t[2]*e[2],t[3]*e[0]+t[4]*e[1]+t[5]*e[2],t[6]*e[0]+t[7]*e[1]+t[8]*e[2]]}}},7930:(t,e,s)=>{s.d(e,{A:()=>o});var i=s(54262);const r=t=>t>=0?2*t:-2*t-1,a=(t,e)=>(t+e)*(t+e+1)/2+e;class o{x;y;z;static Create(t=0,e=0,s=0){return new o(t,e,s)}static HashXYZ(t,e,s){const i=r(t),o=r(e),n=r(s),c=a(i,o);return a(c,n)}static Hash(t){return this.HashXYZ(t.x,t.y,t.z)}static HashArray(t){return this.HashXYZ(t[0],t[1],t[2])}static ApplyMatrix(t,e){return i.J.ApplyMatrix(t,e)}static ApplyMatrixArray(t,e){return i.J.ApplyMatrixArray(t,e)}static RotateAroundPivot(t,e,s){const i={x:e.x-s.x,y:e.y-s.y,z:e.z-s.z},r=o.ApplyMatrix(t,i);return{x:r.x+s.x,y:r.y+s.y,z:r.z+s.z}}static RotateAroundPivotArray(t,e,s){const i=[e[0]-s[0],e[1]-s[1],e[2]-s[2]],r=o.ApplyMatrixArray(t,i);return[r[0]+s[0],r[1]+s[1],r[2]+s[2]]}static FloorInPlace(t){return t.x=Math.floor(t.x),t.y=Math.floor(t.y),t.z=Math.floor(t.z),t}static FloorArrayInPlace(t){return t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.floor(t[2]),t}static RoundArrayInPlaceToScalar(t,e){return t[0]=Math.round(t[0]*e)/e,t[1]=Math.round(t[1]*e)/e,t[2]=Math.round(t[2]*e)/e,t}static Add(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}}static AddToRef(t,e,s){s.x=t.x+e.x,s.y=t.y+e.y,s.z=t.z+e.z}static AddInPlace(t,e){t.x+=e.x,t.y+=e.y,t.z+=e.z}static AddArray(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2]]}static AddArrayToRef(t,e,s){s[0]=t[0]+e[0],s[1]=t[1]+e[1],s[2]=t[2]+e[2]}static AddArrayInPlace(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}static AddScalar(t,e){return{x:t.x+e,y:t.y+e,z:t.z+e}}static AddScalarToRef(t,e,s){s.x=t.x+e,s.y=t.y+e,s.z=t.z+e}static AddScalarInPlace(t,e){t.x+=e,t.y+=e,t.z+=e}static AddScalarArray(t,e){return[t[0]+e,t[1]+e,t[2]+e]}static AddScalarArrayToRef(t,e,s){s[0]=t[0]+e,s[1]=t[1]+e,s[2]=t[2]+e}static AddScalarArrayInPlace(t,e){t[0]+=e,t[1]+=e,t[2]+=e}static Subtract(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}}static SubtractToRef(t,e,s){s.x=t.x-e.x,s.y=t.y-e.y,s.z=t.z-e.z}static SubtractInPlace(t,e){return t.x-=e.x,t.y-=e.y,t.z-=e.z,t}static SubtractArray(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}static SubtractArrayToRef(t,e,s){s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2]}static SubtractArrayInPlace(t,e){t[0]-=e[0],t[1]-=e[1],t[2]-=e[2]}static SubtractScalar(t,e){return{x:t.x-e,y:t.y-e,z:t.z-e}}static SubtractScalarToRef(t,e,s){s.x=t.x-e,s.y=t.y-e,s.z=t.z-e}static SubtractScalarInPlace(t,e){t.x-=e,t.y-=e,t.z-=e}static SubtractScalarArray(t,e){return[t[0]-e,t[1]-e,t[2]-e]}static SubtractScalarArrayToRef(t,e,s){s[0]=t[0]-e,s[1]=t[1]-e,s[2]=t[2]-e}static SubtractScalarArrayInPlace(t,e){t[0]-=e,t[1]-=e,t[2]-=e}static Multiply(t,e){return{x:t.x*e.x,y:t.y*e.y,z:t.z*e.z}}static MultiplyToRef(t,e,s){s.x=t.x*e.x,s.y=t.y*e.y,s.z=t.z*e.z}static MultiplyInPlace(t,e){t.x*=e.x,t.y*=e.y,t.z*=e.z}static MultiplyArray(t,e){return[t[0]*e[0],t[1]*e[1],t[2]*e[2]]}static MultiplyArrayToRef(t,e,s){s[0]=t[0]*e[0],s[1]=t[1]*e[1],s[2]=t[2]*e[2]}static MultiplyArrayInPlace(t,e){t[0]*=e[0],t[1]*=e[1],t[2]*=e[2]}static MultiplyScalar(t,e){return{x:t.x*e,y:t.y*e,z:t.z*e}}static MultiplyScalarToRef(t,e,s){s.x=t.x*e,s.y=t.y*e,s.z=t.z*e}static MultiplyScalarInPlace(t,e){t.x*=e,t.y*=e,t.z*=e}static MultiplyScalarArray(t,e){return[t[0]*e,t[1]*e,t[2]*e]}static MultiplyScalarArrayToRef(t,e,s){s[0]=t[0]*e,s[1]=t[1]*e,s[2]=t[2]*e}static MultiplyScalarArrayInPlace(t,e){t[0]*=e,t[1]*=e,t[2]*=e}static Divide(t,e){return{x:t.x/e.x,y:t.y/e.y,z:t.z/e.z}}static DivideToRef(t,e,s){s.x=t.x/e.x,s.y=t.y/e.y,s.z=t.z/e.z}static DivideInPlace(t,e){return t.x/=e.x,t.y/=e.y,t.z/=e.z,t}static DivideArray(t,e){return[t[0]/e[0],t[1]/e[1],t[2]/e[2]]}static DivideArrayToRef(t,e,s){s[0]=t[0]/e[0],s[1]=t[1]/e[1],s[2]=t[2]/e[2]}static DivideArrayInPlace(t,e){t[0]/=e[0],t[1]/=e[1],t[2]/=e[2]}static DivideScalar(t,e){return{x:t.x/e,y:t.y/e,z:t.z/e}}static DivideScalarToRef(t,e,s){s.x=t.x/e,s.y=t.y/e,s.z=t.z/e}static DivideScalarInPlace(t,e){t.x/=e,t.y/=e,t.z/=e}static DivideScalarArray(t,e){return[t[0]/e,t[1]/e,t[2]/e]}static DivideScalarArrayToRef(t,e,s){s[0]=t[0]/e,s[1]=t[1]/e,s[2]=t[2]/e}static DivideScalarArrayInPlace(t,e){t[0]/=e,t[1]/=e,t[2]/=e}static Dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static DotArray(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}static Cross(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}}static CrossToRef(t,e,s){s.x=t.y*e.z-t.z*e.y,s.y=t.z*e.x-t.x*e.z,s.z=t.x*e.y-t.y*e.x}static CrossInPlace(t,e){const s=t.y*e.z-t.z*e.y,i=t.z*e.x-t.x*e.z,r=t.x*e.y-t.y*e.x;t.x=s,t.y=i,t.z=r}static CrossArray(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}static CrossArrayToRef(t,e,s){s[0]=t[1]*e[2]-t[2]*e[1],s[1]=t[2]*e[0]-t[0]*e[2],s[2]=t[0]*e[1]-t[1]*e[0]}static CrossArrayInPlace(t,e){const s=t[1]*e[2]-t[2]*e[1],i=t[2]*e[0]-t[0]*e[2],r=t[0]*e[1]-t[1]*e[0];t[0]=s,t[1]=i,t[2]=r}static Length(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}static LengthArray(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}static Normalize(t){const e=o.Length(t);return 0===e?{x:0,y:0,z:0}:{x:t.x/e,y:t.y/e,z:t.z/e}}static NormalizeToRef(t,e){const s=o.Length(t);0===s?(e.x=0,e.y=0,e.z=0):(e.x=t.x/s,e.y=t.y/s,e.z=t.z/s)}static NormalizeInPlace(t){const e=o.Length(t);0===e?(t.x=0,t.y=0,t.z=0):(t.x/=e,t.y/=e,t.z/=e)}static NormalizeArray(t){const e=o.LengthArray(t);return 0===e?[0,0,0]:[t[0]/e,t[1]/e,t[2]/e]}static NormalizeArrayToRef(t,e){const s=o.LengthArray(t);0===s?(e[0]=0,e[1]=0,e[2]=0):(e[0]=t[0]/s,e[1]=t[1]/s,e[2]=t[2]/s)}static NormalizeArrayInPlace(t){const e=o.LengthArray(t);0===e?(t[0]=0,t[1]=0,t[2]=0):(t[0]/=e,t[1]/=e,t[2]/=e)}static Distance(t,e){return o.Length(o.Subtract(t,e))}static DistanceArray(t,e){return o.LengthArray(o.SubtractArray(t,e))}static Lerp(t,e,s){return{x:t.x+s*(e.x-t.x),y:t.y+s*(e.y-t.y),z:t.z+s*(e.z-t.z)}}static LerpToRef(t,e,s,i){i.x=t.x+s*(e.x-t.x),i.y=t.y+s*(e.y-t.y),i.z=t.z+s*(e.z-t.z)}static LerpInPlace(t,e,s){t.x+=s*(e.x-t.x),t.y+=s*(e.y-t.y),t.z+=s*(e.z-t.z)}static LerpArray(t,e,s){return[t[0]+s*(e[0]-t[0]),t[1]+s*(e[1]-t[1]),t[2]+s*(e[2]-t[2])]}static LerpArrayToRef(t,e,s,i){i[0]=t[0]+s*(e[0]-t[0]),i[1]=t[1]+s*(e[1]-t[1]),i[2]=t[2]+s*(e[2]-t[2])}static LerpArrayInPlace(t,e,s){t[0]+=s*(e[0]-t[0]),t[1]+=s*(e[1]-t[1]),t[2]+=s*(e[2]-t[2])}static Negate(t){return{x:-t.x,y:-t.y,z:-t.z}}static NegateToRef(t,e){e.x=-t.x,e.y=-t.y,e.z=-t.z}static NegateInPlace(t){t.x=-t.x,t.y=-t.y,t.z=-t.z}static NegateArray(t){return[-t[0],-t[1],-t[2]]}static NegateArrayToRef(t,e){e[0]=-t[0],e[1]=-t[1],e[2]=-t[2]}static NegateArrayInPlace(t){t[0]=-t[0],t[1]=-t[1],t[2]=-t[2]}static Equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}static EqualsArray(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}static Clone(t){return{x:t.x,y:t.y,z:t.z}}static CloneArray(t){return[t[0],t[1],t[2]]}static Copy(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t}static CopyArray(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}static CopyFromArray(t,e){return t.x=e[0],t.y=e[1],t.z=e[2],t}static CopyIntoArray(t,e){return t[0]=e.x,t[1]=e.y,t[2]=e.z,t}static ToArray(t){return[t.x,t.y,t.z]}static FromArray(t){return new o(t[0],t[1],t[2])}constructor(t,e,s){this.x=t,this.y=e,this.z=s}}},55725:(t,e,s)=>{s.d(e,{E:()=>n,z:()=>d});var i=s(84918),r=s(87137),a=s(28432);let o=0;class n{static _tasks=new Map;static _waiting=new Map;static getTasks(t){return this._tasks.get(t)||!1}static getInternal(t){return!!c[t[0]]&&c[t[0]]}static runInternal(t,e,s){const i=this.getInternal(t);i&&i(t,e,s)}static getPromiseId(){return o++,o}static addPromiseTakss(t,e,s){let i=this._waiting.get(t);i||(i=new Map,this._waiting.set(t,i)),i.set(e,s)}static completePromiseTasks(t,e,s){let i=this._waiting.get(t);if(!i)return;const r=i.get(e);i.delete(e),r&&r(s)}}const c={[i.g.connectPort]:(t,e,s)=>{const i=t[1],a=t[2];let o;if(o="browser"==r.Q.environment?s.ports[0]:t[3],"worker"==a){const t=r.Q.getThread(i);t&&t.setPort(o)}if("worker"!=a){const t=r.Q.getThreadPool(a);t&&t.addPort(o)}},[i.g.setReady]:(t,e)=>{a.j.readySet.add(e),e.name=t[1],e.index=t[2]},[i.g.runTask]:async(t,e,s)=>{const i=t[1],a=n.getTasks(i);if(!a)return void console.warn(`Tried running task ${i} | Thread ${r.Q.threadName} | Origin Thread ${e.name}`);const o=t[2],c=a(t[3],e,s);if(o<0)return;let h=null;h=c instanceof Promise?await c:c;let l=null,u=null;Array.isArray(h)&&(l=h[0],u=h[1]),d.completeTasks[1]=i,d.completeTasks[2]=o,d.completeTasks[3]=l,e.sendMessage(d.completeTasks,u),d.completeTasks[3]=null},[i.g.completeTasks]:(t,e)=>{const s=t[1],i=t[2],r=t[3];n.completePromiseTasks(s,i,r)},[i.g.checkTasks]:(t,e)=>{d.cehckTasksResult[1]=!!n.getTasks(t[1]),d.cehckTasksResult[2]=t[2],e.sendMessage(d.cehckTasksResult)},[i.g.checkTasksResult]:t=>{const e=t[1],s=t[2];n.completePromiseTasks("tasks-check",s,e)}},d={runTask:[i.g.runTask,"",0,null],completeTasks:[i.g.completeTasks,"",0,null],checkTasks:[i.g.checkTasks,"",0],cehckTasksResult:[i.g.checkTasksResult,!1,0]}},84918:(t,e,s)=>{var i;s.d(e,{g:()=>i}),function(t){t[t.setReady=0]="setReady",t[t.connectPort=1]="connectPort",t[t.runTask=2]="runTask",t[t.completeTasks=3]="completeTasks",t[t.checkTasks=4]="checkTasks",t[t.checkTasksResult=5]="checkTasksResult"}(i||(i={}))},87137:(t,e,s)=>{s.d(e,{Q:()=>n});var i=s(28432),r=s(82938),a=s(55725);let o=!1;class n{static threadNumber=0;static threadName="unamed-threadcomm-thread";static environment="browser";static _threads=new Map;static _threadPools=new Map;static parent=new i.j("parent",0);static get isInitalized(){return o}static async init(t,e,s="window"){this.threadName=t,this.parent.name=s,this.parent.setPort(e),o=!0,this.addThread(this.parent)}static addThread(t){this._threads.set(t.name,t)}static createThread(t,e={}){const s=Object.assign(new i.j(t,0),e);return this._threads.set(t,s),s}static createThreadPool(t){const e=new r.p(t);return this._threadPools.set(t,e),e}static getThread(t){return this._threads.get(t)||null}static getThreadPool(t){return this._threadPools.get(t)||null}static registerTask(t,e){a.E._tasks.set(t,e)}}"undefined"!=typeof process&&"undefined"==typeof Worker&&"undefined"==typeof window&&(n.environment="node")},81168:(t,e,s)=>{s.d(e,{QK:()=>i.Q,jV:()=>r.j,pX:()=>a.p});var i=s(87137),r=s(28432),a=s(82938)},27293:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(81168),r=s(39757),a=s(46830),o=s(61295),n=s(18556),c=s(15661),d=s(5522);function h(t){i.QK.registerTask("sync-data",(e=>{r.i.syncSettings(e.settings),n.A.voxels.load(e.voxels.data.palette),c.L.VoxelTags=e.voxels.data.tags,n.A.voxelIdToNameMap=new Map(e.voxels.data.idToNameMap),n.A.voxelNametoIdMap=new Map(e.voxels.data.nameToIdMap),n.A.substance.load(e.voxels.substances.palette),c.L.SubstanceStags=e.voxels.substances.tags,n.A.material.load(e.voxels.materials.palette);const s=e.voxels.models;for(const t of s.models)a.r.registerModel(t.id,t.schema);for(const t of s.voxels)a.r.registerVoxel(t.id,t.modelId,t.modSchema);o.B.load(s.tagState);for(const t in e.voxels.data.logic)d.U.register(t,e.voxels.data.logic[t]);t.onSync(e)}))}},39212:(t,e,s)=>{s.d(e,{Q:()=>r});var i=s(81168);class r{threadMap=new Map;_threads=[];constructor(){self.addEventListener("beforeunload",(()=>{for(const t of this._threads)t instanceof i.pX&&t.destroyAll(),t instanceof i.jV&&t.destroy()}))}setThreadPort(t,e){const s=this.getThread(t);if(s instanceof i.pX){if(!Array.isArray(e))throw new Error("Thread is a pool and needs an array of ports");for(const t of e)s.addPort(t)}else if(s instanceof i.jV){if(Array.isArray(e))throw new Error("Thread is a single thread and needs one port.");s.setPort(e)}}addThread(t){this.threadMap.set(t.name,t),this._threads.push(t)}getThread(t){const e=this.threadMap.get(t);if(!e)throw new Error(`Thread with id ${t} does not exists`);return e}}},92287:(t,e,s)=>{s.d(e,{BN:()=>c,WS:()=>r,bv:()=>n,pN:()=>a,uv:()=>o});var i=s(99673);function r(t,e,s,i,r,a,o=[0,0,0]){return o[0]=t>>i<<i,o[1]=e>>r<<r,o[2]=s>>a<<a,o}function a(t,e,s,r,a,o,n=i.Az.Create()){return n.x=t>>r<<r,n.y=e>>a<<a,n.z=s>>o<<o,n}function o(t,e,s,i,r=[0,0,0]){return r[1]=Math.floor(t/(e*i)),r[0]=Math.floor(t%(e*i)/i),r[2]=t%i,r}function n(t,e,s,r,a=i.Az.Create()){return a.y=Math.floor(t/(e*r)),a.x=Math.floor(t%(e*r)/r),a.z=t%r,a}function c(t,e,s,i,r,a){return Math.floor(s+a*(t+i*e))}},39757:(t,e,s)=>{s.d(e,{i:()=>n});var i=s(98222),r=s(22120),a=s(55128);class o extends a.m{enviorment=r.O.isNode()?"node":"browser";settings=new i.ih;version="0.0.72";get doSunPropagation(){return 1==this.settings.propagation.sunLightEnabled}get doRGBPropagation(){return 1==this.settings.propagation.rgbLightEnabled}get doLight(){return this.doRGBPropagation||this.doSunPropagation}get doFlow(){return this.settings.propagation.flowEnabled}get doPower(){return this.settings.propagation.powerEnabled}getSettings(){return this.settings}syncSettings(t){for(const e of Object.keys(t)){if(e.includes("__"))throw new Error("Can not include properties with multpile underscores.");if(void 0!==this.settings[e])for(const s of Object.keys(t[e])){if(s.includes("__"))throw new Error("Can not include properties with multpile underscores.");void 0!==this.settings[e][s]&&(this.settings[e][s]=t[e][s])}}this.dispatch("synced",{settings:this})}getSettingsCopy(){return JSON.parse(JSON.stringify(this.settings))}}const n=new o},98222:(t,e,s)=>{s.d(e,{ih:()=>d});var i=s(99673);class r{doSunLight=!0;doAO=!0;doColors=!0}class a{mode="webgl";cpuBound=!1}class o{dirtyMechanism=!0;autoRebuild=!1}class n{min=i.Az.Create(-Number.MAX_SAFE_INTEGER,0,-Number.MAX_SAFE_INTEGER);max=i.Az.Create(Number.MAX_SAFE_INTEGER,256,Number.MAX_SAFE_INTEGER);sectorPower2Size=i.Az.Create(4,8,4);sectionPower2Size=i.Az.Create(4,4,4)}class c{rgbLightEnabled=!0;sunLightEnabled=!0;flowEnabled=!0;powerEnabled=!0}class d{mesher=new r;rendererSettings=new a;updating=new o;world=new n;propagation=new c}},29105:(t,e,s)=>{function i(t,e,s){return t>>>e&(1<<s)-1}function r(t,e,s,i){const r=(1<<i)-1;return t&~(r<<e)|(s&r)<<e}function a(t){return t%2==0?t:t+1}s.d(e,{Lm:()=>r,bZ:()=>a,x3:()=>i})},22120:(t,e,s)=>{s.d(e,{O:()=>i});class i{static isNode(){return"undefined"!=typeof process&&process.versions&&!!process.versions.node}static isBrowser(){return!this.isNode()}}},11601:(t,e,s)=>{s.d(e,{N:()=>i});class i{_count=0;_palette=[];_map={};constructor(t){if(t){const e=t.length;for(let s=0;s<e;s++)this.register(t[s])}}get size(){return this._count}load(t){this._palette=[],this._map={};const e=t.length;for(let s=0;s<e;s++)this.register(t[s])}register(t){const e=this._count;return this._count++,this._palette[e]=t,this._map[t]=e,e}get(){return this._palette}getMap(){return this._map}isRegistered(t){return void 0!==this._map[t]}getNumberId(t){return this._map[t]}getStringId(t){return this._palette[t]}}},55128:(t,e,s)=>{s.d(e,{m:()=>i});class i extends EventTarget{addEventListener(t,e,s){super.addEventListener(t,e,s)}removeEventListener(t,e){super.removeEventListener(t,e)}dispatch(t,e){return super.dispatchEvent(new CustomEvent(t,{detail:e})),!0}}},46088:(t,e,s)=>{s.d(e,{S:()=>h});var i=s(50327),r=s(63846),a=s(61295),o=s(59194),n=s(15661),c=s(18556),d=s(5522);class h{_loadedId=0;id=0;secondaryId=0;_tags={};_substanceTags={};__secondary=!1;_index=0;_lightData=new i.$;process(){this.id=this.ids[this._index],this.secondaryId=this.secondary[this._index],this.secondaryId>1?this.id=this.secondaryId:this.secondaryId=0,this._loadedId=this.getId(),this._tags=n.L.VoxelTags[this._loadedId],this._substanceTags=n.L.SubstanceStags[c.A.substance.getNumberId(this._tags.dve_substance)]}setSecondary(t){return this.__secondary=t,o.x,n.L,this._loadedId=this.getId(),this}getRenderedMaterial(){return this._tags[o.x.renderedMaterial]}getMaterial(){return this._tags[o.x.voxelMaterial]}checkCollisions(){return this._tags[o.x.checkCollisions]}getCollider(){return this._tags[o.x.colliderID]}getSubstance(){return this._tags[o.x.substance]}getSubstanceData(){return this._substanceTags}isOpaque(){return!this._tags[o.x.isTransparent]}getMod(){return this.mod[this._index]}setMod(t){return this.mod[this._index]=t,this}getLevel(){return r.o.getLevel(this.level[this._index])}setLevel(t){return this.level[this._index]=r.o.setLevel(this.level[this._index],t),this}getLevelState(){return r.o.getLevelState(this.level[this._index])}setLevelState(t){return this.level[this._index]=r.o.setLevelState(this.level[this._index],t),this}getState(){return this.state[this._index]}setState(t){return this.state[this._index]=t,this}hasSecondaryVoxel(){return this.secondaryId>1}canHaveSecondaryVoxel(){return this._tags[o.x.canHaveSecondary]}hasRGBLight(){const t=this.getLight();return this._lightData.hasRGBLight(t)}hasSunLight(){const t=this.getLight();return this._lightData.hasSunLight(t)}getLight(){return 0==this._loadedId?this.light[this._index]:this.isOpaque()?this.isLightSource()?this._tags[o.x.lightValue]:-1:this.isLightSource()?this._lightData.mixLight(this.light[this._index],this._tags[o.x.lightValue]):this.light[this._index]}setLight(t){return this.light[this._index]=t,this}isLightSource(){return!(this._loadedId<=0)&&(d.U.voxels[this._loadedId]?.hasTag(o.x.isLightSource)?d.U.voxels[this._loadedId].getTagValue(o.x.isLightSource,this):a.B.isRegistered(this._loadedId,o.x.isLightSource)?!0===a.B.getValue(this._loadedId,o.x.isLightSource,this.getState()):this._tags[o.x.isLightSource])}doesVoxelAffectLogic(){return!!(this._tags.dve_can_be_powered||this._tags.dve_can_hold_power||this._tags.dve_can_carry_power||this._tags.dve_is_power_source)}getLightSourceValue(){return this._loadedId<=0?0:this._tags[o.x.lightValue]}getPower(){if(0==this._loadedId)return-1;if(this._substanceTags.dve_is_liquid)return-1;if(!(this._tags.dve_can_carry_power||this._tags.dve_can_hold_power||this._tags.dve_can_be_powered||this._tags.dve_is_power_source))return-1;const t=r.o.getLevel(this.level[this._index]);return this._tags.dve_is_power_source&&this._tags.dve_power_value>t?this._tags.dve_power_value:t}setPower(t){return this.level[this._index]=r.o.setLevel(this.level[this._index],t),this}isPowerSource(){return!(this._loadedId<=0)&&(a.B.isRegistered(this._loadedId,o.x.isPowerSource)?!0===a.B.getValue(this._loadedId,o.x.isPowerSource,this.getState()):this._tags[o.x.isPowerSource])}getPowerSourceValue(){return this._loadedId<=0?0:this._tags[o.x.powerValue]}noAO(){return!(this._loadedId<=0)&&this._tags[o.x.noAO]}isRenderable(){return this.id>0||!!(this.canHaveSecondaryVoxel()&&this.secondary[this._index]>0)}isAir(){return 0==this.ids[this._index]}setAir(){return this.ids[0]=0,this}getId(){return this.__secondary?this.secondaryId:this.id}setId(t){return this.__secondary?(this.secondary[this._index]=t,this):(this.ids[this._index]=t,this)}setStringId(t){return this.setId(c.A.voxels.getNumberId(t))}getStringId(){return this.__secondary?c.A.voxels.getStringId(this.secondaryId):c.A.voxels.getStringId(this.id)}setName(t){return this.setStringId(c.A.voxelNametoIdMap.get(t))}getName(){return c.A.voxelIdToNameMap.get(this.getStringId())}isSameVoxel(t){return this.getId()==t.getId()}copy(t){return this.ids[this._index]=t.ids[t._index],this.light[this._index]=t.light[t._index],this.level[this._index]=t.level[t._index],this.state[this._index]=t.state[t._index],this.mod[this._index]=t.mod[t._index],this.secondary[this._index]=t.secondary[t._index],this}copyRaw(t){return this.ids[this._index]=t[0],this.light[this._index]=t[1],this.level[this._index]=t[2],this.state[this._index]=t[3],this.secondary[this._index]=t[4],this.mod[this._index]=t[5],this}getRaw(){return[this.ids[this._index],this.light[this._index],this.level[this._index],this.state[this._index],this.mod[this._index],this.secondary[this._index]]}getRawToRef(t){return t[0]=this.ids[this._index],t[1]=this.light[this._index],t[2]=this.level[this._index],t[3]=this.state[this._index],t[4]=this.mod[this._index],t[5]=this.secondary[this._index],t}}},63846:(t,e,s)=>{s.d(e,{o:()=>i});class i{static getLevel(t){return 15&t}static setLevel(t,e){return-16&t|e}static getLevelState(t){return(240&t)>>4}static setLevelState(t,e){return-241&t|e<<4}}},50327:(t,e,s)=>{s.d(e,{$:()=>i});class i{_lightValues=[0,0,0,0];sumRGB(t){return this.getR(t)+this.getG(t)+this.getB(t)}getS(t){return 15&t}getR(t){return(240&t)>>4}getG(t){return(3840&t)>>8}getB(t){return(61440&t)>>12}setS(t,e){return-16&e|t}setR(t,e){return-241&e|t<<4}setG(t,e){return-3841&e|t<<8}setB(t,e){return-61441&e|t<<12}removeS(t){return this.setS(0,t)}hasRGBLight(t){return!(t<=0)&&(this.getR(t)>0||this.getG(t)>0||this.getB(t)>0)}hasSunLight(t){return!(t<=0)&&this.getS(t)>0}mixLight(t,e){const s=this.getS(t),i=this.getS(e),r=s<i?i:s,a=this.getR(t),o=this.getR(e),n=a<o?o:a,c=this.getG(t),d=this.getG(e),h=c<d?d:c,l=this.getB(t),u=this.getB(e),g=l<u?u:l;let x=this.setS(r,0);return x=this.setR(n,x),x=this.setG(h,x),x=this.setB(g,x),x}getRGB(t){return t<0?0:(65520&t)>>4}setRGB(t,e){return e<0?0:-65521&e|t<<4}createLightValue(t,e,s,i){let r=0;return r=this.setS(t,r),r=this.setR(e,r),r=this.setG(e,r),this.setB(e,r)}setLightValues(t){let e=this.setS(t[0],0);return e=this.setR(t[1],e),e=this.setG(t[2],e),this.setB(t[3],e)}getLightValuesArray(t){return this._lightValues[0]=this.getS(t),this._lightValues[1]=this.getR(t),this._lightValues[2]=this.getG(t),this._lightValues[3]=this.getB(t),this._lightValues}getLightValuesArrayToRef(t,e){return e[0]=this.getS(t),e[1]=this.getR(t),e[2]=this.getG(t),e[3]=this.getB(t),e}addLightValues(t,e){return this._lightValues[0]=this.getS(t)+this.getS(e),this._lightValues[1]=this.getR(t)+this.getR(e),this._lightValues[2]=this.getG(t)+this.getG(e),this._lightValues[3]=this.getB(t)+this.getB(e),this._lightValues[0]>15&&(this._lightValues[0]=15),this._lightValues[1]>15&&(this._lightValues[1]=15),this._lightValues[2]>15&&(this._lightValues[2]=15),this._lightValues[3]>15&&(this._lightValues[3]=15),this.setLightValues(this._lightValues)}divideLightValue(t,e){return this._lightValues[0]=Math.ceil(this.getS(t)/e),this._lightValues[1]=Math.ceil(this.getR(t)/e),this._lightValues[2]=Math.ceil(this.getG(t)/e),this._lightValues[3]=Math.ceil(this.getB(t)/e),this.setLightValues(this._lightValues)}}},18556:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(11601);class r{static material=new i.N;static substance=new i.N;static voxels=new i.N;static voxelNametoIdMap=new Map;static voxelIdToNameMap=new Map}},59194:(t,e,s)=>{var i,r;s.d(e,{L:()=>r,x:()=>i}),function(t){t.substance="dve_substance",t.renderedMaterial="dve_rendered_material",t.voxelMaterial="dve_voxel_material",t.hardness="dve_hardness",t.colliderID="dve_collider_id",t.checkCollisions="dve_check_collisions",t.isLightSource="dve_is_light_source",t.lightValue="dve_light_value",t.noAO="dve_no_ao",t.isTransparent="dve_is_transparent",t.canHaveSecondary="dve_can_have_secondary",t.canBePowered="dve_can_be_powered",t.canCarryPower="dve_can_carry_power",t.canHoldPower="dve_can_hold_power",t.isPowerSource="dve_is_power_source",t.powerValue="dve_power_value"}(i||(i={})),function(t){t.parent="dve_parent_substance",t.isSolid="dve_is_solid",t.isTransparent="dve_is_transparent",t.isLiquid="dve_is_liquid",t.flowRate="dve_flow_rate",t.isWindAffected="dve_is_wind_affected"}(r||(r={}))},61295:(t,e,s)=>{s.d(e,{B:()=>n});var i=s(18556),r=s(61886),a=s(50556),o=s(46830);class n{static voxelTags=[];static toJSON(){const t=[];return this.voxelTags.forEach(((e,s)=>{t[s]=Object.fromEntries(Object.keys(e).map((t=>[t,{tree:e[t].tree.tree,treePalette:e[t].treePalette}])))})),t}static load(t){t.forEach(((t,e)=>{if(!t)return;const s=new r.X(o.r.modelStaeBaseSchemaData.get(o.r.voxelModelMap.get(i.A.voxels.getStringId(e))));for(const i in t)this.register(e,i,s,t[i].tree,t[i].treePalette)}))}static register(t,e,s,i,r){let o=this.voxelTags[t];o||(o={},this.voxelTags[t]=o),o[e]={tree:new a.z(s,0,i),treePalette:r}}static isRegistered(t,e){return this.voxelTags[t]&&void 0!==this.voxelTags[t][e]}static getData(t,e){return this.voxelTags[t][e]}static getState(t,e,s){return this.voxelTags[t][e].tree.getState(s)}static getValue(t,e,s){return this.voxelTags[t][e].treePalette[this.voxelTags[t][e].tree.getState(s)]}}},15661:(t,e,s)=>{s.d(e,{L:()=>r});var i=s(59194);class r{static IncludedVoxelTags=[i.x.substance,i.x.renderedMaterial,i.x.voxelMaterial,i.x.hardness,i.x.colliderID,i.x.checkCollisions,i.x.isLightSource,i.x.lightValue,i.x.noAO,i.x.isTransparent,i.x.canHaveSecondary,i.x.isPowerSource,i.x.canBePowered,i.x.canCarryPower,i.x.canHoldPower,i.x.powerValue];static IncludedSubstnacesTags=[i.L.parent,i.L.isSolid,i.L.isTransparent,i.L.isLiquid,i.L.flowRate,i.L.isWindAffected];static VoxelTagDefaults={[i.x.renderedMaterial]:"dve_solid",[i.x.substance]:"dve_solid",[i.x.colliderID]:"dve_cube"};static VoxelTags=[];static SubstanceStagDefaults={};static SubstanceStags=[]}},17952:(t,e,s)=>{s.d(e,{P:()=>r});var i=s(52746);class r extends i.v{run(t){return t.getPower()>0}}},36162:(t,e,s)=>{s.d(e,{t:()=>r});var i=s(5522);class r{types=[];effectedTags=new Map;constructor(t){for(const e of t){const t=i.U.types.get(e.type);if(this.types.push(t),"powered"==e.type){for(const s of e.on)"tag"==s.type&&this.registerEffectOnTag(s.tagId,t);for(const s of e.off)"tag"==s.type&&this.registerEffectOnTag(s.tagId,t)}if("state"==e.type){for(const s of e.true)"tag"==s.type&&this.registerEffectOnTag(s.tagId,t);for(const s of e.false)"tag"==s.type&&this.registerEffectOnTag(s.tagId,t)}}}getTagValue(t,e){let s=this.effectedTags.get(t);if(!s)return null;let i=null;for(let t=0;t<s.length;t++)i=s[t].run(e);return i}registerEffectOnTag(t,e){let s=this.effectedTags.get(t);s||(s=[],this.effectedTags.set(t,s)),s.push(e)}hasTag(t){return this.effectedTags.has(t)}}},52746:(t,e,s)=>{s.d(e,{v:()=>i});class i{}},5522:(t,e,s)=>{s.d(e,{U:()=>o});var i=s(18556),r=s(36162),a=s(17952);class o{static voxels=[];static types=new Map;static register(t,e){const s=i.A.voxels.getNumberId(t);this.voxels[s]=new r.t(e)}static registerType(t,e){this.types.set(t,e)}}o.registerType("powered",new a.P)},46830:(t,e,s)=>{s.d(e,{r:()=>a});var i=s(14696),r=s(23403);class a{static modelStaeBaseSchemaData=new Map;static modelStateSchemaData=new Map;static voxelModSchemaData=new Map;static modelStaeSchemas=new Map;static voxelModSchemas=new Map;static voxelModelMap=new Map;static voxelSchemas=new Map;static hasVoxelSchema(t){return!!this.voxelSchemas.has(t)||!(!this.modelStateSchemaData.has(this.voxelModelMap.get(t)||"")||!this.voxelModSchemaData.has(t))}static getVoxelSchemas(t){if(this.voxelSchemas.has(t))return this.voxelSchemas.get(t);const e=this.voxelModelMap.get(t);if(!e)throw new Error(`Voxel ${t} is not registered`);let s=this.modelStaeSchemas.get(e);if(!s){const t=this.modelStateSchemaData.get(e);if(!t)throw new Error(`Model ${e} is not registered`);s=new i.n(t)}let a=this.voxelModSchemas.get(t);if(!a){const e=this.voxelModSchemaData.get(t);if(!e)throw new Error(`Voxel ${t} is not registered`);a=new i.n(e)}const o=new r.G(t,s,a);return this.voxelSchemas.set(t,o),o}static registerModel(t,e){const s=[];this.modelStaeBaseSchemaData.set(t,e);for(const t of e)"binary"==t.type&&s.push(t);this.modelStateSchemaData.set(t,s)}static registerVoxel(t,e,s){this.voxelModelMap.set(t,e);const i=[];for(const t of s)"binary"==t.type&&i.push(t);this.voxelModSchemaData.set(t,i)}}},14696:(t,e,s)=>{s.d(e,{n:()=>r});var i=s(87144);class r{nodeMap=new Map;nodes=[];constructor(t){for(const e of t)if("binary"==e.type){const t=new i.f(e);this.nodes.push(t),this.nodeMap.set(e.id,t)}}_value=0;readString(t){if("*"==t)return 0;const e=t.split(",");let s=0;for(const t of e){const[e,i]=t.split("=");if("*"==i)continue;const r=this.nodeMap.get(e);if(r)if(r.valuePalette){const t=r.valuePalette.getNumberId(i);if(void 0===t)throw new Error(`Binary schema string node value with id ${i} does not exist.`);s=r.setValue(s,t)}else s=r.setValue(s,Number(i))}return s}fromStateObject(t){let e=0;for(let s=0;s<t.length;s+=2){const i=t[s];if("string"!=typeof i)continue;const r=t[s+1],a=this.nodeMap.get(i);if(a)if("string"!=typeof r)e=a.setValue(e,r);else{if(!a.valuePalette)continue;e=a.setValue(e,a.valuePalette.getNumberId(r)||0)}}return e}getStateObject(t){const e=[];for(const s of this.nodes)s.valuePalette?e.push(s.id,s.valuePalette.getStringId(s.getValue(t))):e.push(s.id,s.getValue(t));return e}compareString(t,e){if("*"==t)return!0;const s=t.split(",");for(const t of s){const[s,i]=t.split("=");if("*"==i)continue;const r=this.nodeMap.get(s);if(r)if(r.valuePalette){const t=r.valuePalette.getNumberId(i);if(void 0===t)throw new Error(`Binary schema string node value  with id ${s} does not exist.`);if(r.getValue(e)!==t)return!1}else if(r.getValue(e)!==Number(i))return!1}return!0}startEncoding(t=0){return this._value=t,this}getNmber(t){const e=this.nodeMap.get(t);if(!e)throw new Error(`Node with ${t} does not exist.`);return e.getValue(this._value)}getValue(t){const e=this.nodeMap.get(t);if(!e)throw new Error(`Node with ${t} does not exist.`);if(!e.valuePalette)throw new Error(`Node with ${t} does not have a value palette.`);return e.valuePalette.getStringId(e.getValue(this._value))}setNumber(t,e){const s=this.nodeMap.get(t);if(!s)throw new Error(`Node with ${t} does not exist.`);return this._value=s.setValue(this._value,e),this}setValue(t,e){const s=this.nodeMap.get(t);if(!s)throw new Error(`Node with ${t} does not exist.`);if(!s.valuePalette)throw new Error(`Node with ${t} does not have a value palette.`);return this._value=s.setValue(this._value,s.valuePalette.getNumberId(e)),this}getEncoded(){return this._value}}},87144:(t,e,s)=>{s.d(e,{f:()=>r});var i=s(11601);class r{id;valuePalette;bitIndex=0;bitMask=0;constructor(t){this.id=t.id,this.bitIndex=t.index,this.bitMask=t.mask,t.valuePalette&&(this.valuePalette=new i.N(t.valuePalette))}getValue(t){return(t&this.bitMask<<this.bitIndex)>>this.bitIndex}setValue(t,e){return t&~(this.bitMask<<this.bitIndex)|(e&this.bitMask)<<this.bitIndex}}},14003:(t,e,s)=>{s.d(e,{u:()=>r});var i=s(92944);class r extends i.k{data;constructor(t,e){super(t),this.data=e}evulate(){const t=this.schema.position.x+this.data.direction[0],e=this.schema.position.y+this.data.direction[1],s=this.schema.position.z+this.data.direction[2],i=this.schema.dataCursor.getVoxel(t,e,s);return!!i&&this.schema.voxel.isSameVoxel(i)}}},92944:(t,e,s)=>{s.d(e,{k:()=>i});class i{schema;constructor(t){this.schema=t}}},73415:(t,e,s)=>{s.d(e,{i:()=>r});var i=s(14003);class r{schema;id;conditions=[];constructor(t,e){this.schema=t,this.id=e.id;for(const s of e.conditions)"same-voxel"==s.type&&this.conditions.push(new i.u(t,s))}getValue(){let t=1;const e=this.conditions.length;for(let s=0;s<e;s++)if(!this.conditions[s].evulate()){t=0;break}return t}}},61886:(t,e,s)=>{s.d(e,{X:()=>o});var i=s(73415),r=s(87144),a=s(99673);class o{nodes=[];position=a.Az.Create();voxel;dataCursor;constructor(t){for(const e of t)"binary"==e.type&&this.nodes.push(new r.f(e)),"relation"==e.type&&this.nodes.push(new i.i(this,e))}}},23403:(t,e,s)=>{s.d(e,{G:()=>i});class i{id;state;mod;constructor(t,e,s){this.id=t,this.state=e,this.mod=s}}},50556:(t,e,s)=>{s.d(e,{z:()=>i});class i{schema;defaultValue;tree;startingIndex=0;constructor(t,e=0,s){this.schema=t,this.defaultValue=e,this.tree=s}getState(t){if(!this.tree.length)return this.defaultValue;let e=this.startingIndex,s=this.tree;for(;;){if(s=s[e][this.schema.nodes[e].getValue(t)],"number"==typeof s)return s;if(void 0===s)return-1;for(let t=0;t<s.length;t++)if(s[t]){e=t;break}if("number"==typeof s)return s}return-1}}},69224:(t,e,s)=>{s.d(e,{j:()=>n});var i=s(75438),r=s(57870),a=s(62312),o=s(99673);class n{_current=null;_section;voxel=new r.$(this);_voxelIndex=0;_voxelPosition=o.Az.Create();_sectorPosition=o.Az.Create();inBounds(t,e,s){const i=this._sectorPosition.x+a.k.sector.bounds.x,r=this._sectorPosition.y+a.k.sector.bounds.y,o=this._sectorPosition.z+a.k.sector.bounds.z;return!(t<this._sectorPosition.x||e<this._sectorPosition.y||s<this._sectorPosition.z||t>i||e>r||s>o)}setSector(t,e,s,r){const a=i._.sectors.get(t,e,s,r);return!!a&&(this._current=a,this._sectorPosition.x=a.position[0],this._sectorPosition.y=a.position[1],this._sectorPosition.z=a.position[2],!0)}getSection(t,e,s){if(!this._current)return null;const i=this._current.sections[a.k.section.getIndex(t,e,s)];if(!i){if(!i)throw new Error(`Could not load section at ${t}-${e}-${s} | ${a.k.section.getIndex(t,e,s)}`);return this._section=null,null}return i}getVoxel(t,e,s){if(!this._current)return null;const i=this.getSection(t,e,s);return this._section=i,a.k.voxel.getPosition(t,e,s,this._voxelPosition),this._voxelIndex=a.k.voxel.getIndexFromPosition(this._voxelPosition.x,this._voxelPosition.y,this._voxelPosition.z),this.voxel.loadIn(),this.voxel}getVoxelAtIndex(t){this._voxelIndex=t}}},57870:(t,e,s)=>{s.d(e,{$:()=>r});var i=s(46088);class r extends i.S{dataCursor;_section=null;ids=new Uint16Array(1);light=new Uint16Array(1);level=new Uint8Array(1);state=new Uint16Array(1);mod=new Uint16Array(1);secondary=new Uint16Array(1);constructor(t){super(),this.dataCursor=t}loadIn(){this.dataCursor._section&&(this._section=this.dataCursor._section,this.ids=this._section.ids,this.light=this._section.light,this.level=this._section.level,this.state=this._section.state,this.mod=this._section.mod,this.secondary=this._section.secondary,this._index=this.dataCursor._voxelIndex,this.process())}updateVoxel(t){const e=this.dataCursor._voxelPosition;return this.dataCursor._section?.sector.setStored(!1),this.dataCursor._section?.setBuried(this.dataCursor._voxelIndex,!1),0==t?(this.doesVoxelAffectLogic()&&(this.dataCursor._section?.setLogicDirty(!0),this.dataCursor._section?.setLogicSliceDirty(e.y,!0),this.dataCursor._section?.setVoxelLogicDirty(this.dataCursor._voxelIndex,!0)),this.dataCursor._section?.setHasVoxel(e.y,!0),!0):1==t?(this.doesVoxelAffectLogic()&&(this.dataCursor._section?.setLogicDirty(!0),this.dataCursor._section?.setLogicSliceDirty(e.y,!0),this.dataCursor._section?.setVoxelLogicDirty(this.dataCursor._voxelIndex,!0)),this.dataCursor._section?.setHasVoxelDirty(e.y,!0),this.dataCursor._section?.setHasVoxel(e.y,!1),!0):(2==t&&this.doesVoxelAffectLogic()&&(this.dataCursor._section?.setLogicDirty(!0),this.dataCursor._section?.setLogicSliceDirty(e.y,!0),this.dataCursor._section?.setVoxelLogicDirty(this.dataCursor._voxelIndex,!0)),!1)}}},22132:(t,e,s)=>{s.d(e,{f:()=>i});class i{static CreateNew(t,e=""){return new i({id:e,index:t,sectors:new Map})}constructor(t){return Object.assign(this,t)}set(t,e){this.sectors.set(t,e)}delete(t){this.sectors.delete(t)}get(t){return this.sectors.get(t)}getData(){return{id:this.id,index:this.index}}}},80903:(t,e,s)=>{var i;s.d(e,{B:()=>r,n:()=>i}),function(t){t[t.displayDirty=0]="displayDirty",t[t.logicDirty=1]="logicDirty",t[t.inProgress=2]="inProgress",t[t.logicUpdateInProgress=3]="logicUpdateInProgress"}(i||(i={}));class r{static Flags=i;static StoredFlags={}}},70522:(t,e,s)=>{s.d(e,{h:()=>c});var i=s(52196),r=s(62312),a=s(85212),o=s(17541),n=s(29105);class c{position;static FlagIds=o.kP.Flags;static TimeStampIds=o.kP.TimeStamps;static GetHeaderSize(){return(0,n.bZ)(60)}static GetBufferSize(){const t=r.k.sector.bounds.y/r.k.section.bounds.y;return this.GetHeaderSize()+i.w.GetBufferSize()*t}static CreateNew(){const t=new SharedArrayBuffer(this.GetBufferSize()),e=new Uint8Array(t,0,12),s=new Uint32Array(t,12,12),a=[],o=r.k.sector.sectionVolumne;for(let e=0;e<o;e++)a[e]=i.w.CreateNew(e,t);return{buffer:t,flagArray:e,timeStampArray:s,sections:a}}sections=[];bufferView;constructor(t,e){this.position=e,this.flagArray=t.flagArray,this.timeStampArray=t.timeStampArray,this.buffer=t.buffer,this.bufferView=new Uint8Array(t.buffer);for(let e=0;e<t.sections.length;e++)this.sections[e]=new i.w(this,e,t.sections[e])}getSection(t,e,s){return this.sections[r.k.section.getIndex(t,e,s)]}setBitFlag(t,e){(0,a.JU)(this.flagArray,t,e?1:0)}getBitFlag(t){return 1==(0,a.Tv)(this.flagArray,t)}isDisplayDirty(){return this.getBitFlag(o.ng.displayDirty)}setDisplayDirty(t){this.setBitFlag(o.ng.displayDirty,t)}isLogicDirty(){return this.getBitFlag(o.ng.logicDirty)}setLogicDirty(t){this.setBitFlag(o.ng.logicDirty,t)}setStored(t){this.setBitFlag(o.ng.stored,t)}isStored(){return this.getBitFlag(o.ng.stored)}setTimeStamp(t,e){this.timeStampArray[t]=e}getTimeStamp(t){return this.timeStampArray[t]}*getRenerableSections(){for(const t of this.sections){const[e,s]=t.getMinMax();e!=1/0&&s!=-1/0&&(yield t)}}*getLogicDirtySections(){for(const t of this.sections){const[e,s]=t.getLogicMinMax();e!=1/0&&s!=-1/0&&(yield t)}}anySectionDisplayDirty(){if(!this.isDisplayDirty())return!1;for(let t=0;t<this.sections.length;t++)if(this.sections[t].isDisplayDirty()&&!this.sections[t].isInProgress())return!0;return this.setDisplayDirty(!1),!1}anySectionLogicDirty(){if(!this.isLogicDirty())return!1;for(let t=0;t<this.sections.length;t++)if(this.sections[t].isLogicDirty()&&!this.sections[t].isLogicUpdateInProgress())return!0;return this.setLogicDirty(!1),!1}storeFlags(){const t={};for(const e in o.kP.StoredFlags)t[e]=this.getBitFlag(o.kP.StoredFlags[e]);return t}loadFlags(t){for(const e in t){const s=o.kP.StoredFlags[e];void 0!==s?this.setBitFlag(s,t[e]):console.warn(`${e} does not exist on stored flags for sector`)}}storeTimestamps(){const t={};for(const e in o.kP.StoredTimeStamps)t[e]=this.getTimeStamp(o.kP.StoredTimeStamps[e]);return t}loadTimestamps(t){for(const e in t){const s=o.kP.StoredTimeStamps[e];void 0!==s?this.setTimeStamp(s,t[e]):console.warn(`${e} does not exist on stored timestamps for sector`)}}toJSON(){const t=[];for(const e of this.sections)t.push(e.toJSON());return{buffer:this.buffer,flagArray:this.flagArray,timeStampArray:this.timeStampArray,sections:t}}}},17541:(t,e,s)=>{var i,r;s.d(e,{kP:()=>a,ng:()=>i}),function(t){t[t.isWorldGenDone=0]="isWorldGenDone",t[t.isWorldDecorDone=1]="isWorldDecorDone",t[t.isWorldPropagationDone=2]="isWorldPropagationDone",t[t.isWorldSunDone=3]="isWorldSunDone",t[t.displayDirty=4]="displayDirty",t[t.logicDirty=5]="logicDirty",t[t.stored=6]="stored"}(i||(i={})),function(t){t[t.lastSaveTimestamp=0]="lastSaveTimestamp"}(r||(r={}));class a{static Flags=i;static StoredFlags={dve_is_world_gen_done:i.isWorldGenDone,dve_is_world_decoration_done:i.isWorldDecorDone,dve_is_world_progation_done:i.isWorldPropagationDone,dve_is_world_sun_done:i.isWorldSunDone};static TimeStamps=r;static StoredTimeStamps={}}},55138:(t,e,s)=>{var i;s.d(e,{U:()=>i}),function(t){t.SyncSector="sync-sector",t.UnSyncSector="unsync-sector",t.SyncDimension="sync-dimension",t.UnSyncDimension="unsync-dimension"}(i||(i={}))},75438:(t,e,s)=>{s.d(e,{_:()=>u});var i=s(62312),r=s(22132),a=s(70522),o=s(99673);class n{static dimension={onNew:t=>{},onRemove:t=>{}};static sectors={onNew:(t,e)=>{},onRemove:(t,e)=>{}}}class c{static add(t,e=""){const s=r.f.CreateNew(t,e);return u._dimensions.set(t,s),n.dimension.onNew(s.getData()),s}static get(t){return u._dimensions.get(t)}}const d=o.Az.Create();class h{static _secotrs=[];static _enabled=!1;static getSector(){return this._enabled&&this._secotrs.length?this._secotrs.shift():a.h.CreateNew()}static returnSector(t){t.bufferView.fill(0),this._secotrs.push(t.toJSON())}}class l{static setSecotrPool(t){h._enabled=t,h._secotrs.length=0}static add(t,e,s,r,o){let n=u.dimensions.get(t);n||(n=u.dimensions.add(t));const c=new a.h(o,i.k.sector.getPositionVec3Array(e,s,r));return n.sectors.set(i.k.hash.hashVec3Array(c.position),c),c}static addAt(t,e){return this.add(...t,e)}static new(t,e,s,i){if(this.get(t,e,s,i))return!1;let r=u.dimensions.get(t);r||(r=u.dimensions.add(t));const a=this.add(t,e,s,i,h.getSector());return n.sectors.onNew([t,e,s,i],a),!0}static newAt(t){return this.new(...t)}static get(t,e,s,r){let a=u.dimensions.get(t);return a&&a.sectors.get(i.k.hash.hashVec3(i.k.sector.getPosition(e,s,r,d)))||!1}static getAt(t){return this.get(...t)}static remove(t,e,s,r){let a=u.dimensions.get(t);if(!a)return!1;const o=i.k.sector.getPosition(e,s,r,d),c=i.k.hash.hashVec3(o),l=a.sectors.get(c);return!!l&&(h._enabled&&h.returnSector(l),n.sectors.onRemove([t,o.x,o.y,o.z],l),a.sectors.delete(c),!0)}static removeAt(t){return this.remove(...t)}}class u{static _dimensions=new Map([[0,new r.f(r.f.CreateNew(0,"main"))]]);static _hooks=n;static dimensions=c;static sectors=l;static clearAll(){this._dimensions.clear()}}},62312:(t,e,s)=>{s.d(e,{k:()=>g});var i=s(39757),r=s(99673),a=s(92287);const o=r.Az.Create(),n=r.Az.Create();class c{static bounds={MinZ:-Number.MAX_SAFE_INTEGER,MaxZ:Number.MAX_SAFE_INTEGER,MinX:-Number.MAX_SAFE_INTEGER,MaxX:Number.MAX_SAFE_INTEGER,MinY:0,MaxY:256};static setWorldBounds(t,e,s,i,r,a){this.bounds.MinX=t,this.bounds.MaxX=i,this.bounds.MinX=s,this.bounds.MaxZ=a,this.bounds.MinY=e,this.bounds.MaxY=r}static inBounds(t,e,s){return!(t<this.bounds.MinX||e<this.bounds.MinY||s<this.bounds.MinZ||t>this.bounds.MaxX||e>this.bounds.MaxY||s>this.bounds.MaxZ)}static getWorldWidth(){return this.bounds.MaxX-this.bounds.MinX}static getWorldDepth(){return this.bounds.MaxZ-this.bounds.MinZ}static getWorldHeightY(){return this.bounds.MaxY-this.bounds.MinY}static getWorldDimensions(){return{width:this.getWorldWidth(),depth:this.getWorldDepth(),height:this.getWorldHeightY()}}}class d{static power2Axes=r.Az.Create();static bounds=r.Az.Create();static volumne=0;static sectionBounds=r.Az.Create();static sectionVolumne=0;static getPosition(t,e,s,i=r.Az.Create()){return(0,a.pN)(t,e,s,d.power2Axes.x,d.power2Axes.y,d.power2Axes.z,i),i}static getPositionVec3Array(t,e,s,i=[0,0,0]){return(0,a.WS)(t,e,s,d.power2Axes.x,d.power2Axes.y,d.power2Axes.z,i),i}}class h{static power2Axes=r.Az.Create();static bounds=r.Az.Create();static volumne=0;static getPosition(t,e,s,i=r.Az.Create()){return(0,a.pN)(t,e,s,h.power2Axes.x,h.power2Axes.y,h.power2Axes.z,i),i}static getPositionVec3Array(t,e,s,i=[0,0,0]){return(0,a.WS)(t,e,s,h.bounds.x,h.bounds.y,h.bounds.z,i),i}static getIndex(t,e,s){return h.getPosition(t,e,s,o),d.getPosition(t,e,s,n),(0,a.BN)((o.x-n.x)/h.bounds.x,(o.y-n.y)/h.bounds.y,(o.z-n.z)/h.bounds.z,d.sectionBounds.x,d.sectionBounds.y,d.sectionBounds.z)}static getPositionFromIndex(t,e=r.Az.Create()){return(0,a.bv)(t,d.sectionBounds.x,d.sectionBounds.y,d.sectionBounds.z,e)}static getPositionFromIndexVec3Array(t,e=[0,0,0]){return(0,a.uv)(t,d.sectionBounds.x,d.sectionBounds.y,d.sectionBounds.z,e)}}class l{static bounds=r.Az.Create();static getPosition(t,e,s,i=r.Az.Create()){return(0,a.pN)(t,e,s,h.power2Axes.x,h.power2Axes.y,h.power2Axes.z,i),i.x=t-i.x,i.y=e-i.y,i.z=s-i.z,i}static getPositionVec3Array(t,e,s,i=[0,0,0]){return(0,a.WS)(t,e,s,h.power2Axes.x,h.power2Axes.y,h.power2Axes.z,i),i[0]=t-i[0],i[1]=e-i[1],i[2]=s-i[2],i}static getPositionFromIndex(t,e=r.Az.Create()){return(0,a.bv)(t,h.bounds.x,h.bounds.y,h.bounds.z,e)}static getIndex(t,e,s){const i=this.getPosition(t,e,s,o);return(0,a.BN)(i.x,i.y,i.z,h.bounds.x,h.bounds.y,h.bounds.z)}static getIndexFromPosition(t,e,s){return(0,a.BN)(t,e,s,h.bounds.x,h.bounds.y,h.bounds.z)}}class u{static hashVec3(t){return`${t.x}-${t.y}-${t.z}`}static hashVec3Array(t){return`${t[0]}-${t[1]}-${t[2]}`}static hashXYZ(t,e,s){return`${t}-${e}-${s}`}}class g{static hash=u;static world=c;static sector=d;static section=h;static voxel=l}i.i.addEventListener("synced",(t=>{const{settings:e}=t.detail.settings;c.setWorldBounds(e.world.min.x,e.world.min.y,e.world.min.z,e.world.max.x,e.world.max.y,e.world.max.z),d.power2Axes.x=e.world.sectorPower2Size.x,d.power2Axes.y=e.world.sectorPower2Size.y,d.power2Axes.z=e.world.sectorPower2Size.z,d.bounds.x=1<<d.power2Axes.x,d.bounds.y=1<<d.power2Axes.y,d.bounds.z=1<<d.power2Axes.z,d.volumne=d.bounds.x*d.bounds.y*d.bounds.z,h.power2Axes.x=e.world.sectionPower2Size.x,h.power2Axes.y=e.world.sectionPower2Size.y,h.power2Axes.z=e.world.sectionPower2Size.z,h.bounds.x=1<<h.power2Axes.x,h.bounds.y=1<<h.power2Axes.y,h.bounds.z=1<<h.power2Axes.z,h.volumne=h.bounds.x*h.bounds.y*h.bounds.z,d.sectionBounds.x=d.bounds.x/h.bounds.x,d.sectionBounds.y=d.bounds.y/h.bounds.y,d.sectionBounds.z=d.bounds.z/h.bounds.z,d.sectionVolumne=d.sectionBounds.x*d.sectionBounds.y*d.sectionBounds.z}))}}]);