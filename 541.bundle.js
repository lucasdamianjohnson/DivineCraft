(()=>{"use strict";var t,e,s,i,r,o,n={71447:(t,e,s)=>{s.a(t,(async(t,e)=>{try{var i=s(97039),r=s(66421);const t=await(0,i.Y)();r.h.init(t),r.h.start(),e()}catch(t){e(t)}}),1)},99673:(t,e,s)=>{s.d(e,{Az:()=>i.Az});var i=s(33410);s(93587)},28432:(t,e,s)=>{s.d(e,{j:()=>n});var i=s(87137),r=s(84918),o=s(55725);class n{name;index;threadPoolName;static readySet=new Set;get isRemoteReady(){return n.readySet.has(this)}get isPortSet(){return Boolean(this.port)}port=null;_pool=null;constructor(t,e,s="worker",i=null){this.name=t,this.index=e,this.threadPoolName=s,this._pool=i}setPort(t){if(this.port=t,"browser"==i.Q.environment){const e=t;e.onmessage=t=>{o.E.runInternal(t.data,this,t)},e.onmessageerror=t=>{console.error(`Error occured in from thread ${this.name}`),console.log(t.data),console.log(t)}}if("node"==i.Q.environment){const e=t;e.on("message",(t=>{o.E.runInternal(t,this,t)})),e.on("error",(t=>{console.error(`Error occured in from thread ${this.name}`),console.log(t)}))}this.sendMessage([r.g.setReady,this.name,this.index])}sendMessage(t,e){if(!this.port)throw new Error(`Cannot send message to thread [${this.name}] port is not set`);this.port.postMessage(t,"browser"==i.Q.environment&&e?e:void 0)}connectToThread(t){const e=new MessageChannel;t.sendMessage([r.g.connectPort,this.name,this.threadPoolName,e.port1],[e.port1]),this.sendMessage([r.g.connectPort,t.name,t.threadPoolName,e.port2],[e.port2])}waitTillTaskExist(t,e=50){let s=!1;return new Promise((i=>{const r=t=>{if(s)return clearTimeout(n);t?(s=!0,i(!0),clearTimeout(n)):setTimeout(o,e)},o=()=>{this.taskExist(t,r)};let n=setTimeout(o,e)}))}taskExist(t,e){const s=o.E.getPromiseId();o.z.checkTasks[1]=t,o.z.checkTasks[2]=s,this.sendMessage(o.z.checkTasks),o.E.addPromiseTakss("tasks-check",s,(t=>{e(t)}))}runTask(t,e,s,i){const r=i?o.E.getPromiseId():-1;i&&o.E.addPromiseTakss(t,r,i),o.z.runTask[1]=t,o.z.runTask[2]=r,o.z.runTask[3]=e,this.sendMessage(o.z.runTask,s),o.z.runTask[3]=null}runTaskAsync(t,e,s){return new Promise((i=>{this.runTask(t,e,s,(t=>{i(t)}))}))}waitTillReady(){return new Promise(((t,e)=>{const s=setInterval((()=>{this.isPortSet&&(clearInterval(s),t(!0))}),1)}))}destroy(){n.readySet.delete(this),this.port&&"terminate"in this.port&&this.port.terminate()}}},82938:(t,e,s)=>{s.d(e,{p:()=>o});var i=s(28432),r=s(87137);class o{name;_totalThreads=0;_currentThread=0;__threads=[];constructor(t){this.name=t}getThreads(){return this.__threads}connectToThread(t){for(const e of this.__threads)e.connectToThread(t)}destroyAll(){for(const t of this.__threads)t.destroy()}isReady(){let t=!0;for(const e of this.__threads)e.isPortSet||(t=!1);return t}waitTillAllAreReady(){return new Promise(((t,e)=>{const s=setInterval((()=>{this.isReady()&&(clearInterval(s),t(!0))}),1)}))}addPort(t){const e=`${this.name}-${this._totalThreads}`,s=new i.j(e,this._totalThreads,this.name,this);r.Q.addThread(s),s.setPort(t),this.__threads.push(s),this._totalThreads++}runTaskForAll(t,e,s){for(let i=0;i<this.__threads.length;i++)this.__threads[i].runTask(t,e,s)}runTask(t,e,s,i,r,o){return"number"!=typeof r?(this._currentThread==o&&this.__handleCount(),this.__threads[this._currentThread].runTask(t,e,s,i),this.__handleCount()):(this.__threads[r].runTask(t,e,s,i),r)}runTaskAsync(t,e,s,i,r){return new Promise((o=>{this.runTask(t,e,s,o,i,r)}))}__handleCount(){let t=this._currentThread;return this._currentThread++,this._currentThread>=this._totalThreads&&(this._currentThread=0),t}}},66421:(t,e,s)=>{s.d(e,{h:()=>V});var i=s(24579);const r=i.$m.registerContext({type:"dve-nexus"});var o=s(99673);const n=i.$m.registerComponent({type:"transform",schema:i.$m.schema({position:i.$m.property(o.Az.Create(),{type:"vector-3",binary:"f32"}),rotation:i.$m.property(o.Az.Create(),{type:"vector-3",binary:"f32"}),scale:i.$m.property(o.Az.Create(1,1,1),{type:"vector-3",binary:"f32"})},[{id:"shared-array",type:"typed-array",sharedMemory:!0,arrayType:"f32"},{id:"array",type:"typed-array",arrayType:"f32"}])}),a=i.$m.registerComponent({type:"box-collider",schema:i.$m.schema({offset:i.$m.property(o.Az.Create(),{type:"vector-3",binary:"f32"}),size:i.$m.property(o.Az.Create(),{type:"vector-3",binary:"f32"})},[{id:"shared-binary-object",type:"binary-object",sharedMemory:!0},{id:"shared-binary-object",type:"binary-object"}])});class h{component;constructor(t){this.component=t}setForce(t){return o.Az.Copy(this.component.schema.force,t),t}getForce(){return this.component.schema.force}setVelocity(t){return o.Az.Copy(this.component.schema.velocity,t),t}getVelocity(){return this.component.schema.velocity}}const d=i.$m.registerComponent({type:"physics-body",data:i.$m.data(),schema:i.$m.schema({velocity:i.$m.property(o.Az.Create(),{binary:"f32"}),mass:i.$m.property(1,{binary:"f32"}),friction:i.$m.property(.5,{binary:"f32"}),acceleration:i.$m.property(o.Az.Create(),{binary:"f32"}),angularVelocity:i.$m.property(o.Az.Create(),{binary:"f32"}),angularAcceleration:i.$m.property(o.Az.Create(),{binary:"f32"}),force:i.$m.property(o.Az.Create(),{binary:"f32"}),torque:i.$m.property(o.Az.Create(),{binary:"f32"}),damping:i.$m.property(o.Az.Create(),{binary:"f32"}),angularDamping:i.$m.property(.1,{binary:"f32"}),gravityScale:i.$m.property(1,{binary:"f32"}),isKinematic:i.$m.property(0,{binary:"ui8"})},[{id:"shared-binary-object",type:"binary-object",sharedMemory:!0},{id:"binary-object",type:"binary-object"}]),init:t=>t.data=new h(t.cloneCursor()),dispose:t=>t.data.component.returnCursor()});class c{raw={hitDepth:1,nx:0,ny:0,nz:0};update(t,e,s,i){return this.raw.hitDepth=t,this.raw.nx=e,this.raw.ny=s,this.raw.nz=i,this}loadIn(t){this.raw.hitDepth=t.raw.hitDepth,this.raw.nx=t.raw.nx,this.raw.ny=t.raw.ny,this.raw.nz=t.raw.nz}reset(){this.raw.hitDepth=1,this.raw.nx=0,this.raw.ny=0,this.raw.nz=0}collided(){return this.raw.hitDepth<1}faceHit={top:()=>1==this.raw.ny&&this.collided(),bottom:()=>-1==this.raw.ny&&this.collided(),east:()=>1==this.raw.nx&&this.collided(),west:()=>-1==this.raw.nx&&this.collided(),north:()=>1==this.raw.nz&&this.collided(),south:()=>-1==this.raw.nz&&this.collided()};normalHit={x:()=>this.raw.nx,y:()=>this.raw.ny,z:()=>this.raw.nz}}class l{bounds={minX:1/0,maxX:-1/0,minZ:1/0,maxZ:-1/0,minY:1/0,maxY:-1/0};_full={w:.8,h:1.8,d:.8};_half={w:.4,h:.9,d:.4};position=o.Az.Create();constructor(t=1,e=t,s=t){this._full.w=t,this._full.h=e,this._full.d=s,this._half.w=t/2,this._half.h=e/2,this._half.d=s/2}update(t,e,s){this.width=t,this.height=e,this.depth=s}setPosition(t){o.Az.Copy(this.position,t);const e=this.position;this.bounds.minX=e.x,this.bounds.maxX=e.x+this.width,this.bounds.minZ=e.z,this.bounds.maxZ=e.z+this.depth,this.bounds.minY=e.y,this.bounds.maxY=e.y+this.height}get width(){return this._full.w}get height(){return this._full.h}get depth(){return this._full.d}set width(t){this._full.w=t,this._half.w=t/2}set height(t){this._full.h=t,this._half.h=t/2}set depth(t){this._full.d=t,this._half.d=t/2}get halfWidth(){return this._half.w}get halfHeight(){return this._half.h}get halfDepth(){return this._half.d}pointIsInside(t){return t.x>=this.bounds.minX&&t.x<=this.bounds.maxX&&t.y>=this.bounds.minY&&t.y<=this.bounds.maxY&&t.z>=this.bounds.minZ&&t.z<=this.bounds.maxZ}doesIntersect(t){return this.bounds.minX<=t.bounds.maxX&&this.bounds.maxX>=t.bounds.minX&&this.bounds.minY<=t.bounds.maxY&&this.bounds.maxY>=t.bounds.minY&&this.bounds.minZ<=t.bounds.maxZ&&this.bounds.maxZ>=t.bounds.minZ}*query(){const t=Math.floor(this.bounds.minX),e=Math.floor(this.bounds.minY),s=Math.floor(this.bounds.minZ),i=Math.ceil(this.bounds.maxX),r=Math.ceil(this.bounds.maxY),o=Math.ceil(this.bounds.maxZ);for(let n=e;n<=r;n++)for(let e=t;e<=i;e++)for(let t=s;t<=o;t++)yield[e,n,t]}}const y=i.$m.registerComponent({type:"collider-state",schema:i.$m.schema({isGrounded:i.$m.property(0,{binary:"ui8"}),isInLiquid:i.$m.property(0,{binary:"ui8"})},[{id:"shared-binary-object",type:"binary-object",sharedMemory:!0},{id:"binary-object",type:"binary-object"}])});var u=s(69224),p=s(62312);let m=[];const g=o.Az.Create();class x{sectorCursors={};origin=o.Az.Create();dimension=0;_lastPosition=o.Az.Create();setFocalPoint(t,e,s,i){const r=p.k.sector.getPosition(e,s,i,g);for(const t in this.sectorCursors)for(const e in this.sectorCursors[t]){const s=this.sectorCursors[t][e];s&&(m.push(s),this.sectorCursors[t][e]=null)}this.dimension=t,this.origin.x=r.x/p.k.sector.bounds.x,this.origin.y=r.y/p.k.sector.bounds.y,this.origin.z=r.z/p.k.sector.bounds.z,this.getSector(e,s,i)}inBounds(t,e,s){return p.k.world.inBounds(t,e,s)}getSector(t,e,s){if(!this.inBounds(t,e,s))return null;const i=p.k.sector.getPosition(t,e,s,g),r=i.x/p.k.sector.bounds.x-this.origin.x,o=i.z/p.k.sector.bounds.z-this.origin.z;let n=this.sectorCursors[r]?.[o];if(!n){if(n=m.length?m.shift():new u.j,!n.setSector(this.dimension,i.x,i.y,i.z))return m.push(n),null;this.sectorCursors[r]||(this.sectorCursors[r]??={}),this.sectorCursors[r][o]=n}return n}getVoxel(t,e,s){const i=this.getSector(t,e,s);return i?i.getVoxel(t,e,s):null}}const f={colliders:{},registerCollider(t){if(Array.isArray(t))return t.forEach((t=>this.colliders[t.id]=t));this.colliders[t.id]=t},getCollider(t){const e=this.colliders[t];if(!e)throw new Error(`Collider with ${t} does not exists.`);return e}},z=o.Az.Create(),b=o.Az.Create(),w=o.Az.Create(),v=o.Az.Create(),C=.001,_={results:new c,line:new class{start=o.Az.Create();end=o.Az.Create();update(t,e){return o.Az.Copy(this.start,t),o.Az.Copy(this.end,e),this}},plane:new class{dimensions=o.Az.Create();normal=o.Az.Create();update(t,e){return o.Az.Copy(this.dimensions,t),o.Az.Copy(this.normal,e),this}lineToPlane(t){const e=this.normal.x*t.end.x+this.normal.y*t.end.y+this.normal.z*t.end.z;return 0==e?1/0:(this.normal.x*(this.dimensions.x-t.start.x)+this.normal.y*(this.dimensions.y-t.start.y)+this.normal.z*(this.dimensions.z-t.start.z))/e}},dimensions:o.Az.Create()},A=new l,T=(t,e,s)=>t>=e&&t<=s,D={Zero:o.Az.Create(),Up:o.Az.Create(0,1,0),Down:o.Az.Create(0,-1,0),West:o.Az.Create(-1,0,0),East:o.Az.Create(1,0,0),North:o.Az.Create(0,0,1),South:o.Az.Create(0,0,-1)},k=(t,e,s,i)=>{let r,o,n,a,h,d,c;r=s.position.x-(t.x+e.width),o=s.position.y-(t.y+e.height),n=s.position.z-(t.z+e.depth),a=e.width+s.boundingBox.width,h=e.height+s.boundingBox.height,d=e.depth+s.boundingBox.depth,s.results.reset();const l=s.results.raw;return _.line.update(D.Zero,i),_.dimensions.x=r,_.dimensions.y=o,_.dimensions.z=n,c=_.plane.update(_.dimensions,D.West).lineToPlane(_.line),c>=0&&i.x>0&&c<l.hitDepth&&T(c*i.y,o,o+h)&&T(c*i.z,n,n+d)&&s.results.update(c,-1,0,0),_.dimensions.x=r+a,_.dimensions.y=o,_.dimensions.z=n,c=_.plane.update(_.dimensions,D.East).lineToPlane(_.line),c>=0&&i.x<0&&c<l.hitDepth&&T(c*i.y,o,o+h)&&T(c*i.z,n,n+d)&&s.results.update(c,1,0,0),_.dimensions.x=r,_.dimensions.y=o,_.dimensions.z=n,c=_.plane.update(_.dimensions,D.Down).lineToPlane(_.line),c>=0&&i.y>0&&c<l.hitDepth&&T(c*i.x,r,r+a)&&T(c*i.z,n,n+d)&&s.results.update(c,0,-1,0),_.dimensions.x=r,_.dimensions.y=o+h,_.dimensions.z=n,c=_.plane.update(_.dimensions,D.Up).lineToPlane(_.line),c>=0&&i.y<0&&c<l.hitDepth&&T(c*i.x,r,r+a)&&T(c*i.z,n,n+d)&&s.results.update(c,0,1,0),_.dimensions.x=r,_.dimensions.y=o,_.dimensions.z=n,c=_.plane.update(_.dimensions,D.South).lineToPlane(_.line),c>=0&&i.z>0&&c<l.hitDepth&&T(c*i.x,r,r+a)&&T(c*i.y,o,o+h)&&s.results.update(c,0,0,-1),_.dimensions.x=r,_.dimensions.y=o,_.dimensions.z=n+d,c=_.plane.update(_.dimensions,D.South).lineToPlane(_.line),c>=0&&i.z<0&&c<l.hitDepth&&T(c*i.x,r,r+a)&&T(c*i.y,o,o+h)&&s.results.update(c,0,0,1),s.results.raw};let M;o.Az.Create();const P=o.Az.Create();function S(t,e,s){if(e.isKinematic)return;e.force.y+=-9.81*e.mass*e.gravityScale;const i=e.force.x/e.mass,r=e.force.y/e.mass,o=e.force.z/e.mass;e.velocity.x+=i*s,e.velocity.y+=r*s,e.velocity.z+=o*s,e.velocity.y<-50&&(e.velocity.y=-50),e.velocity.x*=1-e.damping.x*s,e.velocity.y*=1-e.damping.y*s,e.velocity.z*=1-e.damping.z*s,P.x=-e.friction*e.velocity.x,P.y=-e.friction*e.velocity.y,P.z=-e.friction*e.velocity.z,e.velocity.x+=P.x*s,e.velocity.y+=P.y*s,e.velocity.z+=P.z*s,e.force.x=0,e.force.y=0,e.force.z=0,t.x+=e.velocity.x*s,t.y+=e.velocity.y*s,t.z+=e.velocity.z*s}function $(t,e,s){e.isKinematic&&(t.x+=e.velocity.x*s,t.y+=(e.velocity.y+-9.81*s)*s,t.z+=e.velocity.z*s)}const B=o.Az.Create(),U=i.$m.registerSystem({type:"physics",queries:[i.$m.createQuery({inclueComponents:[d]})],update(t){M||(M=new x);const e=t.node;for(let s=0;s<t.queries.length;s++){const i=t.queries[s];for(let s=0;s<i.nodes.length;s++){e.setNode(t.graph,i.nodes[s]);const r=n.getRequired(e).schema;o.Az.Copy(z,r.position),o.Az.Copy(v,r.position),M.setFocalPoint(0,0|z.x,0|z.y,0|z.z);const h=d.getRequired(e).schema,c=a.getRequired(e),l=y.getRequired(e).schema;A.update(c.schema.size.x,c.schema.size.y,c.schema.size.z);const u=A.halfWidth,p=A.halfDepth,m=A.halfHeight;S(z,h,.016),$(z,h,.016);let g=!1,x=!1;for(;;){b.x=z.x-v.x,b.y=z.y-v.y,b.z=z.z-v.z;const t=Math.floor(Math.min(z.x,v.x)-u),e=Math.floor(Math.max(z.x,v.x)+u),s=Math.floor(Math.min(z.y,v.y)-m),i=Math.floor(Math.max(z.y,v.y)+m),r=Math.floor(Math.min(z.z,v.z)-p),n=Math.floor(Math.max(z.z,v.z)+p);_.results.reset();let a=_.results.raw;for(let o=s;o<=i;o++)for(let s=r;s<=n;s++)for(let i=t;i<=e;i++){const t=M.getVoxel(i,o,s);if(B.x=i,B.y=o,B.z=s,!t)continue;t.isRenderable()&&t.getSubstanceData().dve_is_liquid&&(x=!0);const e=t.getCollider();if(!e)continue;const r=f.getCollider(e);if(!r)continue;const n=r.getNodes(B);for(const e of n){w.x=v.x-u,w.y=v.y-m,w.z=v.z-p;const s=k(w,A,e,b);s.hitDepth<1&&1==s.ny&&(g=!0),t.checkCollisions()&&t.getSubstanceData().dve_is_solid&&r.isSolid&&s.hitDepth<a.hitDepth&&_.results.loadIn(e.results)}}if(z.x=v.x+a.hitDepth*b.x+C*a.nx,z.y=v.y+a.hitDepth*b.y+C*a.ny,z.z=v.z+a.hitDepth*b.z+C*a.nz,1==a.hitDepth)break;const h=a.nx*a.nx+a.ny*a.ny+a.nz*a.nz;if(0!=h){o.Az.Copy(v,z);const t=(1-a.hitDepth)*(b.x*a.nx+b.y*a.ny+b.z*a.nz);z.x+=(1-a.hitDepth)*b.x-t/h*a.nx,z.y+=(1-a.hitDepth)*b.y-t/h*a.ny,z.z+=(1-a.hitDepth)*b.z-t/h*a.nz}}o.Az.Copy(r.position,z),l.isGrounded=g?1:0,l.isInLiquid=x?1:0}}}});class F{name;boundingBox;results=new c;position=o.Az.Create();constructor(t,e){this.name=t,this.boundingBox=e}}class I{static createBBox(t=1,e=t,s=t){const i=new l(t,e,s);return i.setPosition(o.Az.Create()),i}nodes=[];addNode(t,e){this.nodes.push(new F(t,e))}hasFlag(t){return void 0!==this.flags[t]}}f.registerCollider(new class extends I{id="dve_cube";isSolid=!0;flags={};constructor(){super(),this.addNode("main",I.createBBox())}getNodes(t){return this.nodes[0].position.x=t.x,this.nodes[0].position.y=t.y,this.nodes[0].position.z=t.z,this.nodes}}),f.registerCollider(new class extends I{id="dve_climable_box";isSolid=!1;flags={dve_climbable:1};constructor(){super(),this.addNode("main",I.createBBox())}getNodes(t){return this.nodes[0].position.x=t.x,this.nodes[0].position.y=t.y,this.nodes[0].position.z=t.z,this.nodes}}),f.registerCollider(new class extends I{id="dve_stair";isSolid=!0;flags={};constructor(){super(),this.addNode("stair-bottom",I.createBBox(1,.5,1)),this.addNode("stair-top",I.createBBox(1,.5,.5))}getNodes(t){return this.nodes[0].position.x=t.x,this.nodes[0].position.y=t.y,this.nodes[0].position.z=t.z,this.nodes[0].position.x=t.x,this.nodes[1].position.y=t.y+.5,this.nodes[0].position.z=t.z,this.nodes}});const j=i.$m.registerContext({type:"dve-dimension",schema:i.$m.schemaFromObject(new class{dimension="main"})});var N;let Q;i.$m.registerComponent({type:"dimension-provider",schema:i.$m.schema({dimension:i.$m.property(0)}),init(t){const e=j.get(t.node);e&&t.schema.getCursor().setProxy(t.schema.getSchemaIndex().dimension,e.schema,"dimension")}}),function(t){t.RegisterCollider="register-collider",t.RemoveCollider="remove-collider"}(N||(N={}));let E=!1;const K=()=>{E&&(V.graph.update(),Q=setTimeout(R,16))},R=()=>K();class V{static graph;static async init(t){const e=i.$m.createGraph();var s;r.set(e.root,null,null,{dve:t}),this.graph=e,(s=t).TC.registerTask(N.RegisterCollider,(t=>[V.graph.addNode(t).index])),s.TC.registerTask(N.RemoveCollider,(([t])=>{V.graph.removeNode(t)}))}static start(){U.set(this.graph),E=!0,K()}static stop(){U.remove(this.graph),E=!1,Q&&clearTimeout(Q)}}},97039:(t,e,s)=>{s.d(e,{Y:()=>l});var i=s(27293),r=s(81168),o=s(39212);r.QK.parent,r.QK.createThread("rich-world"),r.QK.createThread("world");class n extends o.Q{parent=r.QK.parent;world=r.QK.createThread("world");NexusComm=r.QK.createThread("nexus");DataComm=r.QK.createThread("data-loader");ConstructorComm=r.QK.createThreadPool("constructor")}class a{static environment="browser";static instance;TC=r.QK;threads=new n;constructor(t){if(a.instance)return a.instance;a.instance=this}}var h=s(22120),d=s(55138),c=s(75438);async function l(t={}){const e=new a(t||{});a.environment=h.O.isNode()?"node":"browser";let s="render";"node"==a.environment&&(s="server"),await r.QK.init("constructor",self,s);let o=!1;return(0,i.A)({onSync(t){o=!0}}),r.QK.registerTask(d.U.SyncDimension,(t=>{c._.dimensions.add(t.index,t.id)})),r.QK.registerTask(d.U.UnSyncDimension,(t=>{})),r.QK.registerTask(d.U.SyncSector,(t=>{c._.sectors.add(t[0][0],t[0][1],t[0][2],t[0][3],t[1])})),r.QK.registerTask(d.U.UnSyncSector,(t=>{c._.sectors.remove(t[0],t[1],t[2],t[3])})),await new Promise((t=>{const e=()=>{if(o)return t(!0);setTimeout(e,10)};e()})),e}},52196:(t,e,s)=>{s.d(e,{w:()=>d});var i=s(62312),r=s(70522),o=s(85212),n=s(80903),a=s(29105);const h=[0,0];class d{sector;index;static GetBufferSize(){const t=i.k.section.volumne,e=i.k.section.bounds.y;return(0,a.bZ)(2+e/8+e/8+e/8+t/8+t/8+2*t+2*t+t+2*t+2*t+2*t)}static GetArrayStartIndex(t){return t*d.GetBufferSize()+r.h.GetHeaderSize()}static CreateNew(t,e){const s=i.k.section.volumne,r=i.k.section.bounds.y;let o=this.GetArrayStartIndex(t);const n=new Uint8Array(e,o,2);o+=2;const a=new Uint8Array(e,o,r/8);o+=r/8;const h=new Uint8Array(e,o,r/8);o+=r/8;const d=new Uint8Array(e,o,r/8);o+=r/8;const c=new Uint8Array(e,o,s/8);o+=s/8;const l=new Uint8Array(e,o,s/8);o+=s/8;const y=new Uint16Array(e,o,s);o+=2*s;const u=new Uint16Array(e,o,s);o+=2*s;const p=new Uint16Array(e,o,s);o+=2*s;const m=new Uint16Array(e,o,s);o+=2*s;const g=new Uint16Array(e,o,s);o+=2*s;const x=new Uint8Array(e,o,s);return o+=s,{flagArray:n,voxelMap:a,dirtyMap:h,logicDirtyMap:d,logicDirty:l,buried:c,ids:y,light:u,level:x,state:p,mod:m,secondary:g}}static toObject(t,e,s){return new d(t,e,s)}position;constructor(t,e,s){this.sector=t,this.index=e,this.position=i.k.section.getPositionFromIndexVec3Array(this.index),this.position[0]=this.position[0]*i.k.section.bounds.x+this.sector.position[0],this.position[1]=this.position[1]*i.k.section.bounds.y+this.sector.position[1],this.position[2]=this.position[2]*i.k.section.bounds.z+this.sector.position[2],this.flagArray=s.flagArray,this.voxelMap=s.voxelMap,this.dirtyMap=s.dirtyMap,this.logicDirty=s.logicDirty,this.logicDirtyMap=s.logicDirtyMap,this.buried=s.buried,this.ids=s.ids,this.level=s.level,this.light=s.light,this.secondary=s.secondary,this.state=s.state,this.mod=s.mod}getPosition(){return this.position}setBitFlag(t,e){(0,o.JU)(this.flagArray,t,e?1:0)}getBitFlag(t){return 1==(0,o.Tv)(this.flagArray,t)}isDisplayDirty(){return this.getBitFlag(n.n.displayDirty)}setDisplayDirty(t){this.setBitFlag(n.n.displayDirty,t),t&&(this.sector.setStored(!1),this.sector.setDisplayDirty(!0))}isLogicDirty(){return this.getBitFlag(n.n.logicDirty)}setLogicDirty(t){this.setBitFlag(n.n.logicDirty,t),t&&this.sector.setLogicDirty(!0)}isLogicSliceDirty(t){return 1==(0,o.Tv)(this.logicDirtyMap,t)}setLogicSliceDirty(t,e){(0,o.JU)(this.logicDirtyMap,t,e?1:0)}getVoxelLogicDirty(t){return 1==(0,o.Tv)(this.logicDirty,t)}setVoxelLogicDirty(t,e){return(0,o.JU)(this.logicDirty,t,e?1:0)}isInProgress(){return this.getBitFlag(n.n.inProgress)}setInProgress(t){this.setBitFlag(n.n.inProgress,t)}isLogicUpdateInProgress(){return this.getBitFlag(n.n.logicUpdateInProgress)}setLogicUpdateInProgress(t){this.setBitFlag(n.n.logicUpdateInProgress,t)}getBuried(t){return 1==(0,o.Tv)(this.buried,t)}setBuried(t,e){return(0,o.JU)(this.buried,t,e?1:0)}setHasVoxel(t,e){return(0,o.JU)(this.voxelMap,t,e?1:0)}getHasVoxel(t){return 1==(0,o.Tv)(this.voxelMap,t)}setHasVoxelDirty(t,e){return(0,o.JU)(this.dirtyMap,t,e?1:0)}getHasVoxelDirty(t){return 1==(0,o.Tv)(this.dirtyMap,t)}getMinMax(){let t=1/0,e=-1/0,s=i.k.section.bounds.y;for(;s--;)(this.getHasVoxel(s)||this.getHasVoxelDirty(s))&&(s<t&&(t=s),s>e&&(e=s));return h[0]=t,h[1]=e,h}getLogicMinMax(){let t=1/0,e=-1/0,s=i.k.section.bounds.y;for(;s--;)this.isLogicSliceDirty(s)&&(s<t&&(t=s),s>e&&(e=s));return h[0]=t,h[1]=e,h}storeFlags(){const t={};for(const e in n.B.StoredFlags)t[e]=this.getBitFlag(n.B.StoredFlags[e]);return t}loadFlags(t){for(const e in t){const s=n.B.StoredFlags[e];void 0!==s?this.setBitFlag(s,t[e]):console.warn(`${e} does not exist on stored flags for section`)}}toJSON(){return{flagArray:this.flagArray,logicDirtyMap:this.logicDirtyMap,logicDirty:this.logicDirty,voxelMap:this.voxelMap,dirtyMap:this.dirtyMap,buried:this.buried,ids:this.ids,light:this.light,level:this.level,secondary:this.secondary,state:this.state,mod:this.mod}}}}},a={};function h(t){var e=a[t];if(void 0!==e)return e.exports;var s=a[t]={exports:{}};return n[t](s,s.exports,h),s.exports}h.m=n,h.x=()=>{var t=h.O(void 0,[147,133],(()=>h(71447)));return h.O(t)},t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",s="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",i=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},h.a=(r,o,n)=>{var a;n&&((a=[]).d=-1);var h,d,c,l=new Set,y=r.exports,u=new Promise(((t,e)=>{c=e,d=t}));u[e]=y,u[t]=t=>(a&&t(a),l.forEach(t),u.catch((t=>{}))),r.exports=u,o((r=>{var o;h=(r=>r.map((r=>{if(null!==r&&"object"==typeof r){if(r[t])return r;if(r.then){var o=[];o.d=0,r.then((t=>{n[e]=t,i(o)}),(t=>{n[s]=t,i(o)}));var n={};return n[t]=t=>t(o),n}}var a={};return a[t]=t=>{},a[e]=r,a})))(r);var n=()=>h.map((t=>{if(t[s])throw t[s];return t[e]})),d=new Promise((e=>{(o=()=>e(n)).r=0;var s=t=>t!==a&&!l.has(t)&&(l.add(t),t&&!t.d&&(o.r++,t.push(o)));h.map((e=>e[t](s)))}));return o.r?d:n()}),(t=>(t?c(u[s]=t):d(y),i(a)))),a&&a.d<0&&(a.d=0)},r=[],h.O=(t,e,s,i)=>{if(!e){var o=1/0;for(c=0;c<r.length;c++){for(var[e,s,i]=r[c],n=!0,a=0;a<e.length;a++)(!1&i||o>=i)&&Object.keys(h.O).every((t=>h.O[t](e[a])))?e.splice(a--,1):(n=!1,i<o&&(o=i));if(n){r.splice(c--,1);var d=s();void 0!==d&&(t=d)}}return t}i=i||0;for(var c=r.length;c>0&&r[c-1][2]>i;c--)r[c]=r[c-1];r[c]=[e,s,i]},h.d=(t,e)=>{for(var s in e)h.o(e,s)&&!h.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},h.f={},h.e=t=>Promise.all(Object.keys(h.f).reduce(((e,s)=>(h.f[s](t,e),e)),[])),h.u=t=>t+".bundle.js",h.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),h.p="/",(()=>{var t={541:1};h.f.i=(e,s)=>{t[e]||importScripts(h.p+h.u(e))};var e=self.webpackChunkdivinecraft=self.webpackChunkdivinecraft||[],s=e.push.bind(e);e.push=e=>{var[i,r,o]=e;for(var n in r)h.o(r,n)&&(h.m[n]=r[n]);for(o&&o(h);i.length;)t[i.pop()]=1;s(e)}})(),o=h.x,h.x=()=>Promise.all([h.e(147),h.e(133)]).then(o),h.x()})();