"use strict";(self.webpackChunkdivinecraft=self.webpackChunkdivinecraft||[]).push([[741],{71280:(e,t,s)=>{var r,n;!function(e){e.North="north",e.South="south",e.West="west",e.East="east",e.NorthEast="north-east",e.NorthWest="north-west",e.SouthEast="south-east",e.SouthWest="south-west"}(r||(r={})),function(e){e[e.North=0]="North",e[e.NorthEast=Math.PI/4]="NorthEast",e[e.East=Math.PI/2]="East",e[e.SouthEast=3*Math.PI/4]="SouthEast",e[e.South=Math.PI]="South",e[e.SouthWest=5*Math.PI/4]="SouthWest",e[e.West=3*Math.PI/2]="West",e[e.NorthWest=7*Math.PI/4]="NorthWest"}(n||(n={})),r.North,n.North,r.South,n.South,r.West,n.West,r.East,n.East,r.NorthEast,n.NorthEast,r.NorthWest,n.NorthWest,r.SouthEast,n.SouthEast,r.SouthWest,n.SouthWest},5919:(e,t,s)=>{s.d(t,{Az:()=>r.A});var r=s(68823)},30053:(e,t,s)=>{s.d(t,{N:()=>h});var r=s(18472),n=s(62789),i=s(93406),o=s(85296);const a=[0,0];class d{componentAdded=new r.c;componentRemoved=new r.c;nodeAdded=new r.c;nodeRemoved=new r.c}class h{graph;numberTypeId;_freeSlots=[];_node=[];_disposed=[];_data=[];schemaArray;proto;observers=new d;_nodeCursor;_componentCursor;constructor(e,t){this.graph=e,this.numberTypeId=t;const s=n.g.components.get(n.g.components.idPalette.getStringId(t));s.schema&&(this.schemaArray=s.schema.array),this.proto=s,this._nodeCursor=i.t.Get(),this._componentCursor=o.w.Get()}addComponent(e,t,s){let r=this._freeSlots.length?this._freeSlots.shift():this._node.length;return this._node[r]=e,this._disposed[r]=!1,this.schemaArray&&this.schemaArray.setData(r,t,s),a[0]=this.numberTypeId,a[1]=r,this.observers.componentAdded.notify(a),r}removeComponent(e){if(void 0===this._node[e])return null;a[0]=this.numberTypeId,a[1]=e,this.observers.componentRemoved.notify(a),this.observers.nodeRemoved.notify(this._node[e]),this._freeSlots.push(e);const t=this._node[e];return this._disposed[e]=!0,this._data[e]=void 0,this._node[e]=-1,this.schemaArray&&this.schemaArray.removeData(e),t}update(){const e=this.proto.update;if(e)for(let t=0;t<this._disposed.length;t++)this._disposed[t]||(this._componentCursor.setInstance(this._nodeCursor.setNode(this.graph,this._node[t]),this.numberTypeId,t),e(this._componentCursor))}init(e){const t=this.proto.init;return!!t&&(this._componentCursor.setInstance(this._nodeCursor.setNode(this.graph,this._node[e]),this.numberTypeId,e),t(this._componentCursor),!1)}}},85296:(e,t,s)=>{s.d(t,{w:()=>o});var r=s(62789),n=s(93406),i=s(47525);class o{static Get(){return i.u.componentCursor.get()||new o}static Retrun(e){return i.u.componentCursor.addItem(e)}get index(){return this._index}get type(){return r.g.components.idPalette.getStringId(this._type)}get shared(){return this.__proto.shared}schema;get data(){return this.arrays._data[this._index]}set data(e){this.arrays._data[this._index]=e}node;arrays;__proto;get typeId(){return this._type}_index=0;_type=0;constructor(){}setInstance(e,t,s){return this._index=s,this._type=t,this.node=e,this.__proto=r.g.components.items[this._type],this.arrays=e.graph._components[t],void 0!==this.arrays?.schemaArray?._data[s]&&(this.schema=this.arrays.schemaArray.createViewCursor(s),this.schema.setInstance(s)),this}get isDisposed(){return this.arrays._disposed[this._index]}dispose(){this.__proto.dispose&&this.__proto.dispose(this),this.arrays.removeComponent(this._index)}returnCursor(){return o.Retrun(this)}cloneCursor(e,t){const s=e||o.Get(),r=t||n.t.Get();return r.setNode(this.node.graph,this.node.index),s.setInstance(r,this.typeId,this._index),s}update(){this.__proto.update&&this.__proto.update(this)}}},8149:(e,t,s)=>{s.d(t,{F:()=>n});var r=s(62789);class n{_freeSlots=[];_type=[];_node=[];_state=[];_disposed=[];_data=[];schemaArray;numberTypeId;addContext(e,t,s,n,i=null){let o=this._freeSlots.length?this._freeSlots.shift():this._node.length;const a=r.g.contexts.get(e).schema;if(a){let t=this.schemaArray[e];t||(t=a.array,this.schemaArray[e]=t),t.setData(o,n)}return this._type[o]=e,this._node[o]=t,this._state[o]=s,this._disposed[o]=!1,i&&(this._data[o]=i),o}removeContext(e){if(void 0===this._node[e])return null;this._freeSlots.push(e);const t=this._node[e];this._node[e]=[],this._state[e]=-1,this._disposed[e]=!0;let s=this.schemaArray[this._type[e]];return this._type[e]=-1,s&&s.removeData(e),this._data[e]=void 0,t}}},52800:(e,t,s)=>{s.d(t,{C:()=>i});var r=s(62789),n=s(47525);class i{static Get(){return n.u.contextCursor.get()||new i}static Retrun(e){return n.u.contextCursor.addItem(e)}proto;_index=0;_type=0;get index(){return this._index}get data(){return this.arrays._data[this._index]}schema;get nodes(){return this.arrays._node[this._index]}get type(){return r.g.contexts.idPalette.getStringId(this.arrays._type[this._index])}arrays;constructor(){}setContext(e,t){this._index=t,this.arrays=e.graph._contexts,this._type=this.arrays._type[t]}dispose(){this.arrays.removeContext(this._index)}}},74511:(e,t,s)=>{function r(e){return[e.type,e.schema||null,e.schemaViewId||null,null]}s.d(t,{f:()=>r})},76462:(e,t,s)=>{s.d(t,{m:()=>o});var r=s(46973),n=s(74511),i=s(62789);function o(e){let t=null;if(e.components){t=[];for(let s=0;s<e.components.length;s++){const r=e.components[s];t.push((0,n.f)(r))}}let s=null;if(e.tags){s=[];for(let t=0;t<e.tags.length;t++)s.push(i.g.tags.idPalette.getNumberId(e.tags[t]))}let a=null;if(e.children){a=[];for(let t=0;t<e.children.length;t++)a.push(o(e.children[t]))}return[e.id?r.W.FromString(e.id):null,e.name,t,s,a]}},67512:(e,t,s)=>{s.d(t,{$_:()=>o,Mk:()=>a,Mn:()=>i,Si:()=>n});var r=s(62789);function n(e){return{type:r.g.components.get(e[0]).type,...e[1]?{schema:e[1]}:{},...e[2]&&"default"!==e[2]?{schemaViewId:e[2]}:{}}}function i(e){return{type:e.type,...e.schema?{schema:e.schema.toJSON()}:{},...e.schema?.__view&&"default"!==e.schema?.__view.id?{schemaViewId:e.schema.__view.id}:{}}}function o(e){return[e.type,e.schema?e.schema.toJSON():null,e.schema?e.schema.__view.id:null,null]}function a(e){return[e.type,e.schema?e.schema.__view.toRemote(e.schema):null,e.schema?e.schema.__view.id:null,!0]}},61695:(e,t,s)=>{s.d(t,{Hy:()=>h,Ud:()=>a,Uk:()=>d,li:()=>o,zl:()=>i});var r=s(46973),n=s(67512);function i(e){return{name:e[1]}}function o(e){const t=e.id;let s=null;if(e.hasComponents){s=[];for(const t of e.traverseComponents())s.push((0,n.Mn)(t))}let i=null;if(e.hasTags){i=[];for(const t of e.traverseTags())i.push(t.type)}let a=null;if(e.childrenArray?.length){a=[];for(const t of e.children())a.push(o(t))}return{...t?{id:r.W.ToHexString(t)}:{},name:e.name,...s?{components:s}:{},...i?{tags:i}:{},...a?{children:a}:{}}}function a(e){return[null,e.name,null,null,null]}function d(e){return{name:e.name}}function h(e,t=!1,s=[]){let r=null;if(t){r=[];for(const n of e.children())r.push(h(n,t,s))}let i=null;if(e.hasComponents){i=[];for(const t of e.traverseComponents())if(s.length){for(let e=0;e<s.length;e++)if(s[e].type==t.type){i.push((0,n.Mk)(t));break}}else i.push((0,n.Mk)(t))}let o=null;if(e.hasTags){o=[];for(const t of e.traverseTags())o.push(t.typeId)}return[e.id?e.id:null,e.name,i,o,r]}},38019:(e,t,s)=>{s(65156)},84256:(e,t,s)=>{s.d(t,{T:()=>u});var r=s(46973),n=s(80571),i=s(93406),o=s(8149),a=s(47525);const d=i.t.Get(),h=i.t.Get();function c(e,t,s){const n=e._nodes.addNode("string"==typeof t[0]?r.W.FromString(t[0]):t[0],s,t[1]);if(h.graph=e,h.setNode(e,n),t[2]?.length)for(let e=0;e<t[2].length;e++)h.components.add(t[2][e]);if(t[3]?.length)for(let e=0;e<t[3].length;e++)h.tags.add(t[3][e]);if(s>=0&&(d.setNode(e,s),d.addChild(h)),t[4]?.length)for(let s=0;s<t[4].length;s++)c(e,t[4][s],n);return h.setNode(e,n),t[0]=null,t[1]="",t[2]=null,t[3]=null,t[4]=null,a.u.createNodeData.addItem(t),h}class u{_systems=[];_nodes=new n._;_components=[];_contexts=new o.F;_tags=[];_updatingComponents=[];root=i.t.Get();constructor(){const e=this._nodes.addNode(null,-1,"root");this.root.setNode(this,e)}getNode(e,t=h){if(void 0===this._nodes._parents[e])throw new Error(`Node with index ${e} does not exist`);return t.setNode(this,e),t}getNodeFromId(e,t=h){"string"==typeof e&&(e=r.W.FromString(e));const s=this._nodes._idMap.get(e);if(void 0===s)throw new Error(`Node with id ${e} does not exist`);return t.setNode(this,s),t}addNode(e,t=this.root.index,s=h){const r=c(this,e,t);if(r.hasComponents){const e=r.components.components;for(let t=0;t<e.length;t+=2)this._components[e[t]].init(e[t+1])}for(const e of r.traverseChildren())if(e.hasComponents){const t=e.components.components;for(let e=0;e<t.length;e+=2)this._components[t[e]].init(t[e+1])}return r.toRef(s),s}removeNode(e){return!!this._nodes.removeNode(e)}update(){for(let e=0;e<this._updatingComponents.length;e++)this._updatingComponents[e].update();for(let e=0;e<this._systems.length;e++)this._systems[e].update()}}},65156:(e,t,s)=>{s.d(t,{$:()=>y});var r=s(84256),n=s(46973),i=s(51873),o=s(37560),a=s(99820),d=s(32343),h=s(67922),c=s(47525),u=s(65035),l=s(67512),_=s(74511),p=s(61695),g=s(76462),m=s(18188);const v=(e,t)=>{for(const s in e){t.children??=[];const r=e[s];if(r instanceof m.P)if(r.value instanceof m.P&&"object"==typeof r.value.value){const e={id:s,meta:r.meta,value:r.value,children:[]};t.children.push(e),v(r.value.value,e)}else t.children.push({id:s,meta:r.meta,value:r.value})}return t},y={createGraph:()=>new r.T,createNode(e,t,s,r,i=[]){const o=c.u.createNodeData.get()||[];return o[0]=e?n.W.Create():null,o[1]=t||"New Node",o[2]=r||null,o[3]=s||null,o[4]=i||null,o},schemaFromObject:e=>u.S.FromObject(e),schema(e,t){const s=new u.S(v(e,{id:"root",value:{},children:[]}).children);if(t)for(const e of t)s.createView(e);return s},property:(e,t={})=>new m.P(e,t),data:(e={})=>e,createQuery:e=>new i.T(e),registerSystem:h.b,registerComponent:a.N,registerContext:o.j,registerTag:d.K,serializeComponent:l.Mn,serializeComponentData:l.Si,createRemoteComponent:l.Mk,copyComponent:l.$_,deserializeComponentData:_.f,serializeNode:p.li,serializeNodeData:p.zl,copyNode:p.Ud,cloneNode:p.Uk,createRemoteNode:p.Hy,deserializeNodeData:g.m}},32367:(e,t,s)=>{var r;s.d(t,{J:()=>r}),function(e){e[e.Disposed=0]="Disposed",e[e.Enabled=1]="Enabled",e[e.Parented=2]="Parented",e[e.RemovedFromParent=3]="RemovedFromParent",e[e.ChildAdded=4]="ChildAdded",e[e.ChildRemoved=5]="ChildRemoved",e[e.ChildrenUpdated=6]="ChildrenUpdated",e[e.ComponentAdded=7]="ComponentAdded",e[e.ComponentRemoved=8]="ComponentRemoved",e[e.ComponentsUpdated=9]="ComponentsUpdated",e[e.TagAdded=10]="TagAdded",e[e.TagRemoved=11]="TagRemoved",e[e.TagsUpdated=12]="TagsUpdated"}(r||(r={}))},80571:(e,t,s)=>{s.d(t,{_:()=>d});var r=s(17065),n=s(47525),i=s(32367);const o=Object.values(i.J).map((e=>Number(e))).filter((e=>!Number.isNaN(e))),a=[];for(let e=0;e<o.length;e++)a[o[e]]=[];class d{_freeSlots=[];_eventPalette=new r.Z;_idMap=new Map;_indexMap=[];_names=[];_events=[];_observers=structuredClone(a);_parents=[];_children=[];_components=[];_tags=[];_context=[];_disposed=[];_enabled=[];_hasObservers=[];addNode(e,t,s){let r=this._freeSlots.length?this._freeSlots.shift():this._parents.length;return e&&this.addNodeId(r,e),this._parents[r]=t,this._names[r]=s,this._disposed[r]=!1,this._enabled[r]=!0,this._hasObservers[r]=!1,r}removeNode(e){if(void 0===this._parents[e])return!1;this._freeSlots.push(e),this._indexMap[e]&&this.removeNodeId(this._indexMap[e]),this._parents[e]=-1,this._names[e]="",this._disposed[e]=!0,this._enabled[e]=!1,this._hasObservers[e]=!1;for(let t=0;t<o.length;t++){const s=this._observers[t][e];void 0!==s&&(n.u.observers.addItem(s),this._events[t][e]=void 0)}for(let t=0;t<this._eventPalette.size;t++){const s=this._events[t][e];void 0!==s&&(n.u.observers.addItem(s),this._events[t][e]=void 0)}return void 0!==this._children[e]&&(this._children[e].length=0,n.u.numberArray.addItem(this._children[e]),this._children[e]=void 0),void 0!==this._components[e]&&(this._components[e].length=0,n.u.numberArray.addItem(this._components[e]),this._components[e]=void 0),void 0!==this._tags[e]&&(this._tags[e].length=0,n.u.numberArray.addItem(this._tags[e]),this._tags[e]=void 0),void 0!==this._context[e]&&(this._context[e].length=0,n.u.numberArray.addItem(this._context[e]),this._context[e]=void 0),!0}addNodeId(e,t){this._idMap.set(t,e),this._indexMap[e]=t}removeNodeId(e){const t=this._idMap.get(e);this._indexMap[t]=void 0,this._idMap.delete(e)}}},93688:(e,t,s)=>{s.d(t,{t:()=>d});var r=s(85296),n=s(62789),i=s(30053),o=s(47525);const a=r.w.Get();class d{static Get(){return o.u.nodeComponents.get()||new d}static Retrun(e){return o.u.nodeComponents.addItem(e)}get components(){return this.node.arrays._components[this.node.index]||null}node;constructor(){}dispose(){if(!this.components)return;const e=this.components;for(let t=0;t<e.length;t+=2)a.setInstance(this.node,e[t],e[t+1]),a.dispose()}add(e){this.components||(this.node.arrays._components[this.node.index]=o.u.numberArray.get()||[]);const t=n.g.components.get(e[0]),s=n.g.components.idPalette.getNumberId(t.type);let r=this.node.graph._components[s];r||(r=new i.N(this.node.graph,s),r.proto.update&&this.node.graph._updatingComponents.push(r),this.node.graph._components[s]=r);let d=null;d=e[3]?r.schemaArray.schema.getView(e[2]||"default").fromRemote(e[1]):t.schema&&t.schema.getView(e[2]||"default")?.createData(e[1])||null;const h=r.addComponent(this.node.index,d,e[2]||"default");return e[0]="",e[1]=null,e[2]=null,e[3]=null,o.u.createComponentData.addItem(e),this.components.push(s,h),r.observers.nodeAdded.notify(this.node.index),this.node.hasObservers&&(a.setInstance(this.node,s,h),this.node.observers.isComponentAddedSet&&this.node.observers.componentAdded.notify(a),this.node.observers.isComponentsUpdatedSet&&this.node.observers.componentsUpdated.notify(a)),h}remove(e){const t=this.components;if(!t)return;let s=-1,r=-1;const i=n.g.components.idPalette.getNumberId(e);for(let e=0;e<t.length;e+=2)if(t[e]==i){s=e,r=t[e+1];break}return-1!=s?(a.setInstance(this.node,i,r),this.components.splice(s,2),this.node.hasObservers&&(this.node.observers.isComponentRemovedSet&&this.node.observers.componentRemoved.notify(a),this.node.observers.isComponentsUpdatedSet&&this.node.observers.componentsUpdated.notify(a)),a.dispose(),!0):void 0}has(e){const t=this.components;if(!t)return!1;const s=n.g.components.idPalette.getNumberId(e);for(let e=0;e<t.length;e+=2)if(t[e]==s)return!0;return!1}get(e,t=r.w.Get()){const s=this.components;if(!s)return null;const i=n.g.components.idPalette.getNumberId(e);for(let e=0;e<s.length;e+=2)if(s[e]==i)return t.setInstance(this.node,i,s[e+1]),t;return null}getAll(e){const t=this.components;if(!t)return[];const s=[],i=n.g.components.idPalette.getNumberId(e);for(let e=0;e<t.length;e+=2)if(t[e]==i){const n=r.w.Get();n.setInstance(this.node,t[e],t[e+1]),s.push(n)}return s}removeAll(e){const t=this.components;if(!t)return!1;const s=n.g.components.idPalette.getNumberId(e);for(let e=t.length;e>0;e-=2)t[e]==s&&(a.setInstance(this.node,t[e],t[e+1]),this.components.splice(e,2),this.node.hasObservers&&(this.node.observers.isComponentRemovedSet&&this.node.observers.componentRemoved.notify(a),this.node.observers.isComponentsUpdatedSet&&this.node.observers.componentsUpdated.notify(a)));return!0}getChild(e,t=r.w.Get()){for(const s of this.node.traverseChildren()){if(!s.components)continue;const r=s.components.get(e,t);if(r)return r}return null}getParent(e,t=r.w.Get()){for(const s of this.node.traverseParents()){if(!s.components)continue;const r=s.components.get(e,t);if(r)return r}return null}}},78209:(e,t,s)=>{s.d(t,{S:()=>a});var r=s(52800),n=s(62789),i=s(93406),o=s(47525);class a{node;static Get(){return o.u.nodeContext.get()||new a}static Retrun(e){return o.u.nodeContext.addItem(e)}get context(){return this.node.arrays._context[this.node.index]}constructor(){}dispose(){if(!this.context)return;const e=this.context,t=r.C.Get();for(let s=0;s<e.length;s+=2)t.setContext(this.node,e[s]),t.dispose();r.C.Retrun(t)}add(e){const t=r.C.Get();this.context||(this.node.arrays._context[this.node.index]=o.u.numberArray.get()||[]);const s=this.context;for(let r=0;r<s.length;r++)if(t.setContext(this.node,s[r]),t.type==e[0])return t.index;const i=n.g.contexts.get(e[0]),a=n.g.contexts.idPalette.getNumberId(e[0]),d=this.node.graph._contexts.addContext(a,[this.node.index],i,i.schema?i.schema.getView(e[2]||"default").createData(e[1]):null,e[3]);return s.push(d),t.setContext(this.node,d),e[0]="",e[1]=null,e[2]=null,e[3]=null,o.u.createContextData.addItem(e),r.C.Retrun(t),d}remove(e){const t=r.C.Get(),s=this.context;for(let n=0;n<s.length;n++)if(t.setContext(this.node,s[n]),t.type==e){s.splice(n,1);for(let e=0;e<t.nodes.length;e++)if(t.nodes[e]==this.node.index){t.nodes.splice(e,1);break}return r.C.Retrun(t),!0}return r.C.Retrun(t),!1}get(e){const t=this.context,s=r.C.Get();if(t)for(let r=0;r<t.length;r++)if(s.setContext(this.node,t[r]),s.type==e)return s;const n=i.t.Get();for(const t of this.node.traverseParents(n))if(this.node.arrays._context[t.index]){const r=this.node.arrays._context[t.index];for(let n=0;n<r.length;n++)if(s.setContext(t,r[n]),s.type==e)return s.setContext(t,r[n]),s}return i.t.Retrun(n),null}}},93406:(e,t,s)=>{s.d(t,{t:()=>l});var r=s(46973),n=s(62965),i=s(857),o=s(78209),a=s(93688),d=s(96949),h=s(85296),c=s(9346),u=s(47525);class l{static Get(){return u.u.nodeCursor.get()||new l}static Retrun(e){e.clear(e.hasEvents,e.hasContexts,e.hasObservers,e.hasComponents,e.hasTags),u.u.nodeCursor.addItem(e)}clear(e,t,s,r,o){e&&this._events&&(n.s.Retrun(this._events),this._events=null),t&&this._components&&(a.t.Retrun(this._components),this._components=null),s&&this._observers&&(i.a.Retrun(this._observers),this._observers=null),r&&this._components&&(a.t.Retrun(this._components),this._components=null),o&&this._tags&&(d.s.Retrun(this._tags),this._tags=null)}get index(){return this._index}get parentIndex(){return this.arrays._parents[this._index]}get id(){return this.graph._nodes._indexMap[this.index]||null}get name(){return this.arrays._names[this._index]}_events=null;get events(){return this._events||(this._events=n.s.Get()),this._events.node=this,this._events}get hasEvents(){return null!==this._events}_context=null;get context(){return this._context||(this._context=o.S.Get()),this._context.node=this,this._context}get hasContexts(){return null!==this._context}_observers=null;get observers(){return this._observers||(this._observers=i.a.Get()),this._observers.node=this,this._observers}get hasObservers(){return this.arrays._hasObservers[this._index]}_components=null;get components(){return this._components||(this._components=a.t.Get()),this._components.node=this,this._components}get hasComponents(){return null!==this._components}_tags=null;get tags(){return this._tags||(this._tags=d.s.Get()),this._tags.node=this,this._tags}get hasTags(){return null!==this._tags}get childrenArray(){return this.arrays._children[this._index]||null}get parent(){return this.arrays._parents[this._index]}set parent(e){this.arrays._parents[this._index]=e}graph;get arrays(){return this.graph._nodes}get enabled(){return this.arrays._enabled[this._index]}set enabled(e){this.arrays._enabled[this._index]=e,this.hasObservers&&this.observers.isEnabledSet&&this.observers.enabled.notify(e)}get isDisposed(){return this.arrays._disposed[this._index]}_index=0;constructor(){}setNode(e,t){return this._index=t,this.graph=e,void 0!==this.arrays._components[t]?(this._components=a.t.Get(),this._components.node=this):(this._components&&a.t.Retrun(this._components),this._components=null),void 0!==this.arrays._tags[t]?(this._tags=d.s.Get(),this._tags.node=this):(this._tags&&d.s.Retrun(this._tags),this._tags=null),void 0!==this.arrays._context[t]?(this._context=o.S.Get(),this._context.node=this):(this._context&&o.S.Retrun(this._context),this._context=null),this}toRef(e=new l){return e.setNode(this.graph,this.index)}*children(e=g){const t=this.childrenArray;if(!t)return!1;for(let s=0;s<t.length;s++)e.setNode(this.graph,t[s]),yield e;return!0}*traverseChildren(e=g){if(!this.childrenArray)return!1;const t=[this.childrenArray];for(;t.length;){const s=t.shift();if(s)for(let r=0;r<s.length;r++)e.setNode(this.graph,s[r]),yield e,void 0!==this.arrays._children[s[r]]&&t.push(this.arrays._children[s[r]])}return!0}*traverseParents(e=g){let t=this.parent;if(void 0===t||t<0)return!1;for(;;)if(e.setNode(this.graph,t),yield e,t=this.arrays._parents[e._index],void 0===t||t<0)return!0}*traverseComponents(e=_){const t=this.components.components;if(!t)return!1;for(let s=0;s<t.length;s+=2)yield e.setInstance(this,t[s],t[s+1]);return!0}*traverseTags(e=p){const t=this.tags.tags;if(!this.tags)return!1;for(let s=0;s<t.length;s+=2)yield e.setTag(this,t[s],t[s+1]);return!0}dispose(){if(!this.isDisposed){if(this.hasObservers&&this.observers.isDisposedSet&&this.observers.disposed.notify(this),void 0!==this.parent&&(g.setNode(this.graph,this.parent),g.removeChild(this.index)),this.arrays._components[this._index]?.length&&this.components.dispose(),this.arrays._tags[this._index]?.length&&this.tags.dispose(),this.childrenArray)for(let e=0;e<this.childrenArray.length;e++)g.setNode(this.graph,this.childrenArray[e]),g.dispose();this.graph.removeNode(this.index),this.clear(this.hasEvents,this.hasContexts,this.hasObservers,this.hasComponents,this.hasTags)}}hasChild(e){if(!this.childrenArray)return!1;for(let t=0;t<this.childrenArray.length;t++)if(this.childrenArray[t]==e.index)return!0;return!1}parentTo(e){e.hasChild(this)||(void 0!==this.parent&&(g.setNode(this.graph,this.parent),g.removeChild(this.index)),e.addChild(this),this.parent=e.index,this.hasObservers&&this.observers.isParentedSet&&e.observers.parented.notify(g))}getChild(e,t=l.Get()){const s=this.childrenArray;return s&&void 0!==s[e]?t.setNode(this.graph,s[e]):null}addChild(e){this.hasChild(e)||(this.childrenArray||(this.arrays._children[this._index]=u.u.numberArray.get()||[]),e.parent=this.index,this.childrenArray.push(e.index),this.hasObservers&&(this.observers.isChildAddedSet&&this.observers.childAdded.notify(e),this.observers.isChildrenUpdatedSet&&this.observers.childrenUpdated.notify(e)),e.hasObservers&&e.observers.isParentedSet&&e.observers.parented.notify(e))}removeChild(e){if(this.childrenArray){for(let t=0;t<this.childrenArray.length;t++)if(this.childrenArray[t]==e){const e=this.childrenArray.splice(t,1)[0];return g.setNode(this.graph,e),this.hasObservers&&(this.hasObservers&&this.observers.isChildRemovedSet&&this.observers.childRemoved.notify(g),this.hasObservers&&this.observers.isChildrenUpdatedSet&&this.observers.childrenUpdated.notify(g)),g.hasObservers&&g.observers.isRemovedFromParentSet&&g.observers.removedFromParent.notify(g),e}return null}}addUniqueId(){let e=this.graph._nodes._indexMap[this.index];return e||(e=r.W.Create()),this.graph._nodes.addNodeId(this.index,e),e}returnCursor(){return l.Retrun(this)}cloneCursor(e){const t=e||l.Get();return t.setNode(this.graph,this._index),t}}const _=h.w.Get(),p=c.v.Get(),g=l.Get()},62965:(e,t,s)=>{s.d(t,{s:()=>o});var r=s(47525),n=s(18472);class i{id;node;data}class o{static Get(){return r.u.nodeEvents.get()||new o}static Retrun(e){return r.u.nodeEvents.addItem(e)}get events(){return this.node.arrays._events}get index(){return this.node.index}node;cursor=new i;constructor(){}hasListener(e){const t=this.node.arrays._eventPalette.getNumberId(e);return void 0!==t&&void 0!==this.node.arrays._events[t][this.index]}clearListeners(e){const t=this.node.arrays._eventPalette.getNumberId(e);if(void 0===t)return!1;let s=this.node.arrays._events[t]?.[this.index];if(!s)return!1;s.clear(),r.u.observers.addItem(s),this.node.arrays._events[t][this.index]=void 0}addListener(e,t){const s=this.node.arrays._eventPalette.isRegistered(e)?this.node.arrays._eventPalette.getNumberId(e):this.node.arrays._eventPalette.register(e);let i=this.node.arrays._events[s];i||(i=[],this.node.arrays._events[s]=i);let o=i[this.index];o||(o=r.u.observers.get()||new n.c,i[this.index]=o),o.subscribe(t)}removeListener(e,t){const s=this.node.arrays._eventPalette.getNumberId(e);if(void 0===s)return!1;let r=this.node.arrays._events[s];return!(!r||!r[this.index]||(r[this.index].unsubscribe(t),0))}dispatch(e,t){const s=this.node.arrays._eventPalette.getNumberId(e);if(void 0===s)return!1;let r=this.node.arrays._events[s];return!(!r||!r[this.index]||(r[this.index].notify(t),this.cursor.id=e,this.cursor.data=t,0))}dispatchDeep(e,t){for(const s of this.node.traverseChildren())s.events.dispatch(e,t)}}},46973:(e,t,s)=>{s.d(t,{W:()=>o});const r=new ArrayBuffer(16),n=new Uint8Array(r),i=new DataView(r);class o{static Create(){return crypto.getRandomValues(n),BigInt(i.getUint32(0))<<96n|BigInt(i.getUint32(4))<<64n|BigInt(i.getUint32(8))<<32n|BigInt(i.getUint32(12))}static CreateString(){return this.ToHexString(this.Create())}static FromString(e){return BigInt("0x"+e)}static ToHexString(e){return e.toString(16).padStart(32,"0")}}},857:(e,t,s)=>{s.d(t,{a:()=>o});var r=s(18472),n=s(32367),i=s(47525);class o{node;static Get(){return i.u.nodeObservers.get()||new o}static Retrun(e){return i.u.nodeObservers.addItem(e)}constructor(){}get observers(){return this.node.arrays._observers}get disposed(){let e=this.observers[n.J.Disposed][this.node.index];return e||(e=i.u.observers.get()||new r.c,this.observers[n.J.Disposed][this.node.index]=e),this.node.arrays._hasObservers[this.node.index]=!0,e}get enabled(){let e=this.observers[n.J.Enabled][this.node.index];return e||(e=i.u.observers.get()||new r.c,this.observers[n.J.Enabled][this.node.index]=e),this.node.arrays._hasObservers[this.node.index]=!0,e}get parented(){let e=this.observers[n.J.Parented][this.node.index];return e||(e=i.u.observers.get()||new r.c,this.observers[n.J.Parented][this.node.index]=e),this.node.arrays._hasObservers[this.node.index]=!0,e}get removedFromParent(){let e=this.observers[n.J.RemovedFromParent][this.node.index];return e||(e=i.u.observers.get()||new r.c,this.observers[n.J.RemovedFromParent][this.node.index]=e),this.node.arrays._hasObservers[this.node.index]=!0,e}get childAdded(){let e=this.observers[n.J.ChildAdded][this.node.index];return e||(e=i.u.observers.get()||new r.c,this.observers[n.J.ChildAdded][this.node.index]=e),this.node.arrays._hasObservers[this.node.index]=!0,e}get childRemoved(){let e=this.observers[n.J.ChildRemoved][this.node.index];return e||(e=i.u.observers.get()||new r.c,this.observers[n.J.ChildRemoved][this.node.index]=e),this.node.arrays._hasObservers[this.node.index]=!0,e}get childrenUpdated(){let e=this.observers[n.J.ChildrenUpdated][this.node.index];return e||(e=i.u.observers.get()||new r.c,this.observers[n.J.ChildrenUpdated][this.node.index]=e),this.node.arrays._hasObservers[this.node.index]=!0,e}get isDisposedSet(){return void 0!==this.observers[n.J.Disposed][this.node.index]}get isEnabledSet(){return void 0!==this.observers[n.J.Enabled][this.node.index]}get isParentedSet(){return void 0!==this.observers[n.J.Parented][this.node.index]}get isRemovedFromParentSet(){return void 0!==this.observers[n.J.RemovedFromParent][this.node.index]}get isChildAddedSet(){return void 0!==this.observers[n.J.ChildAdded][this.node.index]}get isChildRemovedSet(){return void 0!==this.observers[n.J.ChildRemoved][this.node.index]}get isChildrenUpdatedSet(){return void 0!==this.observers[n.J.ChildrenUpdated][this.node.index]}get componentAdded(){let e=this.observers[n.J.ComponentAdded][this.node.index];return e||(e=new r.c,this.observers[n.J.ComponentAdded][this.node.index]=e),this.node.arrays._hasObservers[this.node.index]=!0,e}get componentRemoved(){let e=this.observers[n.J.ComponentRemoved][this.node.index];return e||(e=i.u.observers.get()||new r.c,this.observers[n.J.ComponentRemoved][this.node.index]=e),this.node.arrays._hasObservers[this.node.index]=!0,e}get componentsUpdated(){let e=this.observers[n.J.ComponentsUpdated][this.node.index];return e||(e=i.u.observers.get()||new r.c,this.observers[n.J.ComponentsUpdated][this.node.index]=e),this.node.arrays._hasObservers[this.node.index]=!0,e}get isComponentAddedSet(){return void 0!==this.observers[n.J.ComponentAdded][this.node.index]}get isComponentRemovedSet(){return void 0!==this.observers[n.J.ComponentRemoved][this.node.index]}get isComponentsUpdatedSet(){return void 0!==this.observers[n.J.ComponentsUpdated][this.node.index]}get tagsAdded(){let e=this.observers[n.J.TagAdded][this.node.index];return e||(e=i.u.observers.get()||new r.c,this.observers[n.J.TagAdded][this.node.index]=e),this.node.arrays._hasObservers[this.node.index]=!0,e}get tagsRemoved(){let e=this.observers[n.J.TagRemoved][this.node.index];return e||(e=i.u.observers.get()||new r.c,this.observers[n.J.TagRemoved][this.node.index]=e),this.node.arrays._hasObservers[this.node.index]=!0,e}get tagsUpdated(){let e=this.observers[n.J.TagsUpdated][this.node.index];return e||(e=i.u.observers.get()||new r.c,this.observers[n.J.TagsUpdated][this.node.index]=e),this.node.arrays._hasObservers[this.node.index]=!0,e}get isTagsAddedSet(){return void 0!==this.observers[n.J.TagAdded][this.node.index]}get isTagsRemovedSet(){return void 0!==this.observers[n.J.TagRemoved][this.node.index]}get isTagsUpdatedSet(){return void 0!==this.observers[n.J.TagsUpdated][this.node.index]}}},96949:(e,t,s)=>{s.d(t,{s:()=>a});var r=s(47525),n=s(62789),i=s(9346);const o=i.v.Get();class a{node;static Get(){return r.u.nodeTags.get()||new a}static Retrun(e){return r.u.nodeTags.addItem(e)}get tags(){return this.node.arrays._tags[this.node.index]}constructor(){}dispose(){for(let e=0;e<this.tags.length;e+=2)o.setTag(this.node,this.tags[e],this.tags[e+1]),o.dispose()}add(e,t=o){const s=this.node.graph._tags[e].addTag(this.node.index);return this.tags.push(e,s),t.setTag(this.node,e,s),this.node.hasObservers&&this.node.observers.isTagsAddedSet&&this.node.observers.tagsAdded.notify(t),t}remove(e){const t=n.g.tags.idPalette.getNumberId(e),s=this.tags;for(let e=0;e<s.length;e++)if(s[e]==t)return o.setTag(this.node,t,s[e]),o.dispose(),this.tags.splice(e,2),this.node.hasObservers&&this.node.observers.isTagsRemovedSet&&this.node.observers.tagsRemoved.notify(o),this.node.hasObservers&&this.node.observers.isTagsUpdatedSet&&this.node.observers.tagsUpdated.notify(0),!0;return!1}get(e,t=o){const s=n.g.tags.idPalette.getNumberId(e),r=this.tags;for(let e=0;e<r.length;e+=2)if(r[e]==s)return t.setTag(this.node,r[e],r[e+1]),t;return null}getChild(e,t=o){for(const s of this.node.traverseChildren()){const r=s.tags.get(e,t);if(r)return r}return null}getAllChildlren(e){const t=[];for(const s of this.node.traverseChildren()){const r=s.tags.get(e);r&&t.push(i.v.Get().setTag(this.node,r.typeId,r.index))}return t}getParent(e,t=o){for(const s of this.node.traverseParents()){const r=s.tags.get(e,t);if(r)return r}return null}getAllParents(e){const t=[];for(const s of this.node.traverseParents()){const r=s.tags.get(e,o);r&&t.push(i.v.Get().setTag(this.node,r.typeId,r.index))}return t}}},47525:(e,t,s)=>{s.d(t,{u:()=>n});var r=s(52316);class n{static observers=new r.K;static numberArray=new r.K;static createNodeData=new r.K;static createComponentData=new r.K;static createContextData=new r.K;static nodeCursor=new r.K;static nodeContext=new r.K;static nodeObservers=new r.K;static nodeEvents=new r.K;static nodeComponents=new r.K;static nodeTags=new r.K;static tagCursor=new r.K;static componentCursor=new r.K;static contextCursor=new r.K}},20048:(e,t,s)=>{s.d(t,{k:()=>a});var r=s(93406),n=s(62789),i=s(30053),o=s(2807);class a{graph;data;nodes=[];_updateFunction;nodeCursor=r.t.Get();constructor(e,t){this.graph=e,this.data=t}evulate(e){if(this.data.inclueComponents)for(const t of this.data.inclueComponents)if(!e.components.has(t.type))return!1;if(this.data.includeTags)for(const t of this.data.includeTags)if(!e.hasTags||!e.tags.get(t.id))return!1;if(this.data.excludeComponents)for(const t of this.data.excludeComponents)if(e.components.has(t.type))return!1;if(this.data.excludeTags)for(const t of this.data.excludeTags)if(e.hasTags&&e.tags.get(t.id))return!1;return!0}init(){if(this._updateFunction=e=>{const t=this.nodeCursor.setNode(this.graph,e);if(this.evulate(t))this.nodes.push(e);else for(let e=0;e<this.nodes.length;e++)this.nodes[e]==t.index&&this.nodes.splice(e,1)},this.data.inclueComponents)for(const e of this.data.inclueComponents){const t=n.g.components.idPalette.getNumberId(e.type);let s=this.graph._components[t];s||(s=new i.N(this.graph,t),this.graph._components[t]=s),s.observers.nodeAdded.subscribe(this._updateFunction),s.observers.nodeRemoved.subscribe(this._updateFunction)}if(this.data.includeTags)for(const e of this.data.includeTags){const t=n.g.tags.get(e.id),s=n.g.tags.idPalette.getNumberId(e.id);let r=this.graph._tags[s];r||(r=new o.k(e.id),this.graph._tags[s]=r),r.observers.nodeAdded.subscribe(this._updateFunction),r.observers.nodeRemoved.subscribe(this._updateFunction);for(const e of t.traverseChildren()){const t=n.g.tags.idPalette.getNumberId(e.id);let s=this.graph._tags[t];s||(s=new o.k(e.id),this.graph._tags[t]=s),s.observers.nodeAdded.subscribe(this._updateFunction),s.observers.nodeRemoved.subscribe(this._updateFunction)}}}dispose(){if(this.data.inclueComponents)for(const e of this.data.inclueComponents){const t=this.graph._components[n.g.components.idPalette.getNumberId(e.type)];t&&(t.observers.nodeAdded.unsubscribe(this._updateFunction),t.observers.nodeRemoved.unsubscribe(this._updateFunction))}if(this.data.includeTags)for(const e of this.data.includeTags){const t=n.g.tags.get(e.id),s=this.graph._tags[n.g.tags.idPalette.getNumberId(e.id)];if(s){s.observers.nodeAdded.unsubscribe(this._updateFunction),s.observers.nodeRemoved.unsubscribe(this._updateFunction);for(const e of t.traverseChildren()){const t=this.graph._tags[n.g.tags.idPalette.getNumberId(e.id)];t&&(t.observers.nodeAdded.unsubscribe(this._updateFunction),t.observers.nodeRemoved.unsubscribe(this._updateFunction))}}}}}},51873:(e,t,s)=>{s.d(t,{T:()=>n});var r=s(20048);class n{data;queries=new Map;constructor(e){this.data=e}add(e){if(this.queries.has(e))return this.queries.get(e);const t=new r.k(e,this.data);return this.queries.set(e,t),t.init(),t}remove(e){const t=this.queries.get(e);return!!t&&(t.dispose(),!0)}}},62789:(e,t,s)=>{s.d(t,{g:()=>i});var r=s(17065);class n{itemtype;items=[];idPalette=new r.Z;constructor(e){this.itemtype=e}get(e){const t="string"==typeof e?this.items[this.idPalette.getNumberId(e)]:this.items[e];if(!t)throw new Error(`[${this.itemtype}]: Entry with id ${e} does not exist`);return t}has(e){return this.idPalette.isRegistered(e)}register(e,t){const s=this.idPalette.register(e);return this.items[s]=t,s}}class i{static components=new n("Components");static contexts=new n("Context");static tags=new n("Tags");static systems=new n("Systems")}},99820:(e,t,s)=>{s.d(t,{N:()=>a});var r=s(62789),n=s(85296),i=s(93406),o=s(47525);const a=e=>{const t=r.g.components.register(e.type,e);e.shared=e.shared||{};const s=(t,s)=>{const r=o.u.createComponentData.get()||[];return r[0]=e.type,r[1]=t||{},r[2]=s||"default",r};return Object.assign(s,e,{data:e,type:e.type,typeId:t,*getNodes(e,s=i.t.Get()){const r=e._components[t];if(!r)return!1;for(let t=0;t<r._disposed.length;t++)s.setNode(e,r._node[t]),yield s;return i.t.Retrun(s),!0},*getComponents(e,s=n.w.Get(),r=i.t.Get()){const o=e._components[t];if(!o)return!1;for(let n=0;n<o._disposed.length;n++)r.setNode(e,o._node[n]),s.setInstance(r,t,n),yield s;return n.w.Retrun(s),i.t.Retrun(r),!0},set(e,r,i,o=n.w.Get()){const a=e.components.add(s(r,i));return o.setInstance(e,t,a),e.graph._components[t].init(a),o},has:t=>t.components.has(e.type),get:(t,s)=>t.components.get(e.type,s),getRequired(t,s){const r=t.components.get(e.type,s);if(!r)throw new Error(`Node [${t.name}] does not have required component [${e.type}].`);return r},getChild:(t,s)=>t.components.getChild(e.type,s),getRequiredChild(t,s){const r=t.components.getChild(e.type,s);if(!r)throw new Error(`Node [${t.name}] does not have a child with required component [${e.type}].`);return r},getParent:(t,s)=>t.components.getParent(e.type,s),getRequiredParent(t,s=n.w.Get()){const r=t.components.getParent(e.type,s);if(!r)throw new Error(`Node [${t.name}] does not have a parent with required component [${e.type}].`);return r},getAll:t=>t.components.getAll(e.type),removeAll:t=>t.components.removeAll(e.type),remove:t=>t.components.remove(e.type),nodeData:{get:t=>t.components?.find((t=>t.type==e.type))||null,getAll:t=>t.components?.filter((t=>t.type==e.type)),remove:t=>t.components?.splice(t.components?.findIndex((t=>t.type==e.type)))[0]||null,removeAll(t){const s=this.getAll(t);return t.components=t.components?.filter((t=>t.type!=e.type)),s?.length?s:null},set:(t,s)=>{t.components??=[],t.components.push({type:e.type,schema:{}})}}})}},37560:(e,t,s)=>{s.d(t,{j:()=>i});var r=s(62789),n=s(47525);function i(e){r.g.contexts.register(e.type,e);const t=(t,s,r)=>{const i=n.u.createContextData.get()||[];return i[0]=e.type,i[1]=t||{},i[2]=s||"default",i[3]=r||null,i};return Object.assign(t,e,{data:e,set:(e,s,r,n)=>e.context.add(t(s,r,n)),get:t=>t.context.get(e.type),getRequired:t=>{const s=t.context.get(e.type);if(!s)throw new Error(`Could not find required context type: ${e.type}`);return s},remove:t=>t.context.remove(e.type)})}},67922:(e,t,s)=>{s.d(t,{b:()=>i});var r=s(62789),n=s(77280);function i(e){const t=new n.C(e);return r.g.systems.register(e.type,t),Object.assign(e,{prototype:t,set:e=>t.add(e),get:e=>t.systems.get(e)||null,remove:e=>t.remove(e)})}},32343:(e,t,s)=>{s.d(t,{K:()=>o});var r=s(62789),n=s(9346),i=s(37936);function o(e){const t=new i.v(null,e),s=r.g.tags.register(e.id,t),o=()=>s;return Object.assign(o,e,{tag:t,data:e,getChild:(t,s)=>t.tags.getChild(e.id,s),getAllChildlren:t=>t.tags.getAllChildlren(e.id),getParent:(t,s)=>t.tags.getParent(e.id,s),getAllParents:t=>t.tags.getAllParents(e.id),set(e,t=n.v.Get()){const r=e.tags.add(o());return t.setTag(e,s,r),t},get:(t,s)=>t.tags.get(e.id,s),remove:t=>t.tags.remove(e.id)})}},64338:(e,t,s)=>{s.d(t,{p:()=>n});var r=s(20912);function n(){class e{__view;__cursor;__cursors=[];constructor(e){this.__view=e,this.__cursor=new r.Z(this.__view.schema.array)}__array;__index;setInstance(e){this.__cursor.setIndex(e)}getInstance(){return this.__cursor._index}getCursor(){return this.__cursor}getSchemaIndex(){return this.__view.schema.index}clone(){return new e(this.__view)}toJSON(){return this.__view.toJSON(this)}}return e}},16553:(e,t,s)=>{s.d(t,{Wl:()=>h,r5:()=>o});var r=s(64338);const n={i8(e,t,s){e.setInt8(t,s)},ui8(e,t,s){e.setUint8(t,s)},i16(e,t,s){e.setInt16(t,s)},ui16(e,t,s){e.setUint16(t,s)},i32(e,t,s){e.setInt32(t,s)},ui32(e,t,s){e.setUint32(t,s)},f32(e,t,s){e.setFloat32(t,s)},f64(e,t,s){e.setFloat64(t,s)}},i={i8:(e,t)=>e.getInt8(t),ui8:(e,t)=>e.getUint8(t),i16:(e,t)=>e.getInt16(t),ui16:(e,t)=>e.getUint16(t),i32:(e,t)=>e.getInt32(t),ui32:(e,t)=>e.getUint32(t),f32:(e,t)=>e.getFloat32(t),f64:(e,t)=>e.getFloat64(t)};function o(e,t,s,r){if(t.binary)return"object"==typeof t.binary?t.binary.set(e.view,t,s,r):n[t.binary](e.view,s,r)}function a(e,t,s){if(t.binary)return"object"==typeof t.binary?t.binary.get(e.view,t,s):i[t.binary](e.view,s)}function d(e,t){for(let s=0;s<t.length;s++){const r=t[s],n=r.index;if(r.children){class t{__cursor;__cursors;__view;constructor(e,t,s){this.__cursor=e,this.__cursors=t,this.__view=s}}d(t,r.children),Object.defineProperty(e.prototype,r.id,{get(){let e=this.__cursors[n];return e||(e=new t(this.__cursor,this.__cursors,this.__view),this.__cursors[n]=e),e},set(e){}})}else Object.defineProperty(e.prototype,r.id,{get(){return this.__cursor.hasProxy(n)?this.__cursor.fetchProxyData(n):a(this.__cursor.data,this.__view.meta[n],this.__view.byteOffset[n])},set(e){let t=this.__cursor.getObserver(n),s=this.__cursor.hasProxy(n);if(t&&(s?this.__cursor.fetchProxyData(n):a(this.__cursor.data,this.__view.meta[n],this.__view.byteOffset[n]))!=e)return o(this.__cursor.data,this.__view.meta[n],this.__view.byteOffset[n],e),s&&this.__cursor.setProxyData(n,e),void t.notify(e);o(this.__cursor.data,this.__view.meta[n],this.__view.byteOffset[n],e),s&&this.__cursor.setProxyData(n,e)}})}}function h(e){const t=(0,r.p)();return d(t,e.root.children),t}},55037:(e,t,s)=>{function r(e,t){for(let s=0;s<t.length;s++){const n=t[s],i=n.index;if(!n.children){e[n.id]=i;continue}const o={};r(o,n.children),e[n.id]=o}}function n(e){const t={};return r(t,e.root.children),t}s.d(t,{s:()=>n})},15330:(e,t,s)=>{s.d(t,{r:()=>i});var r=s(64338);function n(e,t){for(let s=0;s<t.length;s++){const r=t[s],i=r.index;if(r.children){class t{__cursor;__cursors;constructor(e,t){this.__cursor=e,this.__cursors=t}}n(t,r.children),Object.defineProperty(e.prototype,r.id,{get(){let e=this.__cursors[i];return e||(e=new t(this.__cursor,this.__cursors),this.__cursors[i]=e),e},set(e){}})}else Object.defineProperty(e.prototype,r.id,{get(){return this.__cursor.hasProxy(i)?this.__cursor.fetchProxyData(i):this.__cursor.data[i]},set(e){let t=this.__cursor.getObserver(i),s=this.__cursor.hasProxy(i);if(t&&(s?this.__cursor.fetchProxyData(i):this.__cursor.data[i])!=e)return this.__cursor.data[i]=e,s&&this.__cursor.setProxyData(i,e),void t.notify(e);this.__cursor.data[i]=e,s&&this.__cursor.setProxyData(i,e)}})}}function i(e){const t=(0,r.p)();return n(t,e.root.children),t}},21660:(e,t,s)=>{s.d(t,{f:()=>i});var r=s(64338);function n(e,t){for(let s=0;s<t.length;s++){const r=t[s],i=r.index;if(r.children){class t{__cursor;__cursors;constructor(e,t){this.__cursor=e,this.__cursors=t}}n(t,r.children),Object.defineProperty(e.prototype,r.id,{get(){let e=this.__cursors[i];return e||(e=new t(this.__cursor,this.__cursors),this.__cursors[i]=e),e},set(e){}})}else Object.defineProperty(e.prototype,r.id,{get(){return this.__cursor.hasProxy(i)?this.__cursor.fetchProxyData(i):this.__cursor.data[i]},set(e){let t=this.__cursor.getObserver(i),s=this.__cursor.hasProxy(i);if(t&&(s?this.__cursor.fetchProxyData(i):this.__cursor.data[i])!=e)return this.__cursor.data[i]=e,s&&this.__cursor.setProxyData(i,e),void t.notify(e);this.__cursor.data[i]=e,s&&this.__cursor.setProxyData(i,e)}})}}function i(e){const t=(0,r.p)();return n(t,e.root.children),t}},4825:(e,t,s)=>{s.d(t,{m:()=>r});class r{index;id="";name;type="";meta;value=null;children;constructor(e,t){this.index=t,this.id=e.id,this.name=e.name,this.value=e.value,this.meta=e.meta}}},15426:(e,t,s)=>{s.d(t,{R:()=>r,i:()=>n});const r={i8:Int8Array,ui8:Uint8Array,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array},n={i8:Int8Array.BYTES_PER_ELEMENT,ui8:Uint8Array.BYTES_PER_ELEMENT,i16:Int16Array.BYTES_PER_ELEMENT,ui16:Uint16Array.BYTES_PER_ELEMENT,i32:Int32Array.BYTES_PER_ELEMENT,ui32:Uint32Array.BYTES_PER_ELEMENT,f32:Float32Array.BYTES_PER_ELEMENT,f64:Float64Array.BYTES_PER_ELEMENT}},65035:(e,t,s)=>{s.d(t,{S:()=>m});var r=s(15330),n=s(55037),i=s(4825),o=s(15426),a=s(21660),d=s(16553),h=s(10790),c=s(26042),u=s(17065);const l=(e,t,s)=>{e.children??=[];for(let r=0;r<t.length;r++){const n=t[r];if("object"==typeof n.value&&!n.children){n.children??=[];for(const e in n.value){const t=n.value[e],s=structuredClone(n.meta||{});s.child=!0,n.children.push({id:e,meta:s,value:t})}}if(n.children){const t=new i.m(n,s+1);e.children.push(t),s=l(t,n.children,s)}else s++,e.children.push(new i.m(n,s))}return s},_=(e,t,s)=>{for(let r=0;r<e.children.length;r++){const n=e.children[r];n.children?_(n,t,s):(t[Number(n.index)]=structuredClone(n.value),n.meta&&(s[n.index]=structuredClone(n.meta)))}return t};function p(e,t){for(const s in e){const r=e[s];"object"==typeof r?t.children.push(p(r,{id:s,value:{},children:[]})):t.children.push({id:s,value:r})}return t}function g(e,t,s){for(const r of e.children)void 0!==s[r.id]&&(r.children?g(r,t,s[r.id]):t[r.index]=s[r.id]);return t}class m{static FromObject(e){const t=[];for(const s in e){const r=e[s];"object"==typeof r?t.push(p(r,{id:s,value:{},children:[]})):t.push({id:s,value:r})}return new m(t)}root=new i.m({id:"__root__",meta:{},value:{}},-1);_objectCursorClass;_typedArrayCursorClass;_binaryObjectCursorClass;index;shape;_data=[];_meta=[];viewIdPalettew=new u.Z;views=[];array;constructor(e){l(this.root,e,-1),this.index=(0,n.s)(this),_(this.root,this._data,this._meta),this.createObjectView("default"),this.array=new c.F(this)}createData(e=[],t){for(let t=0;t<this._data.length;t++)e[t]="object"==typeof this._data[t]?structuredClone(this._data[t]):this._data[t];return g(this.root,e,t),e}getView(e){return this.viewIdPalettew.isRegistered(e)?this.views[this.viewIdPalettew.getNumberId(e)]:null}createView(e){let t=null,s=this._meta;if(e.meta&&(s=function(e,t,s){let r=[...t];for(let t=0;t<e.length;t++)s[t]&&(r[t]=s[t]);return r}(this._data,s,e.meta)),"object"==e.type&&(this._objectCursorClass||(this._objectCursorClass=(0,r.r)(this)),t=new h.T(this,e.id,s,[],0,e,this._objectCursorClass)),"typed-array"==e.type&&(this._typedArrayCursorClass||(this._typedArrayCursorClass=(0,a.f)(this)),t=new h.T(this,e.id,s,[],0,e,this._typedArrayCursorClass)),"binary-object"==e.type){this._binaryObjectCursorClass||(this._binaryObjectCursorClass=(0,d.Wl)(this));const{byteSize:r,byteOffsets:n}=(e=>{let t=0;const s=[];for(let r=0;r<e.length;r++){const n=e[r];n&&n.binary&&(s[r]=t,"object"!=typeof n.binary?"string"!=typeof n.binary||(t+=o.i[n.binary]):t+=n.binary.byteSize)}return{byteSize:t,byteOffsets:s}})(s);t=new h.T(this,e.id,s,n,r,e,this._binaryObjectCursorClass)}if(!t)throw new Error("Invalid data");const n=this.viewIdPalettew.register(e.id);return this.views[n]=t,t}createObjectView(e,t=null){return this.createView({id:e,type:"object",meta:t})}createBinaryObjectView(e,t=!1,s=null){return this.createView({id:e,type:"binary-object",meta:s,sharedMemory:t||void 0})}createTypedArrayView(e,t,s=!1,r=null){return this.createView({id:e,type:"typed-array",meta:r,arrayType:t,sharedMemory:s||void 0})}}},18188:(e,t,s)=>{s.d(t,{P:()=>r});class r{value;meta;constructor(e,t){this.value=e,this.meta=t}}},26042:(e,t,s)=>{s.d(t,{F:()=>n});var r=s(47525);class n{schema;_data=[];_dataViews=[];_observers=[];_proxyObjects=[];_proxyKeys=[];constructor(e){this.schema=e;for(let t=0;t<e._data.length;t++)this._observers[t]=[],this._proxyObjects[t]=[],this._proxyKeys[t]=[]}createViewCursor(e){if(void 0===this._data[e])return null;const t=this._dataViews[e],s=this.schema.views[t];return s?s.createCursor():null}setData(e,t,s){this._data[e]=t,this._dataViews[e]=this.schema.viewIdPalettew.getNumberId(s||"default")}getViewAt(e){return void 0===this._data[e]?null:this.schema.getView(this.schema.viewIdPalettew.getStringId(this._dataViews[e]))}removeData(e){if(void 0===this._data[e])return!1;this.getViewAt(e).returnData(this._data[e]),this._data[e]=void 0,this._dataViews[e]=-1;for(let t=0;t<this.schema._data.length;t++)this._observers[t][e]&&(this._observers[t][e].clear(),r.u.observers.addItem(this._observers[t][e]),this._observers[t][e]=void 0),this._proxyObjects[t][e]=void 0,this._proxyKeys[t][e]=void 0;return!0}getObserver(e,t){if(!this._observers[e][t])return null;return this._observers[e][t]||null}setObserver(e,t,s){this._observers[e][t]=s||void 0}hasProxy(e,t){return void 0!==this._proxyObjects[e][t]}fetchProxyData(e,t){return this._proxyObjects[e][t][this._proxyKeys[e][t]]}setProxyData(e,t,s){this._proxyObjects[e][t][this._proxyKeys[e][t]]=s}removeProxy(e,t){this._proxyObjects[e][t]=void 0,this._proxyKeys[e][t]=void 0}setProxy(e,t,s,r){this._proxyObjects[e][t]=s,this._proxyKeys[e][t]=r}}},20912:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(47525),n=s(18472);class i{schemaArray;constructor(e){this.schemaArray=e}get data(){return this.schemaArray._data[this._index]}set data(e){this.schemaArray._data[this._index]=e}_index=0;setIndex(e){this._index=e}getObserver(e){return this.schemaArray.getObserver(e,this._index)}getOrCreateObserver(e){let t=this.schemaArray.getObserver(e,this._index);return t||(t=r.u.observers.get()||new n.c,this.schemaArray.setObserver(e,this._index,t)),t}removeObserver(e){let t=this.schemaArray.getObserver(e,this._index);return!!t&&(t.clear(),r.u.observers.addItem(t),this.schemaArray.setObserver(e,this._index,null),!0)}setObserver(e,t){return this.schemaArray.setObserver(e,this._index,t)}hasProxy(e){return this.schemaArray.hasProxy(e,this._index)}fetchProxyData(e){return this.schemaArray.fetchProxyData(e,this._index)}setProxyData(e,t){return this.schemaArray.setProxyData(e,this._index,t)}removeProxy(e){return this.schemaArray.removeProxy(e,this._index)}setProxy(e,t,s){return this.schemaArray.setProxy(e,this._index,t,s)}}},10790:(e,t,s)=>{s.d(t,{T:()=>d});var r=s(52316),n=s(16553),i=s(15426);function o(e,t,s){for(const r of e.children)r.children?(t[r.id]??={},o(r,t[r.id],s[r.id])):t[r.id]=s[r.id];return t}const a=[];class d{schema;id;meta;byteOffset;byteSize;_createData;_cursorClass;_dataPool=new r.K;constructor(e,t,s,r,n,i,o){this.schema=e,this.id=t,this.meta=s,this.byteOffset=r,this.byteSize=n,this._createData=i,this._cursorClass=o}returnData(e){this._dataPool.addItem(e)}createData(e){const t=this._createData;e&&(a.length=0);let s=e?this.schema.createData(a,e):this.schema._data;if(this._dataPool.items.length){const e=this._dataPool.get();if("object"==t.type){for(let t=0;t<s.length;t++)e[t]="object"==typeof s[t]?structuredClone(s[t]):s[t];return e}if("typed-array"==t.type)return e.set(s),e;if("binary-object"==t.type){for(let t=0;t<s.length;t++){const r=this.meta[t];r.binary&&(0,n.r5)(e,r,this.byteOffset[t],s[t])}return e}}if("object"==t.type){const e=new Array(s.length);for(let t=0;t<s.length;t++)e[t]="object"==typeof s[t]?structuredClone(s[t]):s[t];return e}if("typed-array"==t.type){const e=s.length,r=i.R[t.arrayType];let n=e*r.BYTES_PER_ELEMENT;const o=new r(t.sharedMemory?new SharedArrayBuffer(n):new ArrayBuffer(n));return o.set(s),o}if("binary-object"==t.type){let e=this.byteSize;const r=t.sharedMemory?new SharedArrayBuffer(e):new ArrayBuffer(e),i={view:new DataView(r),buffer:new Uint8Array(r)};for(let e=0;e<s.length;e++){const t=this.meta[e];t.binary&&(0,n.r5)(i,t,this.byteOffset[e],s[e])}return i}throw new Error("Invalid create data")}createCursor(){return new this._cursorClass(this,this.meta,this._createData,this.byteOffset)}toRemote(e){return"object"==this._createData.type||"typed-array"==this._createData.type?e.__cursor.data:"binary-object"==this._createData.type?e.__cursor.data.buffer:void 0}fromRemote(e){return"object"==this._createData.type||"typed-array"==this._createData.type?e:"binary-object"==this._createData.type?{view:new DataView(e.buffer),buffer:new Uint8Array(e.buffer)}:void 0}toJSON(e){return o(this.schema.root,{},e)}}},62299:(e,t,s)=>{s.d(t,{b:()=>n});var r=s(93406);class n{graph;proto;queries=[];node=r.t.Get();constructor(e,t){this.graph=e,this.proto=t;for(const s of t.queries)this.queries.push(s.add(e));this.graph._systems.push(this)}update(){this.proto.update(this)}dispose(){for(let e=0;e<this.graph._systems.length;e++)this.graph._systems[e]==this&&this.graph._systems.splice(e,1)}}},77280:(e,t,s)=>{s.d(t,{C:()=>n});var r=s(62299);class n{data;systems=new Map;constructor(e){this.data=e}add(e){if(this.systems.has(e))return this.systems.get(e);const t=new r.b(e,this.data);return this.systems.set(e,t),t}remove(e){const t=this.systems.get(e);return!!t&&(t.dispose(),!0)}}},37936:(e,t,s)=>{s.d(t,{v:()=>r});class r{parent;tagData;get id(){return this.tagData.id}children=[];constructor(e,t){this.parent=e,this.tagData=t}*traverseChildren(){const e=[...this.children];for(;e.length;){const t=e.shift();yield t,t.children.length&&e.push(...t.children)}}*traverseParents(){let e=this.parent;for(;e;)yield e,e=e.parent}addChild(e){e.parent=this,this.children.push(e)}removeChild(e){const t=this.children.splice(this.children.findIndex((t=>t.id==e)),1)[0];return t?(t.parent=null,t):null}dispose(){for(const e of this.children)e.dispose();this.children=[]}toJSON(){return{id:this.id,meta:this.tagData.meta}}}},2807:(e,t,s)=>{s.d(t,{k:()=>o});var r=s(18472),n=s(62789);class i{tagAdded=new r.c;componentRemoved=new r.c;nodeAdded=new r.c;nodeRemoved=new r.c}class o{typeId;_freeSlots=[];_node=[];observers=new i;typeNumberId;constructor(e){this.typeId=e,this.typeNumberId=n.g.tags.idPalette.getNumberId(e)}addTag(e){let t=this._freeSlots.length?this._freeSlots.shift():this._node.length;return this._node[t]=e,this.observers.tagAdded.notify(t),this.observers.nodeAdded.notify(e),t}removeTag(e){return void 0===this._node[e]?null:(this.observers.tagAdded.notify(e),this.observers.nodeRemoved.notify(this._node[e]),this._freeSlots.push(e),this._node[e]=-1,!0)}}},9346:(e,t,s)=>{s.d(t,{v:()=>i});var r=s(62789),n=s(47525);class i{static Get(){return n.u.tagCursor.get()||new i}static Retrun(e){return n.u.tagCursor.addItem(e)}get id(){return this.tag.id}_index=0;get index(){return this._index}_type=0;get typeId(){return this._type}get type(){return r.g.tags.idPalette.getStringId(this.typeId)}tag;node;constructor(){}tagArray;setTag(e,t,s){return this.node=e,this._type=t,this._index=s,this.tagArray=e.graph._tags[t],this.tag=r.g.tags.get(this.typeId),this}dispose(){return this.tagArray.removeTag(this._index)}toJSON(){return this.id}}},17065:(e,t,s)=>{s.d(t,{Z:()=>r});class r{_count=0;_palette=[];_map={};constructor(e){if(e){const t=e.length;for(let s=0;s<t;s++)this.register(e[s])}}get size(){return this._count}register(e){const t=this._count;return this._count++,this._palette[t]=e,this._map[e]=t,t}get(){return this._palette}getMap(){return this._map}isRegistered(e){return void 0!==this._map[e]}getNumberId(e){return this._map[e]}getStringId(e){return this._palette[e]}}},52316:(e,t,s)=>{s.d(t,{K:()=>r});class r{items=[];maxSize=1/0;addItem(e){return!(this.items.length>this.maxSize||(this.items.push(e),0))}get(){return this.items.shift()||null}}},18472:(e,t,s)=>{s.d(t,{c:()=>r});class r{observers=[];once=null;constructor(){}listener(e){return e}subscribe(e){this.observers.push(e)}unsubscribe(e){for(let t=0;t<this.observers.length;t++)if(this.observers[t]==e)return this.observers.splice(t,1),this.once&&this.once.has(e)&&this.once.delete(e),!0;return!1}subscribeOnce(e){this.observers.push(e),this.once||(this.once=new Set),this.once.add(e)}notify(e){for(let t=this.observers.length-1;t>=0;t--){const s=this.observers[t];s(e),this.once&&this.once.has(s)&&(this.observers.splice(t,1),this.once.delete(s))}}clear(){this.once&&this.once.clear(),this.observers.length=0}}},46392:(e,t,s)=>{s.d(t,{$m:()=>r.$});var r=s(65156);s(38019),s(84256),s(65035),s(93406),s(32367),s(85296),s(9346),s(52800),s(20048),s(62299)}}]);