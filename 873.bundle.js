(()=>{"use strict";var e,t,s,r,i,a,o={78872:(e,t,s)=>{s.a(e,(async(e,t)=>{try{var r=s(31886),i=s(94618),a=s(26983);(new(s(90842).J)).init(),await(0,r.V)(),(0,a.A)(),(0,i.A)(),t()}catch(e){t(e)}}),1)},90842:(e,t,s)=>{s.d(t,{J:()=>ft});var r=s(20650),i=s(66454);class a{chunkDepth=16;chunkWidth=16;minHeight=60;worldHeight=256;noiseHeight=120;waterHeight=60;noise;brush;init(e){this.noise=e.noise,this.brush=e.brush}}const o=(e=[-1,1],t=[-1,1],s=[-1,1],r=[-10,-10],i=[-1,1],a=!1,o=!1,n=!1,l=!0,d=!1,h=!1)=>({temperature:e,moisture:t,elevation:s,river:r,mod:i,hardLimitMoisture:a,hardLimitTemperature:o,hardLimitElevation:n,hardLimitRiver:l,hardLimitMod:d,excludeRiver:h}),n=(e,t)=>t.temperature[0]<=e[0]&&t.temperature[0]>=e[1],l=(e,t)=>t.moisture[0]<=e[1]&&t.moisture[1]>=e[1],d=(e,t)=>t.elevation[0]<=e[2]&&t.elevation[1]>=e[2],h=(e,t)=>{let s=0,r=!1,i=0;if(!t.hardLimitTemperature||t.hardLimitTemperature&&n(e,t)){const r=(t.temperature[1]+t.temperature[0])/2;s+=1-Math.abs((e[0]-r)/(t.temperature[1]-t.temperature[0])),i++}else t.hardLimitTemperature&&!n(e,t)&&(r=!0);if(!t.hardLimitMoisture||t.hardLimitMoisture&&l(e,t)){const r=(t.moisture[1]+t.moisture[0])/2;s+=1-Math.abs((e[1]-r)/(t.moisture[1]-t.moisture[0])),i++}else t.hardLimitMoisture&&!l(e,t)&&(r=!0);if(!t.hardLimitElevation||t.hardLimitElevation&&d(e,t)){const r=(t.elevation[1]+t.elevation[0])/2;s+=1-Math.abs((e[2]-r)/(t.elevation[1]-t.elevation[0])),i++}else t.hardLimitElevation&&d(e,t)&&(r=!0);if(t.river[1]>0)if(!t.hardLimitRiver||t.hardLimitRiver&&((e,t)=>t.river[0]<=e[3]&&t.river[1]>=e[3])(e,t)){const r=(t.river[1]+t.river[0])/2;s+=1-Math.abs((e[3]-r)/(t.river[1]-t.river[0])),i++}else t.hardLimitRiver&&(r=!0);if(t.mod[1]>0&&void 0!==e[4])if(!t.hardLimitMod||t.hardLimitMod&&((e,t)=>t.mod[0]<=e[4]&&t.mod[1]>=e[4])(e,t)){const r=(t.mod[1]+t.mod[0])/2;s+=1-Math.abs((e[4]-r)/(t.mod[1]-t.mod[0])),i++}else t.hardLimitMod&&(r=!0);return r?0:s/(i||1)};class c{static _biomeTypes=new Map;static _biomes=new Map;static _caveCarver=new Map;static registerBiomes(...e){e.forEach((e=>this._biomes.set(e.data.id,e)))}static getBiome(e){const t=this._biomes.get(e);if(!t)throw new Error(`The biome with id ${e} does not exist.`);return t}static registerBiomeTypes(...e){e.forEach((e=>this._biomeTypes.set(e.data.id,e)))}static getBiomeType(e){const t=this._biomeTypes.get(e);if(!t)throw new Error(`The biome type with id ${e} does not exist.`);return t}static registerCaveCarver(...e){e.forEach((e=>this._caveCarver.set(e.data.id,e)))}static getCaveCarver(e){const t=this._caveCarver.get(e);if(!t)throw new Error(`The cave carver with id ${e} does not exist.`);return t}}class u{nodes;constructor(e){this.nodes=e}}const g=2**32;class f extends u{static data={id:"valley"};getCarved(e,t,s){const r=500;t+=1e5;let i=e+200*this.nodes.noise.detailNoise((e-g+1e5)/r,(t-g+1e5)/r,(s-g+1e5)/r),a=t+200*this.nodes.noise.detailNoise((e-g+1e5)/r,(t-g-1e5)/r,(s-g+1e5)/r),o=s+200*this.nodes.noise.detailNoise((e-g-1e5)/r*1.9,(t-g+1e5)/r,(s-g-1e5)/r)*1.9,n=this.nodes.noise.detailNoise((i-g)/100,(a-g)/100,(o-g)/100);const l=this.nodes.noise.worldGenDetailNoise((e+1e3)/r,(t+1e3)/r,(s+1e3)/r);return n=1-Math.abs(n-.5),n=Math.pow(n,16),n>.8&&l>.6}getData(){return f.data}getClass(){return f}}var p;!function(e){e.Snow="dc_snow",e.Stone="dc_stone",e.GrassBlock="dc_grass_block",e.Dirt="dc_dirt",e.Sand="dc_sand",e.Water="dc_water",e.Gravel="dc_gravel",e.Clay="dc_clay",e.Ice="dc_ice",e.Andesite="dc_andesite",e.Granite="dc_granite",e.CobbleStone="dc_cobble_stone",e.MossyCobbleStone="dc_mossy_cobble_stone",e.GlowStone="dc_glow_stone",e.OakLog="dc_oak_log",e.OakPlanks="dc_oak_planks",e.OakLeaves="dc_oak_leaves",e.SpruceLog="dc_spruce_log",e.SpruceLeaves="dc_spruce_leaves",e.SprucePlanks="dc_spruce_planks",e.SmoothAndesite="dc_smooth_andesite",e.SmoothGranite="dc_smooth_granite",e.Glass="dc_glass",e.Podzol="dc_podzol",e.EmeraldOre="dc_emerald_ore",e.GoldOre="dc_gold_ore",e.IronOre="dc_iron_ore",e.LapisOre="dc_lapis_ore",e.RedstoneOre="dc_redstone_ore",e.CoalBlock="dc_coal_block",e.DiamondBlock="dc_diamond_block",e.GoldBlock="dc_gold_block",e.IronBlock="dc_iron_block",e.Mycelium="dc_mycelium",e.TallFern="dc_tall_fern",e.TallGrass="dc_tall_grass",e.TallRose="dc_tall_rose",e.PaeoniaFlower="dc_paeonia_flower",e.SyringaFlower="dc_syringa_flower",e.BlueOrchidFlower="dc_blue_orchid_flower",e.DandelionFlower="dc_dandelion_flower",e.OxeyeDaisyFlower="dc_oxeye_daisy_flower",e.TulipFlower="dc_tulip_flower",e.WaterlilyFlower="dc_waterlily_flower",e.Vine="dc_vine",e.Fern="dc_fern",e.Reeds="dc_reeds",e.Kelp="dc_kelp",e.Cactus="dc_cactus",e.Grass="dc_grass",e.SeaGrass="dc_sea_grass",e.BrainCoral="dc_brain_coral",e.BrainCoralBlock="dc_brain_coral_block",e.BubbleCoral="dc_bubble_coral",e.BubbleCoralBlock="dc_bubble_coral_block",e.DeadBrainCoralBlock="dc_dead_brain_coral_block",e.DeadBubbleCoralBlock="dc_dead_bubble_coral_block",e.DeadFireCoral="dc_dead_fire_coral",e.DeadFireCoralBlock="dc_dead_fire_coral_block",e.DeadHornCoral="dc_dead_horn_coral",e.DeadHornCoralBlock="dc_dead_horn_coral_block",e.DeadTubeCoral="dc_dead_tube_coral",e.DeadTubeCoralBlock="dc_dead_tube_coral_block",e.DeadBrainCoral="dc_dead_brain_coral",e.DeadBubbleCoral="dc_dead_bubble_coral",e.FireCoral="dc_fire_coral",e.FireCoralBlock="dc_fire_coral_block",e.HornCoral="dc_horn_coral",e.HornCoralBlock="dc_horn_coral_block",e.TubeCoral="dc_tube_coral",e.TubeCoralBlock="dc_tube_coral_block",e.DarkOakLeaves="dc_dark_oak_leaves",e.DarkOakLog="dc_dark_oak_log",e.DarkOakPlanks="dc_dark_oak_planks",e.AcaciaLeaves="dc_acacia_leaves",e.AcaciaLog="dc_acacia_log",e.AcaciaPlanks="dc_acacia_planks",e.BirchLeaves="dc_birch_leaves",e.BirchLog="dc_birch_log",e.BirchPlanks="dc_birch_planks",e.DarkPrismarine="dc_dark_prismarine",e.Prismarine="dc_prismarine",e.PrismarineBricks="dc_prismarine_bricks",e.Bedrock="dc_bedrock",e.Obsidian="dc_obsidan",e.SeaLantern="dc_sea_lantern"}(p||(p={}));const m={[p.Stone]:{name:p.Stone},[p.SeaLantern]:{name:p.SeaLantern},[p.Snow]:{name:p.Snow},[p.SeaGrass]:{name:p.SeaGrass},[p.GrassBlock]:{name:p.GrassBlock},[p.Grass]:{name:p.Grass},[p.Dirt]:{name:p.Dirt},[p.Sand]:{name:p.Sand},[p.Water]:{name:p.Water},[p.Gravel]:{name:p.Gravel},[p.Clay]:{name:p.Clay},[p.Ice]:{name:p.Ice},[p.Andesite]:{name:p.Andesite},[p.Granite]:{name:p.Granite},[p.CobbleStone]:{name:p.CobbleStone},[p.MossyCobbleStone]:{name:p.MossyCobbleStone},[p.GlowStone]:{name:p.GlowStone},[p.OakLog]:{name:p.OakLog},[p.OakPlanks]:{name:p.OakPlanks},[p.OakLeaves]:{name:p.OakLeaves},[p.SpruceLog]:{name:p.SpruceLog},[p.SpruceLeaves]:{name:p.SpruceLeaves},[p.SprucePlanks]:{name:p.SprucePlanks},[p.SmoothAndesite]:{name:p.SmoothAndesite},[p.SmoothGranite]:{name:p.SmoothGranite},[p.Glass]:{name:p.Glass},[p.Podzol]:{name:p.Podzol},[p.EmeraldOre]:{name:p.EmeraldOre},[p.GoldOre]:{name:p.GoldOre},[p.IronOre]:{name:p.IronOre},[p.LapisOre]:{name:p.LapisOre},[p.RedstoneOre]:{name:p.RedstoneOre},[p.CoalBlock]:{name:p.CoalBlock},[p.DiamondBlock]:{name:p.DiamondBlock},[p.GoldBlock]:{name:p.GoldBlock},[p.IronBlock]:{name:p.IronBlock},[p.Mycelium]:{name:p.Mycelium},[p.TallFern]:{name:p.TallFern},[p.TallGrass]:{name:p.TallGrass},[p.TallRose]:{name:p.TallRose},[p.PaeoniaFlower]:{name:p.PaeoniaFlower},[p.SyringaFlower]:{name:p.SyringaFlower},[p.BlueOrchidFlower]:{name:p.BlueOrchidFlower},[p.DandelionFlower]:{name:p.DandelionFlower},[p.OxeyeDaisyFlower]:{name:p.OxeyeDaisyFlower},[p.TulipFlower]:{name:p.TulipFlower},[p.WaterlilyFlower]:{name:p.WaterlilyFlower},[p.Vine]:{name:p.Vine},[p.Fern]:{name:p.Fern},[p.Reeds]:{name:p.Reeds},[p.Cactus]:{name:p.Cactus},[p.Kelp]:{name:p.Kelp},[p.BrainCoral]:{name:p.BrainCoral},[p.BrainCoralBlock]:{name:p.BrainCoralBlock},[p.BubbleCoral]:{name:p.BubbleCoral},[p.BubbleCoralBlock]:{name:p.BubbleCoralBlock},[p.DeadBrainCoralBlock]:{name:p.DeadBrainCoralBlock},[p.DeadBubbleCoralBlock]:{name:p.DeadBubbleCoralBlock},[p.DeadFireCoral]:{name:p.DeadFireCoral},[p.DeadFireCoralBlock]:{name:p.DeadFireCoralBlock},[p.DeadHornCoral]:{name:p.DeadHornCoral},[p.DeadHornCoralBlock]:{name:p.DeadHornCoralBlock},[p.DeadTubeCoral]:{name:p.DeadTubeCoral},[p.DeadTubeCoralBlock]:{name:p.DeadTubeCoralBlock},[p.DeadBrainCoral]:{name:p.DeadBrainCoral},[p.DeadBubbleCoral]:{name:p.DeadBubbleCoral},[p.FireCoral]:{name:p.FireCoral},[p.FireCoralBlock]:{name:p.FireCoralBlock},[p.HornCoral]:{name:p.HornCoral},[p.HornCoralBlock]:{name:p.HornCoralBlock},[p.TubeCoral]:{name:p.TubeCoral},[p.TubeCoralBlock]:{name:p.TubeCoralBlock},[p.DarkOakLeaves]:{name:p.DarkOakLeaves},[p.DarkOakLog]:{name:p.DarkOakLog},[p.DarkOakPlanks]:{name:p.DarkOakPlanks},[p.AcaciaLeaves]:{name:p.AcaciaLeaves},[p.AcaciaLog]:{name:p.AcaciaLog},[p.AcaciaPlanks]:{name:p.AcaciaPlanks},[p.BirchLeaves]:{name:p.BirchLeaves},[p.BirchLog]:{name:p.BirchLog},[p.BirchPlanks]:{name:p.BirchPlanks},[p.DarkPrismarine]:{name:p.DarkPrismarine},[p.Prismarine]:{name:p.Prismarine},[p.PrismarineBricks]:{name:p.PrismarineBricks},[p.Bedrock]:{name:p.Bedrock},[p.Obsidian]:{name:p.Obsidian}};var y=s(62312);new Map;const x=new Map,v=new Map,b=new Map,w=new Map;function A(e,t,s){return`${e}-${t}-${s}`}class S{nodes;data;biomeTypes=new Map;constructor(e,t){this.nodes=e,this.data=t}init(){for(const[e,t]of this.data.biomeTypes){const s=new(c.getBiomeType(e))(this.nodes,this,t);this.biomeTypes.set(e,s),s.init()}}isInRange(e,t){return t.temperature[0]<=e[0]&&t.temperature[1]>=e[0]&&t.moisture[0]<=e[1]&&t.moisture[1]>=e[1]&&t.elevation[0]<=e[2]&&t.elevation[1]>=e[2]}getBiomeTypeInRange(e){let t=0,s=null,r=0,i=0;for(const[a,o]of this.data.biomeTypes){let n=h(e,o);if(n>i&&o.river[1]<=0&&o.excludeRiver&&(i=n),n>t){if(o.river[1]>=0&&r>0&&t==i){n=0;continue}t=n,s=this.biomeTypes.get(a),r=o.excludeRiver?100:r}}return s||this.biomeTypes.get("grass-land")}getBiomeTypeFromValue(e){let t=this.getBiomeTypeInRange(e);const s=t.getData();if(!s.edgeBiomeTypes.length||!s.edgeFactor)return t;{const r=[e[0]+s.edgeFactor[0],e[1]+s.edgeFactor[1],e[2]+s.edgeFactor[2],e[3]+s.edgeFactor[3]],i=this.getBiomeTypeInRange(r);if(i!=t){const s=this.getEdgeBiomeTypeFromValue(t,e);if(i.getData().edgeBiomeTypes.find((e=>e[0]==s.getData().id)))return s}}{const r=[e[0]-s.edgeFactor[0],e[1]-s.edgeFactor[1],e[2]-s.edgeFactor[2],e[3]-s.edgeFactor[3]],i=this.getBiomeTypeInRange(r);if(i!=t){const s=this.getEdgeBiomeTypeFromValue(t,e);if(i.getData().edgeBiomeTypes.find((e=>e[0]==s.getData().id)))return s}}return t}getBiomeFromValue(e,t){return this.getBiomeTypeFromValue(e).getBiomeFromValue(e,t)}getEdgeBiomeTypeFromValue(e,t){for(const[s,r]of e.getData().edgeBiomeTypes)if(this.isInRange(t,r))return this.biomeTypes.get(s);throw new Error("No biome type")}_clearTimeOut;getRiverNoise(e,t,s){let r=this.nodes.noise.biomeTypeRiverNoise(e/1600,1.2*s/1600),i=.05*this.nodes.noise.biomeDetailNoise(e/50,10,s/50)+.1;return r>-i&&r<i?(r+i)/(2*i):0}getElavation(e,t,s){const r=2**32;let i=.1*this.nodes.noise.biomeDetailNoise(e/100,50,s/100);const a=this.nodes.noise.biomeTypeElevationNoise((e-r)/1024,(s+r)/1024);let o=a+i;return(o>1||o<-1)&&(i=-i,o=a+i),Math.max(-1,Math.min(1,o))}getTempature(e,t,s){const r=2**32;let i=.1*this.nodes.noise.biomeDetailNoise(e/100,5880,s/100);const a=this.nodes.noise.biomeTypeTemperatureNoise((e-r)/4096,(s-r)/4096);let o=a+i;return(o>1||o<-1)&&(i=-i,o=a+i),Math.max(-1,Math.min(1,o))}getMostiure(e,t,s){const r=2**32;let i=.1*this.nodes.noise.biomeDetailNoise(e/100,10980,s/100);const a=this.nodes.noise.biomeTypeMoistureNoise((e-r)/1024,(s-r)/1024);let o=a+i;return(o>1||o<-1)&&(i=-i,o=a+i),Math.max(-1,Math.min(1,o))}getBiomeTypeValue(e,t,s){const r=this.getMostiure(e,t,s);return[this.getElavation(e,t,s),r,this.getTempature(e,t,s),this.getRiverNoise(e,t,s)]}clearCache(){w.clear(),x.clear(),v.clear(),b.clear()}getBiomeType(e,t,s){const r=A(e,t,s);let i=w.get(r);if(i)return i;let a=this.getBiomeTypeValue(e,t,s);return i=this.getBiomeTypeFromValue(a),w.set(r,i),i}getBiome(e,t,s){const r=A(e,t,s);let i=x.get(r);return i||(i=this.getBiomeType(e,t,s).getBiome(e,t,s),x.set(r,i),i)}getHeight(e,t,s){const r=A(e,t,s);let i=b.get(r);return i||(i=Math.max(this.getBiome(e,t,s).getHeight(e,t,s),1),b.set(r,i),i)}getBlendedHeight(e,t,s){const r=A(e,t,s);let i=v.get(r);return i||(i=Math.max(this.getBiome(e,t,s).getBlendedHeight(e,t,s),1),v.set(r,i),i)}generateWorldColumn(e,t){const{brush:s}=this.nodes,r=s.dataCursor;for(let i=e;i<this.nodes.chunkWidth+e;i++)for(let e=t;e<this.nodes.chunkDepth+t;e++){const t=this.getBiome(i,0,e),a=this.getBlendedHeight(i,0,e);if(a>y.k.world.bounds.MaxY-20)continue;for(let r=0;r<=a;r++){if(0==r){s.setName(p.Bedrock).setXYZ(i,r,e).paint();continue}if(t.getCarved(i,r,e))continue;const a=t.getGenVoxel(i,r,e);a&&s.setData(a).setXYZ(i,r,e).paint()}let o=!1,n=!1;for(let s=a+10;s>=0&&(o||(r.getVoxel(i,s,e)?.isRenderable()||1==s)&&(o=!0,t.fill(i,s+1,e)),n||t.addTopLayer(i,s,e)&&(n=!0),!o||!n);s--);}}decorateWorldColumn(e,t){const{brush:s}=this.nodes;for(let s=e;s<this.nodes.chunkWidth+e;s++)for(let e=t;e<this.nodes.chunkDepth+t;e++){const t=this.getBiome(s,0,e),r=this.getBlendedHeight(s,0,e);for(let i=1;i<=r;i++)t.decorate(s,i,e)}}wormCanver;generateBiomeTypeImage([e,t,s],[r,i,a]){this.wormCanver=new f(this.nodes);const o=new Uint8ClampedArray(4194304);console.log("Start");for(let t=s;t<=a;t++)for(let i=e;i<=r;i++){const r=4*(1024*(t-s)+(i-e));try{const[e,s,a]=this.getBiome(i,0,t).getData().color;o[r]=e,o[r+1]=s,o[r+2]=a,o[r+3]=255}catch(e){o[r]=255,o[r+3]=255}}return console.log("done",o),o}}class B{nodes;dimesnion;range;biomes=new Map;isRiver;constructor(e,t,s){this.nodes=e,this.dimesnion=t,this.range=s}getBiomeFromValue(e,t){e[4]=t;let s=0,r=null,i=null;for(const[t,a]of this.getData().biomes){let o=h(e,a);o>s&&(s=o,i=a,r=this.biomes.get(t))}if(!r||!i)return this.biomes.get(this.biomes.keys().next().value);const a=r.getData();if(!a.edgeBiomes.length||!a.edgeFactor)return r;{const s=[e[0]-(Array.isArray(a.edgeFactor[0])?a.edgeFactor[0][0]:a.edgeFactor[0]),e[1]-(Array.isArray(a.edgeFactor[1])?a.edgeFactor[1][0]:a.edgeFactor[1]),e[2]-(Array.isArray(a.edgeFactor[2])?a.edgeFactor[2][0]:a.edgeFactor[2]),e[3]-(Array.isArray(a.edgeFactor[3])?a.edgeFactor[3][0]:a.edgeFactor[3])],o=this.dimesnion.getBiomeTypeFromValue(s);if((i.excludeRiver||this.range.excludeRiver)&&o.isRiver)return r;if(o!=this)return this.getEdgeBiomeFromValue(e,r,t)}{const s=[e[0]+(Array.isArray(a.edgeFactor[0])?a.edgeFactor[0][1]:a.edgeFactor[0]),e[1]+(Array.isArray(a.edgeFactor[1])?a.edgeFactor[1][1]:a.edgeFactor[1]),e[2]+(Array.isArray(a.edgeFactor[2])?a.edgeFactor[2][1]:a.edgeFactor[2]),e[3]+(Array.isArray(a.edgeFactor[3])?a.edgeFactor[3][1]:a.edgeFactor[3])],o=this.dimesnion.getBiomeTypeFromValue(s);if((i.excludeRiver||this.range.excludeRiver)&&o.isRiver)return r;if(o!=this)return this.getEdgeBiomeFromValue(e,r,t)}return r}getEdgeBiomeFromValue(e,t,s){e[4]=s;let r=0,i=null,a=null;for(const[s,o]of t.getData().edgeBiomes){let t=h(e,o);t>r&&(r=t,a=o,i=this.biomes.get(s))}return i&&a?i:this.biomes.get(this.biomes.keys().next().value)}getBiomeValue(e,t,s){return this.nodes.noise.biomeNoise(e/120,0,s/120)}getBiome(e,t,s){const r=this.getBiomeValue(e,t,s),i=this.dimesnion.getBiomeTypeValue(e,t,s);return this.getBiomeFromValue(i,r)}init(){for(const[e]of this.getData().biomes){const t=c.getBiome(e);if(this.biomes.set(e,new t(this.nodes,this)),t.data.edgeBiomes.length)for(const[e]of t.data.edgeBiomes){const t=c.getBiome(e);this.biomes.set(e,new t(this.nodes,this))}}}}class I{nodes;biomeType;isRiver;constructor(e,t){this.nodes=e,this.biomeType=t}findHeightInDirection(e,t,s,r,i,a){let o=e,n=1;for(let e=1;e<=a;e++){const a=t+e*r,l=s+e*i,d=this.biomeType.dimesnion.getBiome(a,0,l);d!==this&&(o+=d.getHeight(a,0,l),n++)}return o/n}getBlendedHeight(e,t,s){const r=this.getData();if(r.heightBlendFactor<=0)return this.getHeight(e,t,s);const i=32*r.heightBlendFactor;let a=Math.round(this.getHeight(e,t,s)),o=a,n=1;o+=this.findHeightInDirection(a,e,s,0,1,i),o+=this.findHeightInDirection(a,e,s,0,-1,i),o+=this.findHeightInDirection(a,e,s,1,0,i),o+=this.findHeightInDirection(a,e,s,-1,0,i),n+=4,o+=this.findHeightInDirection(a,e,s,1,1,i),o+=this.findHeightInDirection(a,e,s,1,-1,i),o+=this.findHeightInDirection(a,e,s,-1,1,i),o+=this.findHeightInDirection(a,e,s,-1,-1,i),n+=4;const l=Math.round(o/9),d=this.getData().minHeight;return void 0!==d&&l<d?d:l}}class C{data;currentState;rules;angle=25;constructor(e){this.data=e}setRules(e,t,s=this.angle){this.currentState=e,this.rules=t,this.angle=s}setAngle(e){this.angle=e}generateRandomRules(){const e=["F[+F]F[-F]FE","F[&F]F[^F]FE","F[&+F]F[^-F]FE","F[-F][+F]FE","F[&-F][^+F]FE"],t=["FF","FFF","F-F"],s=2+Math.floor(2*Math.random());this.rules=[];for(let r=0;r<s;r++){const s=Math.random()<.5?e.map((e=>e.replace(/F/g,t[Math.floor(Math.random()*t.length)]+(Math.random()>.9?"E":"")))):t.map((e=>e+(Math.random()>.9?"E":"")));this.rules.push({symbol:"F",replacements:s})}return this.rules.push({symbol:"X",replacements:["F[-F][+F]F[&F]^FE","F&[X-FX]+FE","F^F[X]+F-FE"].slice(0,1+Math.floor(2*Math.random()))}),this.currentState="X",this.setRules("X",this.rules,this.angle),this}generateState(e){if(!this.rules.length)throw new Error("Rules not set. Please set rules before generating L-system.");for(let t=0;t<e;t++){let e="";for(const t of this.currentState){let s=!1;for(const r of this.rules)if(t===r.symbol){e+=r.replacements[Math.floor(Math.random()*r.replacements.length)],s=!0;break}s||(e+=t)}this.currentState=e}return this.currentState}interpret(e,t={x:0,y:0,z:0},s={x:0,y:1,z:0}){let r=[],i=t,a=s;for(const t of e)switch(t){case"F":i.x+=a.x,i.y+=a.y,i.z+=a.z,this.placeVoxel(i.x,i.y,i.z);break;case"E":this.placeEnd(i.x,i.y,i.z);case"+":a=this.rotate(a,this.angle,"z");break;case"-":a=this.rotate(a,-this.angle,"z");break;case"&":a=this.rotate(a,this.angle,"x");break;case"^":a=this.rotate(a,-this.angle,"x");break;case"[":r.push({position:{...i},direction:{...a}});break;case"]":const e=r.pop();i=e.position,a=e.direction}}rotate(e,t,s){const r=t*Math.PI/180;let i=e.x,a=e.y,o=e.z;switch(s){case"x":a=e.y*Math.cos(r)-e.z*Math.sin(r),o=e.y*Math.sin(r)+e.z*Math.cos(r);break;case"y":i=e.x*Math.cos(r)-e.z*Math.sin(r),o=e.x*Math.sin(r)+e.z*Math.cos(r);break;case"z":i=e.x*Math.cos(r)-e.y*Math.sin(r),a=e.x*Math.sin(r)+e.y*Math.cos(r)}return{x:i,y:a,z:o}}placeEnd(e,t,s){this.data.placeEnd(Math.round(e),Math.round(t),Math.round(s))}placeVoxel(e,t,s){this.data.placeVoxel(Math.round(e),Math.round(t),Math.round(s))}}var _=s(99673);function T(e,t,s,r,i,a,o=!1,n=!0){let l=s-a,d=i-a;e.setName(t);const h=e.dataCursor;for(let t=l;t<=s+a;t++)for(let l=d;l<=i+a;l++)if(!o||t!=s||l!=i){if(n){const e=h.getVoxel(t,r,l);if(e){if(e.isAir()&&1==e.getLevelState())continue;if(e.isRenderable())continue}}(0,_.me)(t,s,l,i)<=a&&e.setXYZ(t,r,l).paint()}}function V(e,t,s,r,i,a,o=-1,n=!0){let l=Math.floor(s-a),d=Math.floor(r-a),h=Math.floor(i-a);e.setName(t);const c=e.dataCursor;for(let t=l;t<=s+a;t++)for(let l=h;l<=i+a;l++)for(let h=d;h<=r+a;h++){if(o>-1&&Math.random()<o)continue;const d=c.getVoxel(t,h,l);if(n&&d){if(d.isAir()&&1==d.getLevelState())continue;if(d.isRenderable())continue}(0,_.D7)(t,h,l,s,r,i)<=a&&e.setXYZ(t,h,l).paint()}}class z{static oakLSystem=new C({placeVoxel(e,t,s){z.nodes.brush.setXYZ(e,t,s).setName(p.OakLog).paint()},placeEnd(e,t,s){V(z.nodes.brush,p.OakLeaves,e,t,s,Math.max(5*Math.random(),4),.01)}});static birchSystem=new C({placeVoxel(e,t,s){z.nodes.brush.setXYZ(e,t,s).setName(p.BirchLog).paint()},placeEnd(e,t,s){V(z.nodes.brush,p.BirchLeaves,e,t,s,Math.max(5*Math.random(),4),.01)}});static acaciSystem=new C({placeVoxel(e,t,s){z.nodes.brush.setXYZ(e,t,s).setName(p.AcaciaLog).paint()},placeEnd(e,t,s){V(z.nodes.brush,p.AcaciaLeaves,e,t,s,Math.max(5*Math.random(),4),.01)}});static darkOakSystem=new C({placeVoxel(e,t,s){z.nodes.brush.setXYZ(e,t,s).setName(p.DarkOakLog).paint()},placeEnd(e,t,s){V(z.nodes.brush,p.DarkOakLeaves,e,t,s,Math.max(5*Math.random(),4),.01)}});static nodes;static init(e){this.nodes=e}static generateOakTree(e,t,s){this.oakLSystem.generateRandomRules();const r=this.oakLSystem.generateState(2);this.oakLSystem.interpret(r,{x:e,y:t-1,z:s})}static generateDarkOakTree(e,t,s){this.darkOakSystem.generateRandomRules();const r=this.darkOakSystem.generateState(2);this.darkOakSystem.interpret(r,{x:e,y:t-1,z:s})}static generateAcaciaTree(e,t,s){this.acaciSystem.generateRandomRules();const r=this.acaciSystem.generateState(2);this.acaciSystem.interpret(r,{x:e,y:t-1,z:s})}static generateBirchTree(e,t,s){this.birchSystem.generateRandomRules();const r=this.birchSystem.generateState(2);this.birchSystem.interpret(r,{x:e,y:t-1,z:s})}static generateSpruceTree(e,t,s){const{brush:r}=this.nodes;r.setName(p.SpruceLog).setXYZ(e,t,s).paint();let i=Math.floor(30*Math.random()+10);r.setName(p.SpruceLeaves).setXYZ(e,i+t+1,s).paint(),r.setXYZ(e+1,i+t+1,s).paint(),r.setXYZ(e,i+t+1,s+1).paint(),r.setXYZ(e+1,i+t+1,s+1).paint();let a=4,o=i,n=o/4;for(;o>n&&a<10;)T(r,p.SpruceLeaves,e,t+o,s,a),o-=3,a++;for(let a=t;a<=t+i;a++)r.setName(p.SpruceLog).setXYZ(e,a,s).paint(),r.setXYZ(e+1,a,s).paint(),r.setXYZ(e,a,s+1).paint(),r.setXYZ(e+1,a,s+1).paint()}}const M={getIndex(e,t=Math.random()){if(e.length<=1)return 0;const s=[];let r=0;for(const[t,i]of e)r+=i,s.push(r);const i=t*r|0;let a=0;for(const e of s){if(i<=e)break;a++}return a},getValue(e,t=Math.random()){return e[this.getIndex(e,t)][0]}},D=[[p.TulipFlower,10],[p.PaeoniaFlower,10],[p.SyringaFlower,10],[p.DandelionFlower,10],[p.BlueOrchidFlower,10],[p.OxeyeDaisyFlower,10],[p.WaterlilyFlower,10]],N=[[p.Fern,10],[p.Grass,10],[p.TallGrass,10],[p.TallFern,10]],k=[[p.DeadFireCoral,10],[p.DeadHornCoral,10],[p.DeadTubeCoral,10],[p.DeadBrainCoral,10],[p.DeadBubbleCoral,10]],L=[[p.FireCoral,10],[p.HornCoral,10],[p.TubeCoral,10],[p.BrainCoral,10],[p.BubbleCoral,10]],F=[[p.SeaGrass,10]];class R{static generateCactus(e,t,s,r){const{brush:i}=e;let a=Math.floor(5*Math.random()+2);for(let e=s;e<=s+a;e++)i.setName(p.Cactus).setXYZ(t,e,r).paint()}static generateReed(e,t,s,r){const{brush:i}=e;let a=Math.floor(5*Math.random()+2);for(let e=s;e<=s+a;e++)i.setName(p.Reeds).setXYZ(t,e,r).paint()}static generateKelp(e,t,s,r){const{brush:i}=e;let a=Math.floor(15*Math.random()+5),o=Math.floor(5*Math.random());for(let n=s;n<=s+a&&n<e.waterHeight-o;n++)i.setName(p.Water).setLevel(7).setSecondaryName(p.Kelp).setXYZ(t,n,r).paint();i.setLevel(0),i.setSecondaryName("")}static generateWaterPlant(e,t,s,r){const{brush:i}=e,a=M.getValue(F);i.setName(p.Water).setLevel(7).setSecondaryName(a).setXYZ(t,s,r).paint(),i.setLevel(0),i.setSecondaryName("")}static generateRandomFlower(e,t,s,r){const{brush:i}=e,a=M.getValue(D);i.setName(a).setXYZ(t,s,r).paint()}static generateRandomPlant(e,t,s,r){const{brush:i}=e,a=M.getValue(N);i.setName(a).setXYZ(t,s,r).paint()}static generateRandomDeadCoral(e,t,s,r){const{brush:i}=e,a=M.getValue(k);i.setName(a).setXYZ(t,s,r).paint()}static generateRandomCoral(e,t,s,r){const{brush:i}=e,a=M.getValue(L);i.setName(p.Water).setLevel(7).setSecondaryName(a).setXYZ(t,s,r).paint(),i.setLevel(0),i.setSecondaryName("")}}const U=2**32;class E extends u{static data={id:"standard"};getCarved(e,t,s){const r=this.nodes.noise.worldGenNoise(e/50,t/50,s/50),i=(1+this.nodes.noise.detailNoise((e-U)/100,t/100,(s-U)/100))/2;return i<.4+(.6-.4)*r-.9*i&&t<(.2+(.8-.2)*r+.9*i)*this.nodes.worldHeight}getData(){return E.data}getClass(){return E}}const P=2**32;class H extends u{static data={id:"worm"};getCarved(e,t,s){for(let r=0;r<4;r++){let i=150/(r%3);e+=2e4*r,s-=2e4*r;let a=this.nodes.noise.detailNoise(e/200,25e4*r,s/200);if(this.nodes.noise.worldDetailNoise(e/600,25e4*r,s/600)<.5)continue;let o=(1+this.nodes.noise.worldDetailNoise((e-P)/i,5e4,(s-P)/i))/2*60+5,n=(1+this.nodes.noise.worldDetailNoise((e-P)/150,25e4,(s-P)/150))/2*10+5,l=(1+this.nodes.noise.worldDetailNoise((e-P)/30,(t+200)/30,(s-P)/30))/2;if(a>-.03-.02*l&&a<.03+.02*l&&t<=o+(n+20*l)/2&&t>=o-(n+20*l)/2)return!0}return!1}getData(){return H.data}getClass(){return H}}class G{static standard;static worm;static valley;static init(e){this.standard=new E(e),this.worm=new H(e),this.valley=new f(e)}static getCarved(e,t,s){const r=this.standard.getCarved(e,t,s),i=this.worm.getCarved(e,t,s);return r||i}}const[O,Q]=[1e3,1e4];class Y extends I{static data={id:"tundra",heightBlendFactor:1,color:[3,171,121],edgeBiomes:[]};getGenVoxel(e,t,s){return!(t>40*this.noiseQuery(e,t,s)+this.nodes.minHeight)&&m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.getHeight(e,t,s)}noiseQuery(e,t,s){return(1+this.nodes.noise.worldGenNoise((e+O)/100,t/100,(s+Q)/100))/2}getHeight(e,t,s){return 40*this.noiseQuery(e,0,s)+this.nodes.minHeight}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();if(a&&o==p.Stone){r.setData(m[p.GrassBlock]).setXYZ(e,t,s).paint(),r.setData(m[p.Snow]).setXYZ(e,t+1,s).paint();let i=5;for(;i--;)r.setData(m[p.Dirt]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){return!1}decorate(e,t,s){const r=this.nodes.brush.dataCursor,i=r.getVoxel(e,t+1,s)?.isAir()||!0,a=r.getVoxel(e,t,s)?.getName();if(i&&a==p.GrassBlock){const r=Math.random();r>.999&&z.generateOakTree(e,t+1,s),r>.88&&r<.89&&R.generateRandomPlant(this.nodes,e,t+1,s)}}getData(){return this.getClass().data}getClass(){return Y}}const[X,Z]=[1e3,1e4];class W extends I{static data={id:"frozen-waste",heightBlendFactor:1,color:[255,255,255],edgeBiomes:[]};getGenVoxel(e,t,s){return!(t>40*this.noiseQuery(e,t,s)+this.nodes.minHeight)&&m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.getHeight(e,t,s)}noiseQuery(e,t,s){return(1+this.nodes.noise.worldGenNoise((e+X)/100,t/100,(s+Z)/100))/2}getHeight(e,t,s){return 40*this.noiseQuery(e,0,s)+this.nodes.minHeight}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();if(a&&o==p.Stone){r.setData(m[p.Gravel]).setXYZ(e,t,s).paint(),r.setData(m[p.Snow]).setXYZ(e,t+1,s).paint();let i=5;for(;i--;)r.setData(m[p.Dirt]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){return!1}decorate(e,t,s){}getData(){return this.getClass().data}getClass(){return W}}class j extends B{static data={id:"artic",color:[255,255,255],biomes:[[Y.data.id,o([-.8,-.5])],[W.data.id,o([-1,-.8])]],edgeBiomeTypes:[]};getData(){return this.getClass().data}getClass(){return j}}const[q,$]=[1e3,1e4];class K extends I{static data={id:"desert",heightBlendFactor:1,color:[166,132,40],edgeBiomes:[]};getGenVoxel(e,t,s){return m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.getHeight(e,t,s)}noiseQuery(e,t,s){return(1+this.nodes.noise.worldGenNoise((e+q)/480,t/480,(s+$)/480))/2}getHeight(e,t,s){return 30*this.noiseQuery(e,0,s)+this.nodes.minHeight}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();if(a&&o==p.Stone){r.setData(m[p.Sand]).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setData(m[p.Sand]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){return!1}decorate(e,t,s){const r=this.nodes.brush.dataCursor,i=r.getVoxel(e,t+1,s)?.isAir()||!0,a=r.getVoxel(e,t,s)?.getName();if(i&&a==p.Sand){const r=Math.random();if(r>.999)return void z.generateOakTree(e,t+1,s);if(r>.88&&r<.89)return void R.generateCactus(this.nodes,e,t+1,s)}}getData(){return this.getClass().data}getClass(){return K}}class J{static brainCoralSystem=new C({placeVoxel(e,t,s){t>J.nodes.waterHeight-1||J.nodes.brush.setXYZ(e,t,s).setName(p.BrainCoralBlock).paint()},placeEnd(e,t,s){}});static fireCoralSystem=new C({placeVoxel(e,t,s){t>J.nodes.waterHeight-1||J.nodes.brush.setXYZ(e,t,s).setName(p.FireCoralBlock).paint()},placeEnd(e,t,s){}});static bubbleCoralSystem=new C({placeVoxel(e,t,s){t>J.nodes.waterHeight-1||J.nodes.brush.setXYZ(e,t,s).setName(p.BubbleCoralBlock).paint()},placeEnd(e,t,s){}});static hornCoralSystem=new C({placeVoxel(e,t,s){t>J.nodes.waterHeight-1||J.nodes.brush.setXYZ(e,t,s).setName(p.HornCoralBlock).paint()},placeEnd(e,t,s){}});static tubeCoralSystem=new C({placeVoxel(e,t,s){t>J.nodes.waterHeight-1||J.nodes.brush.setXYZ(e,t,s).setName(p.TubeCoralBlock).paint()},placeEnd(e,t,s){}});static nodes;static init(e){this.nodes=e}static generateBrainCoral(e,t,s){this.brainCoralSystem.generateRandomRules();const r=this.brainCoralSystem.generateState(2);this.brainCoralSystem.interpret(r,{x:e,y:t-1,z:s})}static generateFireCoral(e,t,s){this.fireCoralSystem.generateRandomRules();const r=this.fireCoralSystem.generateState(2);this.fireCoralSystem.interpret(r,{x:e,y:t-1,z:s})}static generateBubbleCoral(e,t,s){this.bubbleCoralSystem.generateRandomRules();const r=this.bubbleCoralSystem.generateState(2);this.bubbleCoralSystem.interpret(r,{x:e,y:t-1,z:s})}static generateHornCoral(e,t,s){this.hornCoralSystem.generateRandomRules();const r=this.hornCoralSystem.generateState(2);this.hornCoralSystem.interpret(r,{x:e,y:t-1,z:s})}static generateTubeCoral(e,t,s){this.tubeCoralSystem.generateRandomRules();const r=this.tubeCoralSystem.generateState(2);this.tubeCoralSystem.interpret(r,{x:e,y:t-1,z:s})}static deadBrainCoralSystem=new C({placeVoxel(e,t,s){J.nodes.brush.setXYZ(e,t,s).setName(p.DeadBrainCoralBlock).paint()},placeEnd(e,t,s){}});static deadBubbleCoralSystem=new C({placeVoxel(e,t,s){J.nodes.brush.setXYZ(e,t,s).setName(p.DeadBubbleCoralBlock).paint()},placeEnd(e,t,s){}});static deadFireCoralSystem=new C({placeVoxel(e,t,s){J.nodes.brush.setXYZ(e,t,s).setName(p.DeadFireCoralBlock).paint()},placeEnd(e,t,s){}});static deadHornCoralSystem=new C({placeVoxel(e,t,s){J.nodes.brush.setXYZ(e,t,s).setName(p.DeadHornCoralBlock).paint()},placeEnd(e,t,s){}});static deadTubeCoralSystem=new C({placeVoxel(e,t,s){J.nodes.brush.setXYZ(e,t,s).setName(p.DeadTubeCoralBlock).paint()},placeEnd(e,t,s){}});static generateDeadBrainCoral(e,t,s){this.deadBrainCoralSystem.generateRandomRules();const r=this.deadBrainCoralSystem.generateState(2);this.deadBrainCoralSystem.interpret(r,{x:e,y:t-1,z:s})}static generateDeadBubbleCoral(e,t,s){this.deadBubbleCoralSystem.generateRandomRules();const r=this.deadBubbleCoralSystem.generateState(2);this.deadBubbleCoralSystem.interpret(r,{x:e,y:t-1,z:s})}static generateDeadFireCoral(e,t,s){this.deadFireCoralSystem.generateRandomRules();const r=this.deadFireCoralSystem.generateState(2);this.deadFireCoralSystem.interpret(r,{x:e,y:t-1,z:s})}static generateDeadHornCoral(e,t,s){this.deadHornCoralSystem.generateRandomRules();const r=this.deadHornCoralSystem.generateState(2);this.deadHornCoralSystem.interpret(r,{x:e,y:t-1,z:s})}static generateDeadTubeCoral(e,t,s){this.deadTubeCoralSystem.generateRandomRules();const r=this.deadTubeCoralSystem.generateState(2);this.deadTubeCoralSystem.interpret(r,{x:e,y:t-1,z:s})}static runRandomGenerator(e){return e[Math.floor(Math.random()*e.length)]}static liveGens=[this.generateBrainCoral,this.generateBubbleCoral,this.generateFireCoral,this.generateHornCoral,this.generateTubeCoral];static generateRandomCoral(e,t,s){this.runRandomGenerator(this.liveGens).call(this,e,t,s)}static deadGens=[this.generateDeadBrainCoral,this.generateDeadBubbleCoral,this.generateDeadFireCoral,this.generateDeadHornCoral,this.generateDeadTubeCoral];static generateRandomDeadCoral(e,t,s){this.runRandomGenerator(this.deadGens).call(this,e,t,s)}}const[ee,te]=[1e3,1e4];class se extends I{static data={id:"dea-sea",heightBlendFactor:1,color:[153,131,70],edgeBiomes:[]};caveCarver=new E(this.nodes);getGenVoxel(e,t,s){return m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.getHeight(e,t,s)}noiseQuery(e,t,s){return(1+this.nodes.noise.worldGenNoise((e+ee)/480,t/480,(s+te)/480))/2}getHeight(e,t,s){return 30*this.noiseQuery(e,0,s)+this.nodes.minHeight}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();if(a&&o==p.Stone){r.setData(m[p.Sand]).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setData(m[p.Sand]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){return!1}decorate(e,t,s){const r=this.nodes.brush.dataCursor,i=r.getVoxel(e,t+1,s)?.isAir()||!0,a=r.getVoxel(e,t,s)?.getName();if(i&&a==p.Sand){const r=Math.random();if(r>.87&&r<.89)return void J.generateRandomDeadCoral(e,t+1,s);if(r>.85&&r<.87)return void R.generateRandomDeadCoral(this.nodes,e,t+1,s)}}getData(){return this.getClass().data}getClass(){return se}}class re extends B{static data={id:"desert",color:[166,132,40],biomes:[[K.data.id,o([-1,1],[-1,1],[.3,.7],[-1,1])],[se.data.id,o([-1,1],[-1,1],[0,.2],[-1,1])]],edgeBiomeTypes:[]};getData(){return this.getClass().data}getClass(){return re}}const[ie,ae]=[1e3,1e4];class oe extends I{static data={id:"oak-forest",heightBlendFactor:1,color:[42,102,49],edgeBiomes:[]};caveCarver=new E(this.nodes);getGenVoxel(e,t,s){return m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.getHeight(e,t,s)}noiseQuery(e,t,s){return(1+this.nodes.noise.worldGenNoise((e+ie)/480,t/480,(s+ae)/480))/2}getHeight(e,t,s){return 30*this.noiseQuery(e,0,s)+this.nodes.minHeight}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();if(a&&o==p.Stone){r.setData(m[p.GrassBlock]).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setData(m[p.Dirt]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){return!1}decorate(e,t,s){const r=this.nodes.brush.dataCursor,i=r.getVoxel(e,t+1,s)?.isAir()||!0,a=r.getVoxel(e,t,s)?.getName();if(i&&a==p.GrassBlock){const r=Math.random();if(r>.97)return void z.generateOakTree(e,t+1,s);if(r>.85&&r<.89)return void R.generateRandomFlower(this.nodes,e,t+1,s);if(r>0&&r<.1)return void R.generateRandomPlant(this.nodes,e,t+1,s)}}getData(){return this.getClass().data}getClass(){return oe}}const[ne,le]=[1e3,1e4];class de extends I{static data={id:"spruce-forest",heightBlendFactor:1,color:[32,56,35],edgeBiomes:[]};caveCarver=new E(this.nodes);getGenVoxel(e,t,s){return m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.getHeight(e,t,s)}noiseQuery(e,t,s){return(1+this.nodes.noise.worldGenNoise((e+ne)/480,t/480,(s+le)/480))/2}getHeight(e,t,s){return 30*this.noiseQuery(e,0,s)+this.nodes.minHeight}getFillVoxel(e,t,s,r=!1){const i=(1+this.nodes.noise.worldGenNoise(e/200,t/200,s/200))/2;return i>.4&&i<1?p.Podzol:i>.3&&i<.4?r?p.GrassBlock:p.Dirt:p.Gravel}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();if(a&&o==p.Stone){r.setData(m[this.getFillVoxel(e,t,s,!0)]).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setData(m[this.getFillVoxel(e,t,s)]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){return!1}decorate(e,t,s){const r=this.nodes.brush.dataCursor,i=r.getVoxel(e,t+1,s)?.isAir()||!0,a=r.getVoxel(e,t,s)?.getName();if(i&&(a==p.Podzol||a==p.GrassBlock)){const r=Math.random();if(r>.99)return void z.generateSpruceTree(e,t+1,s);if(r>.88&&r<.89)return void R.generateRandomFlower(this.nodes,e,t+1,s);if(r>0&&r<.05)return void R.generateRandomPlant(this.nodes,e,t+1,s)}}getData(){return this.getClass().data}getClass(){return de}}const[he,ce]=[1e3,1e4];class ue extends I{static data={id:"dark-oak-forest",heightBlendFactor:1,color:[1,66,8],edgeBiomes:[]};caveCarver=new E(this.nodes);getGenVoxel(e,t,s){return m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.getHeight(e,t,s)}noiseQuery(e,t,s){return(1+this.nodes.noise.worldGenNoise((e+he)/480,t/480,(s+ce)/480))/2}getHeight(e,t,s){return 30*this.noiseQuery(e,0,s)+this.nodes.minHeight}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();if(a&&o==p.Stone){r.setData(m[p.GrassBlock]).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setData(m[p.Dirt]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){return!1}decorate(e,t,s){const r=this.nodes.brush.dataCursor,i=r.getVoxel(e,t+1,s)?.isAir()||!0,a=r.getVoxel(e,t,s)?.getName();if(i&&a==p.GrassBlock){const r=Math.random();if(r>.97)return void z.generateDarkOakTree(e,t+1,s);if(r>.85&&r<.89)return void R.generateRandomFlower(this.nodes,e,t+1,s);if(r>0&&r<.1)return void R.generateRandomPlant(this.nodes,e,t+1,s)}}getData(){return this.getClass().data}getClass(){return ue}}class ge extends I{static data={id:"birch-forest",heightBlendFactor:1,color:[95,204,61],edgeBiomes:[]};caveCarver=new E(this.nodes);getGenVoxel(e,t,s){return m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.getHeight(e,t,s)}noiseQuery(e,t,s){const[r,i]=[1e3,1e4];return(1+this.nodes.noise.worldGenNoise((e+r)/480,t/480,(s+i)/480))/2}getHeight(e,t,s){return 30*this.noiseQuery(e,0,s)+this.nodes.minHeight}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();if(a&&o==p.Stone){r.setData(m[p.GrassBlock]).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setData(m[p.Dirt]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){return!1}decorate(e,t,s){const r=this.nodes.brush.dataCursor,i=r.getVoxel(e,t+1,s)?.isAir()||!0,a=r.getVoxel(e,t,s)?.getName();if(i&&a==p.GrassBlock){const r=Math.random();if(r>.97)return void z.generateBirchTree(e,t+1,s);if(r>.85&&r<.89)return void R.generateRandomFlower(this.nodes,e,t+1,s);if(r>0&&r<.1)return void R.generateRandomPlant(this.nodes,e,t+1,s)}}getData(){return this.getClass().data}getClass(){return ge}}class fe extends B{static data={id:"forest",color:[19,77,17],biomes:[[oe.data.id,o([-.2,.3],[-.2,-.01],[.1,.8])],[de.data.id,o([-.8,-.1],[-.4,-.2],[.2,.8])],[ue.data.id,o([-.2,.3],[-.4,-.3],[.2,.5])],[ge.data.id,o([-.3,.4],[-.3,-.1],[.4,.8])]],edgeBiomeTypes:[]};getData(){return this.getClass().data}getClass(){return fe}}const[pe,me]=[1e3,1e4];class ye extends I{static data={id:"prairie",heightBlendFactor:1,color:[117,255,112],edgeBiomes:[]};caveCarver=new E(this.nodes);getCoreVoxel(e,t,s){const r=(1+this.nodes.noise.worldGenNoise(e/200,t/200,s/200))/2;return r>=.8?p.Granite:r>=.7&&r<.8?p.Andesite:p.Stone}getGenVoxel(e,t,s){return m[this.getCoreVoxel(e,t,s)]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.getHeight(e,t,s)}noiseQuery(e,t,s){return(1+this.nodes.noise.worldGenNoise((e+pe)/480,t/480,(s+me)/480))/2}getHeight(e,t,s){return 30*this.noiseQuery(e,0,s)+this.nodes.minHeight}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();if(a&&o==p.Stone||o==p.Andesite||o==p.Granite){r.setData(m[p.GrassBlock]).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setData(m[p.Dirt]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){return!1}decorate(e,t,s){const r=this.nodes.brush.dataCursor,i=r.getVoxel(e,t+1,s)?.isAir()||!0,a=r.getVoxel(e,t,s)?.getName();if(i&&a==p.GrassBlock){const r=Math.random();if(r>.99)return void z.generateOakTree(e,t+1,s);if(r>.9&&r<.92)return void R.generateRandomFlower(this.nodes,e,t+1,s);if(r>0&&r<.1)return void R.generateRandomPlant(this.nodes,e,t+1,s)}}getData(){return this.getClass().data}getClass(){return ye}}const[xe,ve]=[1e3,1e4];class be extends I{static data={id:"savannah",heightBlendFactor:1,color:[188,255,112],edgeBiomes:[]};caveCarver=new E(this.nodes);getCoreVoxel(e,t,s){const r=(1+this.nodes.noise.worldGenNoise(e/200,t/200,s/200))/2;return r>=.8?p.Granite:r>=.7&&r<.8?p.Andesite:p.Stone}getGenVoxel(e,t,s){return m[this.getCoreVoxel(e,t,s)]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.getHeight(e,t,s)}noiseQuery(e,t,s){return(1+this.nodes.noise.worldGenNoise((e+xe)/480,t/480,(s+ve)/480))/2}getHeight(e,t,s){return 30*this.noiseQuery(e,0,s)+this.nodes.minHeight}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();if(a&&o==p.Stone||o==p.Andesite||o==p.Granite){r.setData(m[p.GrassBlock]).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setData(m[p.Dirt]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){return!1}decorate(e,t,s){const r=this.nodes.brush.dataCursor,i=r.getVoxel(e,t+1,s)?.isAir()||!0,a=r.getVoxel(e,t,s)?.getName();if(i&&a==p.GrassBlock){const r=Math.random();if(r>.99)return void z.generateAcaciaTree(e,t+1,s);if(r>0&&r<.01)return void R.generateRandomPlant(this.nodes,e,t+1,s)}}getData(){return this.getClass().data}getClass(){return be}}class we extends B{static data={id:"grass-land",color:[117,255,112],biomes:[[ye.data.id,o([.1,.3],[-.5,-.3])],[be.data.id,o([.3,.4],[-.3,-.1])]],edgeBiomeTypes:[]};getData(){return this.getClass().data}getClass(){return we}}const[Ae,Se]=[1e3,1e4];class Be extends I{static data={id:"rocky-mountain",heightBlendFactor:.2,color:[129,142,143],edgeBiomes:[]};caveCarver=new E(this.nodes);getCoreVoxel(e,t,s){const r=(1+this.nodes.noise.worldGenNoise(e/40,t/40,s/40))/2;return r>.6&&r<.7?p.Gravel:p.Stone}getGenVoxel(e,t,s){return m[this.getCoreVoxel(e,t,s)]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.getHeight(e,t,s)}noiseQuery(e,t,s){return(1+this.nodes.noise.worldGenNoise((e+Ae)/30,t/30,(s+Se)/30))/2}getHeight(e,t,s){return 200*this.noiseQuery(e,0,s)+this.nodes.minHeight}addTopLayer(e,t,s){if(t<150)return!0;const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();if(a&&o==p.Stone){r.setData(m[p.Snow]).setXYZ(e,t,s).paint(),r.setData(m[p.Snow]).setXYZ(e,t+1,s).paint();let i=5;for(;i--;)r.setData(m[p.Snow]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){return!1}decorate(e,t,s){}getData(){return this.getClass().data}getClass(){return Be}}const[Ie,Ce]=[1e3,1e4];class _e extends I{static data={id:"high-gravel-hills",heightBlendFactor:1,color:[90,99,99],edgeBiomes:[]};caveCarver=new E(this.nodes);getCoreVoxel(e,t,s){const r=(1+this.nodes.noise.worldGenNoise(e/40,t/40,s/40))/2;return r>.2&&r<.8?p.Gravel:p.Stone}getGenVoxel(e,t,s){return m[this.getCoreVoxel(e,t,s)]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.getHeight(e,t,s)}noiseQuery(e,t,s){return(1+this.nodes.noise.worldGenNoise((e+Ie)/100,t/100,(s+Ce)/100))/2}getHeight(e,t,s){return 80*this.noiseQuery(e,0,s)+this.nodes.minHeight}addTopLayer(e,t,s){if(t<150)return!0;const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();if(a&&o==p.Stone){r.setData(m[p.Snow]).setXYZ(e,t,s).paint(),r.setData(m[p.Snow]).setXYZ(e,t+1,s).paint();let i=5;for(;i--;)r.setData(m[p.Snow]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){return!1}decorate(e,t,s){}getData(){return this.getClass().data}getClass(){return _e}}class Te extends B{static data={id:"mountain",color:[129,142,143],biomes:[[Be.data.id,o(void 0,void 0,[.85,1])],[_e.data.id,o(void 0,void 0,[.7,.85])]],edgeBiomeTypes:[]};getData(){return this.getClass().data}getClass(){return Te}}const[Ve,ze]=[1e3,1e4];class Me extends I{static data={id:"beache",heightBlendFactor:.5,color:[252,252,3],edgeBiomes:[],minHeight:60};caveCarver=new E(this.nodes);getGenVoxel(e,t,s){return m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.nodes.waterHeight}noiseQuery(e,t,s){return(1+this.nodes.noise.worldGenNoise((e+Ve)/480,t/480,(s+ze)/480))/2}getHeight(e,t,s){return 30*this.noiseQuery(e,0,s)+this.nodes.minHeight}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();if(a&&o==p.Stone){r.setData(m[p.Sand]).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setData(m[p.Sand]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){const{brush:r}=this.nodes;let i=t;for(;i<=this.nodes.waterHeight;)t<this.nodes.waterHeight&&r.setName(p.Sand).setXYZ(e,i,s).paint(),i++}decorate(e,t,s){const r=this.nodes.brush.dataCursor,i=r.getVoxel(e,t+1,s)?.isAir()||!0,a=r.getVoxel(e,t,s)?.getName();if(i&&a==p.GrassBlock){const r=Math.random();if(r>.999)return void z.generateOakTree(e,t+1,s);if(r>.85&&r<.89)return void R.generateRandomPlant(this.nodes,e,t+1,s)}if(i&&a==p.Sand){const r=Math.random();if(r>.88&&r<.89)return void R.generateRandomPlant(this.nodes,e,t+1,s);if(r>2e-4&&r<.005)return void R.generateReed(this.nodes,e,t+1,s)}}getData(){return this.getClass().data}getClass(){return Me}}const[De,Ne]=[1e3,1e4];class ke extends I{static data={id:"rocky-beach",heightBlendFactor:.5,color:[122,122,59],edgeBiomes:[],minHeight:60};caveCarver=new E(this.nodes);getGenVoxel(e,t,s){return m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.nodes.waterHeight}getFillVoxel(e,t,s,r=!1){const i=(1+this.nodes.noise.worldGenNoise(e/200,t/200,s/200))/2;return i>.4&&i<1?p.Gravel:i>.3&&i<.4?p.Sand:p.Andesite}noiseQuery(e,t,s){return(1+this.nodes.noise.worldGenNoise((e+De)/480,t/480,(s+Ne)/480))/2}getHeight(e,t,s){return 30*this.noiseQuery(e,0,s)+this.nodes.minHeight}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();if(a&&o==p.Stone){r.setData(m[this.getFillVoxel(e,t,s)]).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setData(m[this.getFillVoxel(e,t,s)]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){const{brush:r}=this.nodes;let i=t;for(;i<=this.nodes.waterHeight;)t<this.nodes.waterHeight&&r.setName(this.getFillVoxel(e,t,s)).setXYZ(e,i,s).paint(),i++}decorate(e,t,s){const r=this.nodes.brush.dataCursor,i=r.getVoxel(e,t+1,s)?.isAir()||!0,a=r.getVoxel(e,t,s)?.getName();if(i&&a==p.GrassBlock){const r=Math.random();if(r>.999)return void z.generateOakTree(e,t+1,s);if(r>.85&&r<.89)return void R.generateRandomPlant(this.nodes,e,t+1,s)}if(i&&a==p.Sand){const r=Math.random();if(r>.88&&r<.89)return void R.generateRandomPlant(this.nodes,e,t+1,s);if(r>2e-4&&r<.005)return void R.generateReed(this.nodes,e,t+1,s)}}getData(){return this.getClass().data}getClass(){return ke}}const[Le,Fe]=[1e3,1e4];class Re extends I{static data={id:"icy-beach",heightBlendFactor:.5,color:[230,230,85],edgeBiomes:[],minHeight:60};caveCarver=new E(this.nodes);getGenVoxel(e,t,s){return m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.nodes.waterHeight}getHeight(e,t,s){return(1+this.nodes.noise.worldGenNoise((e+Le)/480,0,(s+Fe)/480))/2*5+this.nodes.minHeight}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();if(a&&o==p.Stone){r.setData(m[p.Sand]).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setData(m[p.Sand]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){const{brush:r}=this.nodes;let i=t;for(;i<=this.nodes.waterHeight;)t<this.nodes.waterHeight&&r.setName(p.Sand).setXYZ(e,i,s).paint(),i++}decorate(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();a&&o==p.Sand&&Math.random()<.95&&r.setName(p.Snow).setXYZ(e,t+1,s).paint()}getData(){return this.getClass().data}getClass(){return Re}}const[Ue,Ee]=[1e3,1e4];class Pe extends I{static data={id:"shallow-ocean",heightBlendFactor:1,color:[0,119,128],edgeFactor:[0,[.1,0],0,0],edgeBiomes:[[Me.data.id,o([0,1],void 0,[-1,.6])],[ke.data.id,o(void 0,void 0,[.6,1])],[Re.data.id,o([-1,-.5],void 0,[-1,.6])]]};caveCarver=new E(this.nodes);getGenVoxel(e,t,s){return m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.nodes.waterHeight}getHeight(e,t,s){return this.nodes.minHeight-(1+this.nodes.noise.worldGenNoise((e+Ue)/480,0,(s+Ee)/480))/2*40}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s),o=a?.isAir()||a?.isRenderable()&&i.getVoxel(e,t+1,s).getSubstanceData().dve_is_liquid,n=i.getVoxel(e,t,s)?.getName();if(o&&n==p.Stone){r.setData(m[p.Dirt]).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setData(m[p.Dirt]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){const{brush:r}=this.nodes;let i=t;for(r.setName(p.Water).setLevel(7);i<=this.nodes.waterHeight;)t<this.nodes.waterHeight&&r.setXYZ(e,i,s).paint(),i++;r.setLevel(0)}decorate(e,t,s){const r=this.nodes.brush.dataCursor,i=r.getVoxel(e,t+1,s),a=i?.isAir()||i?.isRenderable()&&r.getVoxel(e,t+1,s).getSubstanceData().dve_is_liquid,o=r.getVoxel(e,t,s)?.getName();if(a&&(o==p.Dirt||o==p.Sand)){const r=Math.random();if(r>.87&&r<.89)return void R.generateKelp(this.nodes,e,t+1,s);if(r>.98)return void R.generateWaterPlant(this.nodes,e,t+1,s)}}getData(){return this.getClass().data}getClass(){return Pe}}const[He,Ge]=[1e3,1e4];class Oe extends I{static data={id:"tropical-ocean",heightBlendFactor:1,color:[10,231,247],edgeFactor:[0,[.1,0],0,0],edgeBiomes:[[Me.data.id,o([0,1],void 0,[-1,.6])],[ke.data.id,o(void 0,void 0,[.6,1])],[Re.data.id,o([-1,-.5],void 0,[-1,.6])]]};caveCarver=new E(this.nodes);getGenVoxel(e,t,s){return m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.nodes.waterHeight}getHeight(e,t,s){return this.nodes.minHeight-(1+this.nodes.noise.worldGenNoise((e+He)/480,0,(s+Ge)/480))/2*40}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s),o=a?.isAir()||a?.isRenderable()&&i.getVoxel(e,t+1,s).getSubstanceData().dve_is_liquid,n=i.getVoxel(e,t,s)?.getName();if(o&&n==p.Stone){r.setData(m[p.Dirt]).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setData(m[p.Dirt]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){const{brush:r}=this.nodes;let i=t;for(r.setName(p.Water).setLevel(7);i<=this.nodes.waterHeight;)t<this.nodes.waterHeight&&r.setXYZ(e,i,s).paint(),i++;r.setLevel(0)}decorate(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s),o=a?.isAir()||a?.isRenderable()&&i.getVoxel(e,t+1,s).getSubstanceData().dve_is_liquid,n=i.getVoxel(e,t,s)?.getName();if(o&&(n==p.Dirt||n==p.Sand)){const i=Math.random();if(i>.87&&i<.89)return void J.generateRandomCoral(e,t+1,s);if(i>.85&&i<.87)return void R.generateRandomCoral(this.nodes,e,t+1,s);if(i>.8&&i<.82)return void r.setName(p.SeaLantern).setXYZ(e,t+1,s).paint();if(i>.98)return void R.generateWaterPlant(this.nodes,e,t+1,s)}}getData(){return this.getClass().data}getClass(){return Oe}}const[Qe,Ye]=[1e3,1e4];class Xe extends I{static data={id:"deep-ocean",heightBlendFactor:1,color:[2,83,89],edgeFactor:[0,[.1,0],0,0],edgeBiomes:[[Me.data.id,o([0,1],void 0,[-1,.6])],[ke.data.id,o(void 0,void 0,[.6,1])],[Re.data.id,o([-1,-.5],void 0,[-1,.6])]]};caveCarver=new E(this.nodes);getGenVoxel(e,t,s){return m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.nodes.waterHeight}getHeight(e,t,s){return this.nodes.minHeight-(1+this.nodes.noise.worldGenNoise((e+Qe)/480,0,(s+Ye)/480))/2*50}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s),o=a?.isAir()||a?.isRenderable()&&i.getVoxel(e,t+1,s).getSubstanceData().dve_is_liquid,n=i.getVoxel(e,t,s)?.getName();if(o&&n==p.Stone){r.setData(m[p.Dirt]).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setData(m[p.Dirt]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){const{brush:r}=this.nodes;let i=t;for(r.setName(p.Water).setLevel(7);i<=this.nodes.waterHeight;)t<this.nodes.waterHeight&&r.setXYZ(e,i,s).paint(),i++;r.setLevel(0)}decorate(e,t,s){const r=this.nodes.brush.dataCursor,i=r.getVoxel(e,t+1,s),a=i?.isAir()||i?.isRenderable()&&r.getVoxel(e,t+1,s).getSubstanceData().dve_is_liquid,o=r.getVoxel(e,t,s)?.getName();if(a&&(o==p.Dirt||o==p.Sand)){const r=Math.random();if(r>.87&&r<.89)return void R.generateKelp(this.nodes,e,t+1,s);if(r>.98)return void R.generateWaterPlant(this.nodes,e,t+1,s)}}getData(){return this.getClass().data}getClass(){return Xe}}const[Ze,We]=[1e3,1e4];class je extends I{static data={id:"frozen-ocean",heightBlendFactor:1,color:[57,99,102],edgeFactor:[0,[.1,0],0,0],edgeBiomes:[[Me.data.id,o([0,1])],[ke.data.id,o(void 0,void 0,[.7,1])],[Re.data.id,o([-1,-.5])]]};caveCarver=new E(this.nodes);getGenVoxel(e,t,s){return m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.nodes.waterHeight}getHeight(e,t,s){return this.nodes.minHeight-(1+this.nodes.noise.worldGenNoise((e+Ze)/480,0,(s+We)/480))/2*40}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s),o=a?.isAir()||a?.isRenderable()&&i.getVoxel(e,t+1,s).getSubstanceData().dve_is_liquid||!1,n=i.getVoxel(e,t,s)?.getName();if(o&&n==p.Stone){r.setData(m[p.Dirt]).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setData(m[p.Dirt]).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){const{brush:r}=this.nodes;Math.random()>.8&&r.setName(p.Ice).setXYZ(e,this.nodes.waterHeight+1,s).paint(),r.setName(p.Ice).setXYZ(e,this.nodes.waterHeight,s).paint();let i=t;for(r.setName(p.Water).setLevel(7);i<=this.nodes.waterHeight-1;)t<this.nodes.waterHeight-1&&r.setXYZ(e,i,s).paint(),i++;r.setLevel(0)}decorate(e,t,s){const r=this.nodes.brush.dataCursor,i=r.getVoxel(e,t+1,s),a=i?.isAir()||i?.isRenderable()&&r.getVoxel(e,t+1,s).getSubstanceData().dve_is_liquid||!1,o=r.getVoxel(e,t,s)?.getName();if(a&&(o==p.Dirt||o==p.Sand)){const r=Math.random();if(r>.87&&r<.89)return void R.generateKelp(this.nodes,e,t+1,s);if(r>.98)return void R.generateWaterPlant(this.nodes,e,t+1,s)}}getData(){return this.getClass().data}getClass(){return je}}class qe extends B{static data={id:"ocean",color:[2,83,89],biomes:[[Pe.data.id,o([-.2,.4],[0,1],[-.4,0])],[Oe.data.id,o([.8,1],[0,1],[-.1,0])],[Xe.data.id,o([-1,.4],[0,1],[-1,-.5])],[je.data.id,o([-1,-.5],[0,1],[-.5,0])]],edgeBiomeTypes:[]};getData(){return this.getClass().data}getClass(){return qe}}const[$e,Ke]=[1e3,1e4];class Je extends I{static data={id:"river-bank",heightBlendFactor:.25,color:[43,26,1],edgeBiomes:[],minHeight:60};caveCarver=new E(this.nodes);getGenVoxel(e,t,s){return m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.nodes.waterHeight}noiseQuery(e,t,s){return(1+this.nodes.noise.worldGenNoise((e+$e)/120,t/120,(s+Ke)/120))/2}getHeight(e,t,s){return 5*this.noiseQuery(e,0,s)+(this.nodes.waterHeight+5)}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s)?.isAir()||!0,o=i.getVoxel(e,t,s)?.getName();if(a&&o==p.Stone){r.setName(this.getFillVoxel(e,t,s,!0)).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setName(this.getFillVoxel(e,t-1-i,s)).setXYZ(e,t-1-i,s).paint();return!0}return!1}getFillVoxel(e,t,s,r=!1){const i=(1+this.nodes.noise.worldGenNoise(e/20+10,t/20+100,s/20+10))/2;return i>.5&&i<1?p.Sand:i>.3&&i<.5?r?p.GrassBlock:p.Dirt:p.Gravel}fill(e,t,s){const r=this.nodes.brush,i=r.dataCursor;let a=t;for(;a<=this.nodes.waterHeight;)t<this.nodes.waterHeight&&(i.getVoxel(e,t,s)?.isRenderable()||r.setName(this.getFillVoxel(e,a,s,a==this.nodes.waterHeight)).setXYZ(e,a,s).paint()),a++}decorate(e,t,s){const r=this.nodes.brush.dataCursor,i=r.getVoxel(e,t+1,s)?.isAir()||!0,a=r.getVoxel(e,t,s)?.getName();if(i&&a==p.GrassBlock){const r=Math.random();if(r>.99)return void z.generateOakTree(e,t+1,s);if(r>.9&&r<.92)return void R.generateReed(this.nodes,e,t+1,s);if(r>0&&r<.1)return void R.generateRandomPlant(this.nodes,e,t+1,s)}}getData(){return this.getClass().data}getClass(){return Je}}const[et,tt]=[1e3,1e4];class st extends I{static data={id:"river",heightBlendFactor:.25,color:[3,206,252],edgeFactor:[0,0,0,[.1,.3]],edgeBiomes:[[Je.data.id,o()]]};caveCarver=new E(this.nodes);isRiver=!0;getGenVoxel(e,t,s){return m[p.Stone]}getCarved(e,t,s){return G.getCarved(e,t,s)}getBlendtoHeight(e,t,s){return this.nodes.waterHeight}getHeight(e,t,s){return this.nodes.waterHeight-5-(1+this.nodes.noise.worldGenNoise((e+et)/480,0,(s+tt)/480))/2*5}getLayerVoxel(e,t,s){const r=(1+this.nodes.noise.worldGenNoise(e/200,t/200,s/200))/2;return r>=.7?p.Gravel:r<.7&&r>.4?p.Dirt:r<=.4&&r>.2?p.Sand:p.Clay}addTopLayer(e,t,s){const r=this.nodes.brush,i=r.dataCursor,a=i.getVoxel(e,t+1,s),o=a?.isAir()||a?.isRenderable()&&i.getVoxel(e,t+1,s).getSubstanceData().dve_is_liquid,n=i.getVoxel(e,t,s)?.getName();if(o&&n==p.Stone){r.setName(this.getLayerVoxel(e,t,s)).setXYZ(e,t,s).paint();let i=5;for(;i--;)r.setName(this.getLayerVoxel(e,t-1,s)).setXYZ(e,t-1-i,s).paint();return!0}return!1}fill(e,t,s){const{brush:r}=this.nodes;let i=t;for(r.setName(p.Water).setLevel(7);i<=this.nodes.waterHeight;)t<this.nodes.waterHeight&&r.setXYZ(e,i,s).paint(),i++;r.setLevel(0)}decorate(e,t,s){const r=this.nodes.brush.dataCursor,i=r.getVoxel(e,t+1,s),a=i?.isAir()||i?.isRenderable()&&r.getVoxel(e,t+1,s).getSubstanceData().dve_is_liquid,o=r.getVoxel(e,t,s)?.getName();a&&(o==p.Dirt||o==p.Sand)&&t<this.nodes.waterHeight-1&&Math.random()>.98&&R.generateWaterPlant(this.nodes,e,t+1,s)}getData(){return this.getClass().data}getClass(){return st}}class rt extends B{static data={id:"river",color:[0,228,245],biomes:[[st.data.id,o()]],edgeBiomeTypes:[]};isRiver=!0;getData(){return this.getClass().data}getClass(){return rt}}const it=-.35,at=.8,ot={id:"overworld",biomeTypes:[[re.data.id,o([.6,1],[-1,-.5],[it,at])],[j.data.id,o([-1,-.8],[-.7,0],[it,at])],[qe.data.id,o([-1,.5],[.1,1],[-1,it],void 0,void 0,!1,!1,!1,!0,!1,!0)],[we.data.id,o([-.2,.5],[-.5,-.2],[it,at])],[fe.data.id,o([-.2,.3],[-.55,-.1],[it,at])],[Te.data.id,o([-.4,.7],[-1,0],[at,1])],[rt.data.id,o([-1,1],[-1,1],[it,at-.2],[.3,1.2],void 0,!1,!1,!1,!0)]]};var nt=s(29835),lt=s.n(nt),dt=s(84627);class ht{worldGenNoise;detailNoise;orePerlin;worldDetailNoise;worldGenDetailNoise;biomeNoise;biomeDetailNoise;biomeTypeMoistureNoise;biomeTypeTemperatureNoise;biomeTypeElevationNoise;biomeTypeRiverNoise;oreNoise;init(e){this.worldGenNoise=(0,dt.Cf)(lt()(`${e.worldNoise}`)),this.detailNoise=(0,dt.Cf)(lt()(`${e.detailNoise}`)),this.biomeNoise=(0,dt.fu)(lt()(`${e.biomeNoise}`)),this.biomeTypeMoistureNoise=(0,dt.fu)(lt()(`${e.biomeTypeMoistureNoise}`)),this.biomeTypeTemperatureNoise=(0,dt.fu)(lt()(`${e.biomeTypeTemperatureNoise}`)),this.biomeTypeElevationNoise=(0,dt.fu)(lt()(`${e.biomeTypeElevationNoise}`)),this.biomeDetailNoise=(0,dt.Cf)(lt()(`${e.biomeDetailNoise}`)),this.biomeTypeRiverNoise=(0,dt.fu)(lt()(e.biomeTypeRiverNoise)),this.oreNoise=(0,dt.Cf)(lt()(e.oreNoise)),this.worldDetailNoise=(0,dt.Cf)(lt()(e.worldDetailNoise)),this.worldGenDetailNoise=(0,dt.Cf)(lt()(e.worldGenDetailNoise)),console.log("noise",this.biomeTypeElevationNoise(123,31290),this.biomeTypeElevationNoise(239048230,42304),this.biomeTypeTemperatureNoise(209348,238490))}}var ct=s(81168);const ut=new i.T;let gt;class ft{static instance;nodes;overWorldGen;constructor(){if(ft.instance)return ft.instance;ft.instance=this}init(){c.registerBiomeTypes(qe,j,fe,Te,re,we,rt),c.registerBiomes(Y,K,se,ue,ge,W,_e,be,oe,Re,ke,Be,de,ye,Be,Pe,Me,Xe,je,Oe,st,Je),c.registerCaveCarver(E,H,f),r.J.setWorldGen(this);const e=new ht;this.nodes=new a,e.init({biomeNoise:8394723847382,biomeDetailNoise:7089879878979,biomeTypeMoistureNoise:2748927489274,biomeTypeTemperatureNoise:1748927483928,biomeTypeElevationNoise:7384723847938,biomeTypeRiverNoise:3472983472983,worldNoise:1892738192738,detailNoise:3928743928743,oreNoise:1928371928371,worldDetailNoise:4938274938274,worldGenDetailNoise:0xefabe3fe05}),this.nodes.init({noise:e,brush:ut}),this.overWorldGen=new S(this.nodes,ot),this.overWorldGen.init(),z.init(this.nodes),G.init(this.nodes),J.init(this.nodes)}async generate([[e,t,s,r],i]){ut.start(e,t,s,r),this.overWorldGen.generateWorldColumn(t,r),ut.stop()}async decorate([[e,t,s,r],i]){ut.start(e,t,s,r),this.overWorldGen.decorateWorldColumn(t,r),clearTimeout(gt),gt=setTimeout((()=>this.overWorldGen.clearCache()),6e4),ut.stop()}}ct.QK.registerTask("get-biome-image",(([e,t])=>{const s=ft.instance.overWorldGen.generateBiomeTypeImage(e,t);return[s,[s.buffer]]}))},23891:(e,t,s)=>{s.d(t,{P:()=>i});var r=s(8126);class i{buffer;data;constructor(e){return this.buffer=e,this.data=new DataView(ArrayBuffer.isView(e)?e.buffer:e),new Proxy(this,{get:(e,t)=>{if("string"==typeof t&&!isNaN(Number(t))){const s=Number(t);return e.get(s)}return e[t]},set:(e,t,s)=>{if("string"==typeof t&&!isNaN(Number(t))){const r=Number(t);return e.set(r,s),!0}return e[t]=s,!0}})}get length(){return 8*this.buffer.byteLength}get(e){if(e<0||e>=this.length)throw new RangeError(`Index ${e} is out of bounds`);return r.u.getBitArrayIndexView(this.data,0,e)}set(e,t){if(e<0||e>=this.length)throw new RangeError(`Index ${e} is out of bounds`);if(t<0||t>1)throw new RangeError(`Value ${t} is out of bounds for a bit`);r.u.setBitArrayIndexView(this.data,0,e,t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.length?{value:this.get(e++),done:!1}:{value:void 0,done:!0}}}forEach(e){for(let t=0;t<this.length;t++)e(this.get(t),t,this)}}},85860:(e,t,s)=>{var r,i;s.d(t,{QI:()=>r,Yd:()=>a,bI:()=>i}),function(e){e[e.Int8=0]="Int8",e[e.Uint8=1]="Uint8",e[e.Uint8Clamped=2]="Uint8Clamped",e[e.Int16=3]="Int16",e[e.Uint16=4]="Uint16",e[e.Float32=5]="Float32",e[e.Int32=6]="Int32",e[e.Uint32=7]="Uint32",e[e.Float64=8]="Float64",e[e.BigInt=9]="BigInt",e[e.BigUint=10]="BigUint"}(r||(r={})),function(e){e[e.Int8=1]="Int8",e[e.Uint8=1]="Uint8",e[e.Uint8Clamped=1]="Uint8Clamped",e[e.Int16=2]="Int16",e[e.Uint16=2]="Uint16",e[e.Float32=4]="Float32",e[e.Int32=4]="Int32",e[e.Uint32=4]="Uint32",e[e.Float64=8]="Float64",e[e.BigInt=8]="BigInt",e[e.BigUint=8]="BigUint"}(i||(i={}));const a={[r.Int8]:i.Int8,[r.Uint8]:i.Uint8,[r.Uint8Clamped]:i.Uint8Clamped,[r.Int16]:i.Int16,[r.Uint16]:i.Uint16,[r.Float32]:i.Float32,[r.Int32]:i.Int32,[r.Uint32]:i.Uint32,[r.Float64]:i.Float64,[r.BigInt]:i.BigInt,[r.BigUint]:i.BigUint}},8126:(e,t,s)=>{s.d(t,{u:()=>i});var r=s(35112);class i{static getBitArrayIndexView(e,t,s){const i=s/8|0,a=s-8*i,o=e.getUint8(i+t);return r.y.getBitValue(o,a,1)}static setBitArrayIndexView(e,t,s,i){const a=s/8|0,o=s-8*a,n=e.getUint8(a+t);e.setUint8(a+t,r.y.setBitValue(n,o,i,1))}static getBitArrayIndex(e,t,s){const i=s/8|0,a=s-8*i,o=e[i+t];return r.y.getBitValue(o,a,1)}static setBitArrayIndex(e,t,s,i){const a=s/8|0,o=s-8*a,n=e[a+t];e[a+t]=r.y.setBitValue(n,o,i,1)}static getNibbleArrayIndex(e,t,s){const i=s/2|0,a=s%2==0,o=e.getUint8(i+t);return r.y.getBitValue(o,a?4:0,4)}static setNibbleArrayIndex(e,t,s,i){const a=s/2|0,o=s%2==0,n=e.getUint8(a+t);e.setUint8(a+t,r.y.setBitValue(n,o?4:0,i,4))}static getHalfNibbleArrayIndex(e,t,s){const i=s/4|0,a=s%4,o=e.getUint8(i+t);return r.y.getBitValue(o,2*a,2)}static setHalfNibbleArrayIndex(e,t,s,i){const a=s/4|0,o=s%4,n=e.getUint8(a+t);e.setUint8(a+t,r.y.setBitValue(n,2*o,i,2))}}},35112:(e,t,s)=>{s.d(t,{y:()=>o});var r=s(34135),i=s(85860),a=s(25075);class o{static setTypedNumber(e,t,s,r){return a.v[s](e,t,r)}static getTypedNumber(e,t,s){return r.n[s](e,t)}static calculateBitsNeeded(e,t){let s=t-e;return Math.ceil(Math.log2(s))}static getTypedSize(e){return i.Yd[e]}static getBitValue(e,t,s){return(2**s-1<<t&e)>>>t}static setBitValue(e,t,s,r){const i=2**r-1;return e&~(i<<t)|(s&i)<<t}}},34135:(e,t,s)=>{s.d(t,{n:()=>i});var r=s(85860);const i={[r.QI.Int8]:(e,t)=>e.getInt8(t),[r.QI.Uint8]:(e,t)=>e.getUint8(t),[r.QI.Uint8Clamped]:(e,t)=>e.getUint8(t),[r.QI.Int16]:(e,t)=>e.getInt16(t,!0),[r.QI.Uint16]:(e,t)=>e.getUint16(t,!0),[r.QI.Float32]:(e,t)=>e.getFloat32(t,!0),[r.QI.Int32]:(e,t)=>e.getInt32(t,!0),[r.QI.Uint32]:(e,t)=>e.getUint32(t,!0),[r.QI.Float64]:(e,t)=>e.getFloat64(t,!0),[r.QI.BigInt]:(e,t)=>e.getBigInt64(t,!0),[r.QI.BigUint]:(e,t)=>e.getBigUint64(t,!0)}},25075:(e,t,s)=>{s.d(t,{v:()=>i});var r=s(85860);const i={[r.QI.Int8]:(e,t,s)=>e.setInt8(t,s),[r.QI.Uint8]:(e,t,s)=>e.setUint8(t,s),[r.QI.Uint8Clamped]:(e,t,s)=>e.setUint8(t,s),[r.QI.Int16]:(e,t,s)=>e.setInt16(t,s,!0),[r.QI.Uint16]:(e,t,s)=>e.setUint16(t,s,!0),[r.QI.Float32]:(e,t,s)=>e.setFloat32(t,s,!0),[r.QI.Int32]:(e,t,s)=>e.setInt32(t,s,!0),[r.QI.Uint32]:(e,t,s)=>e.setUint32(t,s,!0),[r.QI.Float64]:(e,t,s)=>e.setFloat64(t,s,!0),[r.QI.BigInt]:(e,t,s)=>e.setBigInt64(t,s,!0),[r.QI.BigUint]:(e,t,s)=>e.setBigUint64(t,s,!0)}},93587:(e,t,s)=>{var r,i;s.d(t,{$f:()=>r,xH:()=>i}),function(e){e.North="north",e.South="south",e.West="west",e.East="east",e.NorthEast="north-east",e.NorthWest="north-west",e.SouthEast="south-east",e.SouthWest="south-west"}(r||(r={})),function(e){e[e.North=0]="North",e[e.NorthEast=Math.PI/4]="NorthEast",e[e.East=Math.PI/2]="East",e[e.SouthEast=3*Math.PI/4]="SouthEast",e[e.South=Math.PI]="South",e[e.SouthWest=5*Math.PI/4]="SouthWest",e[e.West=3*Math.PI/2]="West",e[e.NorthWest=7*Math.PI/4]="NorthWest"}(i||(i={})),r.North,i.North,r.South,i.South,r.West,i.West,r.East,i.East,r.NorthEast,i.NorthEast,r.NorthWest,i.NorthWest,r.SouthEast,i.SouthEast,r.SouthWest,i.SouthWest},27798:(e,t,s)=>{s.d(t,{Jd:()=>r.J});var r=s(54262)},82843:(e,t,s)=>{function r(e,t,s,r){var i=t-e,a=r-s;return Math.sqrt(i*i+a*a)}s.d(t,{m:()=>r})},63086:(e,t,s)=>{function r(e,t,s,r,i,a){return Math.sqrt((r-e)**2+(i-t)**2+(a-s)**2)}s.d(t,{D:()=>r})},29600:(e,t,s)=>{s.d(t,{D7:()=>i.D,me:()=>r.m});var r=s(82843),i=s(63086)},85443:(e,t,s)=>{s.d(t,{Z:()=>r});class r{x;y;z;w;static Create(e=0,t=0,s=0,i=0){return new r(e,t,s,i)}static ApplyMatrix(e,t){return{x:e[0]*t.x+e[1]*t.y+e[2]*t.z+e[3]*t.w,y:e[4]*t.x+e[5]*t.y+e[6]*t.z+e[7]*t.w,z:e[8]*t.x+e[9]*t.y+e[10]*t.z+e[11]*t.w,w:e[12]*t.x+e[13]*t.y+e[14]*t.z+e[15]*t.w}}static ApplyMatrixArray(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]]}static RotateAroundPivot(e,t,s){const i={x:t.x-s.x,y:t.y-s.y,z:t.z-s.z,w:t.w-s.w},a=r.ApplyMatrix(e,i);return{x:a.x+s.x,y:a.y+s.y,z:a.z+s.z,w:a.w+s.w}}static RotateAroundPivotArray(e,t,s){const i=[t[0]-s[0],t[1]-s[1],t[2]-s[2],t[3]-s[3]],a=r.ApplyMatrixArray(e,i);return[a[0]+s[0],a[1]+s[1],a[2]+s[2],a[3]+s[3]]}static Add(e,t){return{x:e.x+t.x,y:e.y+t.y,z:e.z+t.z,w:e.w+t.w}}static AddToRef(e,t,s){s.x=e.x+t.x,s.y=e.y+t.y,s.z=e.z+t.z,s.w=e.w+t.w}static AddInPlace(e,t){e.x+=t.x,e.y+=t.y,e.z+=t.z,e.w+=t.w}static AddArray(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3]]}static AddArrayToRef(e,t,s){s[0]=e[0]+t[0],s[1]=e[1]+t[1],s[2]=e[2]+t[2],s[3]=e[3]+t[3]}static AddArrayInPlace(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[3]}static AddScalar(e,t){return{x:e.x+t,y:e.y+t,z:e.z+t,w:e.w+t}}static AddScalarToRef(e,t,s){s.x=e.x+t,s.y=e.y+t,s.z=e.z+t,s.w=e.w+t}static AddScalarInPlace(e,t){e.x+=t,e.y+=t,e.z+=t,e.w+=t}static AddScalarArray(e,t){return[e[0]+t,e[1]+t,e[2]+t,e[3]+t]}static AddScalarArrayToRef(e,t,s){s[0]=e[0]+t,s[1]=e[1]+t,s[2]=e[2]+t,s[3]=e[3]+t}static AddScalarArrayInPlace(e,t){e[0]+=t,e[1]+=t,e[2]+=t,e[3]+=t}static Subtract(e,t){return{x:e.x-t.x,y:e.y-t.y,z:e.z-t.z,w:e.w-t.w}}static SubtractToRef(e,t,s){s.x=e.x-t.x,s.y=e.y-t.y,s.z=e.z-t.z,s.w=e.w-t.w}static SubtractInPlace(e,t){e.x-=t.x,e.y-=t.y,e.z-=t.z,e.w-=t.w}static SubtractArray(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3]]}static SubtractArrayToRef(e,t,s){s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],s[3]=e[3]-t[3]}static SubtractArrayInPlace(e,t){e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e[3]-=t[3]}static SubtractScalar(e,t){return{x:e.x-t,y:e.y-t,z:e.z-t,w:e.w-t}}static SubtractScalarToRef(e,t,s){s.x=e.x-t,s.y=e.y-t,s.z=e.z-t,s.w=e.w-t}static SubtractScalarInPlace(e,t){e.x-=t,e.y-=t,e.z-=t,e.w-=t}static SubtractScalarArray(e,t){return[e[0]-t,e[1]-t,e[2]-t,e[3]-t]}static SubtractScalarArrayToRef(e,t,s){s[0]=e[0]-t,s[1]=e[1]-t,s[2]=e[2]-t,s[3]=e[3]-t}static SubtractScalarArrayInPlace(e,t){e[0]-=t,e[1]-=t,e[2]-=t,e[3]-=t}static Multiply(e,t){return{x:e.x*t.x,y:e.y*t.y,z:e.z*t.z,w:e.w*t.w}}static MultiplyToRef(e,t,s){s.x=e.x*t.x,s.y=e.y*t.y,s.z=e.z*t.z,s.w=e.w*t.w}static MultiplyInPlace(e,t){e.x*=t.x,e.y*=t.y,e.z*=t.z,e.w*=t.w}static MultiplyArray(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3]]}static MultiplyArrayToRef(e,t,s){s[0]=e[0]*t[0],s[1]=e[1]*t[1],s[2]=e[2]*t[2],s[3]=e[3]*t[3]}static MultiplyArrayInPlace(e,t){e[0]*=t[0],e[1]*=t[1],e[2]*=t[2],e[3]*=t[3]}static MultiplyScalar(e,t){return{x:e.x*t,y:e.y*t,z:e.z*t,w:e.w*t}}static MultiplyScalarToRef(e,t,s){s.x=e.x*t,s.y=e.y*t,s.z=e.z*t,s.w=e.w*t}static MultiplyScalarInPlace(e,t){e.x*=t,e.y*=t,e.z*=t,e.w*=t}static MultiplyScalarArray(e,t){return[e[0]*t,e[1]*t,e[2]*t,e[3]*t]}static MultiplyScalarArrayToRef(e,t,s){s[0]=e[0]*t,s[1]=e[1]*t,s[2]=e[2]*t,s[3]=e[3]*t}static MultiplyScalarArrayInPlace(e,t){e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t}static Divide(e,t){return{x:e.x/t.x,y:e.y/t.y,z:e.z/t.z,w:e.w/t.w}}static DivideToRef(e,t,s){s.x=e.x/t.x,s.y=e.y/t.y,s.z=e.z/t.z,s.w=e.w/t.w}static DivideInPlace(e,t){e.x/=t.x,e.y/=t.y,e.z/=t.z,e.w/=t.w}static DivideArray(e,t){return[e[0]/t[0],e[1]/t[1],e[2]/t[2],e[3]/t[3]]}static DivideArrayToRef(e,t,s){s[0]=e[0]/t[0],s[1]=e[1]/t[1],s[2]=e[2]/t[2],s[3]=e[3]/t[3]}static DivideArrayInPlace(e,t){e[0]/=t[0],e[1]/=t[1],e[2]/=t[2],e[3]/=t[3]}static DivideScalar(e,t){return{x:e.x/t,y:e.y/t,z:e.z/t,w:e.w/t}}static DivideScalarToRef(e,t,s){s.x=e.x/t,s.y=e.y/t,s.z=e.z/t,s.w=e.w/t}static DivideScalarInPlace(e,t){e.x/=t,e.y/=t,e.z/=t,e.w/=t}static DivideScalarArray(e,t){return[e[0]/t,e[1]/t,e[2]/t,e[3]/t]}static DivideScalarArrayToRef(e,t,s){s[0]=e[0]/t,s[1]=e[1]/t,s[2]=e[2]/t,s[3]=e[3]/t}static DivideScalarArrayInPlace(e,t){e[0]/=t,e[1]/=t,e[2]/=t,e[3]/=t}static Dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w}static DotArray(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}static Length(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w)}static LengthArray(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3])}static Normalize(e){const t=r.Length(e);return 0===t?{x:0,y:0,z:0,w:0}:{x:e.x/t,y:e.y/t,z:e.z/t,w:e.w/t}}static NormalizeToRef(e,t){const s=r.Length(e);0===s?(t.x=0,t.y=0,t.z=0,t.w=0):(t.x=e.x/s,t.y=e.y/s,t.z=e.z/s,t.w=e.w/s)}static NormalizeInPlace(e){const t=r.Length(e);0===t?(e.x=0,e.y=0,e.z=0,e.w=0):(e.x/=t,e.y/=t,e.z/=t,e.w/=t)}static NormalizeArray(e){const t=r.LengthArray(e);return 0===t?[0,0,0,0]:[e[0]/t,e[1]/t,e[2]/t,e[3]/t]}static NormalizeArrayToRef(e,t){const s=r.LengthArray(e);0===s?(t[0]=0,t[1]=0,t[2]=0,t[3]=0):(t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s,t[3]=e[3]/s)}static NormalizeArrayInPlace(e){const t=r.LengthArray(e);0===t?(e[0]=0,e[1]=0,e[2]=0,e[3]=0):(e[0]/=t,e[1]/=t,e[2]/=t,e[3]/=t)}static Distance(e,t){return r.Length(r.Subtract(e,t))}static DistanceArray(e,t){return r.LengthArray(r.SubtractArray(e,t))}static Lerp(e,t,s){return{x:e.x+s*(t.x-e.x),y:e.y+s*(t.y-e.y),z:e.z+s*(t.z-e.z),w:e.w+s*(t.w-e.w)}}static LerpToRef(e,t,s,r){r.x=e.x+s*(t.x-e.x),r.y=e.y+s*(t.y-e.y),r.z=e.z+s*(t.z-e.z),r.w=e.w+s*(t.w-e.w)}static LerpInPlace(e,t,s){e.x+=s*(t.x-e.x),e.y+=s*(t.y-e.y),e.z+=s*(t.z-e.z),e.w+=s*(t.w-e.w)}static LerpArray(e,t,s){return[e[0]+s*(t[0]-e[0]),e[1]+s*(t[1]-e[1]),e[2]+s*(t[2]-e[2]),e[3]+s*(t[3]-e[3])]}static LerpArrayToRef(e,t,s,r){r[0]=e[0]+s*(t[0]-e[0]),r[1]=e[1]+s*(t[1]-e[1]),r[2]=e[2]+s*(t[2]-e[2]),r[3]=e[3]+s*(t[3]-e[3])}static LerpArrayInPlace(e,t,s){e[0]+=s*(t[0]-e[0]),e[1]+=s*(t[1]-e[1]),e[2]+=s*(t[2]-e[2]),e[3]+=s*(t[3]-e[3])}static Negate(e){return{x:-e.x,y:-e.y,z:-e.z,w:-e.w}}static NegateToRef(e,t){t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w}static NegateInPlace(e){e.x=-e.x,e.y=-e.y,e.z=-e.z,e.w=-e.w}static NegateArray(e){return[-e[0],-e[1],-e[2],-e[3]]}static NegateArrayToRef(e,t){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3]}static NegateArrayInPlace(e){e[0]=-e[0],e[1]=-e[1],e[2]=-e[2],e[3]=-e[3]}static Equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}static EqualsArray(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}static Clone(e){return{x:e.x,y:e.y,z:e.z,w:e.w}}static CloneArray(e){return[e[0],e[1],e[2],e[3]]}static Copy(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e}static CopyArray(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}static CopyFromArray(e,t){return e.x=t[0],e.y=t[1],e.z=t[2],e}static CopyIntoArray(e,t){return e[0]=t.x,e[1]=t.y,e[2]=t.z,e}static ToArray(e){return[e.x,e.y,e.z,e.w]}static FromArray(e){return new r(e[0],e[1],e[2],e[3])}constructor(e,t,s,r){this.x=e,this.y=t,this.z=s,this.w=r}}},33410:(e,t,s)=>{s.d(t,{Az:()=>i.A,D7:()=>o.D7,ZS:()=>a.Z,me:()=>o.me,xt:()=>r.x});var r=s(78441),i=s(7930),a=s(85443),o=s(29600)},6122:(e,t,s)=>{s.d(t,{F:()=>r});class r{_getIndex;_getXYZ;position;bounds;constructor(e,t){this._getIndex=e,this._getXYZ=t,this.position=[0,0,0],this.bounds=[1,1,1]}static GetXZYOrder(){return new r(((e,t)=>e[0]+e[2]*t[0]+e[1]*t[0]*t[2]),((e,t,s)=>{s[1]=Math.floor(e/(t[0]*t[2])),s[2]=Math.floor(e%(t[0]*t[2])/t[0]),s[0]=Math.floor(e%t[0])}))}static GetXYZOrder(){return new r(((e,t)=>e[0]+e[1]*t[0]+e[2]*t[0]*t[1]),((e,t,s)=>{s[2]=Math.floor(e/(t[0]*t[1])),s[1]=Math.floor(e%(t[0]*t[1])/t[0]),s[0]=Math.floor(e%t[0])}))}static GetYXZOrder(){return new r(((e,t)=>e[1]+t[1]*(e[0]+t[0]*e[2])),((e,t,s)=>{s[2]=Math.floor(e/(t[0]*t[1])),s[0]=Math.floor(e%(t[0]*t[1])/t[1]),s[1]=e%t[1]}))}get size(){return this.bounds[0]*this.bounds[1]*this.bounds[2]}getIndex(e){return this._getIndex(e,this.bounds)}getIndexVec3Array(e){return this.position[0]=e[0],this.position[1]=e[1],this.position[2]=e[2],this._getIndex(this.position,this.bounds)}getIndexXYZ(e,t,s){return this.position[0]=e,this.position[1]=t,this.position[2]=s,this._getIndex(this.position,this.bounds)}getIndexVec3(e){return this.position[0]=e.x,this.position[1]=e.y,this.position[2]=e.z,this._getIndex(this.position,this.bounds)}output=[0,0,0];getXYZ(e){return this._getXYZ(e,this.bounds,this.output),this.output}setBounds(e,t,s){this.bounds[0]=e,this.bounds[1]=t,this.bounds[2]=s}}},10538:(e,t,s)=>{s.d(t,{F:()=>r.F});var r=s(6122)},8611:(e,t,s)=>{s.d(t,{l:()=>r});class r{static ForEachFromToVec2(e,t,s,r){const i=e[0]<t[0]?s:-s,a=e[1]<t[1]?s:-s;for(let s=e[0];i>0?s<=t[0]:s>=t[0];s+=i)for(let i=e[1];a>0?i<=t[1]:i>=t[1];i+=a)r(s,i)}static*FromToVec2(e,t,s){const r=e[0]<t[0]?s:-s,i=e[1]<t[1]?s:-s;for(let s=e[0];r>0?s<=t[0]:s>=t[0];s+=r)for(let r=e[1];i>0?r<=t[1]:r>=t[1];r+=i)yield{x:s,y:r}}static ForEachFromToVec3(e,t,s,r){const i=e[0]<t[0]?s:-s,a=e[1]<t[1]?s:-s,o=e[2]<t[2]?s:-s;for(let s=e[0];i>0?s<=t[0]:s>=t[0];s+=i)for(let i=e[1];a>0?i<=t[1]:i>=t[1];i+=a)for(let a=e[2];o>0?a<=t[2]:a>=t[2];a+=o)r(s,i,a)}static*FromToVec3(e,t,s){const r=e[0]<t[0]?s:-s,i=e[1]<t[1]?s:-s,a=e[2]<t[2]?s:-s;for(let s=e[0];r>0?s<=t[0]:s>=t[0];s+=r)for(let r=e[1];i>0?r<=t[1]:r>=t[1];r+=i)for(let i=e[2];a>0?i<=t[2]:i>=t[2];i+=a)yield{x:s,y:r,z:i}}}},58917:(e,t,s)=>{s.d(t,{F$:()=>r.F,l5:()=>i.l});var r=s(10538),i=s(8611)},99673:(e,t,s)=>{s.d(t,{$f:()=>o.$f,Az:()=>r.Az,D7:()=>r.D7,F$:()=>i.F$,Jd:()=>a.Jd,ZS:()=>r.ZS,l5:()=>i.l5,me:()=>r.me,xH:()=>o.xH,xt:()=>r.xt});var r=s(33410),i=s(58917),a=s(27798),o=s(93587)},28432:(e,t,s)=>{s.d(t,{j:()=>o});var r=s(87137),i=s(84918),a=s(55725);class o{name;index;threadPoolName;static readySet=new Set;get isRemoteReady(){return o.readySet.has(this)}get isPortSet(){return Boolean(this.port)}port=null;_pool=null;constructor(e,t,s="worker",r=null){this.name=e,this.index=t,this.threadPoolName=s,this._pool=r}setPort(e){if(this.port=e,"browser"==r.Q.environment){const t=e;t.onmessage=e=>{a.E.runInternal(e.data,this,e)},t.onmessageerror=e=>{console.error(`Error occured in from thread ${this.name}`),console.log(e.data),console.log(e)}}if("node"==r.Q.environment){const t=e;t.on("message",(e=>{a.E.runInternal(e,this,e)})),t.on("error",(e=>{console.error(`Error occured in from thread ${this.name}`),console.log(e)}))}this.sendMessage([i.g.setReady,this.name,this.index])}sendMessage(e,t){if(!this.port)throw new Error(`Cannot send message to thread [${this.name}] port is not set`);this.port.postMessage(e,"browser"==r.Q.environment&&t?t:void 0)}connectToThread(e){const t=new MessageChannel;e.sendMessage([i.g.connectPort,this.name,this.threadPoolName,t.port1],[t.port1]),this.sendMessage([i.g.connectPort,e.name,e.threadPoolName,t.port2],[t.port2])}waitTillTaskExist(e,t=50){let s=!1;return new Promise((r=>{const i=e=>{if(s)return clearTimeout(o);e?(s=!0,r(!0),clearTimeout(o)):setTimeout(a,t)},a=()=>{this.taskExist(e,i)};let o=setTimeout(a,t)}))}taskExist(e,t){const s=a.E.getPromiseId();a.z.checkTasks[1]=e,a.z.checkTasks[2]=s,this.sendMessage(a.z.checkTasks),a.E.addPromiseTakss("tasks-check",s,(e=>{t(e)}))}runTask(e,t,s,r){const i=r?a.E.getPromiseId():-1;r&&a.E.addPromiseTakss(e,i,r),a.z.runTask[1]=e,a.z.runTask[2]=i,a.z.runTask[3]=t,this.sendMessage(a.z.runTask,s),a.z.runTask[3]=null}runTaskAsync(e,t,s){return new Promise((r=>{this.runTask(e,t,s,(e=>{r(e)}))}))}waitTillReady(){return new Promise(((e,t)=>{const s=setInterval((()=>{this.isPortSet&&(clearInterval(s),e(!0))}),1)}))}destroy(){o.readySet.delete(this),this.port&&"terminate"in this.port&&this.port.terminate()}}},82938:(e,t,s)=>{s.d(t,{p:()=>a});var r=s(28432),i=s(87137);class a{name;_totalThreads=0;_currentThread=0;__threads=[];constructor(e){this.name=e}getThreads(){return this.__threads}connectToThread(e){for(const t of this.__threads)t.connectToThread(e)}destroyAll(){for(const e of this.__threads)e.destroy()}isReady(){let e=!0;for(const t of this.__threads)t.isPortSet||(e=!1);return e}waitTillAllAreReady(){return new Promise(((e,t)=>{const s=setInterval((()=>{this.isReady()&&(clearInterval(s),e(!0))}),1)}))}addPort(e){const t=`${this.name}-${this._totalThreads}`,s=new r.j(t,this._totalThreads,this.name,this);i.Q.addThread(s),s.setPort(e),this.__threads.push(s),this._totalThreads++}runTaskForAll(e,t,s){for(let r=0;r<this.__threads.length;r++)this.__threads[r].runTask(e,t,s)}runTask(e,t,s,r,i,a){return"number"!=typeof i?(this._currentThread==a&&this.__handleCount(),this.__threads[this._currentThread].runTask(e,t,s,r),this.__handleCount()):(this.__threads[i].runTask(e,t,s,r),i)}runTaskAsync(e,t,s,r,i){return new Promise((a=>{this.runTask(e,t,s,a,r,i)}))}__handleCount(){let e=this._currentThread;return this._currentThread++,this._currentThread>=this._totalThreads&&(this._currentThread=0),e}}},26983:(e,t,s)=>{function r(){}s.d(t,{A:()=>r})},94618:(e,t,s)=>{s.d(t,{A:()=>y});var r=s(80740),i=s(20650),a=s(99673),o=s(11601),n=s(15741),l=s(23891),d=s(8126);class h{buffer;data;constructor(e){return this.buffer=e,this.data=new DataView(ArrayBuffer.isView(e)?e.buffer:e),new Proxy(this,{get:(e,t)=>{if("string"==typeof t&&!isNaN(Number(t))){const s=Number(t);return e.get(s)}return e[t]},set:(e,t,s)=>{if("string"==typeof t&&!isNaN(Number(t))){const r=Number(t);return e.set(r,s),!0}return e[t]=s,!0}})}get length(){return 4*this.buffer.byteLength}get(e){if(e<0||e>=this.length)throw new RangeError(`Index ${e} is out of bounds`);return d.u.getHalfNibbleArrayIndex(this.data,0,e)}set(e,t){if(e<0||e>=this.length)throw new RangeError(`Index ${e} is out of bounds`);if(t<0||t>3)throw new RangeError(`Value ${t} is out of bounds for a half nibble`);d.u.setHalfNibbleArrayIndex(this.data,0,e,t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.length?{value:this.get(e++),done:!1}:{value:void 0,done:!0}}}forEach(e){for(let t=0;t<this.length;t++)e(this.get(t),t,this)}}class c{buffer;data;constructor(e){return this.buffer=e,this.data=new DataView(ArrayBuffer.isView(e)?e.buffer:e),new Proxy(this,{get:(e,t)=>{if("string"==typeof t&&!isNaN(Number(t))){const s=Number(t);return e.get(s)}return e[t]},set:(e,t,s)=>{if("string"==typeof t&&!isNaN(Number(t))){const r=Number(t);return e.set(r,s),!0}return e[t]=s,!0}})}get length(){return 2*this.buffer.byteLength}get(e){if(e<0||e>=this.length)throw new RangeError(`Index ${e} is out of bounds`);return d.u.getNibbleArrayIndex(this.data,0,e)}set(e,t){if(e<0||e>=this.length)throw new RangeError(`Index ${e} is out of bounds`);if(t<0||t>15)throw new RangeError(`Value ${t} is out of bounds for a nibble`);d.u.setNibbleArrayIndex(this.data,0,e,t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.length?{value:this.get(e++),done:!1}:{value:void 0,done:!0}}}forEach(e){for(let t=0;t<this.length;t++)e(this.get(t),t,this)}}const u=(e,t)=>2==e?new l.P(t):e>2&&e<=4?new h(t):e>4&&e<=15?new c(t):t;var g=s(18556),f=s(15661);class p{index=a.F$.GetXZYOrder();size;ids;level;state;mod;secondary;idPalette;levelPalette;statePalette;modPalette;secondaryIdPalette;secondaryStatePalette;constructor(e){this.size=[...e.size],this.index.setBounds(...e.size),this.idPalette=new o.N(e.palettes.id),this.levelPalette=new n.h(e.palettes.level),this.statePalette=new n.h(e.palettes.state),this.modPalette=new n.h(e.palettes.mod),this.secondaryIdPalette=new o.N(e.palettes.secondaryId),this.secondaryStatePalette=new n.h(e.palettes.secondaryState),"object"==typeof e.buffers.ids?this.ids=u(e.palettes.id.length,e.buffers.ids):this.ids=e.buffers.ids,"object"==typeof e.buffers.level?this.level=u(e.palettes.level.length,e.buffers.level):this.level=e.buffers.level,"object"==typeof e.buffers.state?this.state=u(e.palettes.state.length,e.buffers.state):this.state=e.buffers.state,"object"==typeof e.buffers.mod?this.mod=u(e.palettes.mod.length,e.buffers.mod):this.mod=e.buffers.mod,"object"==typeof e.buffers.secondary?this.secondary=u(Math.max(e.palettes.secondaryState.length,e.palettes.secondaryId.length),e.buffers.secondary):this.secondary=e.buffers.secondary}getIndex(e,t,s){return this.index.getIndexXYZ(e,t,s)}getId(e){const t=this.ids;return g.A.voxels.getNumberId(this.idPalette.getStringId("number"==typeof t?t:t[e]))}getState(e){const t=this.state;return this.statePalette.getValue("number"==typeof t?t:t[e])}getLevel(e){const t=this.mod;return this.modPalette.getValue("number"==typeof t?t:t[e])}getMod(e){const t=this.mod;return this.modPalette.getValue("number"==typeof t?t:t[e])}getSecondary(e,t){const s=this.secondary;return f.L.VoxelTags[e].dve_can_have_secondary?g.A.voxels.getNumberId(this.secondaryIdPalette.getStringId("number"==typeof s?s:s[t])):this.secondaryStatePalette.getValue("number"==typeof s?s:s[t])}*traverse(){const e=this.size,t=[0,0,0,0,0,0],s={position:[0,0,0],raw:t};for(const{x:r,y:i,z:o}of a.l5.FromToVec3([0,0,0],[e[0]-1,e[1]-1,e[2]-1],1)){const e=this.index.getIndexXYZ(r,i,o);s.position[0]=r,s.position[1]=i,s.position[2]=o,t[0]=this.getId(e),t[1]=0,t[2]=this.getLevel(e),t[3]=this.getState(e),t[4]=this.getMod(e),t[5]=this.getSecondary(t[0],e),t[0]<1&&t[3]<1||(yield s)}}toJSON(){return{templatorVersion:0,version:0,size:this.size,palettes:{id:this.idPalette._palette,level:Uint8Array.from(this.statePalette._palette),state:Uint16Array.from(this.statePalette._palette),mod:Uint16Array.from(this.modPalette._palette),secondaryId:this.secondaryIdPalette._palette,secondaryState:Uint16Array.from(this.secondaryStatePalette._palette)},buffers:{ids:this.ids instanceof Uint16Array||this.ids instanceof Uint8Array||"number"==typeof this.ids?this.ids:new Uint8Array(this.ids.buffer),level:this.level instanceof Uint8Array||"number"==typeof this.level?this.level:new Uint8Array(this.level.buffer),mod:this.mod instanceof Uint16Array||this.mod instanceof Uint8Array||"number"==typeof this.mod?this.mod:new Uint8Array(this.mod.buffer),state:this.state instanceof Uint16Array||this.state instanceof Uint8Array||"number"==typeof this.state?this.state:new Uint8Array(this.state.buffer),secondary:this.secondary instanceof Uint16Array||this.secondary instanceof Uint8Array||"number"==typeof this.secondary?this.secondary:new Uint8Array(this.secondary.buffer)}}}}var m=s(81168);function y(){const e=i.J.getBrush();m.QK.registerTask(r.m.PlaceVoxelArea,(async([t,[s,r,i],[a,o,n],l])=>{e.start(t,s,r,i),e.setData(l);for(let t=s;t<a;t++)for(let s=r;s<o;s++)for(let r=i;r<n;r++)e.dataCursor.inBounds(t,s,r)&&e.setXYZ(t,s,r).paint();e.runUpdates();for(let t=s;t<a;t++)for(let s=r;s<o;s++)for(let r=i;r<n;r++)e.dataCursor.inBounds(t,s,r)&&e.setXYZ(t,s,r).update();e.runUpdates();const d=e.getUpdatedSections();return e.stop(),[d]})),m.QK.registerTask(r.m.RemoveVoxelArea,(([t,[s,r,i],[a,o,n]])=>{e.start(t,s,r,i);for(let t=s;t<a;t++)for(let s=r;s<o;s++)for(let r=i;r<n;r++)e.dataCursor.inBounds(t,s,r)&&e.dataCursor.getVoxel(t,s,r)?.isRenderable()&&e.setXYZ(t,s,r).erase();e.runUpdates(),r-=1,i-=1,a+=1,o+=1,n+=1;for(let t=s-=1;t<a;t++)for(let s=r;s<o;s++)for(let r=i;r<n;r++)e.dataCursor.inBounds(t,s,r)&&e.setXYZ(t,s,r).update();e.runUpdates();const l=e.getUpdatedSections();return e.stop(),[l]})),m.QK.registerTask(r.m.BuildTemplate,(async([t,[s,r,i],a],o)=>{e.start(t,s,r,i);const n=new p(a),l=s+n.size[0],d=r+n.size[1],h=i+n.size[2];await e.worldAlloc([s,r,i],[l,d,h]);for(const{raw:t,position:a}of n.traverse())t[1]=0,e.setRaw(t).setXYZ(a[0]+s,a[1]+r,a[2]+i).paint();e.runUpdates();for(let t=s;t<l;t++)for(let s=r;s<d;s++)for(let r=i;r<h;r++)e.dataCursor.inBounds(t,s,r)&&e.setXYZ(t,s,r).update();e.runUpdates();const c=e.getUpdatedSections();return e.stop(),await e.worldDealloc([s,r,i],[l,d,h]),[c]}))}},6694:(e,t,s)=>{s.d(t,{c:()=>n});var r=s(81168),i=s(39212);const a=r.QK.createThread("world");class o extends i.Q{static instnace;parent=r.QK.parent;world=a;constructor(){super(),o.instnace=this,this.addThread(this.world),this.addThread(this.parent)}}class n{static environment="browser";static instance;TC=r.QK;threads=new o;constructor(){if(n.instance)return n.instance;n.instance=this}}},31886:(e,t,s)=>{s.d(t,{V:()=>Rs});var r=s(27293),i=s(6694),a=s(81168),o=s(22120),n=s(75438),l=s(86081),d=s(29981),h=s(62312),c=s(57870),u=s(99673);class g{_section;voxel=new c.$(this);_voxelIndex=0;_voxelPosition=u.Az.Create();_sectionPosition=u.Az.Create();inBounds(e,t,s){const r=this._sectionPosition.x+h.k.section.bounds.x,i=this._sectionPosition.y+h.k.section.bounds.y,a=this._sectionPosition.z+h.k.section.bounds.z;return!(e<this._sectionPosition.x||t<this._sectionPosition.y||s<this._sectionPosition.z||e>r||t>i||s>a)}setSection(e,t,s,r){if("object"==typeof e){this._section=e;const t=this._section.getPosition();return this._sectionPosition.x=t[0],this._sectionPosition.y=t[1],void(this._sectionPosition.z=t[2])}const i=n._.sectors.get(e,t||0,s||0,r||0);if(!i)return!1;this._section=i.getSection(t||0,s||0,r||0);const a=this._section.getPosition();return this._sectionPosition.x=a[0],this._sectionPosition.y=a[1],this._sectionPosition.z=a[2],!0}getVoxelAtIndex(e){return this._voxelIndex=e,h.k.voxel.getPositionFromIndex(e,this._voxelPosition),this.voxel.loadIn(),this.voxel}getVoxel(e,t,s){return this._section?(h.k.voxel.getPosition(e,t,s,this._voxelPosition),this._voxelIndex=h.k.voxel.getIndexFromPosition(this._voxelPosition.x,this._voxelPosition.y,this._voxelPosition.z),this.voxel.loadIn(),this.voxel):null}}var f=s(5522),p=s(59194),m=s(10008),y=s(38e3);const x=new g;var v=s(39757),b=s(91437),w=s(83651),A=(s(52196),s(70522)),S=s(48860);async function B(e,t=!0){}new w.l,new S.p,new S.p;const I=e=>{let t=v.i.doRGBPropagation,s=v.i.doSunPropagation;const[r,i,a,o]=e.origin;e.nDataCursor.setFocalPoint(r,i,a,o);for(const r of y.LE){const n=r[0]+i,l=r[1]+a,d=r[2]+o,h=e.nDataCursor.getVoxel(n,l,d);h&&(t&&h.hasRGBLight()&&e.rgb.update.push(n,l,d),s&&h.hasSunLight()&&e.sun.update.push(n,l,d))}},C=e=>{const[t,s,r,i]=e.origin;e.nDataCursor.setFocalPoint(t,s,r,i);for(const t of y.LE){const a=t[0]+s,o=t[1]+r,n=t[2]+i,l=e.nDataCursor.getVoxel(a,o,n);l&&l.getPower()>0&&e.power.update.push(a,o,n)}},_=new d.$;async function T(e){const[t,s,r,i]=e[0];_.setOrigin(e[0]);const a=_.sDataCursor.getVoxel(s,r,i);if(!a)return!1;let o=v.i.doRGBPropagation,n=v.i.doSunPropagation;return v.i.doLight&&(I(_),o&&(_.rgb.update.push(s,r,i),(0,m.D)(_)),n&&(_.sun.update.push(s,r,i),(0,b.a)(_))),v.i.doFlow&&a.getSubstanceData().dve_is_solid&&B(),_.bounds.update(s,r,i),_.bounds.update(s+1,r+1,i+1),_}function V(e){const t=e.power.update;for(;t.length;){const s=t.shift(),r=t.shift(),i=t.shift(),a=e.sDataCursor.getVoxel(s,r,i);if(!a)continue;const o=a.getPower();if(!(o<=0)){for(let a=0;a<6;a++){const n=y.LE[a][0]+s,l=y.LE[a][1]+r,d=y.LE[a][2]+i;if(!e.nDataCursor.inBounds(n,l,d))continue;const h=e.nDataCursor.getVoxel(n,l,d);if(!h)continue;const c=h.getPower();c>-1&&c<o&&(h._tags.dve_can_carry_power&&t.push(n,l,d),h.setPower(o-1))}e.bounds.update(s,r,i)}}}const z=new d.$;const M=new d.$;function D(e){a.QK.registerTask(l.z.VoxelUpdate,(async(t,s)=>{const r=await T(t);r&&e.onDone(r,s)})),a.QK.registerTask(l.z.VoxelErease,(async(t,s)=>{const r=await async function(e){const[t,s,r,i]=e;z.setOrigin(e);let a=z.sDataCursor.getVoxel(s,r,i);if(!a)return!1;const o=a.getSubstanceData(),n=a.getPower();if(!a.isAir()&&v.i.doFlow&&a.isRenderable()&&o.dve_is_liquid)return async function(){}(),z;a=z.sDataCursor.getVoxel(s,r,i);const l=a.getLight(),d=a.isLightSource();a.setSecondary(!0).setId(0).setSecondary(!1),a.setLight(l>0?l:0).setId(0).setLevel(0).setLevelState(0).setState(0).setMod(0).updateVoxel(1),v.i.doLight&&(v.i.doRGBPropagation&&d&&(z.rgb.remove.push(s,r,i),(0,m.Q)(z)),I(z),v.i.doRGBPropagation&&(0,m.D)(z),v.i.doSunPropagation&&(0,b.a)(z)),a=z.sDataCursor.getVoxel(s,r,i),v.i.doPower&&n>-1&&(a.setLevel(n),z.power.remove.push(s,r,i),function(e){const t=e.power.remove,s=e.power.update,r=e.power.removeMap,i=e.power.updateMap;for(;t.length;){const a=t.shift(),o=t.shift(),n=t.shift();if(r.has(a,o,n))continue;r.add(a,o,n);const l=e.sDataCursor.getVoxel(a,o,n);if(!l)continue;const d=l.isAir()?l.getLevel():l.getPower();if(!(d<=0)){for(let r=0;r<6;r++){const l=y.LE[r][0]+a,h=y.LE[r][1]+o,c=y.LE[r][2]+n;if(!e.nDataCursor.inBounds(l,h,c))continue;const u=e.nDataCursor.getVoxel(l,h,c);if(!u)continue;const g=u.isAir()?u.getLevel():u.getPower();g>0&&g<d?(t.push(l,h,c),u.isPowerSource()&&s.push(l,h,c)):g>0&&g>d&&!i.has(l,h,c)&&(i.add(l,h,c),s.push(l,h,c))}e.bounds.update(a,o,n),l.setPower(0)}}r.clear()}(z),V(z)),z.bounds.update(s,r,i),z.bounds.update(s+1,r+1,i+1);for(let e=0;e<y.LE.length;e++)z.sDataCursor.getVoxel(y.LE[e][0]+s,y.LE[e][1]+r,y.LE[e][2]+i)?.updateVoxel(2);return z}(t);r&&e.onDone(r,s)})),a.QK.registerTask(l.z.VoxelPaint,(async(t,s)=>{const r=await async function(e){const[t,s,r,i]=e[0];M.setOrigin(e[0]);let a=M.sDataCursor.getVoxel(s,r,i);if(!a)return!1;const o=e[1],n=a.isOpaque();let l=v.i.doRGBPropagation,d=v.i.doSunPropagation;e:if(v.i.doLight){if(a.getLight()<=0)break e;d&&a.hasSunLight()&&(M.sun.remove.push(s,r,i),(0,b.z)(M)),l&&a.hasRGBLight()&&n&&(M.rgb.remove.push(s,r,i),(0,m.Q)(M))}a=M.sDataCursor.getVoxel(s,r,i);const h=o[0];if(h<0)return!1;a.setId(h),a.setLevel(o[2]),a.setState(o[3]),a.setMod(o[4]),a.process(),o[3]>0&&a.canHaveSecondaryVoxel()&&(a.setSecondary(!0),a.setId(o[5]),a.setSecondary(!1)),a.isLightSource()&&a.getLightSourceValue()&&a.setLight(a.getLightSourceValue()),a.updateVoxel(0),v.i.doLight&&(I(M),l&&(M.rgb.update.push(s,r,i),(0,m.D)(M)),d&&(0,b.a)(M)),a=M.sDataCursor.getVoxel(s,r,i),v.i.doFlow&&!a.isAir()&&a.getSubstanceData().dve_is_liquid&&B(),v.i.doPower&&(a._tags.dve_can_be_powered||a._tags.dve_is_power_source||a._tags.dve_can_carry_power||a._tags.dve_can_hold_power)&&(C(M),M.power.update.push(s,r,i),V(M)),M.bounds.update(s,r,i),M.bounds.update(s+1,r+1,i+1);for(let e=0;e<y.LE.length;e++)M.sDataCursor.getVoxel(y.LE[e][0]+s,y.LE[e][1]+r,y.LE[e][2]+i)?.updateVoxel(2);return M}(t);r&&e.onDone(r,s)}))}class N{static getRelative(e){e=[...e];const t=h.k.section.bounds.x,s=h.k.section.bounds.z;let r=-1/0;const[i,a,o,n]=e;for(const i of y.vY){e[1]=i[0]*t+a,e[3]=i[1]*s+n;const o=this.getAbsolute(e);o>r&&(r=o)}return r}static getAbsolute(e){const t=n._.sectors.get(e[0],e[1],e[2],e[3]);if(!t)return h.k.world.bounds.MinY;if(0==t.sections.length)return h.k.world.bounds.MinY;let s=h.k.world.bounds.MinY;e[1],e[2],e[3];for(let e=0;e<t.sections.length;e++){const r=t.sections[e];if(!r)continue;const i=r.getPosition();let[a,o]=r.getMinMax();Math.abs(o)!=1/0&&(o=i[1]+o,s<o&&(s=o))}return s+1}}var k=s(50327),L=s(99196);const F=[[1,0,0],[-1,0,0],[0,0,1],[0,0,-1],[0,1,0]],R=[],U=new k.$;var E=s(63086);class P{_map=new Map;get size(){return this._map.size}_getKey(e,t,s){return`${e}_${t}_${s}`}inMap(e,t,s){return this._map.has(this._getKey(e,t,s))}add(e,t,s){this._map.set(this._getKey(e,t,s),!0)}remove(e,t,s){this._map.delete(this._getKey(e,t,s))}removeDiffernce(e){for(const[t]of e._map)this._map.has(t)&&this._map.delete(t);return e}clear(){this._map.clear()}}const H=new k.$,G={runExplosion(e,t){const[s,r,i,a]=e.origin,o=[],n=new P;for(o.push([r,i,a]);o.length;){const s=o.shift();if(!s)break;const l=s[0],d=s[1],h=s[2];!n.inMap(l+1,d,h)&&e.sDataCursor.getVoxel(l+1,d,h)&&((0,E.D)(r,i,a,l+1,d,h)<=t&&o.push([l+1,d,h]),n.add(l+1,d,h)),n.inMap(l-1,d,h)||(e.sDataCursor.getVoxel(l-1,d,h)&&(0,E.D)(r,i,a,l-1,d,h)<=t&&o.push([l-1,d,h]),n.add(l-1,d,h)),n.inMap(l,d,h+1)||(e.sDataCursor.getVoxel(l,d,h+1)&&(0,E.D)(r,i,a,l,d,h+1)<=t&&o.push([l,d,h+1]),n.add(l,d,h+1)),n.inMap(l,d,h-1)||(e.sDataCursor.getVoxel(l,d,h-1)&&(0,E.D)(r,i,a,l,d,h-1)<=t&&o.push([l,d,h-1]),n.add(l,d,h-1)),n.inMap(l,d+1,h)||(e.sDataCursor.getVoxel(l,d+1,h)&&(0,E.D)(r,i,a,l,d+1,h)<=t&&o.push([l,d+1,h]),n.add(l,d+1,h)),n.inMap(l,d-1,h)||(e.sDataCursor.getVoxel(l,d-1,h)&&(0,E.D)(r,i,a,l,d-1,h)<=t&&o.push([l,d-1,h]),n.add(l,d-1,h));const c=e.sDataCursor.getVoxel(l,d,h);if(c&&c.isRenderable()){for(const t of y.LE){const s=l+t[0],r=d+t[1],i=h+t[2],a=e.nDataCursor.getVoxel(l,d,h);if(a){const t=a.getLight();t>0&&(H.getS(t)>0&&e.sun.remove.push(s,r,i),H.hasRGBLight(t)&&e.rgb.remove.push(s,r,i))}}e.bounds.update(l,d,h),c.setAir().updateVoxel(1)}}(0,m.Q)(e),(0,b.z)(e),(0,m.D)(e),(0,b.a)(e)}},O=new g;var Q=s(11601);class Y{static flatIndex=u.F$.GetXYZOrder();static getIndex(e,t,s){return this.flatIndex.getIndexXYZ(e+1,t+1,s+1)}}Y.flatIndex.setBounds(3,3,3);const X=[];for(let e=0;e<Y.flatIndex.size;e++)X[e]=Y.flatIndex.getXYZ(e).map((e=>e-1));const Z=Y.flatIndex.size;function W(e,t,s){return e*s*Z+t*s}class j{view;faceByteCount;constructor(e){this.view=new Uint16Array(e.buffer),this.faceByteCount=e.faceByteCount}getValue(e,t,s){const r=this.view[W(e,t,this.faceByteCount)+s];return 65535==r?-1:r}setValue(e,t,s,r=-1){return this.view[W(e,t,this.faceByteCount)+s]=r}getData(){return{buffer:this.view.buffer,faceByteCount:this.faceByteCount}}}var q=s(8126);const $=Y.flatIndex.size;function K(e,t,s){return e*s*$+t*s}class J{view;vertexByteCount;constructor(e){this.vertexByteCount=e.vertexByteCount,this.view=new Uint8Array(e.buffer)}getValue(e,t,s){return q.u.getBitArrayIndex(this.view,K(e,t,this.vertexByteCount),s)}setValue(e,t,s,r=1){q.u.setBitArrayIndex(this.view,K(e,t,this.vertexByteCount),s,r)}getData(){return{buffer:this.view.buffer,vertexByteCount:this.vertexByteCount}}}var ee;!function(e){e[e.Enabled=0]="Enabled",e[e.Fliped=1]="Fliped",e[e.Texture=2]="Texture",e[e.Rotation=3]="Rotation",e[e.Transparent=4]="Transparent",e[e.UVs=5]="UVs",e[e.Index=6]="Index"}(ee||(ee={}));const te=e=>{const t=[];return t[ee.Enabled]=!0,t[ee.Fliped]=!1,t[ee.Texture]=0,t[ee.Rotation]=0,t[ee.Transparent]=!1,t[ee.UVs]=[[1,1],[0,1],[0,0],[1,0]],t[ee.Index]=e,t};class se{static ArgIndexes=ee;static CreateArgs(){const e=[];for(let t=0;t<6;t++)e[t]=te(t);return e}}class re{geometryPaletteId;geomtry;data;transform;faceIndex=-1;vertexIndex=-1;faceCount=-1;vertexCount=-1;builder;constructor(e,t,s,r){this.geometryPaletteId=e,this.geomtry=t,this.data=s,this.transform=r}}var ie;!function(e){e[e.TopRight=0]="TopRight",e[e.TopLeft=1]="TopLeft",e[e.BottomLeft=2]="BottomLeft",e[e.BottomRight=3]="BottomRight"}(ie||(ie={}));const ae=[ie.TopRight,ie.TopLeft,ie.BottomLeft,ie.BottomRight];var oe;!function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.North=2]="North",e[e.South=3]="South",e[e.East=4]="East",e[e.West=5]="West"}(oe||(oe={}));const ne=Object.freeze([oe.Up,oe.Down,oe.North,oe.South,oe.East,oe.West]),le=Object.freeze({[oe.Up]:[0,1,0],[oe.Down]:[0,-1,0],[oe.North]:[0,0,1],[oe.South]:[0,0,-1],[oe.East]:[1,0,0],[oe.West]:[-1,0,0]}),de=(oe.Up,oe.Down,oe.Down,oe.Up,oe.North,oe.South,oe.South,oe.North,oe.East,oe.West,oe.West,oe.East,oe.Up,u.$f.North,oe.Down,u.$f.South,oe.North,u.$f.North,oe.South,u.$f.South,oe.East,u.$f.East,oe.West,u.$f.West,u.$f.North,oe.North,u.$f.South,oe.South,u.$f.West,oe.West,u.$f.East,oe.East,u.$f.NorthEast,oe.Up,u.$f.NorthWest,oe.Up,u.$f.SouthEast,oe.Up,u.$f.SouthWest,oe.Up,oe.Up,oe.Down,oe.North,oe.South,oe.East,oe.West,oe.Up,oe.Down,oe.North,oe.South,oe.East,oe.West,[]);de[oe.Up]=[],de[oe.Up][ie.TopRight]=[1,1,0,0,1,1,1,1,1],de[oe.Up][ie.TopLeft]=[-1,1,0,0,1,1,-1,1,1],de[oe.Up][ie.BottomLeft]=[-1,1,0,0,1,-1,-1,1,-1],de[oe.Up][ie.BottomRight]=[1,1,0,0,1,-1,1,1,-1],de[oe.Down]=[],de[oe.Down][ie.TopRight]=[-1,-1,0,0,-1,1,-1,-1,1],de[oe.Down][ie.TopLeft]=[1,-1,0,0,-1,1,1,-1,1],de[oe.Down][ie.BottomLeft]=[1,-1,0,0,-1,-1,1,-1,-1],de[oe.Down][ie.BottomRight]=[-1,-1,0,0,-1,-1,-1,-1,-1],de[oe.East]=[],de[oe.East][ie.TopRight]=[1,0,1,1,1,0,1,1,1],de[oe.East][ie.TopLeft]=[1,0,-1,1,1,0,1,1,-1],de[oe.East][ie.BottomLeft]=[1,0,-1,1,-1,0,1,-1,-1],de[oe.East][ie.BottomRight]=[1,0,1,1,-1,0,1,-1,1],de[oe.West]=[],de[oe.West][ie.TopRight]=[-1,0,-1,-1,1,0,-1,1,-1],de[oe.West][ie.TopLeft]=[-1,0,1,-1,1,0,-1,1,1],de[oe.West][ie.BottomLeft]=[-1,0,1,-1,-1,0,-1,-1,1],de[oe.West][ie.BottomRight]=[-1,0,-1,-1,-1,0,-1,-1,-1],de[oe.South]=[],de[oe.South][ie.TopRight]=[1,0,-1,0,1,-1,1,1,-1],de[oe.South][ie.TopLeft]=[-1,0,-1,0,1,-1,-1,1,-1],de[oe.South][ie.BottomLeft]=[-1,0,-1,0,-1,-1,-1,-1,-1],de[oe.South][ie.BottomRight]=[1,0,-1,0,-1,-1,1,-1,-1],de[oe.North]=[],de[oe.North][ie.TopRight]=[-1,0,1,0,1,1,-1,1,1],de[oe.North][ie.TopLeft]=[1,0,1,0,1,1,1,1,1],de[oe.North][ie.BottomLeft]=[1,0,1,0,-1,1,1,-1,1],de[oe.North][ie.BottomRight]=[-1,0,1,0,-1,1,-1,-1,1];const he=new Int8Array(216),ce=[ie.TopRight,ie.TopLeft,ie.BottomLeft,ie.BottomRight];for(const e of ne)for(let t=0;t<ce.length;t++)for(let s=0;s<9;s++)he[36*e+9*ce[t]+s]=de[e][ce[t]][s];const ue=[];for(const e of ne){ue[e]??=[];for(let t=0;t<ce.length;t++){ue[e][ce[t]]??=[];let s=0;for(let r=0;r<9;r+=3){const i=de[e][ce[t]][r],a=de[e][ce[t]][r+1],o=de[e][ce[t]][r+2];ue[e][ce[t]][s]=Y.getIndex(i,a,o),s++}}}Y.getIndex(0,0,0);const ge=[];function fe(e,t,s,r){return e>t&&e>s&&e>r}function pe(e,t,s,r){return a=r,!(e==(i=t)&&i==a&&a==s||fe(r,t,s,e)||fe(t,s,r,e)||!fe(e,t,s,r)&&!fe(s,t,r,e)&&!((e+s)/2>(t+r)/2));var i,a}function me(e,t,s,r){let i,a,o=!1;switch(e){case oe.Up:i=t,a=r;break;case oe.Down:i=t,a=r,o=!0;break;case oe.North:i=t,a=s,o=!0;break;case oe.South:i=t,a=s;break;case oe.East:i=r,a=s;break;case oe.West:i=r,a=s,o=!0}return function(e,t,s=!1){let r=(1-(e=Math.max(0,Math.min(1,e))))*(1-(t=Math.max(0,Math.min(1,t)))),i=e*(1-t),a=e*t,o=(1-e)*t;return s?[o,a,i,r]:[a,o,r,i]}(i,a,o)}ge[oe.Up]=Y.getIndex(0,1,0),ge[oe.Down]=Y.getIndex(0,-1,0),ge[oe.North]=Y.getIndex(0,0,1),ge[oe.South]=Y.getIndex(0,0,-1),ge[oe.East]=Y.getIndex(1,0,0),ge[oe.West]=Y.getIndex(-1,0,0);const ye=new k.$;function xe(e,t){return ye.createLightValue(ye.getS(e[0])*t[0]+ye.getS(e[1])*t[1]+ye.getS(e[2])*t[2]+ye.getS(e[3])*t[3],ye.getR(e[0])*t[0]+ye.getR(e[1])*t[1]+ye.getR(e[2])*t[2]+ye.getR(e[3])*t[3],ye.getG(e[0])*t[0]+ye.getG(e[1])*t[1]+ye.getG(e[2])*t[2]+ye.getG(e[3])*t[3],ye.getB(e[0])*t[0]+ye.getB(e[1])*t[1]+ye.getB(e[2])*t[2]+ye.getB(e[3])*t[3])}const ve=(e,t)=>{const s=[];for(const r of ae){const{x:i,y:a,z:o}=e.positions.vertices[r];s[r]=me(t,i,a,o)}return s};class be{vertices;constructor(e){this.vertices=e}getAsArray(){return[this.vertices[ie.TopRight],this.vertices[ie.TopLeft],this.vertices[ie.BottomLeft],this.vertices[ie.BottomRight]]}setVertex(e,t){this.vertices[e]=t}getVertex(e){return this.vertices[e]}setAll(e){this.vertices[ie.TopRight]=e,this.vertices[ie.TopLeft]=e,this.vertices[ie.BottomLeft]=e,this.vertices[ie.BottomRight]=e}set(e,t,s,r){this.vertices[ie.TopRight]=e,this.vertices[ie.TopLeft]=t,this.vertices[ie.BottomLeft]=s,this.vertices[ie.BottomRight]=r}isEqualTo(e,t,s,r){return this.vertices[ie.TopRight]==e&&this.vertices[ie.TopLeft]==t&&this.vertices[ie.BottomLeft]==s&&this.vertices[ie.BottomRight]==r}isAllEqualTo(e){return this.vertices[ie.TopRight]==e&&this.vertices[ie.TopLeft]==e&&this.vertices[ie.BottomLeft]==e&&this.vertices[ie.BottomRight]==e}[Symbol.iterator](){let e=ie.TopRight;const t=this.vertices;return{next:()=>e<ie.BottomRight?{value:t[e++],done:!1}:{value:void 0,done:!0}}}clone(){return new be([structuredClone(this.vertices[ie.TopRight]),structuredClone(this.vertices[ie.TopLeft]),structuredClone(this.vertices[ie.BottomLeft]),structuredClone(this.vertices[ie.BottomRight])])}}class we extends be{vertices;constructor(e=[u.Az.Create(),u.Az.Create(),u.Az.Create(),u.Az.Create()]){super(e),this.vertices=e}setFromQuadData(e){u.Az.Copy(this.vertices[ie.TopRight],e.vertices[ie.TopRight]),u.Az.Copy(this.vertices[ie.TopLeft],e.vertices[ie.TopLeft]),u.Az.Copy(this.vertices[ie.BottomLeft],e.vertices[ie.BottomLeft]),u.Az.Copy(this.vertices[ie.BottomRight],e.vertices[ie.BottomRight])}addToVertex(e,t){u.Az.AddInPlace(this.vertices[e],t)}subtractFromVertex(e,t){u.Az.SubtractInPlace(this.vertices[e],t)}addAll(e){this.addToVertex(ie.TopRight,e),this.addToVertex(ie.TopLeft,e),this.addToVertex(ie.BottomLeft,e),this.addToVertex(ie.BottomRight,e)}subtractAll(e){this.subtractFromVertex(ie.TopRight,e),this.subtractFromVertex(ie.TopLeft,e),this.subtractFromVertex(ie.BottomLeft,e),this.subtractFromVertex(ie.BottomRight,e)}isEqualTo(e,t,s,r){return u.Az.Equals(this.vertices[ie.TopRight],e)&&u.Az.Equals(this.vertices[ie.TopLeft],t)&&u.Az.Equals(this.vertices[ie.BottomLeft],s)&&u.Az.Equals(this.vertices[ie.BottomRight],r)}isAllEqualTo(e){return u.Az.Equals(this.vertices[ie.TopRight],e)&&u.Az.Equals(this.vertices[ie.TopLeft],e)&&u.Az.Equals(this.vertices[ie.BottomLeft],e)&&u.Az.Equals(this.vertices[ie.BottomRight],e)}clone(){return new we([u.Az.Clone(this.vertices[ie.TopRight]),u.Az.Clone(this.vertices[ie.TopLeft]),u.Az.Clone(this.vertices[ie.BottomLeft]),u.Az.Clone(this.vertices[ie.BottomRight])])}}class Ae extends be{vertices;constructor(e=[u.xt.Create(),u.xt.Create(),u.xt.Create(),u.xt.Create()]){super(e),this.vertices=e}setFromQuadData(e){u.xt.Copy(this.vertices[ie.TopRight],e.vertices[ie.TopRight]),u.xt.Copy(this.vertices[ie.TopLeft],e.vertices[ie.TopLeft]),u.xt.Copy(this.vertices[ie.BottomLeft],e.vertices[ie.BottomLeft]),u.xt.Copy(this.vertices[ie.BottomRight],e.vertices[ie.BottomRight])}addToVertex(e,t){u.xt.AddInPlace(this.vertices[e],t)}subtractFromVertex(e,t){u.xt.SubtractInPlace(this.vertices[e],t)}addAll(e){this.addToVertex(ie.TopRight,e),this.addToVertex(ie.TopLeft,e),this.addToVertex(ie.BottomLeft,e),this.addToVertex(ie.BottomRight,e)}subtractAll(e){this.subtractFromVertex(ie.TopRight,e),this.subtractFromVertex(ie.TopLeft,e),this.subtractFromVertex(ie.BottomLeft,e),this.subtractFromVertex(ie.BottomRight,e)}isEqualTo(e,t,s,r){return u.xt.Equals(this.vertices[ie.TopRight],e)&&u.xt.Equals(this.vertices[ie.TopLeft],t)&&u.xt.Equals(this.vertices[ie.BottomLeft],s)&&u.xt.Equals(this.vertices[ie.BottomRight],r)}isAllEqualTo(e){return u.xt.Equals(this.vertices[ie.TopRight],e)&&u.xt.Equals(this.vertices[ie.TopLeft],e)&&u.xt.Equals(this.vertices[ie.BottomLeft],e)&&u.xt.Equals(this.vertices[ie.BottomRight],e)}clone(){return new Ae([u.xt.Clone(this.vertices[ie.TopRight]),u.xt.Clone(this.vertices[ie.TopLeft]),u.xt.Clone(this.vertices[ie.BottomLeft]),u.xt.Clone(this.vertices[ie.BottomRight])])}}class Se extends be{vertices;constructor(e=[0,0,0,0]){super(e),this.vertices=e}setFromQuadData(e){this.vertices[ie.TopRight]=e.vertices[ie.TopRight],this.vertices[ie.TopLeft]=e.vertices[ie.TopLeft],this.vertices[ie.BottomLeft]=e.vertices[ie.BottomLeft],this.vertices[ie.BottomRight]=e.vertices[ie.BottomRight]}subtractFromVertex(e,t){this.vertices[e]-=t}addAll(e){this.vertices[ie.TopRight]+=e,this.vertices[ie.TopLeft]+=e,this.vertices[ie.BottomLeft]+=e,this.vertices[ie.BottomRight]+=e}add(e,t,s,r){this.vertices[ie.TopRight]+=e,this.vertices[ie.TopLeft]+=t,this.vertices[ie.BottomLeft]+=s,this.vertices[ie.BottomRight]+=r}subtractAll(e){this.vertices[ie.TopRight]-=e,this.vertices[ie.TopLeft]-=e,this.vertices[ie.BottomLeft]-=e,this.vertices[ie.BottomRight]-=e}subtract(e,t,s,r){this.vertices[ie.TopRight]+=e,this.vertices[ie.TopLeft]+=t,this.vertices[ie.BottomLeft]+=s,this.vertices[ie.BottomRight]+=r}isGreaterThan(e,t,s,r){return!(this.vertices[ie.TopRight]<e||this.vertices[ie.TopLeft]<t||this.vertices[ie.BottomLeft]<s||this.vertices[ie.BottomRight]<r)}isAllGreaterThan(e){return!(this.vertices[ie.TopRight]<e||this.vertices[ie.TopLeft]<e||this.vertices[ie.BottomLeft]<e||this.vertices[ie.BottomRight]<e)}isLessThan(e,t,s,r){return!(this.vertices[ie.TopRight]>e||this.vertices[ie.TopLeft]>t||this.vertices[ie.BottomLeft]>s||this.vertices[ie.BottomRight]>r)}isAllLessThan(e){return!(this.vertices[ie.TopRight]>e||this.vertices[ie.TopLeft]>e||this.vertices[ie.BottomLeft]>e||this.vertices[ie.BottomRight]>e)}clone(){return new Se([this.vertices[ie.TopRight],this.vertices[ie.TopLeft],this.vertices[ie.BottomLeft],this.vertices[ie.BottomRight]])}}class Be{static FullUVs=Object.freeze([[1,1],[0,1],[0,0],[1,0]]);static RotateUvs(e,t){const s=u.Jd.RotationZ(t),r=[.5,.5];return[u.xt.RotateAroundPivotArray(s,e[0],r),u.xt.RotateAroundPivotArray(s,e[1],r),u.xt.RotateAroundPivotArray(s,e[2],r),u.xt.RotateAroundPivotArray(s,e[3],r)]}static Create(e,t,s,r){return new Be({positions:e,uvs:t,doubleSided:s,orientation:r})}static RotateVertices90Degrees(e,t=1){for(;t--;)e=[e[1],e[2],e[3],e[0]];return e}static GetQuadNormalRightHanded(e,t,s,r){const i=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],a=[s[0]-e[0],s[1]-e[1],s[2]-e[2]],o=u.Az.NormalizeArray(u.Az.CrossArray(i,a)),n=[s[0]-e[0],s[1]-e[1],s[2]-e[2]],l=[r[0]-e[0],r[1]-e[1],r[2]-e[2]],d=u.Az.NormalizeArray(u.Az.CrossArray(n,l)),h=[u.Az.NormalizeArray([(o[0]+d[0])/2,(o[1]+d[1])/2,(o[2]+d[2])/2]),o,u.Az.NormalizeArray([(o[0]+d[0])/2,(o[1]+d[1])/2,(o[2]+d[2])/2]),d];for(let e=0;e<h.length;e++){const t=h[e];for(let e=0;e<3;e++)0===Math.abs(t[e])&&(t[e]=0)}return h}static GetQuadNormalLeftHanded(e,t,s,r){const i=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],a=[s[0]-e[0],s[1]-e[1],s[2]-e[2]],o=u.Az.MultiplyScalarArray(u.Az.NormalizeArray(u.Az.CrossArray(i,a)),-1),n=[s[0]-e[0],s[1]-e[1],s[2]-e[2]],l=[r[0]-e[0],r[1]-e[1],r[2]-e[2]],d=u.Az.MultiplyScalarArray(u.Az.NormalizeArray(u.Az.CrossArray(n,l)),-1),h=[u.Az.NormalizeArray([(o[0]+d[0])/2,(o[1]+d[1])/2,(o[2]+d[2])/2]),o,u.Az.NormalizeArray([(o[0]+d[0])/2,(o[1]+d[1])/2,(o[2]+d[2])/2]),d];for(let e=0;e<h.length;e++){const t=h[e];for(let e=0;e<3;e++)0===Math.abs(t[e])&&(t[e]=0)}return h}static CalculateQuadPoints(e,t){const s=e.map(((e,s)=>t[s]!==e?s:-1)).filter((e=>-1!==e));let r,i;const a=t,o=e;s.includes(0)&&s.includes(2)?(r=[e[0],e[1],t[2]],i=[t[0],e[1],e[2]]):s.includes(0)&&s.includes(1)?(r=[e[0],t[1],e[2]],i=[t[0],e[1],e[2]]):s.includes(1)&&s.includes(2)&&(r=[e[0],t[1],e[2]],i=[e[0],e[1],t[2]]);const n=[t[0]-e[0],t[1]-e[1],t[2]-e[2]];let l=[0,0,0];return 0===n[0]?l[0]=1:0===n[1]?l[1]=1:0===n[2]&&(l[2]=1),{points:[a,r,o,i],normal:l}}static OrderQuadVertices(e,t){const s={north:e=>[e[0],e[1]],south:e=>[e[0],e[1]],east:e=>[e[2],e[1]],west:e=>[e[2],e[1]],up:e=>[e[0],e[2]],down:e=>[e[0],e[2]]},r=e.map((e=>s[t](e))),i=[(r[0][0]+r[1][0]+r[2][0]+r[3][0])/4,(r[0][1]+r[1][1]+r[2][1]+r[3][1])/4],a=e=>Math.atan2(e[1]-i[1],e[0]-i[0]),o=e.map(((e,t)=>({vertex:e,angle:a(r[t])})));return o.sort(((e,t)=>e.angle-t.angle)),[o[2].vertex,o[3].vertex,o[0].vertex,o[1].vertex]}positions=new we;normals=new we;uvs=new Ae;flip=!1;doubleSided=!1;orientation=0;constructor(e){e.positions&&this.setPositions(e.positions),e.uvs&&this.setUVs(e.uvs),e.doubleSided&&(this.doubleSided=e.doubleSided),void 0!==e.orientation&&(this.orientation=e.orientation)}setUVs([e,t,s,r]){return this.uvs.set(u.xt.FromArray(e),u.xt.FromArray(t),u.xt.FromArray(s),u.xt.FromArray(r)),this}scale(e,t,s){const r=u.Az.Create(e,t,s);for(const e of this.positions)u.Az.MultiplyInPlace(e,r);return this}transform(e,t,s){const r=u.Az.Create(e,t,s);for(const e of this.positions)u.Az.AddInPlace(e,r);return this}setPositions(e){if(2==e.length){const{points:t,normal:s}=Be.CalculateQuadPoints(e[0],e[1]);this.positions.set(u.Az.FromArray(t[0]),u.Az.FromArray(t[1]),u.Az.FromArray(t[2]),u.Az.FromArray(t[3])),this.normals.set(u.Az.FromArray(s),u.Az.FromArray(s),u.Az.FromArray(s),u.Az.FromArray(s))}if(4==e.length){const[t,s,r,i]=Be.GetQuadNormalLeftHanded(...e);this.positions.set(u.Az.FromArray(e[0]),u.Az.FromArray(e[1]),u.Az.FromArray(e[2]),u.Az.FromArray(e[3])),this.normals.set(u.Az.FromArray(t),u.Az.FromArray(s),u.Az.FromArray(r),u.Az.FromArray(i))}return this}clone(){return Be.Create(this.positions.getAsArray().map((e=>u.Az.ToArray(e))),this.uvs.getAsArray().map((e=>u.xt.ToArray(e))))}}function Ie(e){return e*Math.PI/180}function Ce(e){let t=1/0,s=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0;for(let n=0;n<e.length;n++){const[l,d,h]=e[n];l<t&&(t=l),d<s&&(s=d),h<r&&(r=h),l>i&&(i=l),d>a&&(a=d),h>o&&(o=h)}return[[t,s,r],[i,a,o]]}function _e(e,t){const s=[],r=u.Az.Create(...e[0]),i=u.Az.Create(...e[1]),a=[];a[oe.Up]=Be.Create([[i.x,i.y,i.z],[r.x,i.y,i.z],[r.x,i.y,r.z],[i.x,i.y,r.z]]),a[oe.Down]=Be.Create([[r.x,r.y,i.z],[i.x,r.y,i.z],[i.x,r.y,r.z],[r.x,r.y,r.z]]),a[oe.North]=Be.Create([[r.x,i.y,i.z],[i.x,i.y,i.z],[i.x,r.y,i.z],[r.x,r.y,i.z]]),a[oe.South]=Be.Create([[i.x,i.y,r.z],[r.x,i.y,r.z],[r.x,r.y,r.z],[i.x,r.y,r.z]]),a[oe.East]=Be.Create([[i.x,i.y,i.z],[i.x,i.y,r.z],[i.x,r.y,r.z],[i.x,r.y,i.z]]),a[oe.West]=Be.Create([[r.x,i.y,r.z],[r.x,i.y,i.z],[r.x,r.y,i.z],[r.x,r.y,r.z]]),function(e,t){const s=new Map;for(const t of e){const e=[t.positions.vertices[ie.TopRight],t.positions.vertices[ie.TopLeft],t.positions.vertices[ie.BottomLeft],t.positions.vertices[ie.BottomRight]];for(const t of e){const e=`${t.x},${t.y},${t.z}`;s.has(e)||s.set(e,{...t})}}const r=Array.from(s.values()),i={x:0,y:0,z:0};for(const e of r)i.x+=e.x,i.y+=e.y,i.z+=e.z;i.x/=r.length,i.y/=r.length,i.z/=r.length;let a=!1,o=1,n=1,l=1;if(t.scale){const[e,s,r]=t.scale;o=e,n=s,l=r,a=!0}if(t.flip){const[e,s,r]=t.flip;e&&(o*=-1),s&&(n*=-1),r&&(l*=-1),a=!0}const d=o*n*l;if(a)for(const e of r)e.x=i.x+(e.x-i.x)*o,e.y=i.y+(e.y-i.y)*n,e.z=i.z+(e.z-i.z)*l;if(t.rotation){const[e,s,a]=t.rotation,o=Ie(e),n=Ie(s),l=Ie(a),d=t.rotationPivot?{x:t.rotationPivot[0],y:t.rotationPivot[1],z:t.rotationPivot[2]}:i;for(const e of r){let t=e.x-d.x,s=e.y-d.y,r=e.z-d.z;if(o){const e=Math.cos(o),t=Math.sin(o),i=s*t+r*e;s=s*e-r*t,r=i}if(n){const e=Math.cos(n),s=Math.sin(n),i=-t*s+r*e;t=t*e+r*s,r=i}if(l){const e=Math.cos(l),r=Math.sin(l),i=t*r+s*e;t=t*e-s*r,s=i}e.x=t+d.x,e.y=s+d.y,e.z=r+d.z}}if(t.position){const[e,s,i]=t.position;for(const t of r)t.x+=e,t.y+=s,t.z+=i}for(const t of e){const e=[t.positions.vertices[ie.TopRight],t.positions.vertices[ie.TopLeft],t.positions.vertices[ie.BottomLeft],t.positions.vertices[ie.BottomRight]].map((e=>{const t=`${e.x},${e.y},${e.z}`;return s.get(t)}));d<0&&e.reverse(),t.setPositions(e.map((e=>u.Az.ToArray(e))))}}(a,t);const o=new Array(a.length);for(let e=0;e<a.length;e++){const t=[],s=a[e].positions.getAsArray();for(let e=0;e<4;e++)t.push([s[e].x,s[e].y,s[e].z]);o[e]=Ce(t)}return s[oe.Up]=ve(a[oe.Up],oe.Up),s[oe.Down]=ve(a[oe.Down],oe.Down),s[oe.North]=ve(a[oe.North],oe.North),s[oe.South]=ve(a[oe.South],oe.South),s[oe.East]=ve(a[oe.East],oe.East),s[oe.West]=ve(a[oe.West],oe.West),{quads:a,vertexWeights:s,quadBounds:o}}var Te;!function(e){e[e.Panel=1]="Panel",e[e.CrossPanel=2]="CrossPanel",e[e.Box=3]="Box"}(Te||(Te={}));class Ve{static AnimationStates={WindAffected:Te};static LightMask=65535;static AOMask=15;static AnimationMask=4095;static TextureIndexMax=65535;static createTextureIndex(e,t){let s=0;return s=s&~this.TextureIndexMax|e&this.TextureIndexMax,s=s&~(this.TextureIndexMax<<16)|(t&this.TextureIndexMax)<<16,s}static createAttribute(e,t,s){let r=0;return r=r&~this.LightMask|e&this.LightMask,r=r&~(this.AOMask<<16)|(t&this.AOMask)<<16,r=r&~(this.AnimationMask<<20)|(s&this.AnimationMask)<<20,r}}class ze{static VertexFloatSize=24;static VertexByteSize=4*this.VertexFloatSize;static PositionOffset=0;static NormalOffset=4;static TextureIndexOffset=8;static UVOffset=12;static ColorOffset=14;static VoxelDataOFfset=18;get positionX(){return this.data[this.trueIndex+ze.PositionOffset]}set positionX(e){this.data[this.trueIndex+ze.PositionOffset]=e}get positionY(){return this.data[this.trueIndex+ze.PositionOffset+1]}set positionY(e){this.data[this.trueIndex+ze.PositionOffset+1]=e}get positionZ(){return this.data[this.trueIndex+ze.PositionOffset+2]}set positionZ(e){this.data[this.trueIndex+ze.PositionOffset+2]=e}get normalX(){return this.data[this.trueIndex+ze.NormalOffset]}set normalX(e){this.data[this.trueIndex+ze.NormalOffset]=e}get normalY(){return this.data[this.trueIndex+ze.NormalOffset+1]}set normalY(e){this.data[this.trueIndex+ze.NormalOffset+1]=e}get normalZ(){return this.data[this.trueIndex+ze.NormalOffset+2]}set normalZ(e){this.data[this.trueIndex+ze.NormalOffset+2]=e}get voxelData(){return this.data[this.trueIndex+ze.VoxelDataOFfset]}set voxelData(e){this.data[this.trueIndex+ze.VoxelDataOFfset]=e}get textureIndexX(){return this.data[this.trueIndex+ze.TextureIndexOffset]}set textureIndexX(e){this.data[this.trueIndex+ze.TextureIndexOffset]=e}get textureIndexY(){return this.data[this.trueIndex+ze.TextureIndexOffset+1]}set textureIndexY(e){this.data[this.trueIndex+ze.TextureIndexOffset+1]=e}get textureIndexZ(){return this.data[this.trueIndex+ze.TextureIndexOffset+2]}set textureIndexZ(e){this.data[this.trueIndex+ze.TextureIndexOffset+2]=e}get uvX(){return this.data[this.trueIndex+ze.UVOffset]}set uvX(e){this.data[this.trueIndex+ze.UVOffset]=e}get uvY(){return this.data[this.trueIndex+ze.UVOffset+1]}set uvY(e){this.data[this.trueIndex+ze.UVOffset+1]=e}get colorR(){return this.data[this.trueIndex+ze.ColorOffset]}set colorR(e){this.data[this.trueIndex+ze.ColorOffset]=e}get colorG(){return this.data[this.trueIndex+ze.ColorOffset+1]}set colorG(e){this.data[this.trueIndex+ze.ColorOffset+1]=e}get colorB(){return this.data[this.trueIndex+ze.ColorOffset+2]}set colorB(e){this.data[this.trueIndex+ze.ColorOffset+2]=e}trueIndex=0;_index=0;data;get index(){return this._index}set index(e){this._index=e,this.trueIndex=e*ze.VertexFloatSize}constructor(e){e&&(this.data=e)}toJSON(){return{position:[this.positionX,this.positionY,this.positionZ],normal:[this.normalX,this.normalY,this.normalZ],voxelData:this.voxelData,textureIndex:[this.textureIndexX,this.textureIndexY,this.textureIndexZ],uv:[this.uvX,this.uvY],color:[this.colorR,this.colorG,this.colorB]}}}const Me=new ze;function De(e,t,s){if(!e.mesh)return;const r=e.vars.light,i=e.vars.ao,a=e.vars.animation,o=e.vars.textureIndex,n=e.vars.overlayTextures,l=s.positions.vertices[0],d=s.positions.vertices[1],h=s.positions.vertices[2],c=s.positions.vertices[3],u=s.normals.vertices[0],g=s.normals.vertices[1],f=s.normals.vertices[2],p=s.normals.vertices[3],m=Ve.createAttribute(r.vertices[ie.TopRight],i.vertices[ie.TopRight],a.vertices[ie.TopRight]),y=Ve.createAttribute(r.vertices[ie.TopLeft],i.vertices[ie.TopLeft],a.vertices[ie.TopLeft]),x=Ve.createAttribute(r.vertices[ie.BottomLeft],i.vertices[ie.BottomLeft],a.vertices[ie.BottomLeft]),v=Ve.createAttribute(r.vertices[ie.BottomRight],i.vertices[ie.BottomRight],a.vertices[ie.BottomRight]),b=e.mesh.indices;let w=e.mesh.indicieCount,A=s.doubleSided?2:1;const S=s.flip;let B=s.orientation;for(;A--;){const r=e.mesh.vertexCount;S||(e.mesh.buffer.setIndex(r),Me.data=e.mesh.buffer.currentArray,Me.index=e.mesh.buffer.curentIndex,Ne(e.mesh.buffer.curentIndex,e.mesh.buffer.currentArray,t,l,u,s.uvs.vertices[ie.TopRight],m,o,n),e.mesh.buffer.setIndex(r+1),Me.data=e.mesh.buffer.currentArray,Me.index=e.mesh.buffer.curentIndex,Ne(e.mesh.buffer.curentIndex,e.mesh.buffer.currentArray,t,d,g,s.uvs.vertices[ie.TopLeft],y,o,n),e.mesh.buffer.setIndex(r+2),Me.data=e.mesh.buffer.currentArray,Me.index=e.mesh.buffer.curentIndex,Ne(e.mesh.buffer.curentIndex,e.mesh.buffer.currentArray,t,h,f,s.uvs.vertices[ie.BottomLeft],x,o,n),e.mesh.buffer.setIndex(r+3),Me.data=e.mesh.buffer.currentArray,Me.index=e.mesh.buffer.curentIndex,Ne(e.mesh.buffer.curentIndex,e.mesh.buffer.currentArray,t,c,p,s.uvs.vertices[ie.BottomRight],v,o,n)),S&&(e.mesh.buffer.setIndex(r),Me.data=e.mesh.buffer.currentArray,Me.index=e.mesh.buffer.curentIndex,Ne(e.mesh.buffer.curentIndex,e.mesh.buffer.currentArray,t,d,g,s.uvs.vertices[ie.TopLeft],y,o,n),e.mesh.buffer.setIndex(r+1),Me.data=e.mesh.buffer.currentArray,Me.index=e.mesh.buffer.curentIndex,Ne(e.mesh.buffer.curentIndex,e.mesh.buffer.currentArray,t,l,u,s.uvs.vertices[ie.TopRight],m,o,n),e.mesh.buffer.setIndex(r+2),Me.data=e.mesh.buffer.currentArray,Me.index=e.mesh.buffer.curentIndex,Ne(e.mesh.buffer.curentIndex,e.mesh.buffer.currentArray,t,c,p,s.uvs.vertices[ie.BottomRight],v,o,n),e.mesh.buffer.setIndex(r+3),Me.data=e.mesh.buffer.currentArray,Me.index=e.mesh.buffer.curentIndex,Ne(e.mesh.buffer.curentIndex,e.mesh.buffer.currentArray,t,h,f,s.uvs.vertices[ie.BottomLeft],x,o,n)),B||S?!B&&S&&(b.setIndex(w).currentArray[b.curentIndex]=r,b.setIndex(w+1).currentArray[b.curentIndex]=r+3,b.setIndex(w+2).currentArray[b.curentIndex]=r+2,b.setIndex(w+3).currentArray[b.curentIndex]=r+2,b.setIndex(w+4).currentArray[b.curentIndex]=r+1,b.setIndex(w+5).currentArray[b.curentIndex]=r):(b.setIndex(w).currentArray[b.curentIndex]=r,b.setIndex(w+1).currentArray[b.curentIndex]=r+1,b.setIndex(w+2).currentArray[b.curentIndex]=r+2,b.setIndex(w+3).currentArray[b.curentIndex]=r+2,b.setIndex(w+4).currentArray[b.curentIndex]=r+3,b.setIndex(w+5).currentArray[b.curentIndex]=r),B&&!S?(b.setIndex(w).currentArray[b.curentIndex]=r,b.setIndex(w+1).currentArray[b.curentIndex]=r+3,b.setIndex(w+2).currentArray[b.curentIndex]=r+2,b.setIndex(w+3).currentArray[b.curentIndex]=r+2,b.setIndex(w+4).currentArray[b.curentIndex]=r+1,b.setIndex(w+5).currentArray[b.curentIndex]=r):B&&S&&(b.setIndex(w).currentArray[b.curentIndex]=r,b.setIndex(w+1).currentArray[b.curentIndex]=r+1,b.setIndex(w+2).currentArray[b.curentIndex]=r+2,b.setIndex(w+3).currentArray[b.curentIndex]=r+2,b.setIndex(w+4).currentArray[b.curentIndex]=r+3,b.setIndex(w+5).currentArray[b.curentIndex]=r),e.mesh.addVerticies(4,6)}}function Ne(e,t,s,r,i,a,o,n,l){t[0+(e*=24)]=r.x+s.x,t[0+e+1]=r.y+s.y,t[0+e+2]=r.z+s.z,t[12+e]=a.x,t[12+e+1]=a.y,t[4+e]=i.x,t[4+e+1]=i.y,t[4+e+2]=i.z,t[8+e]=Ve.createTextureIndex(n,l.x),t[8+e+1]=Ve.createTextureIndex(l.y,l.z),t[8+e+2]=Ve.createTextureIndex(l.w,0),t[18+e]=o}const ke=se.ArgIndexes;class Le extends re{quads;quadBounds=[];vertexWeights;_wasAOShaded=!1;lightData=new k.$;init(){this.faceCount=6,this.vertexCount=4*this.faceCount;const{quads:e,vertexWeights:t,quadBounds:s}=_e(this.data.points,this.transform);this.quads=e,this.vertexWeights=t,this.quadBounds=s}isExposed(e){const t=e+this.faceIndex,s=this.geomtry.faceCullMap[t];if(!s)return!0;const r=this.builder;for(let e=0;e<s.length;e++){const i=s[e],a=X[i],o=this.builder.space.getHash(r.nVoxel,r.position.x+a[0],r.position.y+a[1],r.position.z+a[2]);if(this.builder.space.foundHash[o]<2)continue;const n=this.builder.space.getConstructor(o),l=this.builder.space.getGeomtry(o);if(l)for(let e=0;e<l.length;e++){const s=l[e];if(Ze.rulesless[s])continue;const r=this.geomtry.cullIndex.getValue(s,i,t);if(r>-1&&!n.isShapeStateFaceTransparent(this.builder.space.modCache[o],this.builder.space.stateCache[o],s,r))return!1}const d=this.builder.space.getConditionalGeomtry(o);if(d)for(let e=0;e<d.length;e++){const s=d[e];for(let e=0;e<s.length;e++){const r=s[e];if(Ze.rulesless[r])continue;const a=this.geomtry.cullIndex.getValue(r,i,t);if(a>-1&&!n.isCondtionalStateFaceTransparent(this.builder.space.modCache[o],this.builder.space.stateCache[o],r,a))return!1}}}return!0}determineShading(e){const t=this.builder,s=t.lightData[e],r=this.builder.voxel.isLightSource()||this.builder.voxel.noAO(),i=this.builder.vars.light,a=this.builder.vars.ao;for(let o=0;o<4;o++){if(a.vertices[o]=0,i.vertices[o]=xe(s,this.vertexWeights[e][o]),r)continue;const n=this.vertexIndex+4*e+o,l=this.geomtry.vertexHitMap[n];if(l)for(let e=0;e<l.length;e++){const s=l[e],r=X[s],i=this.builder.space.getHash(t.nVoxel,t.position.x+r[0],t.position.y+r[1],t.position.z+r[2]);if(this.builder.space.foundHash[i]<2||1===this.builder.space.noCastAO[i])continue;const d=this.builder.space.getGeomtry(i),h=this.builder.space.getConditionalGeomtry(i);if(!d&&!h)continue;let c=0,u=!1;if(d){c=d.length;for(let e=0;e<c;e++)if(this.geomtry.aoIndex.getValue(d[e],s,n)&&(this._wasAOShaded=!0,a.vertices[o]++,a.vertices[o]>=3)){u=!0;break}}if(h&&!u){c=h.length;for(let e=0;e<c;e++){const t=h[e].length;for(let r=0;r<t;r++)if(this.geomtry.aoIndex.getValue(h[e][r],s,n)&&(this._wasAOShaded=!0,a.vertices[o]++,a.vertices[o]>=3)){u=!0;break}}}}}}shouldFlip(){const e=this.builder.vars.ao;if(pe(e.vertices[0],e.vertices[1],e.vertices[2],e.vertices[3])&&this._wasAOShaded)return!0;if(this._wasAOShaded)return!1;const t=this.builder.vars.light;return pe(this.lightData.getS(t.vertices[0]),this.lightData.getS(t.vertices[1]),this.lightData.getS(t.vertices[2]),this.lightData.getS(t.vertices[3]))||pe(this.lightData.sumRGB(t.vertices[0]),this.lightData.sumRGB(t.vertices[1]),this.lightData.sumRGB(t.vertices[2]),this.lightData.sumRGB(t.vertices[3]))}add(e){let t=!1;const s=this.builder;for(let r=0;r<6;r++)if(e[r][ke.Enabled]&&this.isExposed(r)){t=!0;const i=this.quads[r];s.calculateFaceData(r),this.determineShading(r);const a=e[r];i.flip=this.shouldFlip()||a[ke.Fliped],s.vars.textureIndex=a[ke.Texture];const o=a[ke.UVs];i.uvs.vertices[0].x=o[0][0],i.uvs.vertices[0].y=o[0][1],i.uvs.vertices[1].x=o[1][0],i.uvs.vertices[1].y=o[1][1],i.uvs.vertices[2].x=o[2][0],i.uvs.vertices[2].y=o[2][1],i.uvs.vertices[3].x=o[3][0],i.uvs.vertices[3].y=o[3][1],De(s,this.builder.origin,i),s.updateBounds(this.quadBounds[r])}return this.builder.vars.ao.setAll(0),this.builder.vars.light.setAll(0),this._wasAOShaded=!1,t}}var Fe;!function(e){e[e.Enabled=0]="Enabled",e[e.Fliped=1]="Fliped",e[e.Texture=2]="Texture",e[e.Rotation=3]="Rotation",e[e.Transparent=4]="Transparent",e[e.DoubleSided=5]="DoubleSided",e[e.UVs=6]="UVs"}(Fe||(Fe={}));class Re{static ArgIndexes=Fe;static CreateArgs(){const e=[];return e[Fe.Enabled]=!0,e[Fe.Fliped]=!1,e[Fe.Texture]=0,e[Fe.Rotation]=0,e[Fe.Transparent]=!1,e[Fe.DoubleSided]=!1,e[Fe.UVs]=[[1,1],[0,1],[0,0],[1,0]],e}}function Ue(e,t){const s=function(e,t){const s={...e.positions.vertices[ie.TopRight]},r={...e.positions.vertices[ie.TopLeft]},i={...e.positions.vertices[ie.BottomLeft]},a={...e.positions.vertices[ie.BottomRight]},o=[s,r,i,a],n={x:(s.x+r.x+i.x+a.x)/4,y:(s.y+r.y+i.y+a.y)/4,z:(s.z+r.z+i.z+a.z)/4};let l=1,d=1,h=1;if(t.scale){const[e,s,r]=t.scale;l=e,d=s,h=r}if(t.flip){const[e,s,r]=t.flip;e&&(l*=-1),s&&(d*=-1),r&&(h*=-1)}const c=l*d*h;for(const e of o)e.x=n.x+(e.x-n.x)*l,e.y=n.y+(e.y-n.y)*d,e.z=n.z+(e.z-n.z)*h;if(t.rotation){const[e,s,r]=t.rotation,i=Ie(e),a=Ie(s),l=Ie(r),d=t.rotationPivot?{x:t.rotationPivot[0],y:t.rotationPivot[1],z:t.rotationPivot[2]}:n;for(const e of o){let t=e.x-d.x,s=e.y-d.y,r=e.z-d.z;if(i){const e=Math.cos(i),t=Math.sin(i),a=s*t+r*e;s=s*e-r*t,r=a}if(a){const e=Math.cos(a),s=Math.sin(a),i=-t*s+r*e;t=t*e+r*s,r=i}if(l){const e=Math.cos(l),r=Math.sin(l),i=t*r+s*e;t=t*e-s*r,s=i}e.x=t+d.x,e.y=s+d.y,e.z=r+d.z}}if(t.position){const[e,s,r]=t.position;for(const t of o)t.x+=e,t.y+=s,t.z+=r}return c<0&&o.reverse(),Be.Create(o.map((e=>u.Az.ToArray(e))))}(Be.Create(e.points),t);s.orientation=0;const r=s.normals.getAsArray(),i=[0,0,0];for(let e=0;e<r.length;e++)i[0]+=r[e].x,i[1]+=r[e].y,i[2]+=r[e].z;i[0]/=r.length,i[1]/=r.length,i[2]/=r.length;const a=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);0!==a&&(i[0]/=a,i[1]/=a,i[2]/=a);const o=function(e){const[t,s,r]=e;let i=-1/0,a=[0,0,0];for(const e of[-1,0,1])for(const o of[-1,0,1])for(const n of[-1,0,1]){if(0===e&&0===o&&0===n)continue;const l=(t*e+s*o+r*n)/Math.sqrt(e*e+o*o+n*n);l>i&&(i=l,a=[e,o,n])}const o=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/o,a[1]/o,a[2]/o]}(i);let n=oe.Up;return 1==o[0]&&(n=oe.East),-1==o[0]&&(n=oe.West),1==o[1]&&(n=oe.Up),-1==o[1]&&(n=oe.Down),1==o[2]&&(n=oe.North),-1==o[2]&&(n=oe.South),{quad:s,vertexWeights:ve(s,n),closestFace:n,quadBounds:Ce(s.positions.getAsArray().map((e=>u.Az.ToArray(e))))}}const Ee=Re.ArgIndexes;class Pe extends re{quad;quadBounds=[[0,0,0],[0,0,0]];vertexWeights;closestFace;lightData=new k.$;init(){this.faceCount=6,this.vertexCount=4*this.faceCount;const{quad:e,quadBounds:t,closestFace:s,vertexWeights:r}=Ue(this.data,this.transform);this.quad=e,this.quadBounds=t,this.vertexWeights=r,this.closestFace=s}isExposed(){const e=this.faceIndex,t=this.geomtry.faceCullMap[e];if(!t)return!0;const s=this.builder;for(let r=0;r<t.length;r++){const i=t[r],a=X[i],o=this.builder.space.getHash(s.nVoxel,s.position.x+a[0],s.position.y+a[1],s.position.z+a[2]),n=this.builder.space.getGeomtry(o),l=this.builder.space.getConditionalGeomtry(o);if(n)for(let t=0;t<n.length;t++){const s=this.geomtry.cullIndex.getValue(n[t],i,e);if(s>-1&&!this.builder.space.getConstructor(o)?.isShapeStateFaceTransparent(this.builder.space.modCache[o],this.builder.space.stateCache[o],n[t],s))return!1}if(l)for(let t=0;t<l.length;t++){const s=l[t];for(let r=0;r<s.length;r++){const a=this.geomtry.cullIndex.getValue(s[r],i,e);if(a>-1&&!this.builder.space.getConstructor(o)?.isCondtionalStateFaceTransparent(this.builder.space.modCache[o],this.builder.space.stateCache[o],s[t],a))return!1}}}return!0}determineShading(){const e=this.builder,t=e.lightData[oe.Up],s=this.builder.voxel.isLightSource()||this.builder.voxel.noAO(),r=e.vars.light,i=e.vars.ao;for(let a=0;a<4;a++){if(i.vertices[a]=0,r.vertices[a]=xe(t,this.vertexWeights[a]),s)continue;const o=this.vertexIndex+4+a,n=this.geomtry.vertexHitMap[o];if(n)for(let t=0;t<n.length;t++){const s=n[t],r=X[s],l=this.builder.space.getHash(e.nVoxel,e.position.x+r[0],e.position.y+r[1],e.position.z+r[2]);if(1===this.builder.space.noCastAO[l])continue;const d=this.builder.space.getGeomtry(l),h=this.builder.space.getConditionalGeomtry(l);if(!d&&!h)continue;let c=0,u=!1;if(d){c=d.length;for(let e=0;e<c;e++)if(this.geomtry.aoIndex.getValue(d[e],s,o)){i.vertices[a]=1,u=!0;break}}if(h){c=h.length;for(let e=0;e<c;e++){const t=h[e].length;for(let r=0;r<t;r++)if(this.geomtry.aoIndex.getValue(h[e][r],s,o)){i.vertices[a]=1;break}}}}}}shouldFlip(){const e=this.builder.vars.ao,t=this.builder.vars.light;return!!pe(e.vertices[0],e.vertices[1],e.vertices[2],e.vertices[3])||pe(this.lightData.getS(t.vertices[0]),this.lightData.getS(t.vertices[1]),this.lightData.getS(t.vertices[2]),this.lightData.getS(t.vertices[3]))||pe(this.lightData.sumRGB(t.vertices[0]),this.lightData.sumRGB(t.vertices[1]),this.lightData.sumRGB(t.vertices[2]),this.lightData.sumRGB(t.vertices[3]))}add(e){if(!e[Ee.Enabled])return!1;if(!this.isExposed())return!1;this.builder.calculateFaceData(this.closestFace),this.determineShading();const t=this.quad;t.flip=this.shouldFlip()||e[Ee.Fliped],this.builder.vars.textureIndex=e[Ee.Texture],t.doubleSided=e[Ee.DoubleSided];const s=e[Ee.UVs];return t.uvs.vertices[0].x=s[0][0],t.uvs.vertices[0].y=s[0][1],t.uvs.vertices[1].x=s[1][0],t.uvs.vertices[1].y=s[1][1],t.uvs.vertices[2].x=s[2][0],t.uvs.vertices[2].y=s[2][1],t.uvs.vertices[3].x=s[3][0],t.uvs.vertices[3].y=s[3][1],De(this.builder,this.builder.origin,t),this.builder.updateBounds(this.quadBounds),this.builder.vars.light.setAll(0),this.builder.vars.ao.setAll(0),!0}}const He=Re.ArgIndexes;class Ge extends re{quad;quadBounds=[[0,0,0],[0,0,0]];vertexWeights;closestFace;lightData=new k.$;init(){this.faceCount=6,this.vertexCount=4*this.faceCount;const{quad:e,closestFace:t,vertexWeights:s,quadBounds:r}=Ue(this.data,this.transform);this.quad=e,this.quadBounds=r,this.vertexWeights=s,this.closestFace=t}determineShading(){const e=this.builder.lightData[oe.Up],t=(this.builder.voxel.isLightSource()||this.builder.voxel.noAO(),this.builder.vars.light),s=this.builder.vars.ao;for(let r=0;r<4;r++)s.vertices[r]=0,t.vertices[r]=xe(e,this.vertexWeights[r])}shouldFlip(){const e=this.builder.vars.light,t=this.builder.vars.ao;return!!pe(t.vertices[0],t.vertices[1],t.vertices[2],t.vertices[3])||pe(this.lightData.getS(e.vertices[0]),this.lightData.getS(e.vertices[1]),this.lightData.getS(e.vertices[2]),this.lightData.getS(e.vertices[3]))||pe(this.lightData.sumRGB(e.vertices[0]),this.lightData.sumRGB(e.vertices[1]),this.lightData.sumRGB(e.vertices[2]),this.lightData.sumRGB(e.vertices[3]))}add(e){if(!e[He.Enabled])return!1;const t=this.builder;t.calculateFaceData(this.closestFace),this.determineShading();const s=this.quad;s.flip=this.shouldFlip()||e[He.Fliped],t.vars.textureIndex=e[He.Texture],s.doubleSided=e[He.DoubleSided];const r=e[He.UVs];return s.uvs.vertices[0].x=r[0][0],s.uvs.vertices[0].y=r[0][1],s.uvs.vertices[1].x=r[1][0],s.uvs.vertices[1].y=r[1][1],s.uvs.vertices[2].x=r[2][0],s.uvs.vertices[2].y=r[2][1],s.uvs.vertices[3].x=r[3][0],s.uvs.vertices[3].y=r[3][1],De(t,t.position,s),this.builder.updateBounds(this.quadBounds),this.builder.vars.light.setAll(0),this.builder.vars.ao.setAll(0),!0}}const Oe=se.ArgIndexes;class Qe extends re{quads;quadBounds=[];vertexWeights;lightData=new k.$;init(){this.faceCount=6,this.vertexCount=4*this.faceCount;const{quads:e,vertexWeights:t,quadBounds:s}=_e(this.data.points,this.transform);this.quads=e,this.quadBounds=s,this.vertexWeights=t}determineShading(e){const t=this.builder.lightData[e],s=(this.builder.voxel.isLightSource()||this.builder.voxel.noAO(),this.builder.vars.light),r=this.builder.vars.ao;for(let i=0;i<4;i++)r.vertices[i]=0,s.vertices[i]=xe(t,this.vertexWeights[e][i])}shouldFlip(){const e=this.builder.vars.light,t=this.builder.vars.ao;return!!pe(t.vertices[0],t.vertices[1],t.vertices[2],t.vertices[3])||pe(this.lightData.getS(e.vertices[0]),this.lightData.getS(e.vertices[1]),this.lightData.getS(e.vertices[2]),this.lightData.getS(e.vertices[3]))||pe(this.lightData.sumRGB(e.vertices[0]),this.lightData.sumRGB(e.vertices[1]),this.lightData.sumRGB(e.vertices[2]),this.lightData.sumRGB(e.vertices[3]))}add(e){const t=this.builder;let s=!1;for(let r=0;r<6;r++)if(e[r][Oe.Enabled]){s=!0,t.calculateFaceData(r),this.determineShading(r);const i=e[r],a=this.quads[r];a.flip=this.shouldFlip()||i[Oe.Fliped],t.vars.textureIndex=i[Oe.Texture];const o=i[Oe.UVs];a.uvs.vertices[0].x=o[0][0],a.uvs.vertices[0].y=o[0][1],a.uvs.vertices[1].x=o[1][0],a.uvs.vertices[1].y=o[1][1],a.uvs.vertices[2].x=o[2][0],a.uvs.vertices[2].y=o[2][1],a.uvs.vertices[3].x=o[3][0],a.uvs.vertices[3].y=o[3][1],De(t,t.position,a),this.builder.updateBounds(this.quadBounds[r])}return this.builder.vars.light.setAll(0),this.builder.vars.ao.setAll(0),s}}class Ye{geometryPaletteId;nodes=[];faceCullMap;vertexHitMap;cullIndex;aoIndex;constructor(e,t){this.geometryPaletteId=e;for(const s of t.nodes)if("custom"==s.node.type){const t=new(Ze.getCustomNode(s.node.id))(e,this,s.node,s.tranform);t.init(),this.nodes.push(t)}if(t?.ruleless)for(const s of t.nodes){if("box"==s.node.type){const t=new Qe(e,this,s.node,s.tranform);t.init(),this.nodes.push(t)}if("quad"==s.node.type){const t=new Ge(e,this,s.node,s.tranform);t.init(),this.nodes.push(t)}}else{this.faceCullMap=t.faceCullMap,this.vertexHitMap=t.vertexHitMap,this.cullIndex=new j(t.cullIndex),this.aoIndex=new J(t.aoIndex);for(const s of t.nodes){if("box"==s.node.type){const t=new Le(e,this,s.node,s.tranform);t.init(),this.nodes.push(t)}if("quad"==s.node.type){const t=new Pe(e,this,s.node,s.tranform);t.init(),this.nodes.push(t)}}}let s=0,r=0;for(const e of this.nodes)e.faceIndex=s,e.vertexIndex=r,s+=e.faceCount,r+=e.vertexCount}}var Xe=s(18556);class Ze{static geometryPalette;static geometry=[];static rulesless=[];static setGeometryPalette(e){this.geometryPalette=new Q.N(e)}static modelData=new Map;static customNodes=new Map;static registerModels(e){e.forEach((e=>this.modelData.set(e.id,e)))}static registerCustomNode(e,t){this.customNodes.set(e,t)}static getCustomNode(e){const t=this.customNodes.get(e);if(!t)throw new Error(`Custom geometry node [${e}] does not exist.`);return t}static constructorsPaltte=[];static constructors=new Map;static getConstructor(e){return this.constructors.get(e)}static registerVoxel(e){if(Array.isArray(e))for(const t of e)this.constructors.set(t.id,t),this.constructorsPaltte[Xe.A.voxels.getNumberId(t.id)]=t;else this.constructorsPaltte[Xe.A.voxels.getNumberId(e.id)]=e,this.constructors.set(e.id,e)}static registerGeometry(e){for(const t of e){const e=this.geometryPalette.getNumberId(t.id);this.geometry[e]=new Ye(e,t),1==t.ruleless?this.rulesless[e]=!0:this.rulesless[e]=!1}}}var We=s(19305),je=s(92287);class qe{bounds;foundHash;voxelCache;modCache;stateCache;conditonalStateCache;noCastAO;offset=[0,0,0];voxelCursor=new We.x;constructor(e){this.bounds=e;const t=e.x*e.y*e.z;this.foundHash=new Uint8Array(t),this.voxelCache=new Uint16Array(t),this.modCache=new Int32Array(t),this.stateCache=new Int32Array(t),this.conditonalStateCache=new Int32Array(t),this.noCastAO=new Uint8Array(t)}start(e,t,s){this.offset[0]=e,this.offset[1]=t,this.offset[2]=s,this.foundHash.fill(0),this.voxelCache.fill(0),this.modCache.fill(-1),this.stateCache.fill(-1),this.conditonalStateCache.fill(-1),this.noCastAO.fill(0)}getIndex(e,t,s){return(0,je.BN)(e-this.offset[0],t-this.offset[1],s-this.offset[2],this.bounds.x,this.bounds.y,this.bounds.z)}getConstructor(e){return this.foundHash[e]<2?null:Ze.constructorsPaltte[this.voxelCache[e]]}getGeomtry(e){return this.foundHash[e]<2?null:Ze.constructorsPaltte[this.voxelCache[e]].data.stateGeometryMap[this.stateCache[e]]}getConditionalGeomtry(e){return this.foundHash[e]<2?null:Ze.constructorsPaltte[this.voxelCache[e]].data.condiotnalShapeStateGeometryMap[this.conditonalStateCache[e]]}getHash(e,t,s,r){const i=this.getIndex(t,s,r);return 0==this.foundHash[i]&&this.hashState(e,i,t,s,r),i}hashState(e,t,s,r,i){if(1==this.foundHash[t])return;if(2==this.foundHash[t])return;const a=e.getVoxel(s,r,i);if(!a||!a.isRenderable())return void(this.foundHash[t]=1);const o=a.getId(),n=Ze.constructorsPaltte[o];if(!n)return void(this.foundHash[t]=1);this.voxelCache[t]=o,this.foundHash[t]=2,this.noCastAO[t]=a.isLightSource()||a.noAO()?1:0;const l=n.stateTree.getState(a.getState());this.stateCache[t]=l;const d=n.modTree.getState(a.getMod());this.modCache[t]=d,this.voxelCursor.copy(a).process(),n.schema.position.x=s,n.schema.position.y=r,n.schema.position.z=i,n.schema.voxel=this.voxelCursor,n.schema.dataCursor=e;const h=n.condtioanlShapeStateTree.getState();this.conditonalStateCache[t]=h}}class $e{data;get minX(){return this.data[this.trueIndex]}get minY(){return this.data[this.trueIndex+1]}get minZ(){return this.data[this.trueIndex+2]}get maxX(){return this.data[this.trueIndex+4]}get maxY(){return this.data[this.trueIndex+5]}get maxZ(){return this.data[this.trueIndex+6]}get voxelIndex(){return this.data[this.trueIndex+3]}get active(){return this.data[this.trueIndex+3]}get nodeType(){return this.data[this.trueIndex+7]}trueIndex=0;index=0;setIndex(e){this.trueIndex=8*e}constructor(e){this.data=e}setActive(){this.data[this.trueIndex+3]=1}setVoxelIndex(e){this.data[this.trueIndex+3]=e}setInnerNode(){this.data[this.trueIndex+7]=1}setGeomtryNode(){this.data[this.trueIndex+7]=2}updateMin(e,t,s){const r=this.trueIndex,i=this.trueIndex+1,a=this.trueIndex+2;(e<this.data[r]||this.data[r]==-1/0)&&(this.data[r]=e),(t<this.data[i]||this.data[i]==-1/0)&&(this.data[i]=t),(s<this.data[a]||this.data[a]==-1/0)&&(this.data[a]=s)}updateMax(e,t,s){const r=this.trueIndex+4,i=this.trueIndex+5,a=this.trueIndex+6;(e>this.data[r]||this.data[r]==-1/0)&&(this.data[r]=e),(t>this.data[i]||this.data[i]==-1/0)&&(this.data[i]=t),(s>this.data[a]||this.data[a]==-1/0)&&(this.data[a]=s)}}class Ke{levels;constructor(e){this.levels=e}getLevelSize(e){if(e<0||e>=this.levels)throw new Error("Invalid level");return 1<<e}getIndexAtLevel(e,t){if(e<0||e>=this.levels)throw new Error("Invalid level");const s=this.getLevelSize(e);if(t<0||t>=s)throw new Error("Invalid node index at the given level");return(1<<e)-1+t}getLevelAndIndex(e){const t=(1<<this.levels)-1;if(e<0||e>=t)throw new Error("Invalid node index");const s=Math.floor(Math.log2(e+1));return[s,e-((1<<s)-1)]}getLeftChildAtLevel(e,t){if(e+1>=this.levels)return-1;const s=this.getIndexAtLevel(e,t);return this.getLeftChild(s)}getRightChildAtLevel(e,t){if(e+1>=this.levels)return-1;const s=this.getIndexAtLevel(e,t);return this.getRightChild(s)}getParentAtLevel(e,t){if(0===e)return-1;const s=this.getIndexAtLevel(e,t);return this.getParent(s)}getLeftChild(e){const t=2*e+1;return t<(1<<this.levels)-1?t:-1}getRightChild(e){const t=2*e+2;return t<(1<<this.levels)-1?t:-1}getParent(e){return 0===e?-1:Math.floor((e-1)/2)}getTotalSize(){return(1<<this.levels)-1}}const Je=new Float32Array([1/0])[0];class et{static AABBStructByteSize=32;treeIndex=new Ke(13);tree=new Float32Array(new ArrayBuffer(this.treeIndex.getTotalSize()*et.AABBStructByteSize));structCursor=new $e(this.tree);indices=new Uint32Array(2*this.treeIndex.getLevelSize(12));reset(){this.tree.fill(-Je),this.indices.fill(0)}getMeshBounds(){const e=this.treeIndex.getIndexAtLevel(0,0);return{min:[this.tree[e],this.tree[e+1],this.tree[e+2]],max:[this.tree[e+4],this.tree[e+5],this.tree[e+6]]}}updateVoxel(e,t,s,r,i,a,o,n,l,d,c,u){const g=h.k.voxel.getIndex(e,t,s),f=this.treeIndex.getIndexAtLevel(12,g);this.indices[2*g]=i,this.indices[2*g+1]=a,this.structCursor.setIndex(f),this.structCursor.updateMin(o,n,l),this.structCursor.updateMax(d,c,u),this.structCursor.setVoxelIndex(g),this.structCursor.setGeomtryNode();let p=f;for(let e=1;e<13;e++){let e=this.treeIndex.getParent(p);this.structCursor.setIndex(e),this.structCursor.updateMin(o,n,l),this.structCursor.updateMax(d,c,u),this.structCursor.setActive(),this.structCursor.setInnerNode(),p=e}}}const tt=new k.$;class st{vertexFloatSize;sectorVertexSize;_buffers=[];sectorSize=0;constructor(e,t,s=8){this.vertexFloatSize=e,this.sectorVertexSize=t,this.sectorSize=e*t;for(let e=0;e<s;e++)this._buffers.push(new Float32Array(this.sectorSize))}currentArray;curentIndex=0;_index=0;setIndex(e){this._index=e;const t=Math.floor(e*this.vertexFloatSize/this.sectorSize);this._buffers[t]||(this._buffers[t]=new Float32Array(this.sectorSize)),this.curentIndex=(e*this.vertexFloatSize-t*this.sectorSize)/this.vertexFloatSize,this.currentArray=this._buffers[t]}}class rt{sectorSize;_buffers=[];constructor(e,t=8){this.sectorSize=e;for(let s=0;s<t;s++)this._buffers.push(new Uint32Array(e))}currentArray;curentIndex=0;_index=0;setIndex(e){this._index=e;const t=Math.floor(e/this.sectorSize);return this._buffers[t]||(this._buffers[t]=new Uint32Array(this.sectorSize)),this.curentIndex=e-t*this.sectorSize,this.currentArray=this._buffers[t],this}}class it{indicieCount=0;vertexCount=0;minBounds=u.Az.Create(1/0,1/0,1/0);maxBounds=u.Az.Create(-1/0,-1/0,-1/0);buffer=new st(ze.VertexFloatSize,1024);indices=new rt(1024);addVerticies(e,t){this.vertexCount+=e,this.indicieCount+=t}clear(){this.indicieCount=0,this.vertexCount=0,this.minBounds.x=1/0,this.minBounds.y=1/0,this.minBounds.z=1/0,this.maxBounds.x=-1/0,this.maxBounds.y=-1/0,this.maxBounds.z=-1/0}}class at{faceFlipped=!1;textureIndex=0;overlayTextures=u.ZS.Create();light=new Se;ao=new Se;animation=new Se;level=new Se;reset(){this.faceFlipped=!1,this.textureIndex=0,this.overlayTextures.x=0,this.overlayTextures.y=0,this.overlayTextures.z=0}}class ot{id;materialIndex;space;voxel;nVoxel;position=u.Az.Create();origin=u.Az.Create();mesh=new it;bvhTool=null;vars=new at;dataCalculated;condiotnalGeometryData;lightData;effects;constructor(e,t){this.id=e,this.materialIndex=t,this.dataCalculated=[];for(const e of ne)this.dataCalculated[e]=!1;this.condiotnalGeometryData=[];for(const e of ne)this.condiotnalGeometryData[e]=[],this.condiotnalGeometryData[e][ie.TopRight]=[[],[],[]],this.condiotnalGeometryData[e][ie.TopLeft]=[[],[],[]],this.condiotnalGeometryData[e][ie.BottomLeft]=[[],[],[]],this.condiotnalGeometryData[e][ie.BottomRight]=[[],[],[]];this.lightData=[];for(const e of ne)this.lightData[e]=[],this.lightData[e][ie.TopRight]=0,this.lightData[e][ie.TopLeft]=0,this.lightData[e][ie.BottomLeft]=0,this.lightData[e][ie.BottomRight]=0}bounds={min:[0,0,0],max:[0,0,0]};_indexStart=0;startConstruction(){this._indexStart=this.mesh.indicieCount,this.bounds.min[0]=1/0,this.bounds.min[1]=1/0,this.bounds.min[2]=1/0,this.bounds.max[0]=-1/0,this.bounds.max[1]=-1/0,this.bounds.max[2]=-1/0,this._boundsUpdate=!1}endConstruction(){if(this.vars.reset(),this.bvhTool){if(!this._boundsUpdate)return!1;this.bvhTool.updateVoxel(this.position.x,this.position.y,this.position.z,this._indexStart,this.materialIndex,this.mesh.indicieCount,this.bounds.min[0],this.bounds.min[1],this.bounds.min[2],this.bounds.max[0],this.bounds.max[1],this.bounds.max[2])}return!0}_boundsUpdate=!1;updateBounds(e){const t=this.origin;t.x+e[0][0]<this.bounds.min[0]&&(this.bounds.min[0]=t.x+e[0][0]),t.y+e[0][1]<this.bounds.min[1]&&(this.bounds.min[1]=t.y+e[0][1]),t.z+e[0][2]<this.bounds.min[2]&&(this.bounds.min[2]=t.z+e[0][2]),t.x+e[1][0]>this.bounds.max[0]&&(this.bounds.max[0]=t.x+e[1][0]),t.y+e[1][1]>this.bounds.max[1]&&(this.bounds.max[1]=t.y+e[1][1]),t.z+e[1][2]>this.bounds.max[2]&&(this.bounds.max[2]=t.z+e[1][2]),this._boundsUpdate=!0}calculateFaceData(e){if(this.dataCalculated[e])return!0;!function(e,t){const s=t.position.x,r=t.position.y,i=t.position.z,a=t.lightData[e],o=t.nVoxel,n=de[e];let l=0;l=t.voxel.isLightSource()?t.voxel.getLightSourceValue():o.getVoxel(s+le[e][0],r+le[e][1],i+le[e][2])?.getLight()||0,l<0&&(l=0);const d=tt.getS(l),h=tt.getR(l),c=tt.getG(l),u=tt.getB(l);for(let e=0;e<4;e++){a[e]=l;let t=d,g=h,f=c,p=u;for(let a=0;a<9;a+=3){const l=o.getVoxel(n[e][a]+s,n[e][a+1]+r,n[e][a+2]+i)?.getLight()||-1;if(l<=0)continue;let d=tt.getS(l),h=tt.getR(l),c=tt.getG(l),u=tt.getB(l);t<d&&(t=d),g<h&&(g=h),f<c&&(f=c),p<u&&(p=u)}a[e]=tt.createLightValue(t,g,f,p)}}(e,this),this.dataCalculated[e]=!0}clearCalculatedData(){this.dataCalculated[oe.Up]=!1,this.dataCalculated[oe.Down]=!1,this.dataCalculated[oe.North]=!1,this.dataCalculated[oe.South]=!1,this.dataCalculated[oe.East]=!1,this.dataCalculated[oe.West]=!1}clear(){return this.vars.reset(),this.mesh.clear(),this}}class nt{static meshersMap=new Map;static meshers=[];static register(e){for(let t=0;t<e.length;t++){const s=new ot(e[t],t);this.meshersMap.set(e[t],s),this.meshers[t]=s}}}class lt{static GetHeaderByteSize(e=0){return 15+e*this.GetMeshHeaderByteSize()}static GetMeshHeaderByteSize(){return 41}data;setData(e){this.data=new DataView(e)}setTotalMeshes(e){this.data.setUint8(14,e)}getTotalMeshes(){return this.data.getUint8(14)}setLocation(e,t,s,r){this.data.setInt16(0,e),this.data.setInt32(2,t),this.data.setInt32(6,s),this.data.setInt32(10,r)}getLocation(e=[0,0,0,0]){return e[0]=this.data.getInt16(0),e[1]=this.data.getInt32(2),e[2]=this.data.getInt32(6),e[3]=this.data.getInt32(10),e}setMeshData(e,t){const{material:s,minBounds:r,maxBounds:i,vertexIndex:a,indiceIndex:o}=t;let n=lt.GetHeaderByteSize(0)+lt.GetMeshHeaderByteSize()*e;this.data.setUint8(n,Xe.A.material.getNumberId(s)),n++,this.data.setFloat32(n,r[0]),n+=4,this.data.setFloat32(n,r[1]),n+=4,this.data.setFloat32(n,r[2]),n+=4,this.data.setFloat32(n,i[0]),n+=4,this.data.setFloat32(n,i[1]),n+=4,this.data.setFloat32(n,i[2]),n+=4,this.data.setUint32(n,a[0]),n+=4,this.data.setUint32(n,a[1]),n+=4,this.data.setUint32(n,o[0]),n+=4,this.data.setUint32(n,o[1]),n+=4}getMeshData(e,t){let s=lt.GetHeaderByteSize(0)+lt.GetMeshHeaderByteSize()*e;return t.material=Xe.A.material.getStringId(this.data.getUint8(s)),s++,t.minBounds[0]=this.data.getFloat32(s),s+=4,t.minBounds[1]=this.data.getFloat32(s),s+=4,t.minBounds[2]=this.data.getFloat32(s),s+=4,t.maxBounds[0]=this.data.getFloat32(s),s+=4,t.maxBounds[1]=this.data.getFloat32(s),s+=4,t.maxBounds[2]=this.data.getFloat32(s),s+=4,t.vertexIndex[0]=this.data.getUint32(s),s+=4,t.vertexIndex[1]=this.data.getUint32(s),s+=4,t.indiceIndex[0]=this.data.getUint32(s),s+=4,t.indiceIndex[1]=this.data.getUint32(s),s+=4,t.verticies=new Float32Array(this.data.buffer,...t.vertexIndex),t.indices=t.indiceIndex[1]>65535?new Uint32Array(this.data.buffer,...t.indiceIndex):new Uint16Array(this.data.buffer,...t.indiceIndex),t}}const dt=new class{material="dve_solid";minBounds=[0,0,0];maxBounds=[0,0,0];vertexIndex=[0,0];indiceIndex=[0,0];verticies;indices},ht=new lt;function ct(e){return e+3&-4}const ut=new g,gt=new S.p;let ft;const pt=new et;function mt(e,t,s,r){let i=!1;const a=Ze.constructorsPaltte[r.getId()],o=a.builder;return o.origin.x=ut._voxelPosition.x,o.origin.y=ut._voxelPosition.y,o.origin.z=ut._voxelPosition.z,o.position.x=e,o.position.y=t,o.position.z=s,o.voxel=r,o.nVoxel=gt,o.startConstruction(),i=a.process(),o.endConstruction(),i}const yt=u.Az.Create(5,5,5);function xt(e,t=[]){ft||(ft=new qe({x:h.k.section.bounds.x+yt.x,y:h.k.section.bounds.y+yt.y,z:h.k.section.bounds.z+yt.z}));const s=n._.sectors.getAt(e);if(!s)return null;const r=s.getSection(e[1],e[2],e[3]),[i,a,o]=r.getPosition();gt.setFocalPoint(...e),ut.setSection(...e);let[l,d]=r.getMinMax();if(l==1/0&&d==-1/0)return r.setDisplayDirty(!1),r.setInProgress(!1),null;ft.start(i-(yt.x-1),a-(yt.y-1),o-(yt.z-1)),pt.reset();const c={};for(let e=0;e<nt.meshers.length;e++){const t=nt.meshers[e];t.space=ft,t.bvhTool=pt,t.effects=c}const u=h.k.section.bounds.x*h.k.section.bounds.z,g=(d+1)*u;for(let e=l*u;e<g;e++){if(!(e%u)){const t=e/u;if(!r.getHasVoxel(t)&&!r.getHasVoxelDirty(t)){e+=u-1;continue}}if(!r.ids[e])continue;if(!r.ids[e]||r.getBuried(e))continue;const t=ut.getVoxelAtIndex(e),s=i+ut._voxelPosition.x,n=a+ut._voxelPosition.y,l=o+ut._voxelPosition.z;let d=!1;mt(s,n,l,t)&&(d=!0),t.hasSecondaryVoxel()&&(t.setSecondary(!0),mt(s,n,l,t)&&(d=!0),t.setSecondary(!1)),r.setBuried(e,!d)}const f=[];for(let e=0;e<nt.meshers.length;e++){const t=nt.meshers[e];if(!t.mesh.vertexCount){t.clear(),t.bvhTool=null;continue}const{min:s,max:r}=t.bvhTool.getMeshBounds();t.mesh.minBounds.x=s[0],t.mesh.minBounds.y=s[1],t.mesh.minBounds.z=s[2],t.mesh.maxBounds.x=r[0],t.mesh.maxBounds.y=r[1],t.mesh.maxBounds.z=r[2],f.push(t)}const p=function(e,t,s=[]){let r=lt.GetHeaderByteSize(t.length);r=ct(r);let i=r;for(let e=0;e<t.length;e++){const s=t[e];i+=s.mesh.vertexCount*ze.VertexByteSize,i=ct(i),i+=s.mesh.indicieCount>65535?4*s.mesh.indicieCount:2*s.mesh.indicieCount,i=ct(i)}const a=new ArrayBuffer(i);ht.setData(a),ht.setLocation(...e),ht.setTotalMeshes(t.length);let o=r;for(let e=0;e<t.length;e++){const s=t[e];dt.material=s.id;const r=s.mesh.minBounds,i=s.mesh.maxBounds;dt.minBounds[0]=r.x,dt.minBounds[1]=r.y,dt.minBounds[2]=r.z,dt.maxBounds[0]=i.x,dt.maxBounds[1]=i.y,dt.maxBounds[2]=i.z;const n=s.mesh.vertexCount*ze.VertexFloatSize,l=4*n;dt.vertexIndex[0]=o,dt.vertexIndex[1]=n,o+=l,o=ct(o),dt.indiceIndex[0]=o,dt.indiceIndex[1]=s.mesh.indicieCount,o+=s.mesh.indicieCount>65535?4*s.mesh.indicieCount:2*s.mesh.indicieCount,o=ct(o),ht.setMeshData(e,dt);const d=new Float32Array(a,dt.vertexIndex[0],n),h=s.mesh.buffer._buffers;let c=0,u=!1;for(let e=0;e<h.length;e++){const t=h[e];for(let e=0;e<t.length;e++)if(d[c]=t[e],c++,c>=n){u=!0;break}if(u)break}const g=s.mesh.indicieCount>65535?new Uint32Array(a,dt.indiceIndex[0],s.mesh.indicieCount):new Uint16Array(a,dt.indiceIndex[0],s.mesh.indicieCount),f=s.mesh.indices._buffers;c=0,u=!1;for(let e=0;e<f.length;e++){const t=f[e];for(let e=0;e<t.length;e++)if(g[c]=t[e],c++,c>=s.mesh.indicieCount){u=!0;break}if(u)break}}return s.push(a),a}(e,f,t);for(let e=0;e<f.length;e++)f[e].clear(),f[e].bvhTool=null;return r.setDisplayDirty(!1),r.setInProgress(!1),p}var vt,bt,wt=s(20650),At=s(55138);!function(e){e[e.None=0]="None",e[e.Down=1]="Down",e[e.Up=2]="Up"}(vt||(vt={})),function(e){e[e.NorthEast=0]="NorthEast",e[e.NorthWest=1]="NorthWest",e[e.SouthWest=2]="SouthWest",e[e.SouthEsat=3]="SouthEsat"}(bt||(bt={}));const St={[bt.NorthEast]:[1,0,0,1,1,1],[bt.NorthWest]:[-1,0,0,1,-1,1],[bt.SouthWest]:[-1,0,0,-1,-1,-1],[bt.SouthEsat]:[1,0,0,-1,1,-1]};function Bt(e,t,s,r){const i=e.nVoxel.getVoxel(t,s,r);if(!i||!i.isRenderable())return-1;if(!e.voxel.isSameVoxel(i))return-1;const a=i.getLevel();return i.getLevelState()>0?7:a}const It=[u.xH.East,0],Ct=new Se,_t=new Se,Tt=new k.$,Vt=6/7,zt={[u.xH.North]:Be.RotateUvs(Be.FullUVs,u.xH.North),[u.xH.South]:Be.RotateUvs(Be.FullUVs,u.xH.South),[u.xH.East]:Be.RotateUvs(Be.FullUVs,u.xH.East),[u.xH.West]:Be.RotateUvs(Be.FullUVs,u.xH.West),[u.xH.NorthWest]:Be.RotateUvs(Be.FullUVs,u.xH.NorthWest),[u.xH.NorthEast]:Be.RotateUvs(Be.FullUVs,u.xH.NorthEast),[u.xH.SouthWest]:Be.RotateUvs(Be.FullUVs,u.xH.SouthWest),[u.xH.SouthEast]:Be.RotateUvs(Be.FullUVs,u.xH.SouthEast)},Mt=[[1,1],[0,1],[0,0],[1,0]],{quads:Dt,vertexWeights:Nt,quadBounds:kt}=_e([[0,0,0],[1,Vt,1]],{});Dt[oe.Up].setUVs(Mt),Dt[oe.Down].setUVs(Mt);class Lt extends re{init(){this.faceCount=1,this.vertexCount=0}isExposed(e){const t=this.builder.nVoxel.getVoxel(le[e][0]+this.builder.position.x,le[e][1]+this.builder.position.y,le[e][2]+this.builder.position.z);return!(t&&!t.isAir()&&(this.builder.voxel.isSameVoxel(t)||e!=oe.Up))}determineShading(e){this.builder.calculateFaceData(e);const t=this.builder.lightData[e],s=this.builder.vars.light;s.vertices[0]=t[0],s.vertices[1]=t[1],s.vertices[2]=t[2],s.vertices[3]=t[3]}shouldFlip(){const e=this.builder.vars.light;return pe(Tt.getS(e.vertices[0]),Tt.getS(e.vertices[1]),Tt.getS(e.vertices[2]),Tt.getS(e.vertices[3]))||pe(Tt.sumRGB(e.vertices[0]),Tt.sumRGB(e.vertices[1]),Tt.sumRGB(e.vertices[2]),Tt.sumRGB(e.vertices[3]))}add(e){_t.setAll(15),Ct.setAll(0);const t=this.builder;let s=!1,r=!1;if(this.isExposed(oe.Up)){r=!0,s=!0,function(e,t){const s=e.voxel.getLevel(),r=e.voxel.getLevelState();for(let i=0;i<=3;i++){const a=St[i];let o=s,n=0;for(let s=0;s<6;s+=2){const r=a[s]+e.position.x,l=a[s+1]+e.position.z;if(Bt(e,r,e.position.y+1,l)>0){t.vertices[i]=9,o=9;break}const d=Bt(e,r,e.position.y,l);-1==d&&n++,o<d&&(o=d)}(o<7&&o>3||1==r)&&n>=2&&(o=3),t.vertices[i]=o}}(t,_t);const i=Dt[oe.Up];this.determineShading(oe.Up),i.flip=this.shouldFlip(),t.vars.textureIndex=e.stillTexture,Ct.set(_t.vertices[0]/7,_t.vertices[1]/7,_t.vertices[2]/7,_t.vertices[3]/7);const a=function(e){if(e.isAllEqualTo(7))return It[0]=0,It[1]=vt.Up,It;const t=e.vertices[ie.TopRight],s=e.vertices[ie.TopLeft],r=e.vertices[ie.BottomLeft],i=e.vertices[ie.BottomRight],a=t==i,o=s==r;if(t==s&&i==r){if(t<i)return It[0]=u.xH.North,It[1]=vt.Up,It;if(t>i)return It[0]=u.xH.South,It[1]=vt.Up,It}if(a&&o){if(t<s)return It[0]=u.xH.East,It[1]=vt.Up,It;if(t>s)return It[0]=u.xH.West,It[1]=vt.Up,It}return i<t&&i<s&&i<r||s>t&&s>i&&s>r?(It[0]=u.xH.SouthEast,It[1]=vt.Up,It):s<t&&s<i&&s<r||i>t&&i>s&&i>r?(It[0]=u.xH.NorthWest,It[1]=vt.Up,It):t<i&&t<s&&t<r||r>i&&r>s&&r>t?(It[0]=u.xH.NorthEast,It[1]=vt.Up,It):r<i&&r<s&&r<t||t>i&&t>s&&t>r?(It[0]=u.xH.SouthWest,It[1]=vt.Up,It):(It[0]=u.xH.North,It[1]=vt.Up,It)}(_t),o=zt[a[0]];t.vars.animation.setAll(a[1]),i.uvs.vertices[ie.TopRight].x=o[0][0],i.uvs.vertices[ie.TopRight].y=o[0][1],i.uvs.vertices[ie.TopLeft].x=o[1][0],i.uvs.vertices[ie.TopLeft].y=o[1][1],i.uvs.vertices[ie.BottomLeft].x=o[2][0],i.uvs.vertices[ie.BottomLeft].y=o[2][1],i.uvs.vertices[ie.BottomRight].x=o[3][0],i.uvs.vertices[ie.BottomRight].y=o[3][1],i.positions.vertices[0].y=Ct.vertices[0]*Vt,i.positions.vertices[1].y=Ct.vertices[1]*Vt,i.positions.vertices[2].y=Ct.vertices[2]*Vt,i.positions.vertices[3].y=Ct.vertices[3]*Vt,De(t,t.origin,i),t.updateBounds(kt[oe.Up])}if(this.isExposed(oe.Down)){s=!0,t.vars.textureIndex=e.stillTexture;const r=Dt[oe.Down];this.determineShading(oe.Down),r.flip=this.shouldFlip(),De(t,t.origin,r),t.updateBounds(kt[oe.Down])}if(this.isExposed(oe.North)){s=!0,t.vars.textureIndex=e.flowTexture;const i=Dt[oe.North];t.vars.animation.setAll(1),this.determineShading(oe.North),i.flip=this.shouldFlip(),r?(i.positions.vertices[ie.TopRight].y=Ct.vertices[bt.NorthWest]*Vt,i.positions.vertices[ie.TopLeft].y=Ct.vertices[bt.NorthEast]*Vt,i.uvs.vertices[ie.TopRight].y=Ct.vertices[bt.NorthWest],i.uvs.vertices[ie.TopLeft].y=Ct.vertices[bt.NorthEast]):(i.positions.vertices[ie.TopRight].y=1,i.positions.vertices[ie.TopLeft].y=1,i.setUVs(Mt)),De(t,t.origin,i),t.updateBounds(kt[oe.North])}if(this.isExposed(oe.South)){s=!0,t.vars.textureIndex=e.flowTexture;const i=Dt[oe.South];t.vars.animation.setAll(1),this.determineShading(oe.South),i.flip=this.shouldFlip(),r?(i.positions.vertices[ie.TopRight].y=Ct.vertices[bt.SouthEsat]*Vt,i.positions.vertices[ie.TopLeft].y=Ct.vertices[bt.SouthWest]*Vt,i.uvs.vertices[ie.TopRight].y=Ct.vertices[bt.SouthEsat],i.uvs.vertices[ie.TopLeft].y=Ct.vertices[bt.SouthWest]):(i.positions.vertices[ie.TopLeft].y=1,i.positions.vertices[ie.TopRight].y=1,i.setUVs(Mt)),De(t,t.origin,i),t.updateBounds(kt[oe.South])}if(this.isExposed(oe.East)){s=!0,t.vars.textureIndex=e.flowTexture;const i=Dt[oe.East];t.vars.animation.setAll(1),this.determineShading(oe.East),i.flip=this.shouldFlip(),r?(i.positions.vertices[ie.TopRight].y=Ct.vertices[bt.NorthEast]*Vt,i.positions.vertices[ie.TopLeft].y=Ct.vertices[bt.SouthEsat]*Vt,i.uvs.vertices[ie.TopRight].y=Ct.vertices[bt.SouthEsat],i.uvs.vertices[ie.TopLeft].y=Ct.vertices[bt.NorthEast]):(i.positions.vertices[ie.TopLeft].y=1,i.positions.vertices[ie.TopRight].y=1,i.setUVs(Mt)),De(t,t.origin,i),t.updateBounds(kt[oe.East])}if(this.isExposed(oe.West)){s=!0,t.vars.textureIndex=e.flowTexture;const i=Dt[oe.West];t.vars.animation.setAll(1),this.determineShading(oe.West),i.flip=this.shouldFlip(),r?(i.positions.vertices[ie.TopRight].y=Ct.vertices[bt.SouthWest]*Vt,i.positions.vertices[ie.TopLeft].y=Ct.vertices[bt.NorthWest]*Vt,i.uvs.vertices[ie.TopRight].y=Ct.vertices[bt.SouthWest],i.uvs.vertices[ie.TopLeft].y=Ct.vertices[bt.NorthWest]):(i.positions.vertices[ie.TopLeft].y=1,i.positions.vertices[ie.TopRight].y=1,i.setUVs(Mt)),De(t,t.origin,i),t.updateBounds(kt[oe.West])}return this.builder.vars.light.setAll(0),s}}var Ft,Rt,Ut=s(61886),Et=s(50556);class Pt{data;view;constructor(e){this.data=e,this.view=new Uint8Array(e.buffer)}getValue(e,t,s){return q.u.getBitArrayIndex(this.view,this.data.resultsSize*e+t,s)}setValue(e,t,s,r=1){q.u.setBitArrayIndex(this.view,this.data.resultsSize*e+t,s,r)}}class Ht{model;effects=[];constructor(e){this.model=e;for(const t of e.data.effects)"fx-points"==t.type&&this.effects.push({id:t.effectId,reader:new Et.z(e.schema,0,t.tree),palette:t.treePalette})}addEffects(e,t,s){if(this.effects.length)for(let r=0;r<this.effects.length;r++){const i=this.effects[r];let a=s[i.id];a||(a=[],s[i.id]=a);const o=i.reader.getState(e);if(-1==o)continue;const n=i.palette[o];if(!n)continue;let l=a.length;for(let e=0;e<n.length;e++){const s=n[e];a[l]=t.x+s[0],a[l+1]=t.y+s[1],a[l+2]=t.z+s[2],l+=3}}}}!function(e){e[e.Equals=0]="Equals",e[e.NotEquals=1]="NotEquals",e[e.GreaterThan=2]="GreaterThan",e[e.LessThan=3]="LessThan"}(Ft||(Ft={})),function(e){e[e.And=0]="And",e[e.Or=1]="Or"}(Rt||(Rt={})),Ft.Equals,Ft.NotEquals,Ft.GreaterThan,Ft.LessThan,Rt.And,Rt.Or;class Gt{schema;statement;constructor(e,t){this.schema=e,this.statement=t}getValue(e){let t=-1,s=!1,r=!1;for(let e=0;e<this.statement.length;e++){const i=this.statement[e];if(i==Rt.And||i==Rt.Or){t=i;continue}const a=this.schema.nodes[i[0]].getValue(this.schema.voxel.getState());switch(i[1]){case Ft.Equals:r=a==i[2];break;case Ft.NotEquals:r=a!=i[2];break;case Ft.GreaterThan:r=a>=i[2];break;case Ft.LessThan:r=a<=i[2]}if(-1!=t)switch(t){case Rt.And:s=s&&r;break;case Rt.Or:s=s||r}else s=r}return s}}class Ot{schema;tree;statements=[];constructor(e,t,s){this.schema=e,this.tree=s;for(const s of t)this.statements.push(new Gt(e,s))}getState(){if(!this.tree.length)return-1;let e=this.tree;for(let t=0;t<this.statements.length;t++)e=e[this.statements[t].getValue(this)?1:0];return e}}class Qt{id;builder;data;isModel=!0;geometries=[];modSchema;modTree;transparentIndex;baseInputMap;conditonalInputMap;schema;effects;stateTree;condtioanlShapeStateTree;constructor(e,t,s,r){this.id=e,this.builder=t,this.data=s,this.baseInputMap=r.baseGeometryInputMap,this.conditonalInputMap=r.condiotnalGeometryInputMap,this.transparentIndex=new Pt(r.transparentFaceIndex),this.schema=new Ut.X(s.schema),this.stateTree=new Et.z(this.schema,0,s.stateTree),this.condtioanlShapeStateTree=new Ot(this.schema,s.condiotnalStatements,s.condiotnalStateTree),this.modSchema=new Ut.X(r.modSchema),this.modTree=new Et.z(this.modSchema,0,r.modStateTree),this.effects=new Ht(this)}isShapeStateFaceTransparent(e,t,s,r){return 1==this.transparentIndex.getValue(e,this.data.relativeGeometryByteIndexMap[this.data.stateRelativeGeometryMap[t][s]],r)}isCondtionalStateFaceTransparent(e,t,s,r){return 1==this.transparentIndex.getValue(e,this.data.relativeGeometryByteIndexMap[this.data.condiotnalShapeStateRelativeGeometryMap[t][s]],r)}process(){let e=!1;const t=this.builder,s=t.space.getHash(t.nVoxel,t.position.x,t.position.y,t.position.z),r=t.space.stateCache[s],i=t.space.modCache[s];if(r>-1){const t=this.data.stateMap[r],s=this.data.stateGeometryMap[r],a=t.length,o=this.baseInputMap[i][r];for(let r=0;r<a;r++){const i=o[t[r]],a=Ze.geometry[s[r]],n=a.nodes.length;for(let t=0;t<n;t++){const s=a.nodes[t];s.builder=this.builder,s.add(i[t])&&(e=!0)}}}const a=t.space.conditonalStateCache[s];if(a>-1){const t=this.data.condiotnalShapeStateMap[a],s=t.length;for(let r=0;r<s;r++){const s=t[r],a=s.length,o=this.conditonalInputMap[i][r];for(let t=0;t<a;t++){const r=s[t],i=o[t],a=Ze.geometry[this.data.geoLinkMap[r]],n=a.nodes.length;for(let t=0;t<n;t++){const s=a.nodes[t];s.builder=this.builder,s.add(i[t])&&(e=!0)}}}}return this.effects.addEffects(t.voxel.getState(),t.origin,t.effects),t.clearCalculatedData(),e}}var Yt,Xt=s(46830),Zt=s(15661),Wt=s(85212);!function(e){e[e.Value=0]="Value",e[e.BitArray=1]="BitArray",e[e.HalfNibbleArray=2]="HalfNibbleArray",e[e.NibbleArray=4]="NibbleArray",e[e.ByteArray=8]="ByteArray",e[e.ShortArray=16]="ShortArray"}(Yt||(Yt={}));class jt{static ByteArrayMax=256;static NibbleArrayMax=16;static HalfNibbleArrayMax=4;static BitArrayMax=2;static DetermineSubByteArray=e=>e==jt.BitArrayMax?Yt.BitArray:e>jt.BitArrayMax&&e<=jt.HalfNibbleArrayMax?Yt.HalfNibbleArray:e>jt.HalfNibbleArrayMax&&e<=jt.NibbleArrayMax?Yt.NibbleArray:e>jt.NibbleArrayMax&&e<=jt.ByteArrayMax?Yt.ByteArray:null;static CreateBufferForType(e,t){return e==Yt.ShortArray?new Uint16Array(t):new Uint8Array(t)}static GetConvertedBufferSize(e,t){return t==Yt.ShortArray||t==Yt.ByteArray?e.length:t==Yt.BitArray?e.length/8:t==Yt.HalfNibbleArray?e.length/4:t==Yt.NibbleArray?e.length/2:t==Yt.Value?1:e.length}static GetIndexLength(e,t){return t==Yt.ShortArray||t==Yt.ByteArray?e.length:t==Yt.BitArray?8*e.length:t==Yt.HalfNibbleArray?4*e.length:t==Yt.NibbleArray?2*e.length:t==Yt.Value?1:e.length}static ReadBufferAtIndex(e,t,s){return t==Yt.ShortArray||t==Yt.ByteArray?e[s]:t==Yt.BitArray?(0,Wt.Tv)(e,s):t==Yt.NibbleArray?(0,Wt.wu)(e,s):t==Yt.HalfNibbleArray?(0,Wt.pL)(e,s):e[s]}static SetBufferAtIndex(e,t,s,r){return t==Yt.ShortArray||t==Yt.ByteArray?e[s]=r:t==Yt.BitArray?(0,Wt.JU)(e,s,r):t==Yt.NibbleArray?(0,Wt.A8)(e,s,r):t==Yt.HalfNibbleArray?(0,Wt.rW)(e,s,r):e[s]}static Convert(e,t,s){if(t==s||t==Yt.ShortArray&&s==Yt.ByteArray||t==Yt.ByteArray&&s==Yt.ShortArray){const t=this.CreateBufferForType(s,this.GetConvertedBufferSize(e,s));return t.set(e),t}const r=this.GetIndexLength(e,t),i=this.CreateBufferForType(s,this.GetConvertedBufferSize(e,s));for(let a=0;a<r;a++)this.SetBufferAtIndex(i,s,a,this.ReadBufferAtIndex(e,t,a));return i}static Create(e){return{buffer:0,type:Yt.Value,...e}}bufferView;constructor(e){this.buffer=e.buffer,this.type=e.type,"number"!=typeof this.buffer&&(this.type==Yt.ShortArray?this.bufferView=new Uint16Array(this.buffer):this.bufferView=new Uint8Array(this.buffer))}getValue(e){return"number"==typeof this.buffer?this.buffer:jt.ReadBufferAtIndex(this.bufferView,this.type,e)}toJSON(){return{buffer:this.buffer,type:this.type}}}const qt=new k.$,$t=["sun","red","green","blue"],Kt={sun:e=>qt.getS(e),red:e=>qt.getR(e),green:e=>qt.getG(e),blue:e=>qt.getB(e)},Jt={sun:(e,t)=>qt.setS(e,t),red:(e,t)=>qt.setR(e,t),green:(e,t)=>qt.setG(e,t),blue:(e,t)=>qt.setB(e,t)},es="0123456789ABCDEF";function ts(e){if(e<0||e>65535)throw new RangeError("Value must be a 16-bit unsigned integer.");const t=[];for(let s=0;s<4;s++){const r=e>>4*s&15;t.unshift(es[r])}return t.join("").replace(/^0+(?!$)/,"")}function ss(e,t){const s=new Uint8Array(t.length/2);for(let r=0;r<t.length;r++){let i=0;"sun"==e&&(i=qt.getS(t[r])),"red"==e&&(i=qt.getR(t[r])),"green"==e&&(i=qt.getG(t[r])),"blue"==e&&(i=qt.getB(t[r])),(0,Wt.A8)(s,r,i)}return s}var rs=s(15741);class is{buffer;constructor(e){this.buffer=e}allTheSame=!0;isPaletted=!1;remapped=!1;value=0}class as{ids=new rs.h;level=new rs.h;light=new ns;maxStatePaletteSize=0;state={};secondaryState={};maxModPaletteSize=0;mod={};secondaryMod={};secondaryId=new rs.h;secondaryValue=new rs.h}class os{original;palettes=new as;isBuriedAllTheSame=!1;buriedValue=0;isVoxelMapAllTheSame=!1;voxelMapValue=0;isDirtyMapAllTheSame=!1;dirtyMapValue=0;ids;light;level;state;mod;secondary;constructor(e){this.original=e,this.ids=new is(new Uint16Array(e.ids.length)),this.level=new is(new Uint8Array(e.level.length)),this.light={sun:new is(new Uint8Array(e.light.length)),red:new is(new Uint8Array(e.light.length)),green:new is(new Uint8Array(e.light.length)),blue:new is(new Uint8Array(e.light.length))},this.state=new is(new Uint16Array(e.state.length)),this.mod=new is(new Uint16Array(e.mod.length)),this.secondary=new is(new Uint16Array(e.mod.length))}}class ns{sun=new rs.h;red=new rs.h;green=new rs.h;blue=new rs.h}class ls{palette=new rs.h;states=[]}class ds{ids=new Q.N;level=new rs.h;light=new ns;stateMap=[];secondaryStateMap=[];maxStatePaletteSize=0;modMap=[];secondaryModMap=[];maxModPaletteSize=0;secondaryId=new Q.N;secondaryValue=new rs.h}function hs(e,t){const s={};if(e.ids.remapped&&(s.id=Uint16Array.from(e.palettes.ids._palette)),e.level.remapped&&(s.level=Uint8Array.from(e.palettes.level._palette)),e.light.sun.remapped&&(s.light??={},s.light.sun=Uint8Array.from(e.palettes.light.sun._palette)),e.light.red.remapped&&(s.light??={},s.light.red=Uint8Array.from(e.palettes.light.red._palette)),e.light.green.remapped&&(s.light??={},s.light.green=Uint8Array.from(e.palettes.light.green._palette)),e.light.blue.remapped&&(s.light??={},s.light.blue=Uint8Array.from(e.palettes.light.blue._palette)),e.state.remapped){for(const t in e.palettes.state)s.state??=[],s.state[t]=Uint16Array.from(e.palettes.state[t]._palette);for(const t in e.palettes.secondaryState)s.secondaryState??=[],s.secondaryState[t]=Uint16Array.from(e.palettes.secondaryState[t]._palette)}if(e.mod.remapped){for(const t in e.palettes.mod)s.mod??=[],s.mod[t]=Uint16Array.from(e.palettes.mod[t]._palette);for(const t in e.palettes.secondaryMod)s.secondaryMod??=[],s.secondaryMod[t]=Uint16Array.from(e.palettes.secondaryMod[t]._palette)}e.secondary.remapped&&(s.secondaryId=Uint16Array.from(e.palettes.secondaryId._palette),s.secondaryValue=Uint16Array.from(e.palettes.secondaryValue._palette));const r={};if(e.ids.allTheSame)0!==e.ids.buffer[0]&&(r.id=e.ids.buffer[0]);else if(e.ids.isPaletted){const s=jt.DetermineSubByteArray(e.ids.remapped?e.palettes.ids.size:t.ids.size);r.id=jt.Create({buffer:jt.Convert(e.ids.buffer,Yt.ShortArray,s).buffer,type:s})}else r.id=jt.Create({buffer:e.ids.buffer.buffer,type:Yt.ShortArray});if(e.level.allTheSame)0!==e.level.buffer[0]&&(r.level=e.level.buffer[0]);else if(e.level.isPaletted){const s=jt.DetermineSubByteArray(e.level.remapped?e.palettes.level.size:t.level.size);r.level=jt.Create({buffer:jt.Convert(e.level.buffer,Yt.ByteArray,s).buffer,type:s})}else r.level=jt.Create({buffer:e.original.level.slice().buffer,type:Yt.ByteArray});for(const s of $t)if(e.light[s].allTheSame)0!==e.light[s].value&&(r.light??={},r.light[s]=e.light[s].value);else if(e.light[s].isPaletted){const i=jt.DetermineSubByteArray(e.light[s].remapped?e.palettes.light[s].size:t.light[s].size);r.light??={},r.light[s]=jt.Create({buffer:jt.Convert(e.light[s].buffer,Yt.ByteArray,i).buffer,type:i})}else r.light??={},r.light[s]=jt.Create({buffer:ss(s,e.original.light).buffer,type:Yt.NibbleArray});if(e.state.allTheSame)0!==e.state.buffer[0]&&(r.state=e.state.buffer[0]);else if(e.state.isPaletted){const s=jt.DetermineSubByteArray(e.state.remapped?e.palettes.maxStatePaletteSize:t.maxStatePaletteSize);r.state=jt.Create({buffer:jt.Convert(e.state.buffer,Yt.ShortArray,s).buffer,type:s})}else r.state=jt.Create({buffer:e.state.buffer.buffer,type:Yt.ShortArray});if(e.mod.allTheSame)0!==e.mod.buffer[0]&&(r.mod=e.mod.buffer[0]);else if(e.mod.isPaletted){const s=jt.DetermineSubByteArray(e.mod.remapped?e.palettes.maxModPaletteSize:t.maxModPaletteSize);r.mod=jt.Create({buffer:jt.Convert(e.mod.buffer,Yt.ShortArray,s).buffer,type:s})}else r.mod=jt.Create({buffer:e.mod.buffer.buffer,type:Yt.ShortArray});if(e.secondary.allTheSame)0!==e.secondary.buffer[0]&&(r.secondary=e.secondary.buffer[0]);else if(e.secondary.isPaletted){const s=jt.DetermineSubByteArray(e.secondary.remapped?Math.max(e.palettes.secondaryValue.size,e.palettes.secondaryId.size):Math.max(t.secondaryValue.size,t.secondaryId.size));r.secondary=jt.Create({buffer:jt.Convert(e.secondary.buffer,Yt.ShortArray,s).buffer,type:s})}else r.secondary=jt.Create({buffer:e.secondary.buffer.buffer,type:Yt.ShortArray});e.isBuriedAllTheSame?0!==e.buriedValue&&(r.buried=e.buriedValue):r.buried=e.original.buried.slice(),e.isVoxelMapAllTheSame?0!==e.voxelMapValue&&(r.voxelMap=e.voxelMapValue):r.voxelMap=e.original.voxelMap.slice(),e.isDirtyMapAllTheSame?0!==e.dirtyMapValue&&(r.dirtyMap=e.dirtyMapValue):r.dirtyMap=e.original.dirtyMap.slice();const i=e.original.storeFlags();return{...Object.keys(i).length?{flags:i}:{},...Object.keys(s).length?{palettes:s}:{},buffers:r}}function cs(e,t){if("object"==typeof e&&"object"==typeof t&&Object.keys(e).length!=Object.keys(t).length)return!1;for(const s in e){if(!(s in t))return!1;const r=e[s],i=t[s];if(ArrayBuffer.isView(r)||"object"!=typeof r||null===r||ArrayBuffer.isView(i)||"object"!=typeof i||null===i){if("number"!=typeof r&&"string"!=typeof r&&"number"!=typeof i&&"string"!=typeof i){if(r instanceof Uint8Array||r instanceof Uint16Array){if(!(i instanceof r.constructor))return!1;if(r.length!==i.length)return!1;let e=i;for(let t=0;t<e.length;t++)if(r[t]!=e[t])return!1}}else if(r!==i)return!1}else if(!cs(r,i))return!1}return!0}function us(e,t){return cs(e,t)}const gs=new k.$;function fs(e){const t=n._.sectors.get(e.location[0],e.location[1],e.location[2],e.location[3]);if(!t)throw new Error(`Sector at location ${location} does not exist when trying to arhicve it.`);const s=new ds,r=[];for(let e=0;e<t.sections.length;e++){const i=t.sections[e],a=new os(i);{let e=i.buried[0];a.isBuriedAllTheSame=!0;for(let t=0;t<i.buried.length;t++)if(e!=i.buried[t]){a.isBuriedAllTheSame=!1;break}a.buriedValue=e}{let e=i.voxelMap[0];a.isVoxelMapAllTheSame=!0;for(let t=0;t<i.voxelMap.length;t++)if(e!=i.voxelMap[t]){a.isVoxelMapAllTheSame=!1;break}a.voxelMapValue=e}{let e=i.dirtyMap[0];a.isDirtyMapAllTheSame=!0;for(let t=0;t<i.dirtyMap.length;t++)if(e!=i.dirtyMap[t]){a.isDirtyMapAllTheSame=!1;break}a.dirtyMapValue=e}const o=i.ids[0],n=i.light[0],l=i.level[0],d=i.state[0],h=i.mod[0],c=i.secondary[0],u={sun:gs.getS(n),red:gs.getR(n),green:gs.getG(n),blue:gs.getB(n)},g=i.ids.length;for(let e=0;e<g;e++){const t=Xe.A.voxels.getStringId(i.ids[e]),r=s.ids.isRegistered(t)?s.ids.getNumberId(t):s.ids.register(t);a.ids.value=r,a.palettes.ids.isRegistered(r)||a.palettes.ids.register(r);const n=Zt.L.VoxelTags[i.ids[e]].dve_can_have_secondary&&Xe.A.voxels.getStringId(i.secondary[e]),g=n?s.secondaryId.isRegistered(n)?s.secondaryId.getNumberId(n):s.secondaryId.register(n):s.secondaryValue.isRegistered(i.secondary[e])?s.secondaryValue.getId(i.secondary[e]):s.secondaryValue.register(i.secondary[e]);Zt.L.VoxelTags[i.ids[e]].dve_can_have_secondary?a.palettes.secondaryId.isRegistered(g)||a.palettes.secondaryId.register(g):a.palettes.secondaryValue.isRegistered(g)||a.palettes.secondaryValue.register(g);const f=s.level.isRegistered(i.level[e])?s.level.getId(i.level[e]):s.level.register(i.level[e]);let p;a.palettes.level.isRegistered(i.level[e])||a.palettes.level.register(i.level[e]),n?s.secondaryStateMap[g]?p=s.secondaryStateMap[g]:(p=new ls,s.secondaryStateMap[r]=p):s.stateMap[r]?p=s.stateMap[r]:(p=new ls,s.stateMap[r]=p);let m,y=-1;y=p.palette.isRegistered(i.state[e])?p.palette.getId(i.state[e]):p.palette.register(i.state[e]),a.palettes.state[r]||(a.palettes.state[r]=new rs.h),a.palettes.state[r].isRegistered(y)||a.palettes.state[r].register(y),n?s.secondaryModMap[g]?m=s.secondaryModMap[g]:(m=new ls,s.secondaryModMap[g]=m):s.modMap[r]?m=s.modMap[r]:(m=new ls,s.modMap[g]=m);let x=-1;x=m.palette.isRegistered(i.mod[e])?m.palette.getId(i.mod[e]):m.palette.register(i.mod[e]),a.palettes.mod[r]||(a.palettes.mod[r]=new rs.h),a.palettes.mod[r].isRegistered(x)||a.palettes.mod[r].register(x);for(let t=0;t<$t.length;t++){const r=$t[t],o=Kt[r](i.light[e]);o!=u[r]&&(a.light[r].allTheSame=!1),a.light[r].value=o;const n=s.light[r].isRegistered(o)?s.light[r].getId(o):s.light[r].register(o);a.palettes.light[r].isRegistered(o)||a.palettes.light[r].register(o),a.light[r].buffer[e]=n}i.ids[e]!=o&&(a.ids.allTheSame=!1),i.level[e]!=l&&(a.level.allTheSame=!1),i.state[e]!=d&&(a.state.allTheSame=!1),i.mod[e]!=h&&(a.mod.allTheSame=!1),i.secondary[e]!=c&&(a.secondary.allTheSame=!1),a.ids.buffer[e]=r,a.level.buffer[e]=f,a.state.buffer[e]=y,a.mod.buffer[e]=x,a.secondary.buffer[e]=g}r[e]=a}let i={level:!1,light:{sun:!1,red:!1,green:!1,blue:!1}};for(const e of s.stateMap)e&&e.palette.size>s.maxStatePaletteSize&&(s.maxStatePaletteSize=e.palette.size);for(const e of s.modMap)e&&e.palette.size>s.maxModPaletteSize&&(s.maxModPaletteSize=e.palette.size);for(const e of r){for(const t in e.palettes.state){const s=e.palettes.state[t];s&&s.size>e.palettes.maxStatePaletteSize&&(e.palettes.maxStatePaletteSize=s.size)}for(const t in e.palettes.mod){const s=e.palettes.state[t];s&&s.size>e.palettes.maxModPaletteSize&&(e.palettes.maxModPaletteSize=s.size)}e.ids.isPaletted=s.ids.size<=jt.ByteArrayMax||e.palettes.ids.size<=jt.ByteArrayMax,e.ids.remapped=s.ids.size>jt.ByteArrayMax&&e.palettes.ids.size<=jt.ByteArrayMax&&!e.ids.allTheSame,e.level.isPaletted=s.level.size<=jt.NibbleArrayMax&&e.palettes.level.size<=jt.NibbleArrayMax,e.level.remapped=s.level.size>jt.NibbleArrayMax&&e.palettes.level.size<=jt.NibbleArrayMax&&!e.level.allTheSame,e.level.isPaletted&&!e.level.remapped&&(i.level=!0),e.state.isPaletted=s.maxStatePaletteSize<=jt.ByteArrayMax||e.palettes.maxStatePaletteSize<=jt.ByteArrayMax,e.state.remapped=s.maxStatePaletteSize>jt.ByteArrayMax&&e.palettes.maxStatePaletteSize<=jt.ByteArrayMax&&!e.state.allTheSame,e.mod.isPaletted=s.maxModPaletteSize<=jt.ByteArrayMax||e.palettes.maxModPaletteSize<=jt.ByteArrayMax,e.mod.remapped=s.maxModPaletteSize>jt.ByteArrayMax&&e.palettes.maxModPaletteSize<=jt.ByteArrayMax&&!e.mod.allTheSame;for(const t of $t)e.light[t].isPaletted=s.light[t].size<=jt.HalfNibbleArrayMax||e.palettes.light[t].size<=jt.HalfNibbleArrayMax,e.light[t].remapped=s.light[t].size>jt.HalfNibbleArrayMax&&e.palettes.light[t].size<=jt.HalfNibbleArrayMax&&!e.light[t].allTheSame,e.light[t].isPaletted&&!e.light[t].remapped&&(i.light[t]=!0);if(e.secondary.isPaletted=s.secondaryValue.size<=jt.ByteArrayMax&&s.secondaryId.size<=jt.ByteArrayMax||e.palettes.secondaryValue.size<=jt.ByteArrayMax&&e.palettes.secondaryId.size<=jt.ByteArrayMax,e.secondary.remapped=Math.max(s.secondaryValue.size,s.secondaryId.size)>jt.ByteArrayMax&&Math.max(e.palettes.secondaryId.size,e.palettes.secondaryValue.size)<=jt.ByteArrayMax&&!e.secondary.allTheSame,!(e.ids.remapped||e.light.sun.remapped||e.light.red.remapped||e.light.green.remapped||e.light.blue.remapped||e.secondary.remapped||e.mod.remapped||e.level.remapped))continue;const t=e.original.ids.length;for(let r=0;r<t;r++){let t=!1;Zt.L.VoxelTags[e.original.ids[r]].dve_can_have_secondary&&0!==e.original.secondary[r]&&(t=!0);let i=t?e.secondary.buffer[r]:e.ids.buffer[r];e.state.remapped&&(e.state.buffer[r]=e.palettes.state[i].getId(s.stateMap[i].palette.getId(e.state.buffer[r]))),e.mod.remapped&&(e.mod.buffer[r]=e.palettes.mod[i].getId(s.modMap[e.ids.buffer[r]].palette.getId(i))),e.ids.remapped&&(e.ids.buffer[r]=e.palettes.ids.getId(i));for(let t=0;t<$t.length;t++){const s=$t[t];e.light[s].remapped&&(e.light[s].buffer[r]=e.palettes.light[s].getId(Kt[s](e.original.light[r])))}e.level.remapped&&(e.level.buffer[r]=e.palettes.level.getId(e.original.level[r])),e.secondary.remapped&&(e.secondary.buffer[r]=t?e.palettes.secondaryId.getId(e.secondary.buffer[r]):e.palettes.secondaryValue.getId(e.secondary.buffer[r]))}}const a={id:s.ids._palette,stateMap:[],secondaryStateMap:[],modMap:[],secondaryModMap:[],light:{},secondaryId:s.secondaryId._palette,secondaryValue:new Uint16Array(s.secondaryValue._palette)},o=a.stateMap;for(let e=0;e<s.stateMap.length;e++){const t=s.stateMap[e]?.palette;if(!t)continue;const r=s.ids._palette[e];if(!Xt.r.hasVoxelSchema(r))continue;const i=Xt.r.getVoxelSchemas(r),a=[];o[e]=a;for(let e=0;e<t._palette.length;e++)a[e]=i.state.getStateObject(t._palette[e])}const l=a.secondaryStateMap;for(let e=0;e<s.secondaryStateMap.length;e++){const t=s.secondaryStateMap[e]?.palette;if(!t)continue;const r=s.secondaryId._palette[e];if(!Xt.r.hasVoxelSchema(r))continue;const i=Xt.r.getVoxelSchemas(r),a=[];l[e]=a;for(let e=0;e<t._palette.length;e++)a[e]=i.state.getStateObject(t._palette[e])}const d=a.modMap;for(let e=0;e<s.modMap.length;e++){const t=s.modMap[e]?.palette;if(!t)continue;const r=s.ids._palette[e];if(!Xt.r.hasVoxelSchema(r))continue;const i=Xt.r.getVoxelSchemas(r),a=[];d[e]=a;for(let e=0;e<t._palette.length;e++)a[e]=i.mod.getStateObject(t._palette[e])}const h=a.modMap;for(let e=0;e<s.secondaryModMap.length;e++){const t=s.secondaryModMap[e]?.palette;if(!t)continue;const r=s.secondaryId._palette[e];if(!Xt.r.hasVoxelSchema(r))continue;const i=Xt.r.getVoxelSchemas(r),a=[];h[e]=a;for(let e=0;e<t._palette.length;e++)a[e]=i.mod.getStateObject(t._palette[e])}const c=[];for(let e=0;e<r.length;e++)c[e]=hs(r[e],s);i.level&&(a.level=new Uint8Array(s.level._palette));for(const e of $t)i.light[e]&&(a.light[e]=new Uint8Array(s.light[e]._palette));const u={version:"",vloxVersion:v.i.version,dimension:n._.dimensions.get(e.location[0]).id,location:[e.location[1],e.location[2],e.location[3]],flags:t.storeFlags(),timestamps:t.storeTimestamps(),buffers:{},palettes:a,duplicates:{},sections:c};return function(e){const t=new Map;let s=[];for(let r=0;r<e.sections.length;r++)for(let i=r+1;i<e.sections.length;i++){const a=e.sections[r],o=e.sections[i];if("string"==typeof a||"string"==typeof o)continue;let n=-1;if(us(a,o)){if(t.has(o))n=t.get(o)[1];else{let e=!1;for(let t=0;t<s.length;t++)us(a,s[t])&&(n=t,e=!0);e||(s.push(a),n=s.length-1)}t.set(a,[r,n])}}const r={};for(let s=0;s<e.sections.length;s++){const i=e.sections[s];if(t.has(i)){const[,a]=t.get(i),o=ts(a);e.sections[s]=o,r[o]=i}}e.duplicates={sections:r}}(u),u}class ps{ids;level;light;state;mod;secondary;constructor(e){this.ids=e.buffers.id?"number"==typeof e.buffers.id?new jt({buffer:e.buffers.id,type:Yt.Value}):new jt(e.buffers.id):new jt({buffer:0,type:Yt.Value}),this.level=e.buffers.level?"number"==typeof e.buffers.level?new jt({buffer:e.buffers.level,type:Yt.Value}):new jt(e.buffers.level):new jt({buffer:0,type:Yt.Value}),this.light={sun:e.buffers.light?.sun?"number"==typeof e.buffers.light.sun?new jt({buffer:e.buffers.light.sun,type:Yt.Value}):new jt(e.buffers.light.sun):new jt({buffer:0,type:Yt.Value}),red:e.buffers.light?.red?"number"==typeof e.buffers.light.red?new jt({buffer:e.buffers.light.red,type:Yt.Value}):new jt(e.buffers.light.red):new jt({buffer:0,type:Yt.Value}),green:e.buffers.light?.green?"number"==typeof e.buffers.light.green?new jt({buffer:e.buffers.light.green,type:Yt.Value}):new jt(e.buffers.light.green):new jt({buffer:0,type:Yt.Value}),blue:e.buffers.light?.blue?"number"==typeof e.buffers.light.blue?new jt({buffer:e.buffers.light.blue,type:Yt.Value}):new jt(e.buffers.light.blue):new jt({buffer:0,type:Yt.Value})},this.state=e.buffers.state?"number"==typeof e.buffers.state?new jt({buffer:e.buffers.state,type:Yt.Value}):new jt(e.buffers.state):new jt({buffer:0,type:Yt.Value}),this.mod=e.buffers.mod?"number"==typeof e.buffers.mod?new jt({buffer:e.buffers.mod,type:Yt.Value}):new jt(e.buffers.mod):new jt({buffer:0,type:Yt.Value}),this.secondary=e.buffers.secondary?"number"==typeof e.buffers.secondary?new jt({buffer:e.buffers.secondary,type:Yt.Value}):new jt(e.buffers.secondary):new jt({buffer:0,type:Yt.Value})}}class ms{id;level;light;state;secondaryState;mod;secondaryMod;secondaryId;secondaryValue;constructor(e){if(this.id=e.palettes?.id?new rs.h(e.palettes?.id):void 0,this.light={sun:e.palettes?.light?.sun?new rs.h(e.palettes?.light?.sun):null,red:e.palettes?.light?.red?new rs.h(e.palettes?.light?.red):null,green:e.palettes?.light?.green?new rs.h(e.palettes?.light?.green):null,blue:e.palettes?.light?.blue?new rs.h(e.palettes?.light?.blue):null},this.level=e.palettes?.level?new rs.h(e.palettes?.level):void 0,e.palettes?.state)for(const t in e.palettes.state)this.state??=[],this.state[t]=new rs.h(e.palettes.state[t]);if(e.palettes?.mod)for(const t in e.palettes.mod)this.mod??=[],this.mod[t]=new rs.h(e.palettes.mod[t]);this.secondaryValue=e.palettes?.secondaryValue?new rs.h(e.palettes?.secondaryValue):void 0,this.secondaryId=e.palettes?.secondaryId?new rs.h(e.palettes?.secondaryId):void 0}}class ys{sectionIndex;sector;section;buffers;palettes;constructor(e,t,s){this.sectionIndex=e,this.sector=t,this.section=s,this.buffers=new ps(s),this.palettes=new ms(s)}getId(e){const t=this.buffers.ids.getValue(e);return this.buffers.ids.type==Yt.Value?Xe.A.voxels.getNumberId(this.sector.palettes.id.getStringId(t)):this.palettes.id?Xe.A.voxels.getNumberId(this.sector.palettes.id.getStringId(this.palettes.id.getValue(t))):Xe.A.voxels.getNumberId(this.sector.palettes.id.getStringId(t))}getLight(e){let t=0;for(let s=0;s<$t.length;s++){const r=$t[s];let i=0;this.buffers.light[r].type==Yt.Value||this.buffers.light[r].type==Yt.NibbleArray?i=this.buffers.light[r].getValue(e):this.palettes.light[r]?i=this.palettes.light[r].getValue(this.buffers.light[r].getValue(e)):this.sector.palettes.light[r]&&(i=this.sector.palettes.light[r].getValue(this.buffers.light[r].getValue(e))),t=Jt[r](i,t)}return t}getLevel(e){const t=this.buffers.level.getValue(e);return this.palettes.level?this.palettes.level.getValue(t):this.sector.palettes.level?this.sector.palettes.level.getValue(t):t}getSecondary(e){const t=this.getId(e),s=this.buffers.secondary.getValue(e);return Zt.L.VoxelTags[t].dve_can_have_secondary?this.palettes.secondaryId?Xe.A.voxels.getNumberId(this.sector.palettes.secondaryId.getStringId(this.palettes.secondaryId.getValue(s))):Xe.A.voxels.getNumberId(this.sector.sector.palettes.secondaryId[s]):"number"==typeof this.section.buffers.secondary?s:this.palettes.secondaryValue&&this.sector.palettes.secondaryValue?this.sector.palettes.secondaryValue.getValue(this.palettes.secondaryValue.getValue(s)):this.sector.palettes.secondaryValue?this.sector.palettes.secondaryValue.getId(s):s}getState(e){const t=this.buffers.state.getValue(e);let s=t,r=Xe.A.voxels.getStringId(this.getId(e));if(Zt.L.VoxelTags[this.getId(e)].dve_can_have_secondary&&this.getSecondary(e)>0){r=Xe.A.voxels.getStringId(this.getSecondary(e));let i=this.sector.palettes.secondaryId.getNumberId(r);const a=this.sector.palettes.secondaryState[i];if(!a)return 0;s=this.buffers.state.type==Yt.Value?a[t]:this.section.palettes?.secondaryState?a[this.section.palettes?.secondaryState[i][t]]:a[t]}else{let e=this.sector.palettes.id.getNumberId(r);const i=this.sector.palettes.state[e];if(!i)return 0;s=this.buffers.state.type==Yt.Value?i[t]:this.section.palettes?.state?i[this.section.palettes?.state[e][t]]:i[t]}return s}getMod(e){const t=this.buffers.mod.getValue(e);let s=t,r=Xe.A.voxels.getStringId(this.getId(e));if(Zt.L.VoxelTags[this.getId(e)].dve_can_have_secondary&&this.getSecondary(e)>0){r=Xe.A.voxels.getStringId(this.getSecondary(e));let i=this.sector.palettes.secondaryId.getNumberId(r);const a=this.sector.palettes.secondaryMod[i];if(!a)return 0;s=this.buffers.mod.type==Yt.Value?a[t]:this.section.palettes?.secondaryMod?a[this.section.palettes?.secondaryMod[i][t]]:a[t]}else{let e=this.sector.palettes.id.getNumberId(r);const i=this.sector.palettes.mod[e];if(!i)return 0;s=this.buffers.mod.type==Yt.Value?i[t]:this.section.palettes?.mod?i[this.section.palettes?.mod[e][t]]:i[t]}return s}}class xs{id;secondaryId;secondaryValue;level;light;state=[];secondaryState=[];mod=[];secondaryMod=[];constructor(e){for(let t=0;t<e.palettes.id.length;t++){const s=e.palettes.id[t];if(!Xt.r.hasVoxelSchema(s))continue;const r=Xt.r.getVoxelSchemas(s),i=e.palettes.stateMap[t];if(i){const e=[];for(let t=0;t<i.length;t++)e[t]=r.state.fromStateObject(i[t]);this.state[t]=e}const a=e.palettes.modMap[t];if(a){const e=[];for(let t=0;t<a.length;t++)e[t]=r.mod.fromStateObject(a[t]);this.mod[t]=e}}for(let t=0;t<e.palettes.secondaryId.length;t++){const s=e.palettes.secondaryId[t];if(!Xt.r.hasVoxelSchema(s))continue;const r=Xt.r.getVoxelSchemas(s),i=e.palettes.secondaryStateMap[t];if(i){const e=[];for(let t=0;t<i.length;t++)e[t]=r.state.fromStateObject(i[t]);this.secondaryState[t]=e}const a=e.palettes.secondaryModMap[t];if(a){const e=[];for(let t=0;t<a.length;t++)e[t]=r.mod.fromStateObject(a[t]);this.secondaryMod[t]=e}}this.id=new Q.N(e.palettes.id),this.secondaryId=new Q.N(e.palettes.secondaryId),this.secondaryValue=new rs.h(e.palettes.secondaryValue),this.level=e.palettes.level?new rs.h(e.palettes.level):void 0,this.light={sun:e.palettes.light.sun?new rs.h(e.palettes.light.sun):null,red:e.palettes.light.red?new rs.h(e.palettes.light.red):null,green:e.palettes.light.green?new rs.h(e.palettes.light.green):null,blue:e.palettes.light.blue?new rs.h(e.palettes.light.blue):null}}}class vs{sector;sections=[];palettes;constructor(e){this.sector=e,this.palettes=new xs(e);for(let t=0;t<e.sections.length;t++){const s=e.sections[t],r="string"==typeof s?e.duplicates?.sections?.[s]:s;this.sections[t]=new ys(t,this,r)}}}function bs(e,t){const s=new A.h(A.h.CreateNew(),[e.location[0],e.location[1],e.location[2]]);s.loadFlags(e.flags),s.loadTimestamps(e.timestamps);const r=new vs(e);for(const e of r.sections){const t=e.section,r=s.sections[e.sectionIndex];if(t.flags&&r.loadFlags(t.flags),ArrayBuffer.isView(t.buffers.buried))for(let e=0;e<r.buried.length;e++)r.buried[e]=t.buffers.buried[e];else for(let e=0;e<r.buried.length;e++)r.buried[e]=t.buffers.buried||0;if(ArrayBuffer.isView(t.buffers.voxelMap))for(let e=0;e<r.voxelMap.length;e++)r.voxelMap[e]=t.buffers.voxelMap[e];else for(let e=0;e<r.voxelMap.length;e++)r.voxelMap[e]=t.buffers.voxelMap||0;if(ArrayBuffer.isView(t.buffers.dirtyMap))for(let e=0;e<r.dirtyMap.length;e++)r.dirtyMap[e]=t.buffers.dirtyMap[e];else for(let e=0;e<r.dirtyMap.length;e++)r.dirtyMap[e]=t.buffers.dirtyMap||0;for(let t=0;t<r.ids.length;t++)r.ids[t]=e.getId(t),r.level[t]=e.getLevel(t),r.light[t]=e.getLight(t),r.secondary[t]=e.getSecondary(t),r.state[t]=e.getState(t),r.mod[t]=e.getMod(t)}return s.setBitFlag(A.h.FlagIds.stored,!0),s}var ws,As=s(85860);!function(e){e[e.Name=0]="Name",e[e.Object=1]="Object",e[e.ObjectEnd=2]="ObjectEnd",e[e.Array=3]="Array",e[e.ArrayEnd=4]="ArrayEnd",e[e.Int8=5]="Int8",e[e.Uint8=6]="Uint8",e[e.Uint8Clamped=7]="Uint8Clamped",e[e.Int16=8]="Int16",e[e.Uint16=9]="Uint16",e[e.Float32=10]="Float32",e[e.Int32=11]="Int32",e[e.Uint32=12]="Uint32",e[e.Float64=13]="Float64",e[e.BigInt=14]="BigInt",e[e.BigUint=15]="BigUint",e[e.String=16]="String",e[e.Boolean=17]="Boolean",e[e.Undefined=18]="Undefined",e[e.ArrayBuffer=19]="ArrayBuffer",e[e.TypedArray=20]="TypedArray",e[e.Json=21]="Json",e[e.Blob=22]="Blob"}(ws||(ws={}));const Ss={[ws.Int8]:As.QI.Int8,[ws.Uint8]:As.QI.Uint8,[ws.Uint8Clamped]:As.QI.Uint8Clamped,[ws.Int16]:As.QI.Int16,[ws.Uint16]:As.QI.Uint16,[ws.Float32]:As.QI.Float32,[ws.Int32]:As.QI.Int32,[ws.Uint32]:As.QI.Uint32,[ws.Float64]:As.QI.Float64,[ws.BigInt]:As.QI.BigInt,[ws.BigUint]:As.QI.BigUint};class Bs{data;get length(){return this.data[2]}get marker(){return this.data[0]}get numberType(){return Ss[this.marker]}get listType(){return this.data[1]}get value(){return this.data[3]}set value(e){this.data[3]=e}constructor(e,t,s=0,r=0){this.data=[e,s,r,t]}}class Is{static json(e){return new Bs(ws.Json,e)}static object(e){return new Bs(ws.Object,e)}static array(e){if(!Array.isArray(e))throw new Error("Data for array must be an array.");return new Bs(ws.Array,e)}static int8(e){return new Bs(ws.Int8,e)}static uIint8(e){return new Bs(ws.Uint8,e)}static int16(e){return new Bs(ws.Int16,e)}static uint16(e){return new Bs(ws.Uint16,e)}static uint32(e){return new Bs(ws.Uint32,e)}static int32(e){return new Bs(ws.Int32,e)}static float32(e){return new Bs(ws.Float32,e)}static float64(e){return new Bs(ws.Float64,e)}static bingInt(e){return new Bs(ws.BigInt,e)}static bigUint(e){return new Bs(ws.BigUint,e)}static boolean(e){return new Bs(ws.Boolean,e)}static undefined(){return new Bs(ws.Undefined,void 0)}static arrayBuffer(e){return new Bs(ws.ArrayBuffer,e)}static typedArray(e,t){return new Bs(ws.TypedArray,ArrayBuffer.isView(t)?t:TypedArrayMap[e].from(t),e)}static string(e){return new Bs(ws.String,e)}}var Cs=s(34135);const _s={[As.QI.Int8]:(e,t=!1)=>new Int8Array(t?new SharedArrayBuffer(e*Int8Array.BYTES_PER_ELEMENT):new ArrayBuffer(e*Int8Array.BYTES_PER_ELEMENT)),[As.QI.Uint8]:(e,t=!1)=>new Uint8Array(t?new SharedArrayBuffer(e*Uint8Array.BYTES_PER_ELEMENT):new ArrayBuffer(e*Uint8Array.BYTES_PER_ELEMENT)),[As.QI.Uint8Clamped]:(e,t=!1)=>new Uint8ClampedArray(t?new SharedArrayBuffer(e*Uint8ClampedArray.BYTES_PER_ELEMENT):new ArrayBuffer(e*Uint8ClampedArray.BYTES_PER_ELEMENT)),[As.QI.Int16]:(e,t=!1)=>new Int16Array(t?new SharedArrayBuffer(e*Int16Array.BYTES_PER_ELEMENT):new ArrayBuffer(e*Int16Array.BYTES_PER_ELEMENT)),[As.QI.Uint16]:(e,t=!1)=>new Uint16Array(t?new SharedArrayBuffer(e*Uint16Array.BYTES_PER_ELEMENT):new ArrayBuffer(e*Uint16Array.BYTES_PER_ELEMENT)),[As.QI.Int32]:(e,t=!1)=>new Int32Array(t?new SharedArrayBuffer(e*Int32Array.BYTES_PER_ELEMENT):new ArrayBuffer(e*Int32Array.BYTES_PER_ELEMENT)),[As.QI.Uint32]:(e,t=!1)=>new Uint32Array(t?new SharedArrayBuffer(e*Uint32Array.BYTES_PER_ELEMENT):new ArrayBuffer(e*Uint32Array.BYTES_PER_ELEMENT)),[As.QI.Float32]:(e,t=!1)=>new Float32Array(t?new SharedArrayBuffer(e*Float32Array.BYTES_PER_ELEMENT):new ArrayBuffer(e*Float32Array.BYTES_PER_ELEMENT)),[As.QI.Float64]:(e,t=!1)=>new Float64Array(t?new SharedArrayBuffer(e*Float64Array.BYTES_PER_ELEMENT):new ArrayBuffer(e*Float64Array.BYTES_PER_ELEMENT)),[As.QI.BigInt]:(e,t=!1)=>new BigInt64Array(t?new SharedArrayBuffer(e*BigInt64Array.BYTES_PER_ELEMENT):new ArrayBuffer(e*BigInt64Array.BYTES_PER_ELEMENT)),[As.QI.BigUint]:(e,t=!1)=>new BigUint64Array(t?new SharedArrayBuffer(e*BigUint64Array.BYTES_PER_ELEMENT):new ArrayBuffer(e*BigUint64Array.BYTES_PER_ELEMENT))};class Ts{static _mode="object";static _sharedMemory=!1;static _cobj={};static _parents=[];static _objArray=[];static _name="";static _length=0;static _objCount=0;static _inOject=!1;static _newTypedNode(e,t,s=0){return new Bs(e,t,s)}static _assign(e){"object"==this._mode||"json"==this._mode?Array.isArray(this._cobj)?this._cobj.push(e):this._cobj[this._name]=e:Array.isArray(this._cobj.value)?this._cobj.value.push(e):this._cobj.value[this._name]=e}static markFunctions={[ws.Name]:(e,t)=>{this._name="";const s=Number(Cs.n[As.QI.Uint8](e,t+1));for(let r=t+=2*As.bI.Uint8;r<t+s;r++)this._name+=String.fromCharCode(Cs.n[As.QI.Uint8](e,r));return t+s*As.bI.Uint8},[ws.Object]:(e,t)=>{let s;return s="object"==this._mode?{}:this._newTypedNode(ws.Object,{}),0!=this._objCount&&(this._assign(s),this._parents.push(this._cobj)),this._objCount++,this._cobj=s,As.bI.Uint8+t},[ws.ObjectEnd]:(e,t)=>(this._parents.length>0&&(this._cobj=this._parents.pop()),As.bI.Uint8+t),[ws.Array]:(e,t)=>{let s;return s="object"==this._mode?[]:this._newTypedNode(ws.Array,[]),0!=this._objCount&&(this._assign(s),this._parents.push(this._cobj)),this._objCount++,this._cobj=s,As.bI.Uint8+t},[ws.ArrayEnd]:(e,t)=>(this._parents.length>0&&(this._cobj=this._parents.pop()),As.bI.Uint8+t),[ws.Boolean]:(e,t)=>{const s=Cs.n[As.QI.Uint8](e,t+1);return"type-node"!=this._mode?this._assign(!s):this._assign(this._newTypedNode(ws.Boolean,!s)),As.bI.Uint8+As.bI.Int8+t},[ws.Undefined]:(e,t)=>("type-node"!=this._mode?this._assign(void 0):this._assign(this._newTypedNode(ws.Undefined,void 0)),As.bI.Uint8+t),[ws.Int8]:(e,t)=>{const s=Cs.n[As.QI.Int8](e,t+1);return"type-node"!=this._mode?this._assign(s):this._assign(this._newTypedNode(ws.Int8,s)),As.bI.Uint8+As.bI.Int8+t},[ws.Uint8]:(e,t)=>{const s=Cs.n[As.QI.Uint8](e,t+1);return"type-node"!=this._mode?this._assign(s):this._assign(this._newTypedNode(ws.Uint8,s)),As.bI.Uint8+As.bI.Uint8+t},[ws.Uint8Clamped]:(e,t)=>{const s=Cs.n[As.QI.Uint8](e,t+1);return"type-node"!=this._mode?this._assign(s):this._assign(this._newTypedNode(ws.Uint8,s)),As.bI.Uint8+As.bI.Uint8+t},[ws.Int16]:(e,t)=>{const s=Cs.n[As.QI.Int16](e,t+1);return"type-node"!=this._mode?this._assign(s):this._assign(this._newTypedNode(ws.Int16,s)),As.bI.Uint8+As.bI.Int16+t},[ws.Uint16]:(e,t)=>{const s=Cs.n[As.QI.Uint16](e,t+1);return"type-node"!=this._mode?this._assign(s):this._assign(this._newTypedNode(ws.Uint16,s)),As.bI.Uint8+As.bI.Uint16+t},[ws.Float32]:(e,t)=>{const s=Cs.n[As.QI.Float32](e,t+1);return"type-node"!=this._mode?this._assign(s):this._assign(this._newTypedNode(ws.Float32,s)),As.bI.Uint8+As.bI.Float32+t},[ws.Int32]:(e,t)=>{const s=Cs.n[As.QI.Int32](e,t+1);return"type-node"!=this._mode?this._assign(s):this._assign(this._newTypedNode(ws.Int32,s)),As.bI.Uint8+As.bI.Int32+t},[ws.Uint32]:(e,t)=>{const s=Cs.n[As.QI.Uint32](e,t+1);return"type-node"!=this._mode?this._assign(s):this._assign(this._newTypedNode(ws.Uint32,s)),As.bI.Uint8+As.bI.Uint8+As.bI.Uint32+t+1},[ws.Float64]:(e,t)=>{const s=Cs.n[As.QI.Float64](e,t+1);return"type-node"!=this._mode?this._assign(s):this._assign(this._newTypedNode(ws.Float64,s)),As.bI.Uint8+As.bI.Float64+t},[ws.BigInt]:(e,t)=>{const s=Cs.n[As.QI.BigInt](e,t+1);return"type-node"!=this._mode?this._assign(s):this._assign(this._newTypedNode(ws.BigInt,s)),As.bI.Uint8+As.bI.BigInt+t},[ws.BigUint]:(e,t)=>{const s=Cs.n[As.QI.BigUint](e,t+1);return"type-node"!=this._mode?this._assign(s):this._assign(this._newTypedNode(ws.BigUint,s)),As.bI.Uint8+As.bI.BigUint+t},[ws.String]:(e,t)=>{const s=Cs.n[As.QI.Uint32](e,t+1);let r="";for(let i=t+=As.bI.Uint32+As.bI.Uint8;i<t+s;i++)r+=String.fromCharCode(Cs.n[As.QI.Uint8](e,i));return"type-node"!=this._mode?this._assign(r):this._assign(this._newTypedNode(ws.String,r)),t+s*As.bI.Uint8},[ws.TypedArray]:(e,t)=>{const s=Cs.n[As.QI.Uint8](e,t+1);if(void 0===s)throw new Error(`Not a valid type for a typed array ${s}`);const r=Cs.n[As.QI.Uint32](e,t+2);let i;t+=2*As.bI.Uint8+As.bI.Uint32,i="json"==this._mode?[]:_s[s](r,this._sharedMemory);const a=Cs.n[s];for(let o=0;o<r;o++)i[o]=a(e,t),t+=As.Yd[s];return"type-node"!=this._mode?this._assign(i):this._assign(this._newTypedNode(ws.TypedArray,i,s)),t},[ws.Blob]:(e,t)=>("type-node"!=this._mode?this._assign(Blob):this._assign(this._newTypedNode(ws.Blob,void 0)),As.bI.Uint8+t),[ws.ArrayBuffer]:(e,t)=>{const s=Cs.n[As.QI.Uint32](e,t+1);t+=As.bI.Uint8+As.bI.Uint32;const r=new Uint8Array(this._sharedMemory?new SharedArrayBuffer(s):new ArrayBuffer(s));for(let i=0;i<s;i++)r[i]=Cs.n[As.QI.Uint8](e,t),t+=As.QI.Uint8;return"type-node"!=this._mode?this._assign(r.buffer):this._assign(this._newTypedNode(ws.ArrayBuffer,r.buffer)),t},[ws.Json]:(e,t)=>{const s=Cs.n[As.QI.Uint32](e,t+1);let r="";for(let i=t+=As.bI.Float32+As.bI.Uint8;i<t+s;i++)r+=String.fromCharCode(Cs.n[As.QI.Uint8](e,i));const i=JSON.parse(r);return"type-node"!=this._mode?this._assign(i):this._assign(this._newTypedNode(ws.Json,i)),t+s*As.bI.Uint8}};static setUseSharedMemory(e){this._sharedMemory=e}static toObject(e,t=0,s=0){let r;this._mode="object",r=0==s?e.byteLength:s;const i=new DataView(e);this._objCount=0;let a=t,o=ws.Object;for(;a<r;)o=Cs.n[As.QI.Uint8](i,a),a=this.markFunctions[o](i,a);return this._cobj}static toJSON(e,t=0,s=0){let r;this._mode="json",r=0==s?e.byteLength:s;const i=new DataView(e);this._objCount=0;let a=t,o=ws.Object;for(;a<r;)o=Cs.n[As.QI.Uint8](i,a),a=this.markFunctions[o](i,a);return this._cobj}static toTypedNodes(e,t=0,s=0){let r;this._mode="type-node",r=0==s?e.byteLength:s,this._mode="object";const i=new DataView(e);this._objCount=0;let a=t,o=ws.Object;for(;a<r;)o=Cs.n[As.QI.Uint8](i,a),a=this.markFunctions[o](i,a);return this._cobj}}As.QI.Int8,Int8Array,As.QI.Uint8,Uint8Array,As.QI.Uint8Clamped,Uint8ClampedArray,As.QI.Int16,Int16Array,As.QI.Uint16,Uint16Array,As.QI.Float32,Float32Array,As.QI.Int32,Int32Array,As.QI.Uint32,Uint32Array,As.QI.Float64,Float64Array,As.QI.BigInt,BigInt64Array,As.QI.BigUint,BigUint64Array;const Vs=new Map([[Int8Array,As.QI.Int8],[Uint8Array,As.QI.Uint8],[Uint8ClampedArray,As.QI.Uint8Clamped],[Int16Array,As.QI.Int16],[Uint16Array,As.QI.Uint16],[Int32Array,As.QI.Int32],[Uint32Array,As.QI.Uint32],[Float32Array,As.QI.Float32],[Float64Array,As.QI.Float64],[BigInt64Array,As.QI.BigInt],[BigUint64Array,As.QI.BigUint]]);var zs,Ms=s(25075);class Ds{static view=new DataView(new ArrayBuffer(8));static count=0;static value=0;static setValue(e,t){return this.value=t,Ms.v[e](this.view,0,t),this.count=As.Yd[e],this}static addBytes(e){for(let t=0;t<this.count;t++)e.push(this.view.getUint8(t))}}class Ns{static _proto=[];static _tokenizeString(e){for(let t=0;t<e.length;t++)this._addToken(As.QI.Uint8,e.charCodeAt(t))}static _traverseObj(e){this._addMarker(ws.Object);for(const t of Object.keys(e.value)){if(t.length>255)throw new Error("An object key cannot be longer then 255 chars.");this._addMarker(ws.Name),this._addToken(As.QI.Uint8,t.length),this._tokenizeString(t);const s=e.value[t];s.marker!=ws.Object||ArrayBuffer.isView(s.value)?s.marker!=ws.Array||ArrayBuffer.isView(s.value)?this._tokenizePrimiives(s):this._traverseArray(s):this._traverseObj(s)}this._addMarker(ws.ObjectEnd)}static _traverseArray(e){this._addMarker(ws.Array);const t=e.value;for(const e of t)"object"!=typeof e.value||Array.isArray(e.value)||ArrayBuffer.isView(e.value)?"object"!=typeof e.value||!Array.isArray(e.value)||ArrayBuffer.isView(e.value)?this._tokenizePrimiives(e):this._traverseArray(e):this._traverseObj(e);this._addMarker(ws.ArrayEnd)}static _tokenizePrimiives(e){if(e.marker!=ws.String){if("number"==typeof e.value)return this._addMarker(e.marker),void this._addToken(e.numberType,e.value);if("boolean"==typeof e.value)return this._addMarker(e.marker),void this._addToken(As.QI.Uint8,e.value?0:1);if(void 0!==e.value)if(e.marker!=ws.ArrayBuffer){if(e.marker==ws.TypedArray){this._addMarker(ws.TypedArray),this._addToken(As.QI.Uint8,e.listType),this._addToken(As.QI.Uint32,e.value.length);let t=e.value;for(let s=0;s<t.length;s++)this._addToken(e.listType,t[s])}if(e.marker!=ws.Json);else{let t="";t="object"==typeof e.value?JSON.stringify(e.value):e.value,this._addMarker(ws.Json),this._addToken(As.QI.Uint32,t.length);for(let e=0;e<t.length;e++)this._addToken(As.QI.Uint8,t.charCodeAt(e))}}else{this._addMarker(ws.ArrayBuffer);const t=new Uint8Array(e.value);this._addToken(As.QI.Uint32,t.length);for(let e=0;e<t.length;e++)this._addToken(As.QI.Uint8,t[e])}else this._addMarker(ws.Undefined)}else{this._addMarker(ws.String),this._addToken(As.QI.Uint32,e.value.length);for(let t=0;t<e.value.length;t++)this._addToken(As.QI.Uint8,e.value.charCodeAt(t))}}static _tokenize(e){e.marker!=ws.Object||Array.isArray(e.value)||this._traverseObj(e),e.marker==ws.Array&&Array.isArray(e.value)&&this._traverseArray(e)}static toBuffer(e){this._tokenize(e);const t=Uint8Array.from(this._proto);return this._proto=[],t.buffer}static _addMarker(e){Ds.setValue(As.QI.Uint8,e).addBytes(this._proto)}static _addToken(e,t){Ds.setValue(e,t).addBytes(this._proto)}}class ks{static _name="";static _traverseObj(e){const t=Is.object({});for(const s of Object.keys(e)){const r=e[s];this._name=s,r instanceof Bs?t.value[s]=r:ArrayBuffer.isView(r)||r instanceof ArrayBuffer||r instanceof SharedArrayBuffer?t.value[s]=this._addPrimitive(r):r instanceof Blob||"undefined"!=typeof File&&r instanceof File||("object"!=typeof r||Array.isArray(r)?"object"==typeof r&&Array.isArray(r)?t.value[s]=this._traverseArray(r):t.value[s]=this._addPrimitive(r):t.value[s]=this._traverseObj(r))}return t}static _traverseArray(e){const t=Is.array([]);for(const s of e)s instanceof Bs?t.value.push(s):ArrayBuffer.isView(s)?t.value.push(this._addPrimitive(s)):"object"!=typeof s||Array.isArray(s)?"object"!=typeof s||!Array.isArray(s)||ArrayBuffer.isView(s)?t.value.push(this._addPrimitive(s)):t.value.push(this._traverseArray(s)):t.value.push(this._traverseObj(s));return t}static _addPrimitive(e){if("string"==typeof e)return Is.string(e);if("number"==typeof e)return Is.float64(e);if("boolean"==typeof e)return Is.boolean(e);if(void 0===e)return Is.undefined();if(e instanceof ArrayBuffer||e instanceof SharedArrayBuffer)return Is.arrayBuffer(e);if(ArrayBuffer.isView(e)&&Vs.has(e.constructor))return Is.typedArray(Vs.get(e.constructor),e);if(e instanceof Bs)return e;throw new Error("Unsuppourted type for DBO parser.")}static tokTypedNodes(e){if("object"==typeof e&&!Array.isArray(e)){const t=Is.object({});return t.value=this._traverseObj(e).value,t}if("object"==typeof e&&Array.isArray(e)){const t=Is.array([]);return t.value=this._traverseArray(e).value,t}return this._addPrimitive(e)}static toBuffer(e){const t=this.tokTypedNodes(e);return Ns.toBuffer(t)}}class Ls{static nodes=Is;static setUseSharedMemory(e){Ts.setUseSharedMemory(e)}static bufferToObject(e,t=0,s=0){return Ts.toObject(e,t,s)}static objectToBuffer(e){return ks.toBuffer(e)}static objectToTypedNodes(e){return ks.tokTypedNodes(e)}static typedNodeToBuffer(e){return Ns.toBuffer(e)}static bufferToTypedNodes(e,t=0,s=0){return Ts.toTypedNodes(e,t,s)}}function Fs(e){if(!n._.sectors.get(e[0],e[1],e[2],e[3]))throw new Error(`Sector at location ${e.toString()} does not exist`);const t=fs({location:e}),s=[];t.palettes.secondaryValue&&s.push(t.palettes.secondaryValue.buffer);for(const e of t.sections)"string"!=typeof e&&(ArrayBuffer.isView(e.buffers.id?.buffer)&&s.push(e.buffers.id.buffer),ArrayBuffer.isView(e.buffers.state?.buffer)&&s.push(e.buffers.state.buffer),ArrayBuffer.isView(e.buffers.mod?.buffer)&&s.push(e.buffers.mod.buffer),ArrayBuffer.isView(e.buffers.state?.buffer)&&s.push(e.buffers.state.buffer),ArrayBuffer.isView(e.buffers.light?.sun?.buffer)&&s.push((e.buffers.light?.sun).buffer),ArrayBuffer.isView(e.buffers.light?.red?.buffer)&&s.push((e.buffers.light?.red).buffer),ArrayBuffer.isView(e.buffers.light?.green?.buffer)&&s.push((e.buffers.light?.green).buffer),ArrayBuffer.isView(e.buffers.light?.blue?.buffer)&&s.push((e.buffers.light?.blue).buffer),ArrayBuffer.isView(e.buffers.secondary?.buffer)&&s.push(e.buffers.secondary.buffer),e.palettes&&(e.palettes.id&&s.push(e.palettes.id.buffer),e.palettes.secondaryValue&&s.push(e.palettes.secondaryValue.buffer),e.palettes.secondaryId&&s.push(e.palettes.secondaryId.buffer)));return[t,s]}async function Rs(e={}){const t=new i.c;i.c.environment=o.O.isNode()?"node":"browser";let s="render";"node"==i.c.environment&&(s="server"),await a.QK.init("constructor",self,s);let c=!1;var u,g;return(0,r.A)({onSync(e){!function(e,t){nt.register(e),Ze.registerCustomNode("liquid",Lt),Ze.setGeometryPalette(t.geometryPalette),Ze.registerGeometry(t.geometry),Ze.registerModels(t.models);for(const e of t.voxels)Ze.registerVoxel(new Qt(e.id,nt.meshersMap.get(e.materialId),Ze.modelData.get(e.modelId),e))}(e.voxels.materials.palette,e.voxels.models),c=!0}}),a.QK.registerTask("clear-all",(()=>{n._.clearAll()})),await new Promise((e=>{const t=()=>{if(c)return e(!0);setTimeout(t,10)};t()})),g={worldThread:t.threads.world},a.QK.registerTask("archive-sector",(async e=>Fs(e))),a.QK.registerTask("archive-sector-binary",(async e=>{const[t]=Fs(e);try{const e=await async function(e){return await new Response(new Blob([Ls.objectToBuffer(e)]).stream().pipeThrough(new CompressionStream("gzip"))).arrayBuffer()}(t);return[e,[e]]}catch(e){console.log(t),console.error(e)}return[null,[]]})),a.QK.registerTask("import-sector",(async e=>{const t=bs(e);await g.worldThread.runTaskAsync("load-sector",[e.location,t])})),a.QK.registerTask("import-sector-binary",(async([e,t])=>{const s=bs(await async function(e,t=!1){const s=await new Response(new Blob([e]).stream().pipeThrough(new DecompressionStream("gzip"))).arrayBuffer();Ls.setUseSharedMemory(t);const r=Ls.bufferToObject(s);return Ls.setUseSharedMemory(!1),r}(t,!0));await g.worldThread.runTaskAsync("load-sector",[e,s])})),a.QK.registerTask(At.U.SyncDimension,(e=>{n._.dimensions.add(e.index,e.id)})),a.QK.registerTask(At.U.UnSyncDimension,(e=>{})),a.QK.registerTask(At.U.SyncSector,(e=>{n._.sectors.add(e[0][0],e[0][1],e[0][2],e[0][3],e[1])})),a.QK.registerTask(At.U.UnSyncSector,(e=>{n._.sectors.remove(e[0],e[1],e[2],e[3])})),a.QK.registerTask(l.z.Propagation,(async e=>{const t=new d.$;t.setOrigin(e),function(e){if(!v.i.doLight)return!1;const t=n._.sectors.get(e.origin[0],e.origin[1],e.origin[2],e.origin[3]);if(!t)return console.error(`Tried running world rgb on a sector that does not exist ${e.origin.toString()}`),!1;let s=h.k.section.bounds.x+t.position[0],r=h.k.section.bounds.z+t.position[2];for(let i=0;i<t.sections.length;i++){const a=t.sections[i];if(!a)continue;O.setSection(a);let[o,n]=a.getMinMax();const l=t.position[0],d=t.position[1]+i*h.k.section.bounds.y,c=t.position[2];if(Math.abs(o)!=1/0||Math.abs(n)!=1/0)for(let t=d+o;t<=d+n;t++)for(let i=l;i<s;i++)for(let s=c;s<r;s++){const r=O.getVoxel(i,t,s);r&&!r.isAir()&&r.isLightSource()&&e.rgb.update.push(i,t,s)}}(0,m.D)(e)}(t)})),a.QK.registerTask(l.z.Explosion,(async e=>{const t=e[0],s=h.k.sector.getPosition(t[1],t[2],t[3]),r=new d.$;r.setOrigin([t[0],s.x,s.y,s.z]),G.runExplosion(r,e[1])})),a.QK.registerTask(l.z.WorldSun,(e=>{const t=h.k.sector.getPosition(e[1],e[2],e[3]),s=new d.$;s.setOrigin([e[0],t.x,t.y,t.z]),function(e){const[,t,s,r]=e.origin,i=N.getRelative(e.origin),a=N.getAbsolute(e.origin),o=t+h.k.sector.bounds.x,n=s+h.k.sector.bounds.y,l=r+h.k.sector.bounds.z,d=e.nDataCursor.getSector(e.origin[1],e.origin[2],e.origin[3]);if(!d)return void console.warn("Could not load sector when running world sun at ",e.origin.toString());const c=a-1<0?0:a,u=d.getSection(t,c,r).getPosition()[1]+h.k.section.bounds.y;for(let e=c;e<u;e++)for(let s=t;s<o;s++)for(let t=r;t<l;t++){const r=d.getVoxel(s,e,t);if(!r)continue;const i=r.getLight();i<0||r.setLight(U.setS(15,i))}for(let e=u;e<n;e+=h.k.section.bounds.y){const s=d.getSection(t,e,r),i=s.light.length;for(let e=0;e<i;e++)s.light[e]=U.setS(15,s.light[e])}const g=a==i?i+1:i;let f=R.length;for(let s=c;s<=g;s++)for(let i=t;i<o;i++)for(let t=r;t<l;t++){const r=d.getVoxel(i,s,t)?.getLight();if(!(r&&r<0&&15!=U.getS(r)))for(let r=0;r<y.LE.length;r++){const a=y.LE[r],o=i+a[0],n=s+a[1],l=t+a[2],d=e.nDataCursor.getVoxel(o,n,l);if(!d)continue;const h=d.getLight();if(h>-1&&U.getS(h)<15){R[f++]=i,R[f++]=s,R[f++]=t;break}}}for(;R.length;){const t=R.shift(),s=R.shift(),r=R.shift(),i=e.sDataCursor.getVoxel(t,s,r)?.getLight();if(!i||i<0)continue;for(let a=0;a<5;a++){const o=t+F[a][0],n=s+F[a][1],l=r+F[a][2],d=e.nDataCursor.getVoxel(o,n,l);if(d){const e=d.getLight();e>-1&&(0,L.j4)(e,i)&&(R.push(o,n,l),d.setLight((0,L.ig)(i,e)))}}const a=e.nDataCursor.getVoxel(t,s-1,r);if(a){const e=a.getLight();e>-1&&(0,L.jg)(e,i)&&(a.isAir()?(R.push(t,s-1,r),a.setLight((0,L.Kl)(i,e))):a.isOpaque()||(R.push(t,s-1,r),a.setLight((0,L.ig)(i,e))))}}}(s)})),u=t.threads.parent,a.QK.registerTask(l.z.BuildSection,(e=>{const t=[],s=xt(e,t);s&&u.runTask("set-section",s,t)})),a.QK.registerTask(l.z.BuildSector,((e,t)=>{const s=n._.sectors.getAt(e);if(s)for(let r=0;r<s.sections.length;r++){const i=s.sections[r];let[a,o]=i.getMinMax();if(Math.abs(a)==1/0&&Math.abs(o)==1/0)continue;const n=performance.now(),l=[],d=xt([e[0],...i.getPosition()],l);if(!d)continue;u.runTask("set-section",d,l);const h=performance.now()-n;t.runTask("add-build-time",h),console.log("BUILD TIME",h)}else console.warn("Tried building a sector that does not exists.",e)})),function(){const e=new d.$;a.QK.registerTask(l.z.LogicUpdate,(async(t,s)=>{!function(e,t){e.setOrigin(t);const s=n._.sectors.getAt(t);if(!s)return console.warn(`Could not run logic update sector at ${t} does not exist`),!1;const r=s.getSection(t[1],t[2],t[3]);if(!r)return console.warn(`Could not run logic update sector at ${t}.  Section does not exist`),!1;const[i,a]=r.getLogicMinMax(),[o,l,d]=r.position,c=h.k.section.bounds.x*h.k.section.bounds.z,u=i*c,g=(a+1)*c;x.setSection(r);for(let t=u;t<g;t++){if(!(t%c)){const e=t/c;if(!r.isLogicSliceDirty(e)){t+=c-1;continue}}if(!r.ids[t]||!r.getVoxelLogicDirty(t))continue;const s=x.getVoxelAtIndex(t),i=o+x._voxelPosition.x,a=l+x._voxelPosition.y,n=d+x._voxelPosition.z,h=f.U.voxels[r.ids[t]];if(h&&h.hasTag(p.x.isLightSource))if(h.getTagValue(p.x.isLightSource,s))e.rgb.update.push(i,a,n);else for(const t of y.LE){const s=t[0]+i,r=t[1]+a,o=t[2]+n,l=e.nDataCursor.getVoxel(s,r,o);l&&l.hasRGBLight()&&e.rgb.remove.push(s,r,o)}}(0,m.Q)(e),(0,m.D)(e),r.logicDirtyMap.fill(0),r.logicDirty.fill(0),r.setLogicDirty(!1),r.setLogicUpdateInProgress(!1),e.bounds.markSectionsAsDirty()}(e,t)}))}(),D({onDone(e,t){e.bounds.markSectionsAsDirty()}}),a.QK.registerTask(l.z.Generate,(e=>new Promise((t=>wt.J.generate(e,"generate",t))))),a.QK.registerTask(l.z.Decorate,(e=>new Promise((t=>wt.J.generate(e,"decorate",t))))),t}s(35112),function(e){e[e.Boolean=0]="Boolean",e[e.TypedNumber=1]="TypedNumber",e[e.TypedNumberArray=2]="TypedNumberArray",e[e.BitArray=3]="BitArray",e[e.Vector2=4]="Vector2",e[e.Vector3=5]="Vector3",e[e.Vector4=6]="Vector4"}(zs||(zs={})),s(23891),As.bI.Uint32,As.bI.Uint8},38e3:(e,t,s)=>{s.d(t,{LE:()=>a,vY:()=>i});const r=[],i=[[0,0],[1,0],[0,1],[1,1],[-1,0],[0,-1],[-1,-1],[1,-1],[-1,1]],a=[[0,1,0],[0,-1,0],[1,0,0],[-1,0,0],[0,0,-1],[0,0,1]];for(let e=-1;e<2;e++)for(const t of i)r.push([t[0],e,t[1]])},99196:(e,t,s)=>{s.d(t,{Hp:()=>u,Hx:()=>f,IH:()=>w,In:()=>g,Kl:()=>v,QT:()=>A,We:()=>m,Zk:()=>S,ig:()=>b,j4:()=>y,jg:()=>x,pq:()=>p,tr:()=>B});let r=2;function i(e){return 15&e}function a(e){return(240&e)>>4}function o(e){return(3840&e)>>8}function n(e){return(61440&e)>>12}function l(e,t){return-16&t|e}function d(e,t){return-241&t|e<<4}function h(e,t){return-3841&t|e<<8}function c(e,t){return-61441&t|e<<12}function u(e,t){let s=a(e),r=o(e),i=n(e),l=a(t),d=o(t),h=n(t);return s<l||r<d||i<h}function g(e,t){let s=a(e)+2,r=o(e)+2,i=n(e)+2,l=a(t),d=o(t),h=n(t);return s<=l||r<=d||i<=h}function f(e,t){let s=a(e),r=o(e),i=n(e),l=a(t),d=o(t),h=n(t);return s>=l||r>=d||i>=h}function p(e,t){let s=i(t),r=a(e)-1;r<0&&(r=0);let u=a(t);r<u&&(r=u);let g=o(e)-1;g<0&&(g=0);let f=o(t);g<f&&(g=f);let p=n(e)-1;p<0&&(p=0);let m=n(t);p<m&&(p=m);let y=0;return y=l(s,y),y=d(r,y),y=h(g,y),y=c(p,y),y}function m(e){let t=i(e),s=0;return s=d(0,s),s=h(0,s),s=c(0,s),s=l(t,s),s}function y(e,t){let s=i(e),a=i(t);return s+r<a}function x(e,t){let s=i(e),a=i(t);return 15==a?s<a:s+r<a}function v(e,t){let s=i(e),u=i(t);15==s&&(u=s),s<15&&(u=s-r);let g=a(t),f=o(t),p=n(t),m=0;return m=l(u,m),m=d(g,m),m=h(f,m),m=c(p,m),m}function b(e,t){let s=i(e)-r;s<0&&(s=0);let u=i(t);s<u&&(s=u);let g=a(t),f=o(t),p=n(t),m=0;return m=l(s,m),m=d(g,m),m=h(f,m),m=c(p,m),m}function w(e,t){return i(e)<i(t)}function A(e,t){return i(e)>=i(t)}function S(e,t){let s=i(t);return 15==s||i(e)<s}function B(e){return l(0,e)}},10008:(e,t,s)=>{s.d(t,{D:()=>a,Q:()=>o});var r=s(38e3),i=s(99196);function a(e){const t=e.rgb.update;for(;t.length;){const s=t.shift(),a=t.shift(),o=t.shift(),n=e.sDataCursor.getVoxel(s,a,o);if(!n)continue;const l=n.getLight();if(!(l<=0)){for(let n=0;n<6;n++){const d=r.LE[n][0]+s,h=r.LE[n][1]+a,c=r.LE[n][2]+o;if(!e.nDataCursor.inBounds(d,h,c))continue;const u=e.nDataCursor.getVoxel(d,h,c);if(!u)continue;const g=u.getLight();g>-1&&(0,i.In)(g,l)&&(t.push(d,h,c),u.setLight((0,i.pq)(l,g)))}e.bounds.update(s,a,o)}}}function o(e){const t=e.rgb.remove,s=e.rgb.update,a=e.rgb.removeMap,o=e.sun.updateMap;for(;t.length;){const n=t.shift(),l=t.shift(),d=t.shift();if(a.has(n,l,d))continue;a.add(n,l,d);const h=e.sDataCursor.getVoxel(n,l,d);if(!h)continue;const c=h.getLight();if(!(c<=0)){for(let a=0;a<6;a++){const h=r.LE[a][0]+n,u=r.LE[a][1]+l,g=r.LE[a][2]+d;if(!e.nDataCursor.inBounds(h,u,g))continue;const f=e.nDataCursor.getVoxel(h,u,g);if(!f)continue;const p=f.getLight(),m=f.hasRGBLight();m&&(0,i.Hp)(p,c)?(t.push(h,u,g),f.isLightSource()&&s.push(h,u,g)):m&&(0,i.Hx)(p,c)&&!o.has(h,u,g)&&(o.add(h,u,g),s.push(h,u,g))}e.bounds.update(n,l,d),h.setLight((0,i.We)(c))}}a.clear()}},91437:(e,t,s)=>{s.d(t,{a:()=>a,z:()=>o});var r=s(99196);const i=[[1,0,0],[-1,0,0],[0,0,1],[0,0,-1],[0,1,0]];function a(e){const t=e.sun.update;for(;t.length;){const s=t.shift(),a=t.shift(),o=t.shift(),n=e.sDataCursor.getVoxel(s,a,o);if(!n)continue;const l=n.getLight();if(!(l<=0)){for(let n=0;n<5;n++){const d=i[n][0]+s,h=i[n][1]+a,c=i[n][2]+o;if(!e.nDataCursor.inBounds(d,h,c))continue;const u=e.nDataCursor.getVoxel(d,h,c);if(u){const e=u.getLight();e>-1&&(0,r.j4)(e,l)&&(t.push(d,h,c),u.setLight((0,r.ig)(l,e)))}}if(e.nDataCursor.inBounds(s,a-1,o)){const i=e.nDataCursor.getVoxel(s,a-1,o);if(i){const e=i.getLight();e>-1&&(0,r.jg)(e,l)&&(i.isAir()?(t.push(s,a-1,o),i.setLight((0,r.Kl)(l,e))):i.isOpaque()||(t.push(s,a-1,o),i.setLight((0,r.ig)(l,e))))}}e.bounds.update(s,a,o)}}}function o(e,t=!0){const s=e.sun.remove,a=e.sun.update,o=e.sun.removeMap,n=e.sun.updateMap;for(;s.length;){const t=s.shift(),l=s.shift(),d=s.shift();if(o.has(t,l,d))continue;o.add(t,l,d);const h=e.sDataCursor.getVoxel(t,l,d);if(!h)continue;const c=h.getLight();if(!(c<=0)){for(let o=0;o<5;o++){const h=i[o][0]+t,u=i[o][1]+l,g=i[o][2]+d;if(!e.nDataCursor.inBounds(h,u,g))continue;const f=e.nDataCursor.getVoxel(h,u,g);if(f){const e=f.getLight();e>0&&((0,r.IH)(e,c)?s.push(h,u,g):(0,r.QT)(e,c)&&!n.has(h,u,g)&&(n.add(h,u,g),a.push(h,u,g)))}}if(e.nDataCursor.inBounds(t,l-1,d)){const i=e.nDataCursor.getVoxel(t,l-1,d);if(i){const e=i.getLight();e>0&&((0,r.Zk)(e,c)?s.push(t,l-1,d):(0,r.QT)(e,c)&&!n.has(t,l-1,d)&&(n.add(t,l-1,d),a.push(t,l-1,d)))}}e.bounds.update(t,l,d),h.setLight((0,r.tr)(c))}}o.clear()}},29981:(e,t,s)=>{s.d(t,{$:()=>u});var r=s(48860),i=s(99673),a=s(62312),o=s(75438);class n{_map=[];get size(){return this._map.length}origin=i.Az.Create();start(e,t,s){this._map.length=0,this.origin.x=e,this.origin.y=t,this.origin.z=s}has(e,t,s){return void 0!==this._map[i.Az.HashXYZ(e-this.origin.x,t-this.origin.y,s-this.origin.z)]}add(e,t,s){this._map[i.Az.HashXYZ(e-this.origin.x,t-this.origin.y,s-this.origin.z)]=!0}delete(e,t,s){this._map[i.Az.HashXYZ(e-this.origin.x,t-this.origin.y,s-this.origin.z)]=void 0}clear(){this._map.length=0}}const l=i.Az.Create(-1/0,-1/0,-1/0),d=i.Az.Create(1/0,1/0,1/0),h=i.Az.Create();class c{_task;min=i.Az.Clone(d);max=i.Az.Clone(l);dimension=0;constructor(e){this._task=e}start(e){this.dimension=e||0,i.Az.Copy(this.min,d),i.Az.Copy(this.max,l)}update(e,t,s){e<this.min.x&&(this.min.x=e),t<this.min.y&&(this.min.y=t),s<this.min.z&&(this.min.z=s),e>this.max.x&&(this.max.x=e),t>this.max.y&&(this.max.y=t),s>this.max.z&&(this.max.z=s)}getSections(){const e=a.k.section.getPosition(this.min.x-1,this.min.y-1,this.min.z-1,h),t=e.x,s=e.y,r=e.z,i=a.k.section.getPosition(this.max.x+1,this.max.y+1,this.max.z+1,h),o=i.x,n=i.y,l=i.z,d=[];for(let e=t;e<=o;e+=a.k.section.bounds.x)for(let t=s;t<=n;t+=a.k.section.bounds.y)for(let s=r;s<=l;s+=a.k.section.bounds.z)this._task.nDataCursor.inBounds(e,t,s)&&d.push([e,t,s]);return d}markSectionsAsDirty(){const e=a.k.section.getPosition(this.min.x-1,this.min.y-1,this.min.z-1,h),t=e.x,s=e.y,r=e.z,i=a.k.section.getPosition(this.max.x+1,this.max.y+1,this.max.z+1,h),n=i.x,l=i.y,d=i.z;for(let e=t;e<=n;e+=a.k.section.bounds.x)for(let t=r;t<=d;t+=a.k.section.bounds.z)for(let r=s;r<=l;r+=a.k.section.bounds.y){if(!a.k.world.inBounds(e,r,t))continue;const s=o._.sectors.get(this.dimension,e,r,t);s&&s.getSection(e,r,t).setDisplayDirty(!0)}}}class u{flow=new g;rgb=new f;sun=new f;power=new p;bounds=new c(this);sDataCursor=new r.p;nDataCursor=new r.p;origin;setOrigin(e){this.sDataCursor.setFocalPoint(...e),this.nDataCursor.setFocalPoint(...e),this.origin=e,this.rgb.removeMap.start(e[1],e[2],e[3]),this.sun.removeMap.start(e[1],e[2],e[3]),this.rgb.updateMap.start(e[1],e[2],e[3]),this.sun.updateMap.start(e[1],e[2],e[3]),this.flow.update.map.start(e[1],e[2],e[3]),this.flow.remove.map.start(e[1],e[2],e[3]),this.flow.remove.noRemoveMap.start(e[1],e[2],e[3]),this.bounds.start(e[0]),this.clear()}clear(){this.rgb.clear(),this.sun.clear(),this.flow.clear()}}class g{update={queue:[],map:new n};remove={queue:[],map:new n,noRemoveMap:new n};clear(){this.update.queue.length=0,this.update.map.clear(),this.remove.queue.length=0,this.remove.map.clear(),this.remove.noRemoveMap.clear()}}class f{update=[];remove=[];removeMap=new n;updateMap=new n;clear(){this.update.length=0,this.remove.length=0,this.removeMap.clear(),this.updateMap.clear()}}class p{update=[];remove=[];removeMap=new n;updateMap=new n;clear(){this.update.length=0,this.remove.length=0,this.removeMap.clear(),this.updateMap.clear()}}},66454:(e,t,s)=>{s.d(t,{T:()=>u});var r=s(56417),i=s(83651),a=s(50327),o=s(20650),n=s(6694),l=s(29981),d=s(10008),h=s(91437);const c=new a.$;class u extends i.l{constructor(){super(),o.J._brushes.push(this)}requestsId;tasks=new l.$;start(e,t,s,r){return this.dataCursor.setFocalPoint(e,t,s,r),this.tasks.setOrigin([e,t,s,r]),this.dimension=e,this.x=t,this.y=s,this.z=r,this}paint(){let e=this.dataCursor.getVoxel(this.x,this.y,this.z);if(!e){if(""!=this.requestsId)return r.o.addToRequest(this.requestsId,[this.dimension,this.x,this.y,this.z],this.voxelCursor.getRaw()),this;throw new Error(`Tried painting in an unloaded location ${[this.dimension,this.x,this.y,this.z].toString()}`)}const t=e.getLight();return(t>0||!e.isAir())&&(this._erase(),e.setLight(t<0?0:t),c.hasRGBLight(t)&&(this.tasks.rgb.remove.push(this.x,this.y,this.z),(0,d.Q)(this.tasks)),c.hasSunLight(t)&&(this.tasks.sun.remove.push(this.x,this.y,this.z),(0,h.z)(this.tasks))),this._paint(),this.tasks.bounds.update(this.x,this.y,this.z),this}getUpdatedSections(){const e=this.tasks.bounds.getSections();return this.tasks.bounds.start(),e}update(){let e=this.dataCursor.getVoxel(this.x,this.y,this.z);if(!e)return!1;const t=e.getLight();e.updateVoxel(2),c.hasRGBLight(t)&&this.tasks.rgb.update.push(this.x,this.y,this.z),c.hasSunLight(t)&&this.tasks.sun.update.push(this.x,this.y,this.z),this.tasks.bounds.update(this.x,this.y,this.z)}erase(){let e=this.dataCursor.getVoxel(this.x,this.y,this.z);if(!e)return this;const t=e.getLight();return this._erase(),e=this.dataCursor.getVoxel(this.x,this.y,this.z),e.setLight(t>0?t:0),c.hasRGBLight(t)&&(this.tasks.rgb.remove.push(this.x,this.y,this.z),(0,d.Q)(this.tasks)),c.hasSunLight(t)&&(this.tasks.sun.remove.push(this.x,this.y,this.z),(0,h.z)(this.tasks)),this.tasks.bounds.update(this.x,this.y,this.z),this}runUpdates(){(0,d.D)(this.tasks),(0,h.a)(this.tasks),this.tasks.rgb.removeMap.clear(),this.tasks.sun.removeMap.clear()}worldAlloc(e,t){return n.c.instance.threads.world.runTaskAsync("world-alloc",[this.dimension,e,t])}worldDealloc(e,t){return n.c.instance.threads.world.runTaskAsync("world-dealloc",[this.dimension,e,t])}}},56417:(e,t,s)=>{s.d(t,{o:()=>l});var r=s(62312),i=s(83651),a=s(6694),o=s(75438);const n=new i.l;n.voxelCursor;class l{static MAX_ATTEMPTS=100;static _requests=new Map;static registerRequest(e){const t=e.toString();return this._requests.set(t,{attempts:0,sections:new Map,dimension:e[0],voxels:[]}),t}static addToRequest(e,t,s){if(t[2]<r.k.world.bounds.MinY||t[2]>=r.k.world.bounds.MaxY)return!1;const i=this._requests.get(e);if(!i)return;if(!o._.sectors.get(t[0],t[1],t[2],t[3])){const e=r.k.sector.getPosition(t[1],t[2],t[3]),s=r.k.hash.hashVec3(e);i.sections.has(s)||(a.c.instance.threads.world.runTask("add-sector",[i.dimension,e.x,e.y,e.z]),i.sections.set(s,[e.x,e.y,e.z]))}const[n,l,d,h]=t;i.voxels.push([l,d,h,s])}static attemptRequestFullFill(e){const t=this._requests.get(e);if(!t||!t.voxels.length)return!0;let s=!0;for(const[e,i]of t.sections)r.k.world.inBounds(i[0],i[1],i[2])&&(o._.sectors.get(t.dimension,i[0],i[1],i[2])||(s=!1,a.c.instance.threads.world.runTask("add-sector",[t.dimension,i[0],i[1],i[2]])));return s?(n.stop(),this._requests.delete(e),!0):(t.attempts++,t.attempts>=this.MAX_ATTEMPTS&&(console.error("World gen requests cancled after max attempts",t),this._requests.delete(e),!0))}}},20650:(e,t,s)=>{s.d(t,{J:()=>a});var r=s(56417),i=s(66454);class a{static worldGen=null;static register=r.o;static _brushes=[];static setWorldGen(e){this.worldGen=e}static async generate(e,t,s){if(!this.worldGen)throw new Error("A World Generator must be set.");const i=r.o.registerRequest(e[0]);for(const e of this._brushes)e.requestsId=i;if("generate"==t&&await this.worldGen.generate(e),"decorate"==t&&await this.worldGen.decorate(e),r.o.attemptRequestFullFill(i))s();else{const e=()=>{r.o.attemptRequestFullFill(i)?s():setTimeout(e,10)};e()}}static getBrush(){return new i.T}}},85212:(e,t,s)=>{s.d(t,{A8:()=>n,JU:()=>a,Tv:()=>i,pL:()=>l,rW:()=>d,wu:()=>o});var r=s(29105);function i(e,t){const s=Math.floor(t/8),i=t%8;return(0,r.x3)(e[s],i,1)}function a(e,t,s){const i=Math.floor(t/8),a=t%8;e[i]=(0,r.Lm)(e[i],a,1&s,1)}function o(e,t){return(0,r.x3)(e[t/2|0],t%2==0?4:0,4)}function n(e,t,s){const i=t/2|0;e[i]=(0,r.Lm)(e[i],t%2==0?4:0,s,4)}function l(e,t){return(0,r.x3)(e[t/4|0],t%4*2,2)}function d(e,t,s){const i=t/4|0;e[i]=(0,r.Lm)(e[i],t%4*2,s,2)}},15741:(e,t,s)=>{s.d(t,{h:()=>r});class r{_count=0;_palette=[];_map={};get size(){return this._count}constructor(e){if(e){let t=e.length;for(let s=0;s<t;s++)this.register(e[s])}}register(e){const t=this._count;return this._palette[t]=e,this._map[e]=t,this._count++,t}get(){return this._palette}getMap(){return this._map}isRegistered(e){return void 0!==this._map[e]}getId(e){return this._map[e]}getValue(e){return this._palette[e]}}},48860:(e,t,s)=>{s.d(t,{p:()=>l});var r=s(99673),i=s(69224),a=s(62312);let o=[];const n=r.Az.Create();class l{sectorCursors={};origin=r.Az.Create();dimension=0;_lastPosition=r.Az.Create();setFocalPoint(e,t,s,r){const i=a.k.sector.getPosition(t,s,r,n);for(const e in this.sectorCursors)for(const t in this.sectorCursors[e]){const s=this.sectorCursors[e][t];s&&(o.push(s),this.sectorCursors[e][t]=null)}this.dimension=e,this.origin.x=i.x/a.k.sector.bounds.x,this.origin.y=i.y/a.k.sector.bounds.y,this.origin.z=i.z/a.k.sector.bounds.z,this.getSector(t,s,r)}inBounds(e,t,s){return a.k.world.inBounds(e,t,s)}getSector(e,t,s){if(!this.inBounds(e,t,s))return null;const r=a.k.sector.getPosition(e,t,s,n),l=r.x/a.k.sector.bounds.x-this.origin.x,d=r.z/a.k.sector.bounds.z-this.origin.z;let h=this.sectorCursors[l]?.[d];if(!h){if(h=o.length?o.shift():new i.j,!h.setSector(this.dimension,r.x,r.y,r.z))return o.push(h),null;this.sectorCursors[l]||(this.sectorCursors[l]??={}),this.sectorCursors[l][d]=h}return h}getVoxel(e,t,s){const r=this.getSector(e,t,s);return r?r.getVoxel(e,t,s):null}}}},n={};function l(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return o[e].call(s.exports,s,s.exports,l),s.exports}l.m=o,l.x=()=>{var e=l.O(void 0,[289,147,433],(()=>l(78872)));return l.O(e)},e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",s="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",r=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},l.a=(i,a,o)=>{var n;o&&((n=[]).d=-1);var l,d,h,c=new Set,u=i.exports,g=new Promise(((e,t)=>{h=t,d=e}));g[t]=u,g[e]=e=>(n&&e(n),c.forEach(e),g.catch((e=>{}))),i.exports=g,a((i=>{var a;l=(i=>i.map((i=>{if(null!==i&&"object"==typeof i){if(i[e])return i;if(i.then){var a=[];a.d=0,i.then((e=>{o[t]=e,r(a)}),(e=>{o[s]=e,r(a)}));var o={};return o[e]=e=>e(a),o}}var n={};return n[e]=e=>{},n[t]=i,n})))(i);var o=()=>l.map((e=>{if(e[s])throw e[s];return e[t]})),d=new Promise((t=>{(a=()=>t(o)).r=0;var s=e=>e!==n&&!c.has(e)&&(c.add(e),e&&!e.d&&(a.r++,e.push(a)));l.map((t=>t[e](s)))}));return a.r?d:o()}),(e=>(e?h(g[s]=e):d(u),r(n)))),n&&n.d<0&&(n.d=0)},i=[],l.O=(e,t,s,r)=>{if(!t){var a=1/0;for(h=0;h<i.length;h++){for(var[t,s,r]=i[h],o=!0,n=0;n<t.length;n++)(!1&r||a>=r)&&Object.keys(l.O).every((e=>l.O[e](t[n])))?t.splice(n--,1):(o=!1,r<a&&(a=r));if(o){i.splice(h--,1);var d=s();void 0!==d&&(e=d)}}return e}r=r||0;for(var h=i.length;h>0&&i[h-1][2]>r;h--)i[h]=i[h-1];i[h]=[t,s,r]},l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var s in t)l.o(t,s)&&!l.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((t,s)=>(l.f[s](e,t),t)),[])),l.u=e=>e+".bundle.js",l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.p="/",(()=>{var e={873:1};l.f.i=(t,s)=>{e[t]||importScripts(l.p+l.u(t))};var t=self.webpackChunkdivinecraft=self.webpackChunkdivinecraft||[],s=t.push.bind(t);t.push=t=>{var[r,i,a]=t;for(var o in i)l.o(i,o)&&(l.m[o]=i[o]);for(a&&a(l);r.length;)e[r.pop()]=1;s(t)}})(),a=l.x,l.x=()=>Promise.all([289,147,433].map(l.e,l)).then(a),l.x()})();